"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[80],{99636:(_,Q,e)=>{e.d(Q,{b:()=>x});var a=e(39953),v=e(23997),c=e(55356);class x{constructor(A){this._subject=new v.x,this._state=A}useState(){return w(this)}get state(){return this._state}setState(A){this._state={...this._state,...A},this._subject.next(this._state)}subscribeToState(A){return this._subject.subscribe(A)}}function w(o){const A=(0,c.N)();return(0,a.useEffect)(()=>{const f=o.subscribeToState({next:A});return()=>f.unsubscribe()},[o,A]),o.state}},8507:(_,Q,e)=>{e.d(Q,{W:()=>Re});var a=e(96083),v=e(13601),c=e(74502),x=e(97433),w=e(41407),o=e(39953),A=e(53721),f=e(15750),O=e(82803),E=e(64447),S=e(13253),i=e(4919),P=e(16924),L=e(82618),y=e(62679),C=e(86276),J=e(88121);const B=o.memo(({dashboard:h})=>{const{actions:s=[],isEditing:p,viewPanelKey:I,isDirty:W,uid:z}=h.useState(),j=(s??[]).map(G=>o.createElement(G.Component,{key:G.state.key,model:G}));return z&&(j.push(o.createElement(C.u,{key:"share-dashboard-button",tooltip:(0,y.t)("dashboard.toolbar.share","Share dashboard"),icon:"share-alt",iconSize:"lg",onClick:()=>{h.showModal(new J.V({dashboardRef:h.getRef()}))}})),j.push(o.createElement(C.u,{key:"view-in-old-dashboard-button",tooltip:"View as dashboard",icon:"apps",onClick:()=>v.E1.push(`/d/${z}`)}))),j.push(o.createElement(L.M,{leftActionsSeparator:!0,key:"separator"})),I?(j.push(o.createElement(i.zx,{onClick:()=>v.E1.partial({viewPanel:null}),tooltip:"",key:"back",variant:"primary",fill:"text"},"Back to dashboard")),o.createElement(P.A,{actions:j})):(p?(j.push(o.createElement(i.zx,{onClick:h.onSave,tooltip:"Save as copy",fill:"text",key:"save-as"},"Save as")),j.push(o.createElement(i.zx,{onClick:h.onDiscard,tooltip:"Save changes",fill:"text",key:"discard",variant:"destructive"},"Discard")),j.push(o.createElement(i.zx,{onClick:h.onSave,tooltip:"Save changes",key:"save",disabled:!W},"Save"))):j.push(o.createElement(i.zx,{onClick:h.onEnterEditMode,tooltip:"Enter edit mode",key:"edit",variant:"primary",icon:"pen",fill:"text"},"Edit")),o.createElement(P.A,{actions:j}))});B.displayName="NavToolbarActions";function D({model:h}){const{controls:s,viewPanelKey:p,overlay:I}=h.useState(),W=(0,O.wW)(m),z=(0,A.TH)(),j=h.getPageNav(z),G=h.getBodyToRender(p);return o.createElement(S.T,{navId:"scenes",pageNav:j,layout:f.Q.Custom},o.createElement(E.$,{autoHeightMin:"100%"},o.createElement("div",{className:W.canvasContent},o.createElement(B,{dashboard:h}),s&&o.createElement("div",{className:W.controls},s.map(xe=>o.createElement(xe.Component,{key:xe.state.key,model:xe})),o.createElement(c.iu,{scene:h,key:"scene-debugger"})),o.createElement("div",{className:W.body},o.createElement(G.Component,{model:G})))),I&&o.createElement(I.Component,{model:I}))}function m(h){return{canvasContent:(0,w.css)({label:"canvas-content",display:"flex",flexDirection:"column",padding:h.spacing(0,2),flexBasis:"100%",flexGrow:1}),body:(0,w.css)({label:"body",flexGrow:1,display:"flex",gap:"8px",marginBottom:h.spacing(2)}),controls:(0,w.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:h.spacing(1),position:"sticky",top:0,background:h.colors.background.canvas,zIndex:1,padding:h.spacing(2,0)})}}var T=e(87722),r=e(94112),R=e(14768),n=e(56950);class V extends c.wx{constructor(){super(...arguments),this.onClose=()=>{this.state.dashboardRef.resolve().setState({overlay:void 0})}}}V.Component=({model:h})=>{const s=h.state.dashboardRef.resolve(),p=s.getInitialState(),I=new Re(p),W=(0,n.EU)(I),z=(0,n.EU)(s),j=(0,R.Q$)(W,z);return o.createElement(T.d,{title:"Save dashboard",subtitle:s.state.title,onClose:h.onClose},o.createElement(r._,{diff:j,oldValue:W,newValue:z}))};var F=e(31544),K=e(91395),Z=e(40793),U=e(48069),ee=e(77014),N=e(88939);class k{constructor(s){this._scene=s,this.events=new K.F,this._subs=new F.w0;const p=c.ep.getTimeRange(s);this._subs.add(p.subscribeToState((I,W)=>{I.value!==W.value&&this.events.publish(new ee.md(I.value))}))}get id(){return this._scene.state.id??null}get uid(){return this._scene.state.uid??null}get title(){return this._scene.state.title}get meta(){return this._scene.state.meta}get time(){const s=c.ep.getTimeRange(this._scene);return{from:s.state.from,to:s.state.to}}get annotations(){return console.error("Scenes DashboardModelCompatibilityWrapper.annotations not implemented (yet)"),{list:[]}}getTimezone(){return c.ep.getTimeRange(this._scene).getTimeZone()}sharedTooltipModeEnabled(){return this._getSyncMode()>0}sharedCrosshairModeOnly(){return this._getSyncMode()===1}_getSyncMode(){if(this._scene.state.$behaviors){for(const s of this._scene.state.$behaviors)if(s instanceof c.U1.Y)return s.state.sync}return Z.m.Off}otherPanelInFullscreen(s){return!1}formatDate(s,p){return(0,U.dq)(s,{format:p,timeZone:this.getTimezone()})}getPanelById(s){const p=(0,N.ds)(this._scene,(0,N.Rv)(s));return p?new X(p):null}removePanel(s){console.error("Scenes DashboardModelCompatibilityWrapper.removePanel not implemented (yet)")}canEditAnnotations(s){return!1}panelInitialized(){}destroy(){this.events.removeAllListeners(),this._subs.unsubscribe()}}class X{constructor(s){this._vizPanel=s}get type(){return this._vizPanel.state.pluginId}get title(){return this._vizPanel.state.title}get transformations(){return this._vizPanel.state.$data instanceof c.bM?this._vizPanel.state.$data.state.transformations:[]}refresh(){console.error("Scenes PanelCompatibilityWrapper.refresh no implemented (yet)")}render(){console.error("Scenes PanelCompatibilityWrapper.render no implemented (yet)")}getQueryRunner(){console.error("Scenes PanelCompatibilityWrapper.getQueryRunner no implemented (yet)")}}var re=e(71519),de=e(28833),ue=e(57837),ie=e(22784),he=e(77804),fe=e(33155),ve=e(97470),le=e(82247),me=e(10694),te=e(31954),ye=e(66155);class ce extends c.wx{constructor(s){super({...s,options:{withTransforms:!0,withFieldConfig:!0}}),this.onOptionsChange=p=>{this.setState({options:p})}}getTabLabel(){return(0,y.t)("dashboard.inspect.data-tab","Data")}getTabValue(){return te.q.Data}}ce.Component=({model:h})=>{const{options:s}=h.useState(),p=h.state.panelRef.resolve(),I=c.ep.getData(p),{data:W}=ge(I,s.withTransforms).useState(),z=c.ep.getTimeRange(p);return o.createElement(ye.E,{isLoading:W?.state===me.Gu.Loading,data:W?.series,options:s,hasTransformations:pe(I),timeZone:z.getTimeZone(),panelPluginId:p.state.pluginId,dataName:p.state.title,fieldConfig:p.state.fieldConfig,onOptionsChange:h.onOptionsChange})};function pe(h){return h instanceof c.bM?h.state.transformations.length>0:!1}function ge(h,s){return s&&h instanceof c.bM?h.state.$data:h}var t=e(86832),g=e(19977),d=e(28888),l=e(96227),u=e(9558),b=e(84541),M=e(45013),H=e(75397),$=e(2952),Y=e(99664),q=e(14741),ae=e(52274),ne=e(24119);class se extends c.wx{constructor(s){super({...s,source:"panel-json",jsonText:oe("panel-json",s.panelRef.resolve())}),this.onChangeSource=p=>{this.setState({source:p.value,jsonText:oe(p.value,this.state.panelRef.resolve())})},this.onApplyChange=()=>{const p=this.state.panelRef.resolve(),I=(0,N.Pm)(p),W=JSON.parse(this.state.jsonText),z=new H.r(W),j=(0,ne.Ee)(z),G=c.vp.cloneSceneObjectState(j.state);if(!(p.parent instanceof c.bO)||!(j instanceof c.bO)){console.error("Cannot update state of panel",p,j);return}this.state.onClose(),I.state.isEditing||I.onEnterEditMode(),p.parent.setState(G),(0,q.Nw)(te.q.JSON,"apply",{panel_type_changed:p.state.pluginId!==z.type,panel_id_changed:(0,N.Jb)(p)!==z.id,panel_grid_pos_changed:Ee(p.parent.state,G),panel_targets_changed:Ce((0,N.R)(p),(0,N.R)(G.$data))})},this.onCodeEditorBlur=p=>{this.setState({jsonText:p})}}getTabLabel(){return(0,y.t)("dashboard.inspect.json-tab","JSON")}getTabValue(){return te.q.JSON}getOptions(){const p=this.state.panelRef.resolve().state.$data,I=[{label:(0,y.t)("dashboard.inspect-json.panel-json-label","Panel JSON"),description:(0,y.t)("dashboard.inspect-json.panel-json-description","The model saved in the dashboard JSON that configures how everything works."),value:"panel-json"}];return p&&(I.push({label:(0,y.t)("dashboard.inspect-json.panel-data-label","Panel data"),description:(0,y.t)("dashboard.inspect-json.panel-data-description","The raw model passed to the panel visualization"),value:"panel-data"}),I.push({label:(0,y.t)("dashboard.inspect-json.dataframe-label","DataFrame JSON (from Query)"),description:(0,y.t)("dashboard.inspect-json.dataframe-description","Raw data without transformations and field config applied. "),value:"data-frames"})),I}isEditable(){if(this.state.source!=="panel-json")return!1;const s=this.state.panelRef.resolve();return s.parent instanceof c.bO?(0,N.Pm)(s).state.meta.canEdit:!1}}se.Component=({model:h})=>{const{source:s,jsonText:p}=h.useState(),I=(0,O.wW)($.i),W=h.getOptions();return o.createElement("div",{className:I.wrap},o.createElement("div",{className:I.toolbar,"aria-label":d.wl.components.PanelInspector.Json.content},o.createElement(l.g,{label:(0,y.t)("dashboard.inspect-json.select-source","Select source"),className:"flex-grow-1"},o.createElement(u.Ph,{inputId:"select-source-dropdown",options:W,value:W.find(z=>z.value===s)??W[0].value,onChange:h.onChangeSource})),h.isEditable()&&o.createElement(i.zx,{className:I.toolbarItem,onClick:h.onApplyChange},"Apply")),o.createElement("div",{className:I.content},o.createElement(g.Z,{disableWidth:!0},({height:z})=>o.createElement(b.p,{width:"100%",height:z,language:"json",showLineNumbers:!0,showMiniMap:p.length>100,value:p,readOnly:!h.isEditable(),onBlur:h.onCodeEditorBlur}))))};function oe(h,s){let p={};switch(h){case"panel-json":{(0,q.Nw)(te.q.JSON,"panelData"),(s.parent instanceof c.bO||s.parent instanceof ae.o)&&(p=(0,n.vi)(s.parent));break}case"panel-data":{(0,q.Nw)(te.q.JSON,"panelJSON");const I=c.ep.getData(s);I.state.data&&(p=s.applyFieldConfig(I.state.data));break}case"data-frames":{(0,q.Nw)(te.q.JSON,"dataFrame");const I=c.ep.getData(s);I.state.data&&(I instanceof c.bM&&I.state.$data?.state.data?p=(0,M.XJ)(I.state.$data.state.data):p=(0,M.XJ)(I.state.data))}}return(0,Y.w)(p)}function Ee(h,s){return h.x!==s.x||h.y!==s.y||h.width!==s.width||h.height!==s.height}function Ce(h,s){return h===void 0||s===void 0?!1:!(0,t.isEqual)(h.state.queries,s.state.queries)}class be extends c.wx{getTabLabel(){return(0,y.t)("dashboard.inspect.meta-tab","Meta data")}getTabValue(){return te.q.Meta}}be.Component=({model:h})=>{const{panelRef:s,dataSource:p}=h.state,I=c.ep.getData(s.resolve()),W=p.components?.MetadataInspector;return!I.state.data||!W?null:o.createElement(W,{datasource:p,data:I.state.data.series})};var De=e(69496);class Se extends c.wx{constructor(){super(...arguments),this.onRefreshQuery=()=>{const s=(0,N.R)(this.state.panelRef.resolve());s&&s.runQueries()}}getTabLabel(){return(0,y.t)("dashboard.inspect.query-tab","Query")}getTabValue(){return te.q.Query}}Se.Component=({model:h})=>{const s=c.ep.getData(h.state.panelRef.resolve()).useState();return s.data?o.createElement(De.D,{data:s.data,onRefreshQuery:h.onRefreshQuery}):null};var Te=e(68716);class Pe extends c.wx{getTabLabel(){return(0,y.t)("dashboard.inspect.stats-tab","Stats")}getTabValue(){return te.q.Stats}}Pe.Component=({model:h})=>{const s=c.ep.getData(h.state.panelRef.resolve()).useState(),p=c.ep.getTimeRange(h.state.panelRef.resolve());return s.data?o.createElement(Te.f,{data:s.data,timeZone:p.getTimeZone()}):null};class Me extends c.wx{constructor(s){super(s),this.onClose=()=>{v.E1.partial({inspect:null,inspectTab:null})},this.addActivationHandler(()=>this._activationHandler())}_activationHandler(){this.buildTabs(0)}async buildTabs(s){const p=this.state.panelRef,I=p.resolve(),W=I.getPlugin(),z=[];if(W||(s<2e3?setTimeout(()=>this.buildTabs(s+100),100):this.setState({pluginNotLoaded:!0})),(0,le.sY)(W)){const j=c.ep.getData(I);z.push(new ce({panelRef:p})),z.push(new Pe({panelRef:p})),z.push(new Se({panelRef:p}));const G=await(0,ve.L1)(j.state.data);G&&z.push(new be({panelRef:p,dataSource:G}))}z.push(new se({panelRef:p,onClose:this.onClose})),this.setState({tabs:z})}getDrawerTitle(){const s=this.state.panelRef.resolve();return c.ep.interpolate(s,`Inspect: ${s.state.title}`)}}Me.Component=Oe;function Oe({model:h}){const{tabs:s,pluginNotLoaded:p}=h.useState(),I=(0,A.TH)(),W=new URLSearchParams(I.search);if(!s)return null;const z=W.get("inspectTab"),j=s.find(G=>G.getTabValue()===z)??s[0];return o.createElement(T.d,{title:h.getDrawerTitle(),onClose:h.onClose,size:"md",tabs:o.createElement(ie.J,null,s.map(G=>o.createElement(he.O,{key:G.state.key,label:G.getTabLabel(),active:G===j,href:ue.u.getUrlForPartial(I,{inspectTab:G.getTabValue()})})))},p&&o.createElement(fe.b,{title:"Panel plugin not loaded"},"Make sure the panel you want to inspect is visible and has been displayed before opening inspect."),j&&j.Component&&o.createElement(j.Component,{model:j}))}var Ie=e(10780);class Ae{constructor(s){this._scene=s}getKeys(){return["inspect","viewPanel"]}getUrlState(){const s=this._scene.state;return{inspect:s.inspectPanelKey,viewPanel:s.viewPanelKey}}updateFromUrl(s){const{inspectPanelKey:p,viewPanelKey:I}=this._scene.state,W={};if(typeof s.inspect=="string"){const z=(0,N.ds)(this._scene,s.inspect);if(!z){de.Z.emit(re.SI.alertError,["Panel not found"]),v.E1.partial({inspect:null});return}W.inspectPanelKey=s.inspect,W.overlay=new Me({panelRef:z.getRef()})}else p&&(W.inspectPanelKey=void 0,W.overlay=void 0);if(typeof s.viewPanel=="string"){if(!(0,N.ds)(this._scene,s.viewPanel)){if(s.viewPanel.indexOf("clone")){this._handleViewRepeatClone(s.viewPanel);return}de.Z.emit(re.SI.alertError,["Panel not found"]),v.E1.partial({viewPanel:null});return}W.viewPanelKey=s.viewPanel}else I&&(W.viewPanelKey=void 0);Object.keys(W).length>0&&this._scene.setState(W)}_handleViewRepeatClone(s){this._eventSub||(this._eventSub=this._scene.subscribeToEvent(Ie.P,()=>{(0,N.ds)(this._scene,s)&&(this._eventSub?.unsubscribe(),this._scene.setState({viewPanelKey:s}))}))}}class Re extends c.wx{constructor(s){super({title:"Dashboard",meta:{},body:s.body??new c.QY({children:[]}),...s}),this._urlSync=new Ae(this),this.onEnterEditMode=()=>{this._initialState=c.vp.cloneSceneObjectState(this.state),this._initiallUrlState=v.E1.getSearchObject(),this.setState({isEditing:!0}),this.state.body instanceof c.Qh&&(this.state.body.setState({isDraggable:!0,isResizable:!0}),(0,N.pi)(this.state.body,!0)),this.startTrackingChanges()},this.onDiscard=()=>{this.stopTrackingChanges(),this.stopUrlSync(),v.E1.partial(this._initiallUrlState,!0),this.setState({...this._initialState,isEditing:!1}),this.startUrlSync(),this.state.body instanceof c.Qh&&(this.state.body.setState({isDraggable:!1,isResizable:!1}),(0,N.pi)(this.state.body,!0))},this.onSave=()=>{this.setState({overlay:new V({dashboardRef:this.getRef()})})},this.addActivationHandler(()=>this._activationHandler())}_activationHandler(){window.__grafanaSceneContext=this,this.state.isEditing&&this.startTrackingChanges();const s=new k(this);return(0,x.h4)().setCurrent(s),()=>{window.__grafanaSceneContext=void 0,this.stopTrackingChanges(),this.stopUrlSync(),s.destroy()}}startUrlSync(){(0,c.oo)().initSync(this)}stopUrlSync(){(0,c.oo)().cleanUp(this)}getPageNav(s){let p={text:this.state.title,url:(0,N.$9)({uid:this.state.uid,currentQueryParams:s.search,updateQuery:{viewPanel:null,inspect:null}})};return this.state.viewPanelKey&&(p={text:"View panel",parentItem:p}),p}getBodyToRender(s){return(0,N.ds)(this,s)??this.state.body}startTrackingChanges(){this._changeTrackerSub=this.subscribeToEvent(c.QI,s=>{s.payload.changedObject instanceof c.bO&&this.setIsDirty()})}setIsDirty(){this.state.isDirty||this.setState({isDirty:!0})}stopTrackingChanges(){this._changeTrackerSub?.unsubscribe()}getInitialState(){return this._initialState}showModal(s){this.setState({overlay:s})}closeModal(){this.setState({overlay:void 0})}enrichDataRequest(s){const p=(0,N.Qx)(s);return{app:a.zj.Dashboard,dashboardUID:this.state.uid,panelId:(p&&(0,N.Jb)(p))??0}}canEditDashboard(){return!!(this.state.meta.canEdit||this.state.meta.canMakeEditable)}}Re.Component=D},21642:(_,Q,e)=>{e.d(Q,{X:()=>o});var a=e(39953),v=e(74502),c=e(75397),x=e(64840),w=e(51811);class o extends v.wx{constructor({uid:O,title:E,key:S,name:i}){super({uid:O,title:E,key:S,name:i}),this._onActivate=()=>{this.loadLibraryPanelFromPanelModel()},this.addActivationHandler(this._onActivate)}async loadLibraryPanelFromPanelModel(){const{title:O}=this.state;let E=new v.Z({title:O});try{const S=await(0,x.Mh)(this.state.uid,!0),i=new c.r(S.model);E.setState({options:i.options??{},fieldConfig:i.fieldConfig,pluginVersion:i.pluginVersion,displayMode:i.transparent?"transparent":void 0,$data:(0,w.R)(i)})}catch{E.setState({_pluginLoadError:"Unable to load library panel: "+this.state.uid})}this.setState({panel:E})}}o.Component=A;function A({model:f}){const{panel:O}=f.useState();return O?a.createElement(O.Component,{model:O}):null}},52274:(_,Q,e)=>{e.d(Q,{o:()=>f});var a=e(41407),v=e(39953),c=e(32688),x=e(74502),w=e(74602),o=e(88939),A=e(10780);class f extends x.wx{constructor(i){super(i),this._variableDependency=new x.JY(this,{variableNames:[this.state.variableName],onVariableUpdatesCompleted:this._onVariableChanged.bind(this)}),this._isWaitingForVariables=!1,this.addActivationHandler(()=>this._activationHandler())}_activationHandler(){this._subs.add(this.subscribeToState((i,P)=>this._handleGridResize(i,P))),x.ep.hasVariableDependencyInLoadingState(this)?this._isWaitingForVariables=!0:this._performRepeat()}_onVariableChanged(i,P){if(P){this._performRepeat();return}this._isWaitingForVariables&&!x.ep.hasVariableDependencyInLoadingState(this)&&(this._isWaitingForVariables=!1,this._performRepeat())}_handleGridResize(i,P){const L=this.state.repeatedPanels?.length??1,y={};if(i.height!==P.height){if(this.getRepeatDirection()==="v"){const C=Math.ceil(i.height/L);y.itemHeight=C}else{const C=Math.ceil(L/this.getMaxPerRow());y.itemHeight=Math.ceil(i.height/C)}y.itemHeight!==this.state.itemHeight&&this.setState(y)}}_performRepeat(){const i=x.ep.lookupVariable(this.state.variableName,this);if(!i){console.error("SceneGridItemRepeater: Variable not found");return}if(!(i instanceof x.mW)){console.error("PanelRepeaterGridItem: Variable is not a MultiValueVariable");return}const P=this.state.source,{values:L,texts:y}=(0,o.CR)(i),C=[];for(let r=0;r<L.length;r++){const R=P.clone({$variables:new x.hT({variables:[new x.I2({name:i.state.name,value:L[r],text:String(y[r])})]}),key:`${P.state.key}-clone-${r}`});C.push(R)}const J=this.getRepeatDirection(),B={repeatedPanels:C},D=this.state.itemHeight??10,m=this.state.height,T=this.getMaxPerRow();if(J==="h"){const r=Math.ceil(C.length/T);B.height=r*D}else B.height=C.length*D;if(this.setState(B),m!==this.state.height){const r=x.ep.getLayout(this);r instanceof x.Qh&&r.forceRender()}this.publishEvent(new A.P({source:this}),!0)}getMaxPerRow(){return this.state.maxPerRow??4}getRepeatDirection(){return this.state.repeatDirection==="v"?"v":"h"}getClassName(){return"panel-repeater-grid-item"}}f.Component=({model:S})=>{const{repeatedPanels:i,itemHeight:P}=S.useState(),L=i?.length??0,y=O(S.getRepeatDirection(),L,S.getMaxPerRow(),P??10);return i?v.createElement("div",{className:y},i.map(C=>v.createElement("div",{className:E,key:C.state.key},v.createElement(C.Component,{model:C,key:C.state.key})))):null};function O(S,i,P,L){return(0,v.useMemo)(()=>{const y=c.config.theme2,C=L*w.K3*i+(i-1)*w.hD;if(S==="h"){const J=Math.ceil(i/P),B=Math.ceil(i/J);return(0,a.css)({display:"grid",height:"100%",width:"100%",gridTemplateColumns:`repeat(${B}, 1fr)`,gridTemplateRows:`repeat(${J}, 1fr)`,gridColumnGap:y.spacing(1),gridRowGap:y.spacing(1),[y.breakpoints.down("md")]:{display:"flex",flexDirection:"column",height:C}})}return(0,a.css)({display:"flex",height:"100%",width:"100%",flexDirection:"column",gap:y.spacing(1),[y.breakpoints.down("md")]:{height:C}})},[S,i,P,L])}const E=(0,a.css)({display:"flex",flexGrow:1,position:"relative"})},95409:(_,Q,e)=>{e.d(Q,{r:()=>i});var a=e(41407),v=e(39953),c=e(54554),x=e(81626),w=e(77877),o=e(74502),A=e(82803),f=e(69865),O=e(56064),E=e(4185),S=e(12190);class i extends o.qC{constructor(C={}){super({...C,from:"now-6h",to:"now",value:(0,c.JK)()})}ancestorTimeRangeChanged(C){const J=this.getTimeOverride(C.value);this.setState({value:J.timeRange,timeInfo:J.timeInfo})}getTimeOverride(C){const{timeFrom:J,timeShift:B}=this.state,D={timeInfo:"",timeRange:C};if(J){const m=o.ep.interpolate(this,this.state.timeFrom),T=x.describeTextRange(m);if(T.invalid)return D.timeInfo="invalid time override",D;x.isRelativeTimeRange(C.raw)&&(D.timeInfo=T.display,D.timeRange={from:w.parse(T.from),to:w.parse(T.to),raw:{from:T.from,to:T.to}})}if(B){const m=o.ep.interpolate(this,this.state.timeShift);if(x.describeTextRange(m).invalid)return D.timeInfo="invalid timeshift",D;const r="-"+m;D.timeInfo+=" timeshift "+r;const R=w.parseDateMath(r,D.timeRange.from,!1),n=w.parseDateMath(r,D.timeRange.to,!0);D.timeRange={from:R,to:n,raw:{from:R,to:n}}}return D}}i.Component=P;function P({model:y}){const{timeInfo:C,hideTimeOverride:J}=y.useState(),B=(0,A.wW)(L);return!C||J?null:v.createElement(f.u,{content:v.createElement(O.IF,{timeRange:y.state.value,timeZone:y.getTimeZone()})},v.createElement(E.fm.TitleItem,{className:B.timeshift},v.createElement(S.J,{name:"clock-nine",size:"sm"})," ",C))}const L=y=>({timeshift:(0,a.css)({color:y.colors.text.link,gap:y.spacing(.5)})})},58086:(_,Q,e)=>{e.d(Q,{a:()=>x});var a=e(74502),v=e(88939),c=e(10780);class x extends a.wx{constructor(E){super(E),this._variableDependency=new a.JY(this,{variableNames:[this.state.variableName],onVariableUpdatesCompleted:this._onVariableChanged.bind(this)}),this._isWaitingForVariables=!1,this.addActivationHandler(()=>this._activationHandler())}_activationHandler(){a.ep.hasVariableDependencyInLoadingState(this)?this._isWaitingForVariables=!0:this._performRepeat()}_onVariableChanged(E,S){if(S){this._performRepeat();return}this._isWaitingForVariables&&!a.ep.hasVariableDependencyInLoadingState(this)&&(this._isWaitingForVariables=!1,this._performRepeat())}_performRepeat(){const E=a.ep.lookupVariable(this.state.variableName,this.parent?.parent);if(!E){console.error("RepeatedRowBehavior: Variable not found");return}if(!(E instanceof a.mW)){console.error("RepeatedRowBehavior: Variable is not a MultiValueVariable");return}if(!(this.parent instanceof a.I_)){console.error("RepeatedRowBehavior: Parent is not a SceneGridRow");return}const S=a.ep.getLayout(this);if(!(S instanceof a.Qh)){console.error("RepeatedRowBehavior: Layout is not a SceneGridLayout");return}const i=this.parent,{values:P,texts:L}=(0,v.CR)(E),y=[],C=w(this.state.sources);let J=0;for(let B=0;B<P.length;B++){const D=[];for(const T of this.state.sources){const R=(T.state.y??0)+(C+1)*B,n=T.clone({key:`${T.state.key}-clone-${B}`,y:R});f(n,B),D.push(n),J<R+n.state.height&&(J=R+n.state.height)}const m=this.getRowClone(i,B,P[B],L[B],C,D);y.push(m)}o(S,y,J,i),this.publishEvent(new c.P({source:this}),!0)}getRowClone(E,S,i,P,L,y){if(S===0)return E.setState({$variables:new a.hT({variables:[new a.I2({name:this.state.variableName,value:i,text:String(P)})]}),children:y}),E;const C=E.state.y??0;return E.clone({key:`${E.state.key}-clone-${S}`,$variables:new a.hT({variables:[new a.I2({name:this.state.variableName,value:i,text:String(P)})]}),$behaviors:[],children:y,y:C+L*S+S})}}function w(O){let E=0,S=Number.MAX_VALUE;for(const i of O)i.state.y+i.state.height>E&&(E=i.state.y+i.state.height),i.state.y<S&&(S=i.state.y);return E-S}function o(O,E,S,i){const P=A(O,i),L=P.indexOf(i);if(L===-1)throw new Error("RowRepeaterBehavior: Parent row not found in layout children");const y=[...P.slice(0,L),...E,...P.slice(L+1)];if(P.length>L+1){const C=P.slice(L+1),J=C[0].state.y,B=S-J;for(const D of C)D.state.y<S&&D.setState({y:D.state.y+B})}O.setState({children:y})}function A(O,E){return O.state.children.filter(S=>!S.state.key?.startsWith(`${E.state.key}-clone-`))}function f(O,E){O.forEachChild(S=>{S.setState({key:`${S.state.key}-row-${E}`}),f(S,E)})}},69662:(_,Q,e)=>{e.d(Q,{K:()=>o});var a=e(56989),v=e(10694),c=e(54554),x=e(74502),w=e(88939);class o extends x.wx{constructor(O){super(O),this._results=new a.t,this.addActivationHandler(()=>(this._subscribeToSource(),()=>{this._querySub&&this._querySub.unsubscribe(),this._sourceDataDeactivationHandler&&this._sourceDataDeactivationHandler()}))}getResultsStream(){return this._results}_subscribeToSource(){const{query:O}=this.state;if(this._querySub&&this._querySub.unsubscribe(),!O.panelId)return;const E=(0,w.Rv)(O.panelId),S=A(this.getRoot(),P=>P.state.key===E);if(!S){console.log("Shared dashboard query refers to a panel that does not exist in the scene");return}let i=S.state.$data;if(!i){console.log("No source data found for shared dashboard query");return}if(this._sourceDataDeactivationHandler=i.activate(),i instanceof x.bM&&!O.withTransforms){if(!i.state.$data)throw new Error("No source inner query runner found in data transformer");i=i.state.$data}this._querySub=i.subscribeToState(P=>{this._results.next({origin:this,data:P.data||{state:v.Gu.Done,series:[],timeRange:(0,c.JK)()}}),this.setState({data:P.data})}),this.setState({data:i.state.data})}}function A(f,O){if(O(f))return f;let E=null;return f.forEachChild(S=>{let i=A(S,O);i&&(E=i)}),E}},10780:(_,Q,e)=>{e.d(Q,{P:()=>v});var a=e(45276);class v extends a.R{}v.type="dashboard-repeats-processed"},24119:(_,Q,e)=>{e.d(Q,{Ee:()=>le,Yz:()=>he,Td:()=>de});var a=e(74502),v=e(75397),c=e(54554),x=e(33975),w=e(30976),o=e(32688),A=e(50383);class f extends a.o6.y{async resolveDataSource(g){return o.config.publicDashboardAccessToken?new A.k:super.resolveDataSource(g)}processEvents(g,d){if(o.config.publicDashboardAccessToken){const l={series:[],timeRange:(0,c.JK)(),state:d.state},u=(0,x.P)(d.events);return u.meta={...u.meta,dataTopic:w.w5.Annotations},l.annotations=[u],l}else return super.processEvents(g,d)}}var O=e(8507),E=e(21642),S=e(57837),i=e(13601),P=e(72639),L=e(21308),y=e(62679),C=e(44951),J=e(31954),B=e(88121),D=e(88939);function m(t){(async()=>{const d=t.parent,l=i.E1.getLocation(),u=[],b=(0,D.Jb)(d),M=d.getRoot(),H=d.getPlugin(),$=(0,D.R)(d);if(M instanceof O.W&&(u.push({text:(0,y.t)("panel.header-menu.view","View"),iconClassName:"eye",shortcut:"v",onClick:()=>(0,P.ff)("dashboards_panelheader_menu",{item:"view"}),href:S.u.getUrlForPartial(l,{viewPanel:d.state.key})}),u.push({text:(0,y.t)("panel.header-menu.edit","Edit"),iconClassName:"eye",shortcut:"v",onClick:()=>(0,P.ff)("dashboards_panelheader_menu",{item:"edit"}),href:(0,D.$9)({uid:M.state.uid,subPath:`/panel-edit/${b}`,currentQueryParams:l.search})}),u.push({text:(0,y.t)("panel.header-menu.share","Share"),iconClassName:"share-alt",onClick:()=>{(0,P.ff)("dashboards_panelheader_menu",{item:"share"}),M.showModal(new B.V({panelRef:d.getRef(),dashboardRef:M.getRef()}))},shortcut:"p s"})),L.Vt.hasAccessToExplore()&&!H?.meta.skipDataQuery&&$){const Y=a.ep.getTimeRange(d);u.push({text:(0,y.t)("panel.header-menu.explore","Explore"),iconClassName:"compass",shortcut:"p x",onClick:()=>(0,P.ff)("dashboards_panelheader_menu",{item:"explore"}),href:await(0,C.H6)({queries:$.state.queries,dsRef:$.state.datasource,timeRange:Y.state.value,scopedVars:{__sceneObject:{value:d}}})})}u.push({text:(0,y.t)("panel.header-menu.inspect","Inspect"),iconClassName:"info-circle",shortcut:"i",onClick:()=>(0,P.ff)("dashboards_panelheader_menu",{item:"inspect",tab:J.q.Data}),href:S.u.getUrlForPartial(l,{inspect:d.state.key})}),t.setState({items:u})})()}var T=e(52274),r=e(95409),R=e(58086),n=e(96083),V=e(36316),F=e(7376);function K(t,g){g.app=n.zj.Dashboard,g.canAddAnnotations=()=>{const d=(0,D.Pm)(t);return!Z(d)||!d.canEditDashboard()?!1:!!d.state.meta.annotationsPermissions?.dashboard.canAdd},g.canEditAnnotations=d=>{const l=(0,D.Pm)(t);return l.canEditDashboard()?d?!!l.state.meta.annotationsPermissions?.dashboard.canEdit:!!l.state.meta.annotationsPermissions?.organization.canEdit:!1},g.canDeleteAnnotations=d=>{const l=(0,D.Pm)(t);return l.canEditDashboard()?d?!!l.state.meta.annotationsPermissions?.dashboard.canDelete:!!l.state.meta.annotationsPermissions?.organization.canDelete:!1},g.onAnnotationCreate=async d=>{const l=(0,D.Pm)(t),u=d.from!==d.to,b={dashboardUID:l.state.uid,panelId:(0,D.Jb)(t),isRegion:u,time:d.from,timeEnd:u?d.to:0,tags:d.tags,text:d.description};await(0,F.xD)(b),U(l),g.eventBus.publish(new V.n1(b))},g.onAnnotationUpdate=async d=>{const l=(0,D.Pm)(t),u=d.from!==d.to,b={id:d.id,dashboardUID:l.state.uid,panelId:(0,D.Jb)(t),isRegion:u,time:d.from,timeEnd:u?d.to:0,tags:d.tags,text:d.description};await(0,F._E)(b),U(l),g.eventBus.publish(new V.n1(b))},g.onAnnotationDelete=async d=>{await(0,F.Dl)({id:d}),U((0,D.Pm)(t)),g.eventBus.publish(new V.n1({id:d}))},g.onAddAdHocFilter=d=>{const l=(0,D.Pm)(t),u=(0,D.R)(t);if(!u)return;const b=ee(l,u.state.datasource);N(b,d)},g.onUpdateData=d=>Promise.resolve(!0)}function Z(t){if(t.state.$data instanceof a.mv){for(const g of t.state.$data.state.layers)if(g instanceof a.o6.y&&g.state.isEnabled&&g.state.query.builtIn)return g}}function U(t){const g=Z(t);g&&g.runLayer()}function ee(t,g){const d=t.state.controls??[];for(const u of d)if(u instanceof a.zo&&(u.state.datasource===g||u.state.datasource?.uid===g?.uid))return u;const l=new a.zo({datasource:g});return t.setState({controls:[d[0],l,...d.slice(1)]}),l}function N(t,g){for(const d of t.state.filters)if(d.key===g.key){t.setState({filters:t.state.filters.map(l=>l.key===g.key?g:l)});return}t.setState({filters:[...t.state.filters,g]})}var k=e(51811),X=e(6947);function re(t){return function(d,l){if(l.angularPanelCtrl){d.options={angularOptions:t.getOptionsToRemember()};return}if(t.autoMigrateFrom){const u=X.G7[t.autoMigrateFrom]!=null,b=t.getOptionsToRemember(),M=t.autoMigrateFrom;if(l.onPanelTypeChanged){const H=u?{angular:b}:b.options;Object.assign(d.options,l.onPanelTypeChanged(d,M,H,d.fieldConfig))}}}}function de(t){const g=new v.f(t.dashboard,t.meta,{autoMigrateOldPanels:!1});return he(g)}function ue(t){const g=[];let d=null,l=[];for(const u of t)if(u.type==="row")d?d.id!==u.id&&(g.push(ie(d,l)),d=u,l=[]):u.collapsed?g.push(ie(u,[])):d=u;else if(u.libraryPanel?.uid&&!("model"in u.libraryPanel)){const b=ve(u);b&&g.push(b)}else{const b=le(u);d?l.push(b):g.push(b)}return d&&g.push(ie(d,l)),g}function ie(t,g){t.collapsed&&t.panels&&(g=t.panels.map(le));let d,l=g;return t.repeat&&(l=[],d=[new R.a({variableName:t.repeat,sources:g})]),new a.I_({key:(0,D.Rv)(t.id),title:t.title,y:t.gridPos.y,isCollapsed:t.collapsed,children:l,$behaviors:d})}function he(t){let g,d=[],l=[];if(t.templating?.list?.length){const b=t.templating.list.map(M=>{try{return ge(M)?(l.push(new a.zo({name:M.name,datasource:M.datasource,filters:M.filters??[],baseFilters:M.baseFilters??[]})),null):fe(M)}catch(H){return console.error(H),null}}).filter(M=>!!M);g=new a.hT({variables:b})}t.annotations?.list?.length&&(d=t.annotations?.list.map(b=>new f({query:b,name:b.name,isEnabled:!!b.enable,isHidden:!!b.hide})));const u=[new a.dn({}),...l,new a.wJ,new a.o$,new a.n7({}),new a.vf({refresh:t.refresh,intervals:t.timepicker.refresh_intervals})];return new O.W({title:t.title,uid:t.uid,id:t.id,meta:t.meta,body:new a.Qh({isLazy:!0,children:ue(t.panels)}),$timeRange:new a.gg({from:t.time.from,to:t.time.to,fiscalYearStartMonth:t.fiscalYearStartMonth,timeZone:t.timezone,weekStart:t.weekStart}),$variables:g,$behaviors:[new a.U1.Y({sync:t.graphTooltip})],$data:d.length>0?new a.mv({layers:d}):void 0,controls:u})}function fe(t){const g={name:t.name,label:t.label};if(me(t))return new a.eO({...g,value:t.current.value,text:t.current.text,description:t.description,query:t.query,isMulti:t.multi,allValue:t.allValue||void 0,includeAll:t.includeAll,defaultToAll:!!t.includeAll,skipUrlSync:t.skipUrlSync,hide:t.hide});if(te(t))return new a.$1({...g,value:t.current.value,text:t.current.text,description:t.description,query:t.query,datasource:t.datasource,sort:t.sort,refresh:t.refresh,regex:t.regex,allValue:t.allValue||void 0,includeAll:t.includeAll,defaultToAll:!!t.includeAll,isMulti:t.multi,skipUrlSync:t.skipUrlSync,hide:t.hide});if(ye(t))return new a.l3({...g,value:t.current.value,text:t.current.text,description:t.description,regex:t.regex,pluginId:t.query,allValue:t.allValue||void 0,includeAll:t.includeAll,defaultToAll:!!t.includeAll,skipUrlSync:t.skipUrlSync,isMulti:t.multi,hide:t.hide});if(pe(t)){const d=(0,D._B)(t),l=(0,D._n)(t,d);return new a.TC({...g,value:l,description:t.description,intervals:d,autoEnabled:t.auto,autoStepCount:t.auto_count,autoMinInterval:t.auto_min,refresh:t.refresh,skipUrlSync:t.skipUrlSync,hide:t.hide})}else{if(ce(t))return new a.M6({...g,description:t.description,value:t.query,skipUrlSync:t.skipUrlSync,hide:t.hide});throw new Error(`Scenes: Unsupported variable type ${t.type}`)}}function ve(t){return t.libraryPanel?new a.bO({body:new E.X({title:t.title,uid:t.libraryPanel.uid,name:t.libraryPanel.name,key:(0,D.Rv)(t.id)}),y:t.gridPos.y,x:t.gridPos.x,width:t.gridPos.w,height:t.gridPos.h}):null}function le(t){const g={key:(0,D.Rv)(t.id),title:t.title,pluginId:t.type,options:t.options??{},fieldConfig:t.fieldConfig,pluginVersion:t.pluginVersion,displayMode:t.transparent?"transparent":void 0,hoverHeader:!t.title&&!t.timeFrom&&!t.timeShift,$data:(0,k.R)(t),menu:new a.e0({$behaviors:[m]}),extendPanelContext:K,_UNSAFE_customMigrationHandler:re(t)};if((t.timeFrom||t.timeShift)&&(g.$timeRange=new r.r({timeFrom:t.timeFrom,timeShift:t.timeShift,hideTimeOverride:t.hideTimeOverride})),t.repeat){const d=t.repeatDirection??"h";return new T.o({key:`grid-item-${t.id}`,x:t.gridPos.x,y:t.gridPos.y,width:d==="h"?24:t.gridPos.w,height:t.gridPos.h,itemHeight:t.gridPos.h,source:new a.Z(g),variableName:t.repeat,repeatedPanels:[],repeatDirection:t.repeatDirection,maxPerRow:t.maxPerRow})}return new a.bO({key:`grid-item-${t.id}`,x:t.gridPos.x,y:t.gridPos.y,width:t.gridPos.w,height:t.gridPos.h,body:new a.Z(g)})}const me=t=>t.type==="custom",te=t=>t.type==="query",ye=t=>t.type==="datasource",ce=t=>t.type==="constant",pe=t=>t.type==="interval",ge=t=>t.type==="adhoc"},56950:(_,Q,e)=>{e.d(Q,{vi:()=>D,EU:()=>B,h2:()=>T});var a=e(69084),v=e(74502),c=e(61606),x=e(41406),w=e(27554),o=e(45013),A=e(70451),f=e(39064),O=e(21642),E=e(52274),S=e(95409),i=e(58086),P=e(69662),L=e(88939);const y={name:"grafana",uid:"grafana"};function C(r){const R=[];for(const n of r){if(!(n instanceof v.o6.y))continue;const V={...n.state.query,enable:!!n.state.isEnabled,hide:!!n.state.isHidden};R.push(V)}return R}function J(r){const R=[];for(const n of r.state.variables){const V={name:n.state.name,label:n.state.label,description:n.state.description,skipUrlSync:!!n.state.skipUrlSync,hide:n.state.hide||c.bU.dontHide,type:n.state.type};if(n instanceof v.$1)R.push({...V,current:{value:n.state.value,text:n.state.text},options:[],query:n.state.query,datasource:n.state.datasource,sort:n.state.sort,refresh:n.state.refresh,regex:n.state.regex,allValue:n.state.allValue,includeAll:n.state.includeAll,multi:n.state.isMulti,skipUrlSync:n.state.skipUrlSync,hide:n.state.hide||c.bU.dontHide});else if(n instanceof v.eO)R.push({...V,current:{text:n.state.value,value:n.state.value},options:[],query:n.state.query,multi:n.state.isMulti,allValue:n.state.allValue,includeAll:n.state.includeAll});else if(n instanceof v.l3)R.push({...V,current:{value:n.state.value,text:n.state.text},options:[],regex:n.state.regex,refresh:x.Bd.onDashboardLoad,query:n.state.pluginId,multi:n.state.isMulti,allValue:n.state.allValue,includeAll:n.state.includeAll});else if(n instanceof v.M6)R.push({...V,current:{value:n.state.value,text:n.state.value},query:n.state.value,hide:c.bU.hideVariable});else if(n instanceof v.TC){const F=(0,L.U)(n.state.intervals);R.push({...V,current:{text:n.state.value,value:n.state.value},query:F,hide:c.bU.hideVariable,refresh:n.state.refresh,auto:n.state.autoEnabled,auto_min:n.state.autoMinInterval,auto_count:n.state.autoStepCount})}else throw new Error("Unsupported variable type")}for(const n of R)n.hide===c.bU.dontHide&&delete n.hide,n.skipUrlSync||delete n.skipUrlSync,n.label===""&&delete n.label,n.multi||delete n.multi,n.sort===x.$U.disabled&&delete n.sort;return R}function B(r,R=!1){const n=r.state,V=n.$timeRange.state,F=n.$data,K=n.$variables,Z=n.body,U=[];let ee=[];if(Z instanceof v.Qh){for(const X of Z.state.children)if(X instanceof v.bO&&U.push(D(X,R)),X instanceof v.I_){if(X.state.key.indexOf("-clone-")>0)continue;m(X,U,R)}}let N=[];if(F instanceof v.mv){const X=F.state.layers;N=C(X)}if(K instanceof v.hT&&(ee=J(K)),n.controls)for(const X of n.controls)X instanceof v.zo&&ee.push({name:X.state.name,type:"adhoc",datasource:X.state.datasource});const k={...c.Ql,title:n.title,uid:n.uid,id:n.id,time:{from:V.from,to:V.to},panels:U,annotations:{list:N},templating:{list:ee},timezone:V.timeZone,fiscalYearStartMonth:V.fiscalYearStartMonth,weekStart:V.weekStart};return(0,w.M)(k)}function D(r,R=!1){let n,V=0,F=0,K=0,Z=0;if(r instanceof v.bO){if(r.state.body instanceof O.X)return V=r.state.x??0,F=r.state.y??0,K=r.state.width??0,Z=r.state.height??0,{id:(0,L.Jb)(r.state.body),title:r.state.body.state.title,gridPos:{x:V,y:F,w:K,h:Z},libraryPanel:{name:r.state.body.state.name,uid:r.state.body.state.uid}};if(!(r.state.body instanceof v.Z))throw new Error("SceneGridItem body expected to be VizPanel");n=r.state.body,V=r.state.x??0,F=r.state.y??0,K=r.state.width??0,Z=r.state.height??0}if(r instanceof E.o&&(n=r.state.source,V=r.state.x??0,F=r.state.y??0,K=r.state.width??0,Z=r.state.height??0),!n)throw new Error("Unsupported grid item type");const U={id:(0,L.Jb)(n),type:n.state.pluginId,title:n.state.title,gridPos:{x:V,y:F,w:K,h:Z},options:n.state.options,fieldConfig:n.state.fieldConfig??{defaults:{},overrides:[]},transformations:[],transparent:n.state.displayMode==="transparent"},ee=n.state.$timeRange;ee instanceof S.r&&(U.timeFrom=ee.state.timeFrom,U.timeShift=ee.state.timeShift,U.hideTimeOverride=ee.state.hideTimeOverride);const N=n.state.$data;if(N instanceof P.K&&(U.datasource={type:"datasource",uid:A.oe},U.targets=[{datasource:{...U.datasource},refId:"A",panelId:N.state.query.panelId,topic:N.state.query.topic}]),N instanceof v.uq&&(U.targets=N.state.queries,U.maxDataPoints=N.state.maxDataPoints,U.datasource=N.state.datasource),N instanceof v.bM){const k=N.state.$data;k instanceof P.K&&(U.datasource={type:"datasource",uid:A.oe},U.targets=[{datasource:{...U.datasource},refId:"A",panelId:k.state.query.panelId,topic:k.state.query.topic}]),k instanceof v.uq&&(U.targets=k.state.queries,U.maxDataPoints=k.state.maxDataPoints,U.datasource=k.state.datasource),U.transformations=N.state.transformations}if(N&&R){U.datasource=y;let k=(0,o.XJ)(N.state.data);N instanceof v.bM&&(k=(0,o.XJ)(N.state.$data.state.data)),U.targets=[{refId:"A",datasource:U.datasource,queryType:f.hR.Snapshot,snapshot:k}]}return r instanceof E.o&&(U.repeat=r.state.variableName,U.maxPerRow=r.state.maxPerRow,U.repeatDirection=r.getRepeatDirection()),U}function m(r,R,n=!1){const V={type:"row",id:(0,L.Jb)(r),title:r.state.title,gridPos:{x:r.state.x??0,y:r.state.y??0,w:r.state.width??24,h:r.state.height??1},collapsed:!!r.state.isCollapsed,panels:[]};if(r.state.$behaviors?.length){const K=r.state.$behaviors[0];K instanceof i.a&&(V.repeat=K.state.variableName)}R.push(V);const F=r.state.children.map(K=>D(K,n));r.state.isCollapsed?V.panels=F:R.push(...F)}function T(r,R,n,V){let F={...n,title:r,time:{from:R.from.toISOString(),to:R.to.toISOString()},links:[]};if(V){const K=n.panels?.find(Z=>Z.id===(0,L.Jb)(V));K&&(K.gridPos={w:24,x:0,y:0,h:20},F={...F,panels:[K]})}if(F.panels?.forEach(K=>{"links"in K&&(K.links=[])}),F.annotations){const Z=(F.annotations.list?.filter(U=>U.enable)||[]).map(U=>({name:U.name,enable:U.enable,iconColor:U.iconColor,type:U.type,builtIn:U.builtIn,hide:U.hide,snapshotData:[]}));F.annotations.list=Z}return F.templating&&F.templating.list?.forEach(K=>{"query"in K&&(K.query=""),"options"in K&&(K.options=K.current&&!(0,a.Q)(K.current)?[K.current]:[]),"refresh"in K&&(K.refresh=x.Bd.never)}),F}},88121:(_,Q,e)=>{e.d(Q,{V:()=>g});var a=e(39953),v=e(32688),c=e(74502),x=e(35823),w=e(73075),o=e(90201),A=e(21308),f=e(62679),O=e(88939),E=e(22160),S=e.n(E),i=e(20653),P=e(19977),L=e(4148),y=e(12223),C=e(96227),J=e(26286),B=e(4919),D=e(84541),m=e(36210),T=e(98140),r=e(87295),R=e(20230),n=e(75397),V=e(56950);const F=(0,f.t)("share-modal.export.share-externally-label","Export for sharing externally"),K=(0,f.t)("share-modal.export.share-default-label","Export with default values removed");class Z extends c.wx{constructor(u){super({isSharingExternally:!1,shouldTrimDefaults:!1,isViewingJSON:!1,...u}),this._exporter=new T.E,this.onShareExternallyChange=()=>{this.setState({isSharingExternally:!this.state.isSharingExternally})},this.onTrimDefaultsChange=()=>{this.setState({shouldTrimDefaults:!this.state.shouldTrimDefaults})},this.onViewJSON=()=>{this.setState({isViewingJSON:!this.state.isViewingJSON})}}getTabLabel(){return(0,f.t)("share-modal.tab-title.export","Export")}getClipboardText(){}async getExportableDashboardJson(){const{dashboardRef:u,isSharingExternally:b,shouldTrimDefaults:M}=this.state,H=(0,V.EU)(u.resolve()),$=b?await this._exporter.makeExportable(new n.f(H)):H;return M?(await(0,L.i)().post("/api/dashboards/trim",{dashboard:$})).dashboard:$}async onSaveAsFile(){const u=await this.getExportableDashboardJson(),b=JSON.stringify(u,null,2),M=new Blob([b],{type:"application/json;charset=utf-8"}),H=new Date().getTime();S()(M,`${u.title}-${H}.json`),(0,r.PJ)("save_export",R.Ax.export)}}Z.Component=U;function U({model:l}){const{isSharingExternally:u,shouldTrimDefaults:b,isViewingJSON:M,modalRef:H}=l.useState(),$=(0,i.Z)(async()=>{if(M){const Y=await l.getExportableDashboardJson();return JSON.stringify(Y,null,2)}return""},[M]);return a.createElement(a.Fragment,null,!M&&a.createElement(a.Fragment,null,a.createElement("p",{className:"share-modal-info-text"},a.createElement(f.cC,{i18nKey:"share-modal.export.info-text"},"Export this dashboard.")),a.createElement(y.wc,{spacing:"md"},a.createElement(C.g,{label:F},a.createElement(J.r,{id:"share-externally-toggle",value:u,onChange:l.onShareExternallyChange})),v.config.featureToggles.trimDefaults&&a.createElement(C.g,{label:K},a.createElement(J.r,{id:"trim-defaults-toggle",value:b,onChange:l.onTrimDefaultsChange}))),a.createElement(w.u.ButtonRow,null,a.createElement(B.zx,{variant:"secondary",onClick:()=>{H?.resolve().onDismiss()},fill:"outline"},a.createElement(f.cC,{i18nKey:"share-modal.export.cancel-button"},"Cancel")),a.createElement(B.zx,{variant:"secondary",icon:"brackets-curly",onClick:l.onViewJSON},a.createElement(f.cC,{i18nKey:"share-modal.export.view-button"},"View JSON")),a.createElement(B.zx,{variant:"primary",icon:"save",onClick:()=>l.onSaveAsFile()},a.createElement(f.cC,{i18nKey:"share-modal.export.save-button"},"Save to file")))),M&&a.createElement(a.Fragment,null,a.createElement(P.Z,{disableHeight:!0},({width:Y})=>$.value?a.createElement(D.p,{value:$.value??"",language:"json",showMiniMap:!1,height:"500px",width:Y}):$.loading?a.createElement("div",null,"Loading..."):null),a.createElement(w.u.ButtonRow,null,a.createElement(B.zx,{variant:"secondary",fill:"outline",onClick:l.onViewJSON,icon:"arrow-left"},a.createElement(f.cC,{i18nKey:"share-modal.export.back-button"},"Back to export config")),a.createElement(m.m,{variant:"secondary",icon:"copy",disabled:$.loading,getText:()=>$.value??""},a.createElement(f.cC,{i18nKey:"share-modal.view-json.copy-button"},"Copy to Clipboard")),a.createElement(B.zx,{variant:"primary",icon:"save",disabled:$.loading,onClick:()=>l.onSaveAsFile()},a.createElement(f.cC,{i18nKey:"share-modal.export.save-button"},"Save to file")))))}var ee=e(92403),N=e(28888),k=e(13601),X=e(2827),re=e(38637),de=e(12190),ue=e(33155),ie=e(37965),he=e(12781);class fe extends c.wx{constructor(u){super({...u,useLockedTime:!0,useShortUrl:!1,selectedTheme:"current",shareUrl:"",imageUrl:""}),this.onToggleLockedTime=()=>{this.setState({useLockedTime:!this.state.useLockedTime}),this.buildUrl()},this.onUrlShorten=()=>{this.setState({useShortUrl:!this.state.useShortUrl}),this.buildUrl()},this.onThemeChange=b=>{this.setState({selectedTheme:b}),this.buildUrl()},this.getShareUrl=()=>this.state.shareUrl,this.addActivationHandler(()=>{this.buildUrl()})}async buildUrl(){const{panelRef:u,dashboardRef:b,useLockedTime:M,useShortUrl:H,selectedTheme:$}=this.state,Y=b.resolve(),q=u?.resolve(),ae=k.E1.getLocation(),ne=c.ep.getTimeRange(q??Y),se={};q&&(se.viewPanel=q.state.key),M&&(se.from=ne.state.value.from.toISOString(),se.to=ne.state.value.to.toISOString()),$!=="current"&&(se.theme=$);let oe=(0,O.$9)({uid:Y.state.uid,currentQueryParams:ae.search,updateQuery:se,absolute:!0});H&&(oe=await(0,ie.D)(oe));const Ee=(0,O.$9)({uid:Y.state.uid,currentQueryParams:ae.search,updateQuery:se,absolute:!0,soloRoute:!0,render:!0,timeZone:le(ne.getTimeZone())});this.setState({shareUrl:oe,imageUrl:Ee})}getTabLabel(){return(0,f.t)("share-modal.tab-title.link","Link")}onCopy(){(0,r.PJ)("copy_link",R.Ax.link)}}fe.Component=ve;function ve({model:l}){const u=l.useState(),{panelRef:b,dashboardRef:M}=u,H=M.resolve(),$=b?.resolve(),q=c.ep.getTimeRange($??H).state.to==="now",{useLockedTime:ae,useShortUrl:ne,selectedTheme:se,shareUrl:oe,imageUrl:Ee}=u,Ce=N.wl.pages.SharePanelModal,be=!!H.state.uid,De=(0,f.t)("share-modal.link.time-range-label","Lock time range"),Se=(0,f.t)("share-modal.link.time-range-description","Transforms the current relative time range to an absolute time range"),Te=(0,f.t)("share-modal.link.shorten-url","Shorten URL"),Pe=(0,f.t)("share-modal.link.link-url","Link URL");return a.createElement(a.Fragment,null,a.createElement("p",{className:"share-modal-info-text"},a.createElement(f.cC,{i18nKey:"share-modal.link.info-text"},"Create a direct link to this dashboard or panel, customized with the options below.")),a.createElement(X.C,null,a.createElement(C.g,{label:De,description:q?Se:""},a.createElement(J.r,{id:"share-current-time-range",value:ae,onChange:l.onToggleLockedTime})),a.createElement(he.J,{selectedTheme:se,onChange:l.onThemeChange}),a.createElement(C.g,{label:Te},a.createElement(J.r,{id:"share-shorten-url",value:ne,onChange:l.onUrlShorten})),a.createElement(C.g,{label:Pe},a.createElement(re.I,{id:"link-url-input",value:oe,readOnly:!0,addonAfter:a.createElement(m.m,{icon:"copy",variant:"primary",getText:l.getShareUrl,onClipboardCopy:l.onCopy},a.createElement(f.cC,{i18nKey:"share-modal.link.copy-link-button"},"Copy"))}))),$&&v.config.rendererAvailable&&a.createElement(a.Fragment,null,be&&a.createElement("div",{className:"gf-form"},a.createElement("a",{href:Ee,target:"_blank",rel:"noreferrer","aria-label":Ce.linkToRenderedImage},a.createElement(de.J,{name:"camera"}),"\xA0",a.createElement(f.cC,{i18nKey:"share-modal.link.rendered-image"},"Direct link rendered image"))),!be&&a.createElement(ue.b,{severity:"info",title:(0,f.t)("share-modal.link.save-alert","Dashboard is not saved"),bottomSpacing:0},a.createElement(f.cC,{i18nKey:"share-modal.link.save-dashboard"},"To render a panel image, you must save the dashboard first."))),$&&!v.config.rendererAvailable&&a.createElement(ue.b,{severity:"info",title:(0,f.t)("share-modal.link.render-alert","Image renderer plugin not installed"),bottomSpacing:0},a.createElement(f.cC,{i18nKey:"share-modal.link.render-instructions"},"To render a panel image, you must install the",a.createElement("a",{href:"https://grafana.com/grafana/plugins/grafana-image-renderer",target:"_blank",rel:"noopener noreferrer",className:"external-link"},"Grafana image renderer plugin"),". Please contact your Grafana administrator to install the plugin.")))}function le(l){const u="UTC"+encodeURIComponent((0,ee.CQ)().format("Z"));if(l==="utc")return"UTC";if(l==="browser"){if(!window.Intl)return u;const M=window.Intl.DateTimeFormat().resolvedOptions();return M.timeZone?M.timeZone:u}return l}var me=e(95681),te=e(20454);const ye="/api/snapshots",ce={label:(0,f.t)("share-modal.snapshot.expire-never","Never"),value:0},pe=[ce,{label:(0,f.t)("share-modal.snapshot.expire-hour","1 Hour"),value:60*60},{label:(0,f.t)("share-modal.snapshot.expire-day","1 Day"),value:60*60*24},{label:(0,f.t)("share-modal.snapshot.expire-week","7 Days"),value:60*60*24*7}];class ge extends c.wx{constructor(u){super({...u,snapshotName:u.dashboardRef.resolve().state.title,selectedExpireOption:ce}),this.onSnasphotNameChange=b=>{this.setState({snapshotName:b.trim()})},this.onExpireChange=b=>{this.setState({selectedExpireOption:pe.find(M=>M.value===b)})},this.onSnapshotCreate=async(b=!1)=>{const{selectedExpireOption:M}=this.state,H=this.prepareSnapshot(),$={dashboard:H,name:H.title,expires:M?.value,external:b};try{return await(0,L.i)().post(ye,$)}finally{(0,r.PJ)(b?"publish_snapshot":"local_snapshot",R.Ax.snapshot)}},this.addActivationHandler(()=>{this._onActivate()})}_onActivate(){(0,L.i)().get("/api/snapshot/shared-options").then(u=>{this.isActive&&this.setState({snapshotSharingOptions:u})})}getTabLabel(){return(0,f.t)("share-modal.tab-title.snapshot","Snapshot")}prepareSnapshot(){const u=c.ep.getTimeRange(this),{dashboardRef:b,panelRef:M}=this.state,H=(0,V.EU)(b.resolve(),!0);return(0,V.h2)(this.state.snapshotName||"",u.state.value,H,M?.resolve())}}ge.Component=t;function t({model:l}){const{snapshotName:u,selectedExpireOption:b,modalRef:M,snapshotSharingOptions:H}=l.useState(),[$,Y]=(0,me.default)(async(ne=!1)=>l.onSnapshotCreate(ne)),[q,ae]=(0,me.default)(async ne=>await(0,L.i)().get(ne));return q.value?a.createElement(f.cC,{i18nKey:"share-modal.snapshot.deleted-message"},"The snapshot has been deleted. If you have already accessed it once, then it might take up to an hour before before it is removed from browser caches or CDN caches."):a.createElement(a.Fragment,null,!$.value&&a.createElement(a.Fragment,null,a.createElement("div",null,a.createElement("p",{className:"share-modal-info-text"},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.info-text-1"},"A snapshot is an instant way to share an interactive dashboard publicly. When created, we strip sensitive data like queries (metric, template, and annotation) and panel links, leaving only the visible metric data and series names embedded in your dashboard.")),a.createElement("p",{className:"share-modal-info-text"},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.info-text-2"},"Keep in mind, your snapshot ",a.createElement("em",null,"can be viewed by anyone")," that has the link and can access the URL. Share wisely."))),a.createElement(C.g,{label:(0,f.t)("share-modal.snapshot.name","Snapshot name")},a.createElement(re.I,{id:"snapshot-name-input",width:30,defaultValue:u,onBlur:ne=>l.onSnasphotNameChange(ne.target.value)})),a.createElement(C.g,{label:(0,f.t)("share-modal.snapshot.expire","Expire")},a.createElement(te.S,{id:"expire-select-input",options:pe,value:b?.value,onChange:l.onExpireChange})),a.createElement(w.u.ButtonRow,null,a.createElement(B.zx,{variant:"secondary",onClick:()=>{M?.resolve().onDismiss()},fill:"outline"},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.cancel-button"},"Cancel")),H?.externalEnabled&&a.createElement(B.zx,{variant:"secondary",disabled:$.loading,onClick:()=>Y(!0)},H?.externalSnapshotName),a.createElement(B.zx,{variant:"primary",disabled:$.loading,onClick:()=>Y()},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.local-button"},"Local Snapshot")))),$.value&&a.createElement(a.Fragment,null,a.createElement(C.g,{label:(0,f.t)("share-modal.snapshot.url-label","Snapshot URL")},a.createElement(re.I,{id:"snapshot-url-input",value:$.value.url,readOnly:!0,addonAfter:a.createElement(m.m,{icon:"copy",variant:"primary",getText:()=>$.value.url},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.copy-link-button"},"Copy"))})),a.createElement("div",{className:"pull-right",style:{padding:"5px"}},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.mistake-message"},"Did you make a mistake? "),"\xA0",a.createElement(B.zx,{fill:"outline",size:"md",variant:"destructive",onClick:()=>{ae($.value.deleteUrl)}},a.createElement(f.cC,{i18nKey:"share-modal.snapshot.delete-button"},"Delete snapshot.")))))}class g extends c.wx{constructor(u){super({...u,activeTab:"Link"}),this.onDismiss=()=>{(0,O.Pm)(this).closeModal()},this.onChangeTab=b=>{this.setState({activeTab:b.value})},this.addActivationHandler(()=>this.buildTabs())}buildTabs(){const{dashboardRef:u,panelRef:b}=this.state,M=[new fe({dashboardRef:u,panelRef:b,modalRef:this.getRef()})];b||M.push(new Z({dashboardRef:u,modalRef:this.getRef()})),A.Vt.isSignedIn&&v.config.snapshotEnabled&&M.push(new ge({panelRef:b,dashboardRef:u,modalRef:this.getRef()})),this.setState({tabs:M})}}g.Component=d;function d({model:l}){const{panelRef:u,tabs:b,activeTab:M}=l.useState(),H=u?(0,f.t)("share-modal.panel.title","Share Panel"):(0,f.t)("share-modal.dashboard.title","Share");if(!b)return;const $=b?.map(ae=>({label:ae.getTabLabel(),value:ae.getTabLabel()})),Y=a.createElement(x.H,{title:H,icon:"share-alt",tabs:$,activeTab:M,onChangeTab:l.onChangeTab}),q=b.find(ae=>ae.getTabLabel()===M);return a.createElement(w.u,{isOpen:!0,title:Y,onDismiss:l.onDismiss},a.createElement(o.I,null,q&&a.createElement(q.Component,{model:q})))}},51811:(_,Q,e)=>{e.d(Q,{R:()=>w});var a=e(32688),v=e(74502),c=e(70451),x=e(69662);function w(o){if(!o.targets?.length||a.config.panels[o.type]?.skipDataQuery)return;let A;return o.datasource?.uid===c.oe?A=new x.K({query:o.targets[0]}):A=new v.uq({datasource:o.datasource??void 0,queries:o.targets,maxDataPoints:o.maxDataPoints??void 0,maxDataPointsFromWidth:!0,dataLayerFilter:{panelId:o.id}}),o.transformations?.length&&(A=new v.bM({$data:A,transformations:o.transformations})),A}},88939:(_,Q,e)=>{e.d(Q,{$9:()=>i,CR:()=>P,Jb:()=>f,Pm:()=>B,Qx:()=>D,R:()=>J,Rv:()=>A,U:()=>y,_B:()=>L,_n:()=>C,ds:()=>O,pi:()=>S});var a=e(69307),v=e(13601),c=e(32688),x=e(74502),w=e(91482),o=e(8507);function A(m){return`panel-${m}`}function f(m){return parseInt(m.state.key.replace("panel-",""),10)}function O(m,T){if(!T)return null;const r=E(m,T);if(r)return r;const R=parseInt(T,10);return isNaN(R)?null:E(m,A(R))}function E(m,T){if(!T)return null;const r=x.ep.findObject(m,R=>R.state.key===T);if(r){if(r instanceof x.Z)return r;throw new Error(`Found panel with key ${T} but it was not a VizPanel`)}return null}function S(m,T){m.forEachChild(r=>{r.isActive&&(r.forceRender(),S(r,T))})}function i(m){let T=`/scenes/dashboard/${m.uid}${m.subPath??""}`;m.soloRoute&&(T=`/d-solo/${m.uid}${m.subPath??""}`),m.render&&(T="/render"+T,m.updateQuery={...m.updateQuery,width:1e3,height:500,tz:m.timeZone});const r=m.currentQueryParams?(0,v.Ox)(m.currentQueryParams):{};if(m.updateQuery)for(const n of Object.keys(m.updateQuery))m.updateQuery[n]===null||m.updateQuery[n]===void 0?delete r[n]:r[n]=m.updateQuery[n];const R=a.Cj.renderUrl(T,r);return m.absolute?c.config.appUrl+R.slice(1):R}function P(m){const{value:T,text:r,options:R}=m.state;return m.hasAllValue()?{values:R.map(n=>n.value),texts:R.map(n=>n.label)}:{values:Array.isArray(T)?T:[T],texts:Array.isArray(r)?r:[r]}}function L(m){const T=m.query.match(/(["'])(.*?)\1|\w+/g);if(!T)return w.T6.query?.split(",")??[];const r=new Set,R=T.reduce((n,V)=>{const F=V.replace(/["']+/g,"");return F.startsWith("$__auto_interval_")||n.add(F),n},r);return Array.from(R)}function y(m){return Array.isArray(m)?m.join(","):""}function C(m,T){const r=Array.isArray(m.current.value)?m.current.value[0]:m.current.value;return r.startsWith("$__auto_interval_")?"$__auto":T.includes(r)?r:T[0]}function J(m){if(m){if(m.state.$data instanceof x.uq)return m.state.$data;if(m.state.$data instanceof x.bM)return J(m.state.$data)}}function B(m){const T=m.getRoot();if(T instanceof o.W)return T;throw new Error("SceneObject root is not a DashboardScene")}function D(m){return m instanceof x.Z?m:m.parent?D(m.parent):null}},97470:(_,Q,e)=>{e.d(Q,{L1:()=>f,WM:()=>O,pV:()=>A});var a=e(39953),v=e(99292),c=e(26205),x=e(62679),w=e(31954),o=e(82247);const A=E=>(0,v.Z)(async()=>f(E),[E]).value;async function f(E){const S=E?.request?.targets||[];if(E&&E.series&&S.length){for(const i of E.series)if(i.meta&&i.meta.custom){const P=await(0,c.F)().get(S[0].datasource);if(P&&P.components?.MetadataInspector)return P}}}const O=(E,S,i,P,L)=>(0,a.useMemo)(()=>{const y=[];return(0,o.sY)(i)&&(y.push({label:(0,x.t)("dashboard.inspect.data-tab","Data"),value:w.q.Data}),y.push({label:(0,x.t)("dashboard.inspect.stats-tab","Stats"),value:w.q.Stats})),L&&y.push({label:(0,x.t)("dashboard.inspect.meta-tab","Meta data"),value:w.q.Meta}),y.push({label:(0,x.t)("dashboard.inspect.json-tab","JSON"),value:w.q.JSON}),P&&y.push({label:(0,x.t)("dashboard.inspect.error-tab","Error"),value:w.q.Error}),S.meta.canEdit&&(0,o.sY)(i)&&y.push({label:(0,x.t)("dashboard.inspect.query-tab","Query"),value:w.q.Query}),y},[i,L,S,P])},99292:(_,Q,e)=>{var a;a={value:!0};var v=e(52732),c=e(39953),x=v.__importDefault(e(95681));function w(o,A){A===void 0&&(A=[]);var f=x.default(o,A,{loading:!0}),O=f[0],E=f[1];return c.useEffect(function(){E()},[E]),O}Q.Z=w}}]);

//# sourceMappingURL=80.c992a43e88c5c2c36042.js.map