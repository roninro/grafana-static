"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4074],{7965:(ee,k,s)=>{s.d(k,{P:()=>y});var r=s(39953),e=s(20653),x=s(9558),A=s(12190),$=s(9738),w=s(17231);const S=()=>(0,w.getGrafanaSearcher)().getSortOptions();function y({onChange:v,value:L,placeholder:B,filter:W,getSortOptions:O,isClearable:G}){const z=(0,e.Z)(async()=>{const V=await(O??S)();return W?V.filter(N=>W.includes(N.value)):V},[O,W]);if(z.loading)return null;const T=!!(L?.includes("desc")||L?.startsWith("-"));return r.createElement(x.Ph,{key:L,width:28,onChange:v,value:z.value?.find(V=>V.value===L)??null,options:z.value,"aria-label":"Sort",placeholder:B??`Sort (Default ${$.yw.label})`,prefix:r.createElement(A.J,{name:T?"sort-amount-down":"sort-amount-up"}),isClearable:G})}},99636:(ee,k,s)=>{s.d(k,{b:()=>A});var r=s(39953),e=s(23997),x=s(55356);class A{constructor(S){this._subject=new e.x,this._state=S}useState(){return $(this)}get state(){return this._state}setState(S){this._state={...this._state,...S},this._subject.next(this._state)}subscribeToState(S){return this._subject.subscribe(S)}}function $(w){const S=(0,x.N)();return(0,r.useEffect)(()=>{const y=w.subscribeToState({next:S});return()=>y.unsubscribe()},[w,S]),w.state}},62719:(ee,k,s)=>{s.d(k,{p:()=>L});var r=s(39953),e=s(30623),x=s(32688),A=s(32840),$=s(98632),w=s(33155),S=s(62679),y=s(46347),v=s(83408);const L=({onConfirm:B,onDismiss:W,selectedItems:O,...G})=>{const{data:z}=(0,y.zs)(O),T=!x.config.featureToggles.nestedFolders&&z&&(z.alertRule||z.libraryPanel),[V,N]=(0,r.useState)(!1),F=async()=>{N(!0);try{await B(),N(!1),W()}catch{N(!1)}};return r.createElement(A.s,{body:r.createElement(r.Fragment,null,r.createElement($.x,{element:"p"},r.createElement(S.cC,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),r.createElement(v.X,{selectedItems:O}),r.createElement(e.T,{v:2})),description:r.createElement(r.Fragment,null,T?r.createElement(w.b,{severity:"warning",title:(0,S.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder")},r.createElement(S.cC,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text"},"One or more folders contain library panels or alert rules. Delete these first in order to proceed.")):null),confirmationText:"Delete",confirmText:V?(0,S.t)("browse-dashboards.action.deleting","Deleting..."):(0,S.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:W,onConfirm:F,title:(0,S.t)("browse-dashboards.action.delete-modal-title","Delete"),...G})}},44081:(ee,k,s)=>{s.d(k,{_:()=>B});var r=s(39953),e=s(30623),x=s(73075),A=s(33155),$=s(98632),w=s(96227),S=s(4919),y=s(15296),v=s(62679),L=s(83408);const B=({onConfirm:W,onDismiss:O,selectedItems:G,...z})=>{const[T,V]=(0,r.useState)(),[N,F]=(0,r.useState)(!1),H=Object.keys(G.folder).filter(de=>G.folder[de]),te=async()=>{if(T!==void 0){F(!0);try{await W(T),F(!1),O()}catch{F(!1)}}};return r.createElement(x.u,{title:(0,v.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:O,...z},H.length>0&&r.createElement(A.b,{severity:"info",title:(0,v.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),r.createElement($.x,{element:"p"},r.createElement(v.cC,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),r.createElement(L.X,{selectedItems:G}),r.createElement(e.T,{v:3}),r.createElement(w.g,{label:(0,v.t)("browse-dashboards.action.move-modal-field-label","Folder name")},r.createElement(y.E,{value:T,excludeUIDs:H,onChange:V})),r.createElement(x.u.ButtonRow,null,r.createElement(S.zx,{onClick:O,variant:"secondary",fill:"outline"},r.createElement(v.cC,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),r.createElement(S.zx,{disabled:T===void 0||N,onClick:te,variant:"primary"},N?(0,v.t)("browse-dashboards.action.moving","Moving..."):(0,v.t)("browse-dashboards.action.move-button","Move"))))}},34112:(ee,k,s)=>{s.d(k,{A:()=>F});var r=s(39953),e=s(32688),x=s(72639),A=s(13601),$=s(13767),w=s(85001),S=s(58047),y=s(4919),v=s(12190),L=s(87722),B=s(88206),W=s(21308),O=s(62679),G=s(73431),z=s(46347),T=s(33188),V=s(62719),N=s(44081);function F({folder:H}){const[te,de]=(0,r.useState)(!1),[Pe,ae]=(0,r.useState)(!1),[ue]=(0,z.OH)(),[le]=(0,z.yC)(),{canEditFolders:b,canDeleteFolders:me,canViewPermissions:he,canSetPermissions:ge}=(0,T.a)(H),fe=e.config.featureToggles.nestedFolders&&b,ye=async _=>{await ue({folder:H,destinationUID:_}),(0,x.ff)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Y=async()=>{await le(H),(0,x.ff)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:_}=H,Ie=_&&_.length?_[_.length-1].url:"/dashboards";A.E1.push(Ie)},se=()=>{W.h$.publish(new G.Dn({component:N._,props:{selectedItems:{folder:{[H.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:ye}}))},U=()=>{W.h$.publish(new G.Dn({component:V.p,props:{selectedItems:{folder:{[H.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Y}}))},we=(0,O.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),Ce=(0,O.t)("browse-dashboards.folder-actions-button.move","Move"),be=(0,O.t)("browse-dashboards.folder-actions-button.delete","Delete"),R=r.createElement($.v,null,he&&r.createElement(w.s,{onClick:()=>ae(!0),label:we}),fe&&r.createElement(w.s,{onClick:se,label:Ce}),me&&r.createElement(w.s,{destructive:!0,onClick:U,label:be}));return!he&&!fe&&!me?null:r.createElement(r.Fragment,null,r.createElement(S.L,{overlay:R,onVisibleChange:de},r.createElement(y.zx,{variant:"secondary"},r.createElement(O.cC,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),r.createElement(v.J,{name:te?"angle-up":"angle-down"}))),Pe&&r.createElement(L.d,{title:(0,O.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:H.title,onClose:()=>ae(!1),size:"md"},r.createElement(B.P,{resource:"folders",resourceId:H.uid,canSetPermissions:ge})))}},33188:(ee,k,s)=>{s.d(k,{a:()=>$});var r=s(32688),e=s(21308),x=s(57721);function A(w,S){return S?e.Vt.hasPermissionInMetadata(w,S):e.Vt.hasPermission(w)}function $(w){const S=A(x.AccessControlAction.DashboardsCreate,w),y=!!((!w||r.config.featureToggles.nestedFolders)&&A(x.AccessControlAction.FoldersCreate)),v=A(x.AccessControlAction.FoldersDelete,w),L=A(x.AccessControlAction.DashboardsWrite,w),B=A(x.AccessControlAction.FoldersWrite,w),W=A(x.AccessControlAction.FoldersPermissionsWrite,w),O=A(x.AccessControlAction.FoldersPermissionsRead,w);return{canCreateDashboards:S,canCreateFolders:y,canDeleteFolders:v,canEditDashboards:L,canEditFolders:B,canSetPermissions:W,canViewPermissions:O}}},77829:(ee,k,s)=>{s.r(k),s.d(k,{DashboardListPageFeatureToggle:()=>Ne,default:()=>Ra});var r=s(41407),e=s(39953),x=s(20653),A=s(57837),$=s(13601),w=s(13253),S=s(19977),y=s(72639),v=s(82803),L=s(41245),B=s(57721),W=s(82744),O=s(86832),G=s(99636),z=s(23062),T=s(9738),V=s(14741),N=s(17231),F=s(6868),H=s(91344);const te={query:"",tag:[],starred:!1,layout:F.A.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},de={sort:null,starred:null,query:null,tag:null,layout:null};class Pe extends G.b{constructor(){super(...arguments),this.updateLocation=(0,O.debounce)(a=>$.E1.partial(a,!0),300),this.doSearchWithDebounce=(0,O.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...de})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(n=>n!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const n=a.currentTarget.checked;this.setStateAndDoSearch({starred:n})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(T.qb,a):localStorage.removeItem(T.qb),this.state.layout===F.A.Folders?this.setStateAndDoSearch({sort:a,layout:F.A.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(T.rh,a),this.state.sort&&a===F.A.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),z.Z.set(T.to,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,N.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,V.OY)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,V.Qw)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,n=!0){const c=(0,H.vj)($.E1.getSearchObject());(c.query||c.datasource||c.panel_type)&&(c.layout=F.A.List),ae.setState({...te,...c,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),n&&this.doSearch()}setStateAndDoSearch(a){const n=a.sort||this.state.sort||localStorage.getItem(T.qb)||void 0;this.setState({sort:n,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,V.Jy)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const n=(0,N.getGrafanaSearcher)(),c=Date.now();(this.state.starred?n.starred(this.lastQuery):n.search(this.lastQuery)).then(o=>{c>this.lastSearchTimestamp&&(this.setState({result:o,loading:!1}),this.lastSearchTimestamp=c)}).catch(o=>{(0,V.TP)(this.state.eventTrackingNamespace,{...a,error:o?.message}),this.setState({loading:!1})})}}let ae;function ue(){if(!ae){const a=localStorage.getItem(T.rh)??te.layout;let n=z.Z.getBool(T.to,!0);n&&(n=!1),ae=new Pe({...te,layout:a,includePanels:n})}return ae}function le(){const t=ue();return[t.useState(),t]}var b=s(62679);function me(t=!1){return t?(0,b.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,b.t)("search.search-input.placeholder","Search for dashboards and folders")}function he(){return(0,b.t)("search.dashboard-actions.new-dashboard","New dashboard")}function ge(){return(0,b.t)("search.dashboard-actions.new-folder","New folder")}function fe(){return(0,b.t)("search.dashboard-actions.import","Import")}function ye(){return(0,b.t)("search.dashboard-actions.new","New")}var Y=s(46347),se=s(32688),U=s(4919),we=s(69865),Ce=s(28833),be=s(73431),R=s(8099),_=s(62719),Ie=s(44081);function ht(){const t=(0,v.wW)(gt),a=(0,B.useDispatch)(),n=(0,R.m2)(),[c]=(0,Y.zu)(),[l]=(0,Y.jL)(),[,o]=le(),i=(0,e.useMemo)(()=>!se.config.featureToggles.nestedFolders&&Object.values(n.folder).some(g=>g),[n]),d=o.hasSearchFilters(),h=()=>{a((0,R.u6)({isSelected:!1,folderUID:void 0})),d&&o.doSearchWithDebounce()},m=async()=>{await c({selectedItems:n}),$e("delete",n),h()},u=async g=>{await l({selectedItems:n,destinationUID:g}),$e("move",n),h()},f=()=>{Ce.Z.publish(new be.Dn({component:Ie._,props:{selectedItems:n,onConfirm:u}}))},p=()=>{Ce.Z.publish(new be.Dn({component:_.p,props:{selectedItems:n,onConfirm:m}}))},I=e.createElement(U.zx,{onClick:f,variant:"secondary",disabled:i},e.createElement(b.cC,{i18nKey:"browse-dashboards.action.move-button"},"Move"));return e.createElement("div",{className:t.row,"data-testid":"manage-actions"},i?e.createElement(we.u,{content:(0,b.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved")},I):I,e.createElement(U.zx,{onClick:p,variant:"destructive"},e.createElement(b.cC,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const gt=t=>({row:(0,r.css)({display:"flex",flexDirection:"row",gap:t.spacing(1),marginBottom:t.spacing(2)})}),ft={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function $e(t,a){const n=Object.keys(a.dashboard).filter(l=>a.dashboard[l]),c=Object.keys(a.folder).filter(l=>a.folder[l]);(0,y.ff)(ft[t],{item_counts:{folder:c.length,dashboard:n.length},source:"tree_actions"})}var ce=s(12223),ne=s(13026),vt=s(20454),Et=s(7965),pt=s(40835);function yt(){return[{value:F.A.Folders,icon:"folder",description:(0,b.t)("search.actions.view-as-folders","View by folders")},{value:F.A.List,icon:"list-ul",description:(0,b.t)("search.actions.view-as-list","View as list")}]}function We(t){const a=t.layout??F.A.Folders;return a===F.A.Folders&&(t.query||t.sort||t.starred||t.tag.length>0)?F.A.List:a}const Te=({onLayoutChange:t,onSortChange:a,onStarredFilterChange:n=()=>{},onTagFilterChange:c,getTagOptions:l,getSortOptions:o,sortPlaceholder:i,onDatasourceChange:d,onPanelTypeChange:h,onSetIncludePanels:m,state:u,showStarredFilter:f,hideLayout:p})=>{const I=(0,v.wW)(Ue),g=We(u),E=u.query||u.datasource||u.panel_type?[F.A.Folders]:[];return e.createElement("div",{className:I.actionRow},e.createElement(ce.Lh,{spacing:"md",width:"auto"},e.createElement(pt.D,{isClearable:!1,tags:u.tag,tagOptions:l,onChange:c}),se.config.featureToggles.panelTitleSearch&&e.createElement(ne.X,{"data-testid":"include-panels",disabled:g===F.A.Folders,value:u.includePanels,onChange:()=>m(!u.includePanels),label:(0,b.t)("search.actions.include-panels","Include panels")}),f&&e.createElement("div",{className:I.checkboxWrapper},e.createElement(ne.X,{label:(0,b.t)("search.actions.starred","Starred"),onChange:n,value:u.starred})),u.datasource&&e.createElement(U.zx,{icon:"times",variant:"secondary",onClick:()=>d(void 0)},e.createElement(b.cC,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:u.datasource})),u.panel_type&&e.createElement(U.zx,{icon:"times",variant:"secondary",onClick:()=>h(void 0)},"Panel: ",u.panel_type)),e.createElement(ce.Lh,{spacing:"md",width:"auto"},!p&&e.createElement(vt.S,{options:yt(),disabledOptions:E,onChange:t,value:g}),e.createElement(Et.P,{onChange:C=>a(C?.value),value:u.sort,getSortOptions:o,placeholder:i||(0,b.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Te.displayName="ActionRow";const Ue=t=>({actionRow:(0,r.css)`
      display: none;

      ${t.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${t.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,r.css)`
      label {
        line-height: 1.2;
      }
    `});function Ct(){const[t,a]=le();return e.createElement("div",null,e.createElement(Te,{hideLayout:!0,showStarredFilter:!0,state:t,getTagOptions:a.getTagOptions,getSortOptions:(0,N.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,N.getGrafanaSearcher)().sortPlaceholder,includePanels:t.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var bt=s(80318),Ke=s(11906),xe=s(13540),Q=(t=>(t[t.Unselected=0]="Unselected",t[t.Selected=1]="Selected",t[t.Mixed=2]="Mixed",t))(Q||{}),St=s(41655),ke=s(68084),ze=s(96198),Dt=s(10694),J=s(28888);function Mt({row:{original:t},isSelected:a,onItemSelectionChange:n}){const c=(0,v.wW)(Pt),l=t.item;if(!a)return e.createElement("span",{className:c.checkboxSpacer});if(l.kind==="ui")return l.uiKind==="pagination-placeholder"?e.createElement(ne.X,{disabled:!0,value:!1}):e.createElement("span",{className:c.checkboxSpacer});const o=a(l);return e.createElement(ne.X,{"data-testid":J.wl.pages.BrowseDashboards.table.checkbox(l.uid),"aria-label":(0,b.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:o===Q.Selected,indeterminate:o===Q.Mixed,onChange:i=>n?.(l,i.currentTarget.checked)})}const Pt=t=>({checkboxSpacer:(0,r.css)({paddingLeft:t.spacing(2)})});function wt({isSelected:t,onAllSelectionChange:a}){const n=t?.("$all")??Q.Unselected;return e.createElement(ne.X,{value:n===Q.Selected,indeterminate:n===Q.Mixed,"aria-label":(0,b.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:c=>{n===Q.Mixed?a?.(!1):a?.(c.currentTarget.checked)}})}var It=s(15166),Ve=s(98632),Ze=s(68497),Se=s(28409),q=s(12190),Tt=s(18950),He=s(99268),oe=s(39971),Qe=s(58869);function Ge(t,a){return t+a.uid}const Fe="md",je="sm";function xt({row:{original:t},onFolderClick:a,treeID:n}){const c=(0,v.wW)(Ft),{item:l,level:o,isOpen:i}=t,d=(0,R.$H)(),h=i&&!d[l.uid],m=(0,oe.J6)(t.item.kind,i);return l.kind==="ui"?e.createElement(e.Fragment,null,e.createElement(Qe.A,{level:o,spacing:{xs:1,md:3}}),e.createElement("span",{className:c.folderButtonSpacer}),l.uiKind==="empty-folder"?e.createElement("em",{className:c.emptyText},e.createElement(Ve.x,{variant:"body",color:"secondary",truncate:!0},"No items")):e.createElement(It.Z,{width:200})):e.createElement(e.Fragment,null,e.createElement(Qe.A,{level:o,spacing:{xs:1,md:3}}),l.kind==="folder"?e.createElement(Ze.h,{size:Fe,className:c.chevron,onClick:()=>{a(l.uid,!i)},name:i?"angle-down":"angle-right","aria-label":i?(0,b.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:l.title}):(0,b.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:l.title})}):e.createElement("span",{className:c.folderButtonSpacer}),e.createElement("div",{className:c.iconNameContainer},h?e.createElement(Se.$,{size:je}):e.createElement(q.J,{size:je,name:m}),e.createElement(Ve.x,{variant:"body",truncate:!0,id:n&&Ge(n,l)},l.url?e.createElement(Tt.r,{onClick:()=>{(0,y.ff)("manage_dashboards_result_clicked")},href:l.url,className:c.link},l.title):l.title)))}const Ft=t=>({chevron:(0,r.css)({marginRight:t.spacing(1),width:(0,He.Bm)(Fe)}),emptyText:(0,r.css)({overflow:"hidden"}),folderButtonSpacer:(0,r.css)({paddingLeft:`calc(${(0,He.Bm)(Fe)}px + ${t.spacing(1)})`}),iconNameContainer:(0,r.css)({alignItems:"center",display:"flex",gap:t.spacing(1),overflow:"hidden"}),link:(0,r.css)({"&:hover":{textDecoration:"underline"}})});var Ae=s(3532);function At({row:{original:t}}){const a=(0,v.wW)(Ot),n=t.item;return n.kind==="ui"?n.uiKind==="pagination-placeholder"?e.createElement(Ae.P.Skeleton,null):null:n.tags?e.createElement(Ae.P,{className:a.tagList,tags:n.tags}):null}function Ot(t){return{tagList:(0,r.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var Lt=s(69823);const Je=36,Xe=36;function Nt({items:t,width:a,height:n,isSelected:c,onFolderClick:l,onAllSelectionChange:o,onItemSelectionChange:i,isItemLoaded:d,requestLoadMore:h,canSelect:m=!1}){const u=(0,e.useId)(),f=(0,e.useRef)(null),p=(0,v.wW)(Ye);(0,e.useEffect)(()=>{f.current&&f.current.resetloadMoreItemsCache(!0)},[t]);const I=(0,e.useMemo)(()=>{const K={id:"checkbox",width:0,Header:wt,Cell:Mt},j={id:"name",width:3,Header:e.createElement("span",{style:{paddingLeft:24}},e.createElement(b.cC,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:Be=>e.createElement(xt,{...Be,onFolderClick:l})},pe={id:"tags",width:2,Header:(0,b.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:At};return[m&&K,j,pe].filter(Dt.fQ)},[l,m]),g=(0,St.useTable)({columns:I,data:t},Lt._),{getTableProps:E,getTableBodyProps:C,headerGroups:D}=g,M=(0,e.useMemo)(()=>({table:g,isSelected:c,onAllSelectionChange:o,onItemSelectionChange:i,treeID:u}),[g,c,o,i,t,u]),P=(0,e.useCallback)(K=>d(K),[d]),Z=(0,e.useCallback)((K,j)=>{const{parentUID:pe}=t[K];h(pe)},[h,t]);return e.createElement("div",{...E(),role:"table"},D.map(K=>{const{key:j,...pe}=K.getHeaderGroupProps({style:{width:a}});return e.createElement("div",{key:j,...pe,className:(0,r.cx)(p.row,p.headerRow)},K.headers.map(Re=>{const{key:Be,...Ba}=Re.getHeaderProps();return e.createElement("div",{key:Be,...Ba,role:"columnheader",className:p.cell},Re.render("Header",{isSelected:c,onAllSelectionChange:o}))}))}),e.createElement("div",{...C(),"data-testid":J.wl.pages.BrowseDashboards.table.body},e.createElement(ze.Z,{ref:f,itemCount:t.length,isItemLoaded:P,loadMoreItems:Z},({onItemsRendered:K,ref:j})=>e.createElement(ke.t7,{ref:j,height:n-Je,width:a,itemCount:t.length,itemData:M,itemSize:Xe,onItemsRendered:K},Rt))))}function Rt({index:t,style:a,data:n}){const c=(0,v.wW)(Ye),{table:l,isSelected:o,onItemSelectionChange:i,treeID:d}=n,{rows:h,prepareRow:m}=l,u=h[t];return m(u),e.createElement("div",{...u.getRowProps({style:a}),className:(0,r.cx)(c.row,c.bodyRow),"aria-labelledby":Ge(d,u.original.item),"data-testid":J.wl.pages.BrowseDashboards.table.row("title"in u.original.item?u.original.item.title:u.original.item.uid)},u.cells.map(f=>{const{key:p,...I}=f.getCellProps();return e.createElement("div",{key:p,...I,className:c.cell},f.render("Cell",{isSelected:o,onItemSelectionChange:i,treeID:d}))}))}const Ye=t=>({row:(0,r.css)({gap:t.spacing(1)}),headerRow:(0,r.css)({backgroundColor:t.colors.background.secondary,height:Je}),bodyRow:(0,r.css)({height:Xe,"&:hover":{backgroundColor:t.colors.emphasize(t.colors.background.primary,.03)}}),cell:(0,r.css)({padding:t.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,r.css)({"&:hover":{textDecoration:"underline"}})});function Bt({folderUID:t,width:a,height:n,canSelect:c}){const l=(0,R.zw)(t),o=(0,B.useDispatch)(),i=(0,R.Sk)(t),d=(0,R.aw)(),h=(0,R.$H)(),m=(0,e.useCallback)((g,E)=>{o((0,R.xm)({folderUID:g,isOpen:E})),E&&o((0,R.si)({parentUID:g,pageSize:xe.IV}))},[o]),u=(0,e.useCallback)((g,E)=>{o((0,R.wk)({item:g,isSelected:E}))},[o]),f=(0,e.useCallback)(g=>{if(g==="$all"){if(d.$all)return Q.Selected;for(const D of Object.values(d))if(typeof D!="boolean"){for(const M in D)if(D[M])return Q.Mixed}return Q.Unselected}return d[g.kind][g.uid]?Q.Selected:_e(g,h,d)?Q.Mixed:Q.Unselected},[d,h]),p=(0,e.useCallback)(g=>{const E=i[g];if(!E)return!1;const C=E.item;return!(C.kind==="ui"&&C.uiKind==="pagination-placeholder")},[i]),I=(0,R.D$)();return l==="fulfilled"&&i.length===0?e.createElement("div",{style:{width:a}},c?e.createElement(Ke.Z,{title:t?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:t?`dashboard/new?folderUid=${t}`:"dashboard/new",proTip:t&&"Add/move dashboards to your folder at ->",proTipLink:t&&"dashboards",proTipLinkTitle:t&&"Browse dashboards",proTipTarget:""}):e.createElement(bt._,{callToActionElement:e.createElement("span",null,"This folder is empty")})):e.createElement(Nt,{canSelect:c,items:i,width:a,height:n,isSelected:f,onFolderClick:m,onAllSelectionChange:g=>o((0,R.u6)({isSelected:g,folderUID:t})),onItemSelectionChange:u,isItemLoaded:p,requestLoadMore:I})}function _e(t,a,n){const c=a[t.uid];return c?c.items.some(l=>{const o=n[l.kind][l.uid];return o||_e(l,a,n)}):!1}var $t=s(53721),ve=s(13767),Oe=s(85001),qe=s(58047),Wt=s(87722),Ut=s(85830),Kt=s(96227),kt=s(38637),zt=s(17712);const Vt={folderName:""};function Zt({onCancel:t,onConfirm:a}){const n=(0,b.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),c=async o=>{try{return await zt.t.validateNewFolderName(o),!0}catch(i){if(i instanceof Error)return i.message;throw i}},l=(0,b.t)("browse-dashboards.new-folder-form.name-label","Folder name");return e.createElement(Ut.l,{defaultValues:Vt,onSubmit:o=>a(o.folderName),"data-testid":J.wl.pages.BrowseDashboards.NewFolderForm.form},({register:o,errors:i})=>e.createElement(e.Fragment,null,e.createElement(Kt.g,{label:l,invalid:!!i.folderName,error:i.folderName&&i.folderName.message},e.createElement(kt.I,{"data-testid":J.wl.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",...o("folderName",{required:n,validate:async d=>await c(d)})})),e.createElement(ce.Lh,null,e.createElement(U.zx,{variant:"secondary",fill:"outline",onClick:t},e.createElement(b.cC,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),e.createElement(U.zx,{type:"submit"},e.createElement(b.cC,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create")))))}function Ht({parentFolder:t,canCreateDashboard:a,canCreateFolder:n}){const[c,l]=(0,e.useState)(!1),o=(0,$t.TH)(),[i]=(0,Y.wo)(),[d,h]=(0,e.useState)(!1),m=async f=>{try{await i({title:f,parentUid:t?.uid});const p=t?.parents?t.parents.length+1:0;(0,y.ff)("grafana_manage_dashboards_folder_created",{is_subfolder:!!t?.uid,folder_depth:p})}finally{h(!1)}},u=e.createElement(ve.v,null,a&&e.createElement(Oe.s,{label:he(),onClick:()=>(0,y.ff)("grafana_menu_item_clicked",{url:De("/dashboard/new",t?.uid),from:o.pathname}),url:De("/dashboard/new",t?.uid)}),n&&e.createElement(Oe.s,{onClick:()=>h(!0),label:ge()}),a&&e.createElement(Oe.s,{label:fe(),onClick:()=>(0,y.ff)("grafana_menu_item_clicked",{url:De("/dashboard/import",t?.uid),from:o.pathname}),url:De("/dashboard/import",t?.uid)}));return e.createElement(e.Fragment,null,e.createElement(qe.L,{overlay:u,onVisibleChange:l},e.createElement(U.zx,null,ye(),e.createElement(q.J,{name:c?"angle-up":"angle-down"}))),d&&e.createElement(Wt.d,{title:ge(),subtitle:t?.title?`Location: ${t.title}`:void 0,onClose:()=>h(!1),size:"sm"},e.createElement(Zt,{onConfirm:m,onCancel:()=>h(!1)})))}function De(t,a){return a?t+"?folderUid="+a:t}var Qt=s(34112),Gt=s(98579),jt=s(53305),X=s(4236),Le=s(26967),et=s(25467);const ie=50,Jt={view:new Gt.U((0,jt.g0)({fields:[{name:"uid",display:!0,values:Array(ie).fill(null)},{name:"kind",display:!0,values:Array(ie).fill("dashboard")},{name:"name",display:!0,values:Array(ie).fill("")},{name:"location",display:!0,values:Array(ie).fill("")},{name:"tags",display:!0,values:Array(ie).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:ie};function Xt({width:t,height:a,canSelect:n}){const c=(0,B.useDispatch)(),l=(0,B.useSelector)(g=>g.browseDashboards.selectedItems),o=(0,R.QD)(),{keyboardEvents:i}=(0,Le.A)(),[d,h]=le(),m=d.result??Jt,u=(0,e.useCallback)((g,E)=>g?g==="*"&&E==="*"?o:g==="*"?!1:l[tt(g)][E]??!1:!1,[l,o]),f=(0,e.useCallback)(()=>{c((0,R.u6)({isSelected:!1,folderUID:void 0}))},[c]),p=(0,e.useCallback)((g,E)=>{const C=!u(g,E);c((0,R.wk)({item:{kind:tt(g),uid:E},isSelected:C}))},[u,c]);if(m.totalRows===0)return e.createElement("div",{style:{width:t}},e.createElement(X.Z,null,e.createElement(X.Z.Heading,null,e.createElement(b.cC,{i18nKey:"browse-dashboards.no-results.text"},"No results found for your query.")),e.createElement(X.Z.Actions,null,e.createElement(U.zx,{variant:"secondary",onClick:h.onClearSearchAndFilters},e.createElement(b.cC,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")))));const I={response:m,selection:n?u:void 0,selectionToggle:n?p:void 0,clearSelection:f,width:t,height:a,onTagSelected:h.onAddTag,keyboardEvents:i,onDatasourceChange:d.datasource?h.onDatasourceChange:void 0,onClickItem:h.onSearchItemClicked};return e.createElement(et.Q,{...I})}function tt(t){switch(t){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+t)}var Yt=s(33188);const at=(0,e.memo)(({match:t})=>{const{uid:a}=t.params,n=(0,B.useDispatch)(),c=(0,v.wW)(_t),[l,o]=le(),i=o.hasSearchFilters();(0,e.useEffect)(()=>{o.initStateFromUrl(a),n((0,R.u6)({isSelected:!1,folderUID:void 0}))},[n,a,o]),(0,e.useEffect)(()=>{!i&&l.result&&o.setState({result:void 0,includePanels:void 0})},[i,l.result,o]);const{data:d}=(0,Y.t4)(a??Y.CN),[h]=(0,Y.vN)(),m=(0,e.useMemo)(()=>{if(!d)return;const M=(0,W.B1)(d),P=(0,W.Pr)(d.uid),Z=M.children?.find(K=>K.id===P);return Z&&(Z.active=!0),M},[d]),u=(0,R.QD)(),{canEditFolders:f,canEditDashboards:p,canCreateDashboards:I,canCreateFolders:g}=(0,Yt.a)(d),E=f&&a,C=f||p,D=async M=>{if(d){const P=await h({...d,title:M});if("error"in P)throw(0,y.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:P.error}),P.error;(0,y.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,y.ff)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return e.createElement(w.T,{navId:"dashboards/browse",pageNav:m,onEditTitle:E?D:void 0,actions:e.createElement(e.Fragment,null,d&&e.createElement(Qt.A,{folder:d}),(I||g)&&e.createElement(Ht,{parentFolder:d,canCreateDashboard:I,canCreateFolder:g}))},e.createElement(w.T.Contents,{className:c.pageContents},e.createElement(L.H,{placeholder:me(l.includePanels),value:l.query,escapeRegex:!1,onChange:M=>o.onQueryChange(M)}),u?e.createElement(ht,null):e.createElement(Ct,null),e.createElement("div",{className:c.subView},e.createElement(S.Z,null,({width:M,height:P})=>i?e.createElement(Xt,{canSelect:C,width:M,height:P}):e.createElement(Bt,{canSelect:C,width:M,height:P,folderUID:a})))))}),_t=t=>({pageContents:(0,r.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:t.spacing(1)}),subView:(0,r.css)({height:"100%"})});at.displayName="BrowseDashboardsPage";const qt=at;var st=s(23334),ea=s(20367);const ta=t=>ea.ae.getFolderByUid(t,{withAccessControl:!0}).then(a=>{const n=(0,W.B1)(a);return n.children[0].active=!0,{folder:a,folderNav:n}});var re=s(97125),aa=s(48993);function sa(){const t=new Map;return{items:t,isSelected:(n,c)=>!!t.get(n)?.has(c)}}function na(t,a,n,c){const l=t.items;if(c.length){const o=l.get(n);if(o){for(const i of c)a?o.add(i):o.delete(i);o.size<1&&l.delete(n)}else a&&l.set(n,new Set(c))}return{items:l,isSelected:(o,i)=>{if(i==="*"){if(o==="*"){for(const d of l.keys())if(l.get(d)?.size)return!0;return!1}return!!l.get(o)?.size}return!!l.get(o)?.has(i)}}}var oa=s(17393),ra=s(4516),Ee=s(50820);const nt=(0,e.memo)(({onClick:t,className:a,checked:n=!1,editable:c=!1,"aria-label":l})=>c?e.createElement(ne.X,{onClick:t,className:a,value:n,"aria-label":l}):null);nt.displayName="SearchCheckbox";const la=J.wl.components.Search,ca=(t="")=>{const a=new Map([["errors","info-circle"],["views","eye"]]);return a.has(t)?a.get(t):"sort-amount-down"},ot=({item:t,isSelected:a,editable:n,onToggleChecked:c,onTagSelected:l,onClickItem:o})=>{const i=(0,v.wW)(da),d=(0,e.useCallback)((u,f)=>{f.stopPropagation(),f.preventDefault(),l(u)},[l]),h=(0,e.useCallback)(u=>{u.stopPropagation(),c&&c(t)},[t,c]),m=se.config.featureToggles.nestedFolders?e.createElement(e.Fragment,null,e.createElement(q.J,{name:(0,oe.J6)(t.kind),"aria-hidden":!0})," ",ia(t.kind)):e.createElement(e.Fragment,null,e.createElement(q.J,{name:(0,oe.J6)(t.parentKind??"folder"),"aria-hidden":!0})," ",t.parentTitle||"General");return e.createElement("div",{className:i.cardContainer},e.createElement(nt,{className:i.checkbox,"aria-label":"Select dashboard",editable:n,checked:a,onClick:h}),e.createElement(X.Z,{className:i.card,"data-testid":la.dashboardItem(t.title),href:t.url,style:{minHeight:T.CN},onClick:o},e.createElement(X.Z.Heading,null,t.title),e.createElement(X.Z.Meta,{separator:""},e.createElement("span",{className:i.metaContainer},m),t.sortMetaName&&e.createElement("span",{className:i.metaContainer},e.createElement(q.J,{name:ca(t.sortMetaName)}),t.sortMeta," ",t.sortMetaName)),e.createElement(X.Z.Tags,null,e.createElement(Ae.P,{tags:t.tags??[],onClick:d,getAriaLabel:u=>`Filter by tag "${u}"`}))))};function ia(t){switch(t){case"folder":return(0,b.t)("search.result-kind.folder","Folder");case"dashboard":return(0,b.t)("search.result-kind.dashboard","Dashboard");case"panel":return(0,b.t)("search.result-kind.panel","Panel")}}const da=t=>({cardContainer:(0,r.css)`
      display: flex;
      align-items: center;
      margin-bottom: ${t.spacing(.75)};
    `,card:(0,r.css)`
      padding: ${t.spacing(1)} ${t.spacing(2)};
      margin-bottom: 0;
    `,checkbox:(0,r.css)({marginRight:t.spacing(1)}),metaContainer:(0,r.css)`
      display: flex;
      align-items: center;
      margin-right: ${t.spacing(1)};

      svg {
        margin-right: ${t.spacing(.5)};
      }
    `});var ua=s(74681);async function rt(t,a,n=!1){if(!Ee.default.featureToggles.nestedFolders)return console.error("getFolderChildren requires nestedFolders feature toggle"),[];if(!n&&!t)return await(0,xe.ry)();const l=await(0,ua.O)().search({kind:["dashboard"],query:"*",location:t||"general",limit:1e3}),o=l.view.map(d=>(0,oe.f9)(d,l.view));return[...await(0,xe.ry)(t,a),...o]}async function ma(t,a){if(Ee.config.featureToggles.nestedFolders)return rt(t.uid,t.title);const n=t.itemsUIDs?{uid:t.itemsUIDs}:{query:"*",kind:["dashboard"],location:t.uid,sort:"name_sort",limit:1e3},c=await(0,N.getGrafanaSearcher)().search({...n,tags:a});return c.view.map(l=>(0,oe.f9)(l,c.view))}const lt=({section:t,selectionToggle:a,onClickItem:n,onTagSelected:c,selection:l,renderStandaloneBody:o,tags:i})=>{const d=t.uid,h=a!=null,m=(0,v.wW)(ha,h),[u,f]=(0,e.useState)(()=>window.localStorage.getItem(T.__)===d),p=(0,x.Z)(async()=>!u&&!o?Promise.resolve([]):ma(t,i),[u,i]),I=()=>{const P=!u;P?window.localStorage.setItem(T.__,d):window.localStorage.getItem(T.__)===d&&window.localStorage.removeItem(T.__),f(P)},g=P=>{if(P.preventDefault(),P.stopPropagation(),a&&l){const Z=!l(t.kind,t.uid);a(t.kind,t.uid);const K=p.value??[];for(const j of K)l(j.kind,j.uid)!==Z&&a(j.kind,j.uid)}},C=`section-header-label-${(0,e.useId)()}`;let D=(0,oa.iJ)(t.icon??"");D||(D=u?"folder-open":"folder");const M=()=>{if(p.value){if(p.value.length===0&&!p.loading)return e.createElement(X.Z,null,e.createElement(X.Z.Heading,null,"No results found"))}else return null;return p.value.map(P=>e.createElement(ot,{key:P.uid,item:P,onTagSelected:c,onToggleChecked:Z=>a?.(Z.kind,Z.uid),editable:l!=null,onClickItem:n,isSelected:l?.(P.kind,P.uid)}))};return o?e.createElement("div",{className:m.folderViewResults},!p.value?.length&&p.loading?e.createElement(Se.$,{className:m.spinner}):M()):e.createElement(ra.s,{headerDataTestId:J.wl.components.Search.folderHeader(t.title),contentDataTestId:J.wl.components.Search.folderContent(t.title),isOpen:u??!1,onToggle:I,className:m.wrapper,contentClassName:m.content,loading:p.loading,labelId:C,label:e.createElement(e.Fragment,null,a&&l&&e.createElement("div",{onClick:g},e.createElement(ne.X,{className:m.checkbox,value:l(t.kind,t.uid),"aria-label":(0,b.t)("search.folder-view.select-folder","Select folder")})),e.createElement("div",{className:m.icon},e.createElement(q.J,{name:D})),e.createElement("div",{className:m.text},e.createElement("span",{id:C},t.title),t.url&&t.uid!==T.YQ&&e.createElement("a",{href:t.url,className:m.link},e.createElement("span",{className:m.separator},"|")," ",e.createElement(q.J,{name:"folder-upload"})," ",(0,b.t)("search.folder-view.go-to-folder","Go to folder"))))},p.value&&e.createElement("ul",{className:m.sectionItems},M()))},ha=(t,a)=>{const n=t.spacing(1);return{wrapper:(0,r.css)`
      align-items: center;
      font-size: ${t.typography.size.base};
      padding: 12px;
      border-bottom: none;
      color: ${t.colors.text.secondary};
      z-index: 1;

      &:hover,
      &.selected {
        color: ${t.colors.text};
      }

      &:hover,
      &:focus-visible,
      &:focus-within {
        a {
          opacity: 1;
        }
      }
    `,sectionItems:(0,r.css)`
      margin: 0 24px 0 32px;
    `,icon:(0,r.css)`
      padding: 0 ${n} 0 ${a?0:n};
    `,folderViewResults:(0,r.css)`
      overflow: auto;
    `,text:(0,r.css)`
      flex-grow: 1;
      line-height: 24px;
    `,link:(0,r.css)`
      padding: 2px 10px 0;
      color: ${t.colors.text.secondary};
      opacity: 0;
      transition: opacity 150ms ease-in-out;
    `,separator:(0,r.css)`
      margin-right: 6px;
    `,content:(0,r.css)`
      padding-top: 0px;
      padding-bottom: 0px;
    `,spinner:(0,r.css)`
      display: grid;
      place-content: center;
      padding-bottom: 1rem;
    `,checkbox:(0,r.css)({marginRight:t.spacing(1)})}};var ga=s(32840),Me=s(44622);const fa=({results:t,onDeleteItems:a,onDismiss:n})=>{const c=(0,v.wW)(va),l=Array.from(t.get("dashboard")??[]),o=Array.from(t.get("folder")??[]),i=o.length,d=l.length;let h="Do you want to delete the ",m;const u=d===1?"":"s",f=i===1?"":"s";i>0&&d>0?(h+=`selected folder${f} and dashboard${u}?
`,m=`All dashboards and alerts of the selected folder${f} will also be deleted`):i>0?h+=`selected folder${f} and all ${i===1?"its":"their"} dashboards and alerts?`:h+=`${d} selected dashboard${u}?`;const p=()=>{(0,Me.Fd)(o,l).then(()=>{a(),n()})},I=Ee.config.featureToggles.nestedFolders&&i>0;return e.createElement(ga.s,{isOpen:!0,title:"Delete",body:e.createElement(e.Fragment,null,h," ",m&&e.createElement("div",{className:c.subtitle},m)),confirmText:"Delete",confirmationText:I?"delete":void 0,onConfirm:p,onDismiss:n})},va=t=>({subtitle:(0,r.css)`
    font-size: ${t.typography.fontSize}px;
    padding-top: ${t.spacing(2)};
  `});var Ea=s(73075),ct=s(33155),pa=s(67979),ya=s(90634);const it=({results:t,onMoveItems:a,onDismiss:n})=>{const[c,l]=(0,e.useState)(null),o=(0,v.wW)(ba),i=(0,ya.iG)(),[d,h]=(0,e.useState)(!1),m=Ee.default.featureToggles.nestedFolders,u=Array.from(t.get("dashboard")??[]),f=m?Array.from(t.get("folder")??[]).filter(E=>E!==T.YQ):[],p=(0,e.useCallback)(E=>{l(E)},[l]),I=async()=>{if(c){if(m){h(!0);let E=0,C=0;if(u.length){const M=await(0,Me.ct)(u,c);E+=M.totalCount,C+=M.successCount}if(f.length){const M=await(0,Me.Jx)(f,c);E+=M.totalCount,C+=M.successCount}const D=c.title??"General";Ca(i,D,{selectedDashboardsCount:u.length,selectedFoldersCount:f.length,totalCount:E,successCount:C}),a(),h(!1),n();return}if(u.length){const E=c.title??"General";h(!0),(0,Me.ct)(u,c).then(C=>{if(C.successCount>0){const D=C.successCount===1?"":"s",M=`Dashboard${D} Moved`,P=`${C.successCount} dashboard${D} moved to ${E}`;i.success(M,P)}C.totalCount===C.alreadyInFolderCount?i.error("Error",`Dashboard already belongs to folder ${E}`):a(),h(!1),n()})}}},g=[["folder","folders",f.length],["dashboard","dashboards",u.length]].filter(([E,C,D])=>D>0).map(([E,C,D])=>`${D.toLocaleString()} ${D===1?E:C}`).join(" and ");return e.createElement(Ea.u,{isOpen:!0,className:o.modal,title:m?"Move":"Choose Dashboard Folder",icon:"folder-plus",onDismiss:n},e.createElement(e.Fragment,null,e.createElement("div",{className:o.content},m&&f.length>0&&e.createElement(ct.b,{severity:"warning",title:" Moving this item may change its permissions"}),e.createElement("p",null,"Move ",g," to:"),e.createElement(pa.Fz,{allowEmpty:!0,enableCreateNew:!1,onChange:p})),e.createElement(ce.Lh,{justify:"flex-end"},e.createElement(U.zx,{variant:"secondary",onClick:n,fill:"outline"},"Cancel"),e.createElement(U.zx,{icon:d?"fa fa-spinner":void 0,variant:"primary",onClick:I},"Move"))))};function Ca(t,a,{selectedDashboardsCount:n,selectedFoldersCount:c,totalCount:l,successCount:o}){let i;const d=o===1?"":"s",h=l-o;if(n&&c?i=`Item${d}`:n?i=`Dashboard${d}`:c&&(i=`Folder${d}`),i){const m=i?.toLocaleLowerCase();l===o?t.success(`${i} moved`,`Moved ${o} ${m} to ${a}`):o===0?t.error(`Failed to move ${m}`,`Could not move ${l} ${m} due to an error`):t.warning(`Partially moved ${m}`,`Failed to move ${h} ${m} to ${a}`)}}const ba=t=>({modal:(0,r.css)`
      width: 500px;
    `,content:(0,r.css)`
      margin-bottom: ${t.spacing(3)};
    `});function Sa({items:t,folder:a,onChange:n,clearSelection:c}){const l=(0,v.wW)(Ue),o=a?.canSave,i=a?o:re.contextSrv.hasEditPermissionInFolders,d=i,m=Array.from(t.get("folder")??[]).find(D=>D===T.YQ),u=i&&!m,[f,p]=(0,e.useState)(!1),[I,g]=(0,e.useState)(!1),E=()=>{p(!0)},C=()=>{g(!0)};return e.createElement("div",{className:l.actionRow,"data-testid":"manage-actions"},e.createElement(ce.Lh,{spacing:"md",width:"auto"},e.createElement(Ze.h,{name:"check-square",onClick:c,tooltip:"Uncheck everything"}),e.createElement(U.zx,{disabled:!d,onClick:E,icon:"exchange-alt",variant:"secondary"},"Move"),e.createElement(U.zx,{disabled:!u,onClick:C,icon:"trash-alt",variant:"destructive"},"Delete")),I&&e.createElement(fa,{onDeleteItems:n,results:t,onDismiss:()=>g(!1)}),f&&e.createElement(it,{onMoveItems:n,results:t,onDismiss:()=>p(!1)}))}var Da=s(4148),Ma=s(81583);async function Pa(){if(Ee.default.featureToggles.nestedFolders)return rt();const t=(0,N.getGrafanaSearcher)(),a=await t.search({query:"*",kind:["folder"],sort:t.getFolderViewSort(),limit:1e3});return a.view.map(n=>(0,oe.f9)(n,a.view))}const wa=({selection:t,selectionToggle:a,onTagSelected:n,tags:c,hidePseudoFolders:l,onClickItem:o})=>{const i=(0,v.wW)(Ia),d=(0,x.Z)(async()=>{const m=await Pa();if(m.unshift({title:"General",url:"/dashboards",kind:"folder",uid:T.YQ}),!l){const u=await Ma.Z.getDashboardOpened();if(u.length&&m.unshift({title:"Recent",icon:"clock-nine",kind:"folder",uid:"__recent",itemsUIDs:u}),re.contextSrv.isSignedIn){const f=await(0,Da.i)().get("api/user/stars");f.length>0&&m.unshift({title:"Starred",icon:"star",kind:"folder",uid:"__starred",itemsUIDs:f})}}return m},[]),h=()=>d.loading?e.createElement(Se.$,{className:i.spinner}):d.value?d.value.map(m=>e.createElement("div",{"data-testid":J.wl.components.Search.sectionV2,className:i.section,key:m.title},m.title&&e.createElement(lt,{selection:t,selectionToggle:a,onTagSelected:n,section:m,tags:c,onClickItem:o}))):e.createElement(ct.b,{className:i.error,title:d.error?d.error.message:"Something went wrong"});return e.createElement("div",{className:i.wrapper},h())},Ia=t=>({wrapper:(0,r.css)`
      display: flex;
      flex-direction: column;
      overflow: auto;

      > ul {
        list-style: none;
      }

      border: solid 1px ${t.v1.colors.border2};
    `,section:(0,r.css)`
      display: flex;
      flex-direction: column;
      background: ${t.v1.colors.panelBg};

      &:not(:last-child) {
        border-bottom: solid 1px ${t.v1.colors.border2};
      }
    `,spinner:(0,r.css)`
      align-items: center;
      display: flex;
      justify-content: center;
      min-height: 100px;
    `,error:(0,r.css)`
      margin: ${t.spacing(4)} auto;
    `}),dt=e.memo(({response:t,width:a,height:n,selection:c,selectionToggle:l,onTagSelected:o,keyboardEvents:i,onClickItem:d})=>{const h=(0,v.wW)(Ta),m=(0,e.useRef)(null),[u,f]=(0,e.useState)(null),p=(0,Le.v)(i,0,t);(0,e.useEffect)(()=>{m.current&&m.current.resetloadMoreItemsCache(),u&&u.scrollTo(0)},[t,u]);const I=(0,e.useCallback)(({index:g,style:E})=>{let C="";g===p.y&&(C+=" "+h.selectedRow);const D=t.view.get(g),M=(0,oe.f9)(D,t.view),P=l&&c?.(M.kind,M.uid);return e.createElement("div",{style:E,key:D.uid,className:C,role:"row"},e.createElement(ot,{item:M,onTagSelected:o,onToggleChecked:Z=>{l&&l("dashboard",Z.uid)},editable:c!=null,onClickItem:d,isSelected:P}))},[t.view,p,h,o,c,l,d]);return t.totalRows?e.createElement("div",{"aria-label":"Search results list",style:{width:a},role:"list"},e.createElement(ze.Z,{ref:m,isItemLoaded:t.isItemLoaded,itemCount:t.totalRows,loadMoreItems:t.loadMoreItems},({onItemsRendered:g,ref:E})=>e.createElement(ke.t7,{ref:C=>{E(C),f(C)},onItemsRendered:g,height:n,itemCount:t.totalRows,itemSize:72,width:"100%",style:{overflow:"hidden auto"}},I))):e.createElement("div",{className:h.noData,style:{width:a}},"No data")});dt.displayName="SearchResultsCards";const Ta=t=>({noData:(0,r.css)`
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    `,selectedRow:(0,r.css)`
      border-left: 3px solid ${t.colors.primary.border};
    `}),xa=({showManage:t,folderDTO:a,hidePseudoFolders:n,keyboardEvents:c})=>{const l=(0,v.wW)(Fa),o=ue(),i=o.useState(),[d,h]=(0,e.useState)(sa()),m=We(i),u=m===F.A.Folders,[f,p]=(0,e.useState)(Date.now());(0,aa.Z)(o.onReportSearchUsage,1e3,[]);const I=(0,e.useCallback)(()=>{d.items.clear(),h({...d})},[d]),g=(0,e.useCallback)((D,M)=>{const P=d.isSelected(D,M);h(na(d,!P,D,[M]))},[d]),E=async()=>{I(),p(Date.now()),o.onQueryChange(i.query)},C=()=>{const D=i.result;if((!D||!D.totalRows)&&!u)return i.loading&&!D?e.createElement(Se.$,null):e.createElement("div",{className:l.noResults},e.createElement("div",null,e.createElement(b.cC,{i18nKey:"search-view.no-results.text"},"No results found for your query.")),e.createElement("br",null),e.createElement(U.zx,{variant:"secondary",onClick:o.onClearSearchAndFilters},e.createElement(b.cC,{i18nKey:"search-view.no-results.clear"},"Clear search and filters")));const M=t?d.isSelected:void 0;return m===F.A.Folders?a?e.createElement(lt,{section:Aa(a),selection:M,selectionToggle:g,onTagSelected:o.onAddTag,renderStandaloneBody:!0,tags:i.tag,key:f,onClickItem:o.onSearchItemClicked}):e.createElement(wa,{key:f,selection:M,selectionToggle:g,tags:i.tag,onTagSelected:o.onAddTag,hidePseudoFolders:n,onClickItem:o.onSearchItemClicked}):e.createElement("div",{style:{height:"100%",width:"100%"}},e.createElement(S.Z,null,({width:P,height:Z})=>{const K={response:D,selection:M,selectionToggle:g,clearSelection:I,width:P,height:Z,onTagSelected:o.onAddTag,keyboardEvents:c,onDatasourceChange:i.datasource?o.onDatasourceChange:void 0,onClickItem:o.onSearchItemClicked};return P<800?e.createElement(dt,{...K}):e.createElement(et.Q,{...K})}))};return a&&!(0,st.v)()&&!i.loading&&!i.result?.totalRows&&!o.hasSearchFilters()?e.createElement(Ke.Z,{title:"This folder doesn't have any dashboards yet",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:`dashboard/new?folderUid=${a.uid}`,proTip:"Add/move dashboards to your folder at ->",proTipLink:"dashboards",proTipLinkTitle:"Manage dashboards",proTipTarget:""}):e.createElement(e.Fragment,null,d.items.size>0?e.createElement(Sa,{items:d.items,onChange:E,clearSelection:I}):e.createElement(Te,{onLayoutChange:o.onLayoutChange,showStarredFilter:n,onStarredFilterChange:n?o.onStarredFilterChange:void 0,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,getTagOptions:o.getTagOptions,getSortOptions:(0,N.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,N.getGrafanaSearcher)().sortPlaceholder,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,state:i,includePanels:i.includePanels,onSetIncludePanels:o.onSetIncludePanels}),C())},Fa=t=>({searchInput:(0,r.css)`
    margin-bottom: 6px;
    min-height: ${t.spacing(4)};
  `,unsupported:(0,r.css)`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:(0,r.css)`
    padding: ${t.v1.spacing.md};
    background: ${t.v1.colors.bg2};
    font-style: italic;
    margin-top: ${t.v1.spacing.md};
  `});function Aa(t){return{uid:t.uid,kind:"folder",title:t.title}}const Oa=({folder:t,canCreateFolders:a=!1,canCreateDashboards:n=!1})=>{const[c,l]=(0,e.useState)(!1),o=se.config.featureToggles.nestedFolders&&(t?.canSave??!1),i=(0,e.useMemo)(()=>new Map([["folder",new Set(t?.uid?[t.uid]:[])]]),[t]),d=m=>{let u=`dashboard/${m}`;return m==="new_folder"&&(u="dashboards/folder/new/"),t?.uid&&(u+=`?folderUid=${t.uid}`),u},h=()=>e.createElement(ve.v,null,n&&e.createElement(ve.v.Item,{url:d("new"),label:he(),onClick:()=>(0,y.ff)("grafana_menu_item_clicked",{url:d("new"),from:"/dashboards"})}),a&&(se.config.featureToggles.nestedFolders||!t?.uid)&&e.createElement(ve.v.Item,{url:d("new_folder"),label:ge(),onClick:()=>(0,y.ff)("grafana_menu_item_clicked",{url:d("new_folder"),from:"/dashboards"})}),n&&e.createElement(ve.v.Item,{url:d("import"),label:fe(),onClick:()=>(0,y.ff)("grafana_menu_item_clicked",{url:d("import"),from:"/dashboards"})}));return e.createElement(e.Fragment,null,e.createElement("div",null,e.createElement(ce.Lh,null,o&&e.createElement(U.zx,{onClick:()=>l(!0),icon:"exchange-alt",variant:"secondary"},"Move"),e.createElement(qe.L,{overlay:h,placement:"bottom-start"},e.createElement(U.zx,{variant:"primary"},ye(),e.createElement(q.J,{name:"angle-down"}))))),o&&c&&e.createElement(it,{onMoveItems:()=>{},results:i,onDismiss:()=>l(!1)}))},ut=e.memo(({folder:t})=>{const a=(0,v.wW)(Na),n=ue(),c=n.useState(),{onKeyDown:l,keyboardEvents:o}=(0,Le.A)(),i=t?.uid,d=t?.canSave,{isEditor:h}=re.contextSrv,m=t?d:re.contextSrv.hasEditPermissionInFolders,u=re.contextSrv.hasPermission(B.AccessControlAction.FoldersCreate),f=i?re.contextSrv.hasPermissionInMetadata(B.AccessControlAction.DashboardsCreate,t):re.contextSrv.hasPermission(B.AccessControlAction.DashboardsCreate),p=t===void 0&&u||f;return(0,e.useEffect)(()=>n.initStateFromUrl(t?.uid),[t?.uid,n]),e.createElement(e.Fragment,null,e.createElement("div",{className:(0,r.cx)(a.actionBar,"page-action-bar")},e.createElement("div",{className:(0,r.cx)(a.inputWrapper,"gf-form gf-form--grow m-r-2")},e.createElement(L.H,{value:c.query??"",onChange:I=>n.onQueryChange(I),onKeyDown:l,autoFocus:!0,spellCheck:!1,placeholder:me(c.includePanels),escapeRegex:!1,className:a.searchInput})),p&&e.createElement(Oa,{folder:t,canCreateFolders:u,canCreateDashboards:f})),e.createElement(xa,{showManage:!!(h||m||d),folderDTO:t,hidePseudoFolders:!0,keyboardEvents:o}))});ut.displayName="ManageDashboardsNew";const La=ut,Na=t=>({actionBar:(0,r.css)`
    ${t.breakpoints.down("sm")} {
      flex-wrap: wrap;
    }
  `,inputWrapper:(0,r.css)`
    ${t.breakpoints.down("sm")} {
      margin-right: 0 !important;
    }
  `,searchInput:(0,r.css)`
    margin-bottom: 6px;
    min-height: ${t.spacing(4)};
  `,unsupported:(0,r.css)`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:(0,r.css)`
    padding: ${t.v1.spacing.md};
    background: ${t.v1.colors.bg2};
    font-style: italic;
    margin-top: ${t.v1.spacing.md};
  `}),Ne=(0,e.memo)(t=>(0,st.v)()?e.createElement(qt,{...t}):e.createElement(mt,{...t}));Ne.displayName="DashboardListPageFeatureToggle";const mt=(0,e.memo)(({match:t,location:a})=>{const{loading:n,value:c}=(0,x.Z)(()=>{const l=t.params.uid,o=a.pathname;return!l||!o.startsWith("/dashboards")?Promise.resolve({}):ta(l).then(({folder:i,folderNav:d})=>{const h=A.u.stripBaseFromUrl(i.url);return h!==a.pathname&&$.E1.replace(h),{folder:i,pageNav:d}})},[t.params.uid]);return e.createElement(w.T,{navId:"dashboards/browse",pageNav:c?.pageNav},e.createElement(w.T.Contents,{isLoading:n,className:(0,r.css)`
          display: flex;
          flex-direction: column;
          height: 100%;
        `},e.createElement(La,{folder:c?.folder})))});mt.displayName="DashboardListPage";const Ra=Ne},14741:(ee,k,s)=>{s.d(k,{Jy:()=>A,Nw:()=>w,OY:()=>x,Qw:()=>e,TP:()=>$});var r=s(72639);const e=(y,v)=>{(0,r.ff)(`${y}_viewed`,S(v))},x=(y,v)=>{(0,r.ff)(`${y}_result_clicked`,S(v))},A=(y,v)=>{(0,r.ff)(`${y}_query_submitted`,S(v))},$=(y,{error:v,...L})=>{(0,r.ff)(`${y}_query_failed`,{...S(L),error:v})},w=(y,v,L)=>{(0,r.ff)(`grafana_panel_inspect_${y}_${v}_clicked`,L)},S=y=>({layout:y.layout,starredFilter:y.starred??!1,sort:y.sortValue??"",tagCount:y.tagCount??0,queryLength:y.query?.length??0,includePanels:y.includePanels??!1})}}]);

//# sourceMappingURL=DashboardListPage.4d3dfc1a79c682fdfd76.js.map