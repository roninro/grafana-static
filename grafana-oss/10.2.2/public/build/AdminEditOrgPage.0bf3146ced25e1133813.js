"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2721],{23569:(G,U,e)=>{e.r(U),e.d(U,{default:()=>z});var n=e(39953),a=e(65489),I=e(33155),v=e(96276),L=e(85830),B=e(96227),W=e(38637),y=e(4919),T=e(13253),P=e(21308),f=e(57721),K=e(27994),d=e(4148),S=e(26893);const N=30,b=async i=>await(0,d.i)().get(`/api/orgs/${i}`),_=async(i,r)=>P.Vt.hasPermission(f.AccessControlAction.OrgUsersRead)?(0,d.i)().get(`/api/orgs/${i}/users/search`,(0,S.y)({perpage:N,page:r})):{orgUsers:[]},E=async(i,r)=>{const u=r.map(o=>o.userId),l=await(0,d.i)().post("/api/access-control/users/roles/search",{userIds:u,orgId:i});r.forEach(o=>{o.roles=l?l[o.userId]||[]:[]})},h=(i,r)=>(0,d.i)().patch(`/api/orgs/${r}/users/${i.userId}`,i),x=(i,r)=>(0,d.i)().delete(`/api/orgs/${r}/users/${i.userId}`),C=(i,r)=>(0,d.i)().put(`/api/orgs/${r}`,{name:i}),z=({match:i})=>{const r=parseInt(i.params.id,10),u=P.Vt.hasPermission(f.AccessControlAction.OrgsWrite),l=P.Vt.hasPermission(f.AccessControlAction.OrgUsersRead),[o,O]=(0,n.useState)([]),[m,$]=(0,n.useState)(1),[F,X]=(0,n.useState)(1),[D,A]=(0,a.Z)(()=>b(r),[]),[,g]=(0,a.Z)(async s=>{const c=await _(r,s);P.Vt.licensedAccessControlEnabled()&&await E(r,c.orgUsers);const R=c?.perPage!==0?Math.ceil(c.totalCount/c.perPage):0;return X(R),O(c.orgUsers),c.orgUsers},[]);(0,n.useEffect)(()=>{A(),g(m)},[A,g,m]);const M=async s=>{await C(s,r)},p=()=>n.createElement(I.b,{severity:"info",title:"Access denied"},"You do not have permission to see users in this organization. To update this organization, contact your server administrator."),Y=s=>{$(s)},Z=async s=>{await x(s,r),g(m)},j=async(s,c)=>{await h({...c,role:s},r),g(m)},t={text:D?.value?.name??"",icon:"shield",subTitle:"Manage settings and user roles for an organization."};return n.createElement(T.T,{navId:"global-orgs",pageNav:t,subTitle:"Manage settings for this specific org."},n.createElement(T.T.Contents,null,n.createElement(n.Fragment,null,n.createElement(v.D,null,"Edit organization"),D.value&&n.createElement(L.l,{defaultValues:{orgName:D.value.name},onSubmit:s=>M(s.orgName)},({register:s,errors:c})=>n.createElement(n.Fragment,null,n.createElement(B.g,{label:"Name",invalid:!!c.orgName,error:"Name is required",disabled:!u},n.createElement(W.I,{...s("orgName",{required:!0}),id:"org-name-input"})),n.createElement(y.zx,{type:"submit",disabled:!u},"Update"))),n.createElement("div",{style:{marginTop:"20px"}},n.createElement(v.D,null,"Organization users"),!l&&p(),l&&!!o.length&&n.createElement(K.q,{users:o,orgId:r,onRoleChange:j,onRemoveUser:Z,changePage:Y,page:m,totalPages:F})))))}},27994:(G,U,e)=>{e.d(U,{q:()=>i});var n=e(41407),a=e(39953),I=e(28888),v=e(82803),L=e(99503),B=e(51064),W=e(4919),y=e(12223),T=e(94696),P=e(39017),f=e(32840),K=e(69865),d=e(12190),S=e(10639),N=e(4171),b=e(90139),_=e(50820),E=e(21308),h=e(57721),x=e(65741);const C=`This user's role is not editable because it is synchronized from your auth provider.
  Refer to the Grafana authentication docs for details.`,V=l=>{let o=!E.Vt.hasPermissionInMetadata(h.AccessControlAction.OrgUsersWrite,l);return((Array.isArray(l.authLabels)&&l.authLabels.length>0?l.authLabels[0]:"")!=="grafana.com"||_.default.featureToggles.gcomOnlyExternalOrgRoleSync)&&(o=l?.isExternallySynced||o),o},z=I.wl.pages.UserListPage.UsersListPage,i=({users:l,orgId:o,onRoleChange:O,onRemoveUser:m,fetchData:$,changePage:F,page:X,totalPages:D,rolesLoading:A})=>{const[g,M]=(0,a.useState)(null),[p,Y]=(0,a.useState)([]),Z=(0,v.wW)(u);(0,a.useEffect)(()=>{async function t(){try{if(E.Vt.hasPermission(h.AccessControlAction.ActionRolesList)){let s=await(0,N.ul)(o);Y(s)}}catch{console.error("Error loading options")}}E.Vt.licensedAccessControlEnabled()&&t()},[o]);const j=(0,a.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:t}})=>t&&a.createElement(L.q,{src:t,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:t}})=>a.createElement("div",null,t),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:t}})=>t,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:t}})=>t,sortType:(t,s)=>new Date(t.original.lastSeenAt).getTime()-new Date(s.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:t},row:{original:s}})=>{const c=V(s);return E.Vt.licensedAccessControlEnabled()?a.createElement(S.R,{userId:s.userId,roles:s.roles||[],isLoading:A,orgId:o,roleOptions:p,basicRole:t,onBasicRoleChange:R=>O(R,s),basicRoleDisabled:c,basicRoleDisabledMessage:C,width:40}):a.createElement(x.A,{"aria-label":"Role",value:t,disabled:c,onChange:R=>O(R,s)})}},{id:"info",header:"",cell:r},{id:"authLabels",header:"Origin",cell:({cell:{value:t}})=>a.createElement(a.Fragment,null,Array.isArray(t)&&t.length>0&&a.createElement(b.e,{label:t[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:t}})=>a.createElement(a.Fragment,null,t&&a.createElement(B.V,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:t}})=>E.Vt.hasPermissionInMetadata(h.AccessControlAction.OrgUsersRemove,t)&&a.createElement(W.zx,{size:"sm",variant:"destructive",onClick:()=>{M(t)},icon:"times","aria-label":`Delete user ${t.name}`})}],[A,o,p,O]);return a.createElement(y.wc,{spacing:"md","data-testid":z.container},a.createElement("div",{className:Z.wrapper},a.createElement(T.e,{columns:j,data:l,getRowId:t=>String(t.userId),fetchData:$}),a.createElement(y.Lh,{justify:"flex-end"},a.createElement(P.t,{onNavigate:F,currentPage:X,numberOfPages:D,hideWhenSinglePage:!0}))),!!g&&a.createElement(f.s,{body:`Are you sure you want to delete user ${g?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{M(null)},isOpen:!0,onConfirm:()=>{g&&(m(g),M(null))}}))},r=({row:{original:l}})=>{const o=(0,v.wW)(u);return V(l)&&a.createElement("div",{className:o.row},a.createElement(K.u,{content:C},a.createElement(d.J,{name:"question-circle",className:o.icon})))},u=l=>({row:(0,n.css)({display:"flex",alignItems:"center"}),icon:(0,n.css)({marginLeft:l.spacing(1)}),wrapper:(0,n.css)({display:"flex",flexDirection:"column",overflowX:"auto",overflowY:"hidden",minHeight:"100vh",width:"100%","& > div":{overflowX:"unset",marginBottom:l.spacing(2)}})})}}]);

//# sourceMappingURL=AdminEditOrgPage.0bf3146ced25e1133813.js.map