"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7384],{61309:(F,I,t)=>{t.r(I),t.d(I,{EditNotificationChannelPage:()=>O,default:()=>K});var s=t(39953),e=t(32688),h=t(85830),T=t(28409),C=t(13253),N=t(16976),o=t.n(N),m=t(89772),f=t(57721),S=t(43686);const A=(R,p,E)=>$=>{const M=(0,m.connect)(R,p)($),i=n=>{const a=(0,f.useDispatch)();return(0,s.useEffect)(()=>function(){a((0,S.e)({cleanupAction:E}))},[a]),s.createElement(M,{...n})};return i.displayName=`ConnectWithCleanUp(${M.displayName})`,o()(i,$),i};var P=t(49302),c=t(4114),u=t(71854),r=t(81653);class O extends s.PureComponent{constructor(){super(...arguments),this.onSubmit=p=>{const{notificationChannel:E}=this.props;this.props.updateNotificationChannel({...(0,r.YV)({...E,...p,settings:{...E.settings,...p.settings}}),id:E.id})},this.onTestChannel=p=>{const{notificationChannel:E}=this.props;this.props.testNotificationChannel((0,r.dv)({...E,...p,settings:{...E.settings,...p.settings}}))}}componentDidMount(){this.props.loadNotificationChannel(parseInt(this.props.match.params.id,10))}render(){const{notificationChannel:p,notificationChannelTypes:E}=this.props;return s.createElement(C.T,{navId:"channels"},s.createElement(C.T.Contents,null,s.createElement("h2",{className:"page-sub-heading"},"Edit notification channel"),p&&p.id>0?s.createElement(h.l,{maxWidth:600,onSubmit:this.onSubmit,defaultValues:{...p,type:E.find($=>$.value===p.type)}},({control:$,errors:M,getValues:i,register:n,watch:a})=>{const d=E.find(g=>g.value===i().type.value);return s.createElement(P.w,{selectableChannels:(0,r.t7)(E,!0),selectedChannel:d,imageRendererAvailable:e.config.rendererAvailable,onTestChannel:this.onTestChannel,register:n,watch:a,errors:M,getValues:i,control:$,resetSecureField:this.props.resetSecureField,secureFields:p.secureFields})}):s.createElement("div",null,"Loading notification channel",s.createElement(T.$,null))))}}const x=R=>({notificationChannel:R.notificationChannel.notificationChannel,notificationChannelTypes:R.notificationChannel.notificationChannelTypes}),B={loadNotificationChannel:c.tk,testNotificationChannel:c.c1,updateNotificationChannel:c.fg,resetSecureField:u.J0},K=A(x,B,R=>R.notificationChannel=u.Gr)(O)},49302:(F,I,t)=>{t.d(I,{w:()=>$});var s=t(41407),e=t(39953),h=t(82803),T=t(28409),C=t(12223),N=t(4919),o=t(50820),m=t(96227),f=t(38637),S=t(9006),A=t(9558),P=t(13026),c=t(68421);const u=({control:i,option:n,register:a,invalid:d})=>{const g=n.secure?`secureSettings.${n.propertyName}`:`settings.${n.propertyName}`;switch(n.element){case"input":return e.createElement(f.I,{...a(`${g}`,{required:n.required?"Required":!1,validate:v=>n.validationRule!==""?r(v,n.validationRule):!0}),invalid:d,type:n.inputType,placeholder:n.placeholder});case"select":return e.createElement(S.g,{control:i,name:`${g}`,render:({field:{ref:v,...y}})=>e.createElement(A.Ph,{...y,options:n.selectOptions??void 0,invalid:d})});case"textarea":return e.createElement(c.K,{invalid:d,...a(`${g}`,{required:n.required?"Required":!1,validate:v=>n.validationRule!==""?r(v,n.validationRule):!0})});default:return console.error("Element not supported",n.element),null}},r=(i,n)=>RegExp(n).test(i)?!0:"Invalid format",O=({control:i,currentFormValues:n,errors:a,selectedChannelOptions:d,register:g,onResetSecureField:v,secureFields:y})=>e.createElement(e.Fragment,null,d.map((l,b)=>{const W=`${l.label}-${b}`,D=n[`settings.${l.showWhen.field}`]&&n[`settings.${l.showWhen.field}`].value;return l.showWhen.field&&D!==l.showWhen.is?null:l.element==="checkbox"?e.createElement(m.g,{key:W},e.createElement(P.X,{...g(l.secure?`secureSettings.${l.propertyName}`:`settings.${l.propertyName}`),label:l.label,description:l.description})):e.createElement(m.g,{key:W,label:l.label,description:l.description,invalid:a.settings&&!!a.settings[l.propertyName],error:a.settings&&a.settings[l.propertyName]?.message},y&&y[l.propertyName]?e.createElement(f.I,{readOnly:!0,value:"Configured",suffix:e.createElement(N.zx,{onClick:()=>v(l.propertyName),fill:"text",type:"button",size:"sm"},"Clear")}):e.createElement(u,{option:l,register:g,control:i}))})),x=({control:i,currentFormValues:n,errors:a,secureFields:d,selectedChannel:g,channels:v,register:y,resetSecureField:l})=>e.createElement(e.Fragment,null,e.createElement(m.g,{label:"Name",invalid:!!a.name,error:a.name&&a.name.message},e.createElement(f.I,{...y("name",{required:"Name is required"})})),e.createElement(m.g,{label:"Type"},e.createElement(S.g,{name:"type",render:({field:{ref:b,...W}})=>e.createElement(A.Ph,{...W,options:v}),control:i,rules:{required:!0}})),e.createElement(O,{selectedChannelOptions:g.options.filter(b=>b.required),currentFormValues:n,secureFields:d,onResetSecureField:l,register:y,errors:a,control:i}));var B=t(4516),K=t(33155);const R=({control:i,currentFormValues:n,errors:a,selectedChannel:d,secureFields:g,register:v,resetSecureField:y})=>e.createElement(B.s,{label:`Optional ${d.heading}`,isOpen:!1},d.info!==""&&e.createElement(K.b,{severity:"info",title:d.info??""}),e.createElement(O,{selectedChannelOptions:d.options.filter(l=>!l.required),currentFormValues:n,register:v,errors:a,control:i,onResetSecureField:y,secureFields:g}));var p=t(7429);const E=({currentFormValues:i,imageRendererAvailable:n,register:a})=>e.createElement(B.s,{label:"Notification settings",isOpen:!1},e.createElement(m.g,null,e.createElement(P.X,{...a("isDefault"),label:"Default",description:"Use this notification for all alerts"})),e.createElement(m.g,null,e.createElement(P.X,{...a("settings.uploadImage"),label:"Include image",description:"Captures an image and include it in the notification"})),i.uploadImage&&!n&&e.createElement(p.v,{title:"No image renderer available/installed"},"Grafana cannot find an image renderer to capture an image for the notification. Please make sure the Grafana Image Renderer plugin is installed. Please contact your Grafana administrator to install the plugin."),e.createElement(m.g,null,e.createElement(P.X,{...a("disableResolveMessage"),label:"Disable Resolve Message",description:"Disable the resolve message [OK] that is sent when alerting state returns to false"})),e.createElement(m.g,null,e.createElement(P.X,{...a("sendReminder"),label:"Send reminders",description:"Send additional notifications for triggered alerts"})),i.sendReminder&&e.createElement(e.Fragment,null,e.createElement(m.g,{label:"Send reminder every",description:`Specify how often reminders should be sent, e.g. every 30s, 1m, 10m, 30m', or 1h etc.
            Alert reminders are sent after rules are evaluated. A reminder can never be sent more frequently
            than a configured alert rule evaluation interval.`},e.createElement(f.I,{...a("frequency"),width:8})))),$=({control:i,errors:n,selectedChannel:a,selectableChannels:d,register:g,watch:v,getValues:y,imageRendererAvailable:l,onTestChannel:b,resetSecureField:W,secureFields:D})=>{const U=(0,h.wW)(M);(0,e.useEffect)(()=>{const z=new Set(a?.options.filter(j=>j.showWhen.field).map(j=>`settings.${j.showWhen.field}`))||[];v(["type","sendReminder","uploadImage",...z])},[a?.options,v]);const L=y();return a?e.createElement("div",{className:U.formContainer},e.createElement("div",{className:U.formItem},e.createElement(x,{selectedChannel:a,channels:d,secureFields:D,resetSecureField:W,currentFormValues:L,register:g,errors:n,control:i})),a.options.filter(z=>!z.required).length>0&&e.createElement("div",{className:U.formItem},e.createElement(R,{selectedChannel:a,secureFields:D,resetSecureField:W,currentFormValues:L,register:g,errors:n,control:i})),e.createElement("div",{className:U.formItem},e.createElement(E,{imageRendererAvailable:l,currentFormValues:L,register:g,errors:n,control:i})),e.createElement("div",{className:U.formButtons},e.createElement(C.Lh,null,e.createElement(N.zx,{type:"submit"},"Save"),e.createElement(N.zx,{type:"button",variant:"secondary",onClick:()=>b(y())},"Test"),e.createElement("a",{href:`${o.default.appSubUrl}/alerting/notifications`},e.createElement(N.zx,{type:"button",variant:"secondary"},"Back"))))):e.createElement(T.$,null)},M=i=>({formContainer:(0,s.css)``,formItem:(0,s.css)`
      flex-grow: 1;
      padding-top: ${i.spacing(2)};
    `,formButtons:(0,s.css)`
      padding-top: ${i.spacing(4)};
    `})},4114:(F,I,t)=>{t.d(I,{Au:()=>N,C2:()=>m,c1:()=>S,en:()=>o,fA:()=>A,fg:()=>f,tk:()=>P});var s=t(4148),e=t(13601),h=t(97316),T=t(90634),C=t(71854);function N(c){return async u=>{u((0,C.gz)());const r=await(0,s.i)().get("/api/alerts",c);u((0,C.Oc)(r))}}function o(c,u){return async r=>{await(0,s.i)().post(`/api/alerts/${c}/pause`,u);const O=e.E1.getSearchObject().state||"all";r(N({state:O.toString()}))}}function m(c){return async u=>{try{await(0,s.i)().post("/api/alert-notifications",c),u((0,h.$l)((0,T.AT)("Notification created"))),e.E1.push("/alerting/notifications")}catch(r){(0,s.kW)(r)&&u((0,h.$l)((0,T.t_)(r.data.error)))}}}function f(c){return async u=>{try{await(0,s.i)().put(`/api/alert-notifications/${c.id}`,c),u((0,h.$l)((0,T.AT)("Notification updated")))}catch(r){(0,s.kW)(r)&&u((0,h.$l)((0,T.t_)(r.data.error)))}}}function S(c){return async(u,r)=>{const O=r().notificationChannel.notificationChannel;await(0,s.i)().post("/api/alert-notifications/test",{id:O.id,...c})}}function A(){return async c=>{const r=(await(0,s.i)().get("/api/alert-notifiers")).sort((O,x)=>O.name>x.name?1:-1);c((0,C.T2)(r))}}function P(c){return async u=>{await u(A());const r=await(0,s.i)().get(`/api/alert-notifications/${c}`);u((0,C.K)(r))}}},81653:(F,I,t)=>{t.d(I,{Pg:()=>h,YV:()=>C,dv:()=>N,t7:()=>T});var s=t(16360),e=t(32688);const h={id:-1,name:"",type:{value:"email",label:"Email"},sendReminder:!1,disableResolveMessage:!1,frequency:"15m",settings:{uploadImage:e.config.rendererAvailable,autoResolve:!0,httpMethod:"POST",severity:"critical"},secureSettings:{},secureFields:{},isDefault:!1},T=(0,s.Z)((o,m)=>o.map(f=>m?{value:f.value,label:f.label,description:f.description}:{value:f.value,label:f.label})),C=o=>{const m=Object.fromEntries(Object.entries(o.settings).map(([f,S])=>[f,S&&S.hasOwnProperty("value")?S.value:S]));return{...h,...o,frequency:o.frequency===""?h.frequency:o.frequency,type:o.type.value,settings:{...h.settings,...m},secureSettings:{...o.secureSettings}}},N=o=>({name:o.name,type:o.type.value,frequency:o.frequency??h.frequency,settings:{...Object.assign(h.settings,o.settings)},secureSettings:{...o.secureSettings}})}}]);

//# sourceMappingURL=EditNotificationChannel.401eddfcef13e9a36b31.js.map