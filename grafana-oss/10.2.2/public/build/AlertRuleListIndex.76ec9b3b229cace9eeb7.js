"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2461,4286],{9661:(re,G,a)=>{a.d(G,{x:()=>M});var n=a(39953),e=a(57721),f=a(43686);function M(v){const D=(0,e.useDispatch)(),E=(0,n.useRef)(v);E.current=v,(0,n.useEffect)(()=>()=>{D((0,f.e)({cleanupAction:E.current}))},[D])}},26090:(re,G,a)=>{a.r(G),a.d(G,{AlertRuleListUnconnected:()=>he,default:()=>Se});var n=a(39953),e=a(89772),f=a(13601),M=a(32688),v=a(41245),D=a(9558),E=a(4919),y=a(12223),T=a(28833),w=a(13253),R=a(73431),F=a(73075);function h({onDismiss:N}){return n.createElement(F.u,{title:"Adding an Alert",isOpen:!0,onDismiss:N,onClickBackdrop:N},n.createElement(y.wc,{spacing:"sm"},n.createElement("img",{src:"public/img/alert_howto_new.png",alt:""}),n.createElement("p",null,"Alerts are added and configured in the Alert tab of any dashboard graph panel, letting you build and visualize an alert using existing queries."),n.createElement("p",null,"Remember to save the dashboard to persist your alert rule changes.")))}var o=a(90135),p=a.n(o),K=a(4236),O=a(12190);const se=({rule:N,search:$,onTogglePause:X})=>{const xe=`${N.url}?editPanel=${N.panelId}&tab=alert`,_=(0,n.useCallback)(Pe=>n.createElement(p(),{key:Pe,highlightClassName:"highlight-search-match",textToHighlight:Pe,searchWords:[$]}),[$]);return n.createElement(K.Z,null,n.createElement(K.Z.Heading,null,_(N.name)),n.createElement(K.Z.Figure,null,n.createElement(O.J,{size:"xl",name:N.stateIcon,className:`alert-rule-item__icon ${N.stateClass}`})),n.createElement(K.Z.Meta,null,n.createElement("span",{key:"state"},n.createElement("span",{key:"text",className:`${N.stateClass}`},_(N.stateText)," "),"for ",N.stateAge),N.info?_(N.info):null),n.createElement(K.Z.Actions,null,n.createElement(E.zx,{key:"play",variant:"secondary",icon:N.state==="paused"?"play":"pause",onClick:X},N.state==="paused"?"Resume":"Pause"),n.createElement(E.Qj,{key:"edit",variant:"secondary",href:xe,icon:"cog"},"Edit alert")))};var Ee=a(33155);const Ce="grafana.legacyalerting.unifiedalertingpromo",ve=()=>n.createElement(Ee.b,{severity:"warning",title:"Grafana legacy alerting is deprecated and will be removed in a future release."},n.createElement("p",null,"You are using Grafana legacy alerting, which has been deprecated since Grafana 9.0. The codebase is now staying as is and will be removed in Grafana 11.0.",n.createElement("br",null),"We recommend upgrading to Grafana Alerting as soon as possible."),n.createElement("p",null,"See"," ",n.createElement("a",{href:"https://grafana.com/docs/grafana/latest/alerting/migrating-alerts/"},"how to upgrade to Grafana Alerting")," ","to learn more."));var ge=a(4114),Oe=a(71854);const Le=N=>N.searchQuery,ae=N=>{const $=new RegExp(N.alertRules.searchQuery,"i");return N.alertRules.items.filter(X=>$.test(X.name)||$.test(X.stateText)||$.test(X.info))},He=(N,$)=>N.notificationChannel.id===$?N.notificationChannel:null;function be(N){return{alertRules:ae(N),search:Le(N.alertRules),isLoading:N.alertRules.isLoading}}const ue={getAlertRulesAsync:ge.Au,setSearchQuery:Oe.ql,togglePauseAlertRule:ge.en},Fe=(0,e.connect)(be,ue);class he extends n.PureComponent{constructor(){super(...arguments),this.stateFilters=[{label:"All",value:"all"},{label:"OK",value:"ok"},{label:"Not OK",value:"not_ok"},{label:"Alerting",value:"alerting"},{label:"No data",value:"no_data"},{label:"Paused",value:"paused"},{label:"Pending",value:"pending"}],this.onStateFilterChanged=$=>{f.E1.partial({state:$.value})},this.onOpenHowTo=()=>{T.Z.publish(new R.Dn({component:h}))},this.onSearchQueryChange=$=>{this.props.setSearchQuery($)},this.onTogglePause=$=>{this.props.togglePauseAlertRule($.id,{paused:$.state!=="paused"})},this.alertStateFilterOption=({text:$,value:X})=>n.createElement("option",{key:X,value:X},$)}componentDidMount(){this.fetchRules()}componentDidUpdate($){$.queryParams.state!==this.props.queryParams.state&&this.fetchRules()}async fetchRules(){await this.props.getAlertRulesAsync({state:this.getStateFilter()})}getStateFilter(){return this.props.queryParams.state??"all"}render(){const{alertRules:$,search:X,isLoading:xe}=this.props;return n.createElement(w.T,{navId:"alert-list"},n.createElement(w.T.Contents,{isLoading:xe},n.createElement("div",{className:"page-action-bar"},n.createElement("div",{className:"gf-form gf-form--grow"},n.createElement(v.H,{placeholder:"Search alerts",value:X,onChange:this.onSearchQueryChange})),n.createElement("div",{className:"gf-form"},n.createElement("label",{className:"gf-form-label",htmlFor:"alert-state-filter"},"States"),n.createElement("div",{className:"width-13"},n.createElement(D.Ph,{inputId:"alert-state-filter",options:this.stateFilters,onChange:this.onStateFilterChanged,value:this.getStateFilter()}))),n.createElement("div",{className:"page-action-bar__spacer"}),M.config.unifiedAlertingEnabled&&n.createElement(E.Qj,{variant:"primary",href:"alerting/ng/new"},"Add NG Alert"),n.createElement(E.zx,{variant:"secondary",onClick:this.onOpenHowTo},"How to add an alert")),n.createElement(ve,null),n.createElement(y.wc,{spacing:"none"},$.map(_=>n.createElement(se,{rule:_,key:_.id,search:X,onTogglePause:()=>this.onTogglePause(_)})))))}}const Se=Fe(he)},4114:(re,G,a)=>{a.d(G,{Au:()=>D,C2:()=>y,c1:()=>w,en:()=>E,fA:()=>R,fg:()=>T,tk:()=>F});var n=a(4148),e=a(13601),f=a(97316),M=a(90634),v=a(71854);function D(h){return async o=>{o((0,v.gz)());const p=await(0,n.i)().get("/api/alerts",h);o((0,v.Oc)(p))}}function E(h,o){return async p=>{await(0,n.i)().post(`/api/alerts/${h}/pause`,o);const K=e.E1.getSearchObject().state||"all";p(D({state:K.toString()}))}}function y(h){return async o=>{try{await(0,n.i)().post("/api/alert-notifications",h),o((0,f.$l)((0,M.AT)("Notification created"))),e.E1.push("/alerting/notifications")}catch(p){(0,n.kW)(p)&&o((0,f.$l)((0,M.t_)(p.data.error)))}}}function T(h){return async o=>{try{await(0,n.i)().put(`/api/alert-notifications/${h.id}`,h),o((0,f.$l)((0,M.AT)("Notification updated")))}catch(p){(0,n.kW)(p)&&o((0,f.$l)((0,M.t_)(p.data.error)))}}}function w(h){return async(o,p)=>{const K=p().notificationChannel.notificationChannel;await(0,n.i)().post("/api/alert-notifications/test",{id:K.id,...h})}}function R(){return async h=>{const p=(await(0,n.i)().get("/api/alert-notifiers")).sort((K,O)=>K.name>O.name?1:-1);h((0,v.T2)(p))}}function F(h){return async o=>{await o(R());const p=await(0,n.i)().get(`/api/alert-notifications/${h}`);o((0,v.K)(p))}}},94280:(re,G,a)=>{a.r(G),a.d(G,{default:()=>pa});var n=a(41407),e=a(39953),f=a(65489),M=a(21891),v=a(27366),D=a(41393),E=a(82803),y=a(4919),T=a(67650),w=a(57721),R=a(79517),F=a(53721),h=a(948),o=a(69307),p=a(13767),K=a(85001),O=a(58047),Y=a(12190),se=a(84766),Ee=a(26516),Ce=a(91753),ve=a(42527),ge=a(15898);function Oe({onClose:t}){const[r,l]=(0,e.useState)("yaml");return e.createElement(ve.i,{activeTab:r,onTabChange:l,onClose:t,formatProviders:Object.values(ge.uN)},e.createElement(Le,{exportFormat:r,onClose:t}))}function Le({exportFormat:t,onClose:r}){const{currentData:l="",isFetching:c}=Ee.alertRuleApi.endpoints.exportRules.useQuery({format:t}),s=`alert-rules-${new Date().getTime()}`;return c?e.createElement(se.u,{text:"Loading...."}):e.createElement(Ce.u,{format:t,textDefinition:l,downloadFileName:s,onClose:r})}var ae=a(18314);function He({}){const[t,r]=(0,ae.xC)(ae.hB.ViewAlertRule),[l,c]=(0,ae.xC)(ae.hB.CreateAlertRule),[s,i]=(0,ae.xC)(ae.hB.CreateExternalAlertRule),u=l&&c,m=s&&i,g=(0,F.TH)(),[d,C]=(0,h.Z)(!1),S=e.createElement(p.v,null,(u||m)&&e.createElement(K.s,{url:o.Cj.renderUrl("alerting/new/recording",{returnTo:g.pathname+g.search}),label:"New recording rule"}),r&&e.createElement(K.s,{onClick:C,label:"Export all Grafana-managed rules"}));return e.createElement(e.Fragment,null,(u||m)&&e.createElement(y.Qj,{href:o.Cj.renderUrl("alerting/new/alerting",{returnTo:g.pathname+g.search}),icon:"plus",onClick:()=>(0,R.PN)(R.z7.alertRuleFromScratch)},"New alert rule"),e.createElement(O.L,{overlay:S},e.createElement(y.zx,{variant:"secondary"},"More",e.createElement(Y.J,{name:"angle-down"}))),d&&e.createElement(Oe,{onClose:C}))}var be=a(762),ue=a(54538),Fe=a(80318),he=a(11906),Se=a(84367);const N=()=>{const{canCreateGrafanaRules:t,canCreateCloudRules:r}=(0,Se.B)(),l=(0,E.wW)($);return t||r?e.createElement("div",null,e.createElement("p",null,"You haven't created any alert rules yet"),e.createElement(v.K,{direction:"row",gap:1,alignItems:"stretch",flexGrow:1},e.createElement("div",{className:l.newRuleCard},e.createElement(he.Z,{title:"",buttonIcon:"bell",buttonLink:"alerting/new/alerting",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,ue.PN)(R.z7.alertRuleFromScratch)})),e.createElement("div",{className:l.newRuleCard},e.createElement(he.Z,{title:"",buttonIcon:"plus",buttonLink:"alerting/new/recording",buttonTitle:"New recording rule",onClick:()=>(0,ue.PN)(R.z7.recordingRuleFromScratch)})))):e.createElement(Fe._,{message:"No rules exist yet.",callToActionElement:e.createElement("div",null)})},$=t=>({newRuleCard:(0,n.css)`
    width: calc(50% - ${t.spacing(1)});

    > div {
      height: 100%;
    }
  `});var X=a(61403),xe=a(71757),_=a.n(xe),Pe=a(973),dt=a(33155),Ne=a(69865),oe=a(26544),j=a(95712),pe=a(76716),J=a(15032);function gt(){const[t,r]=(0,e.useState)(!1),[l,c]=(0,Pe.Z)("grafana.unifiedalerting.hideErrors",!1),s=(0,oe._)(d=>d.dataSources),i=(0,oe._)(d=>d.promRules),u=(0,oe._)(d=>d.rulerRules),m=(0,E.wW)(Ve),g=(0,e.useMemo)(()=>{const[d,C,S]=[s,i,u].map(P=>(0,j.Eu)().reduce((x,z)=>{const ne=P[z.name]?.error;return P[z.name]&&ne&&!(0,J.m$)(P[z.name])?[...x,{dataSource:z,error:ne}]:x},[])),L=i[j.GC]?.error,I=u[j.GC]?.error,A=[];return L&&A.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules state: ",L.message||"Unknown error.")),I&&A.push(e.createElement(e.Fragment,null,"Failed to load Grafana rules config: ",I.message||"Unknown error.")),d.forEach(({dataSource:P,error:x})=>{A.push(e.createElement(e.Fragment,null,"Failed to load the data source configuration for"," ",e.createElement("a",{href:(0,pe.__)(P),className:m.dsLink},P.name),": ",x.message||"Unknown error."))}),C.forEach(({dataSource:P,error:x})=>A.push(e.createElement(e.Fragment,null,"Failed to load rules state from"," ",e.createElement("a",{href:(0,pe.__)(P),className:m.dsLink},P.name),": ",x.message||"Unknown error."))),S.forEach(({dataSource:P,error:x})=>A.push(e.createElement(e.Fragment,null,"Failed to load rules config from"," ",e.createElement("a",{href:(0,pe.__)(P),className:m.dsLink},P.name),": ",x.message||"Unknown error."))),A},[s,i,u,m.dsLink]);return e.createElement(e.Fragment,null,!!g.length&&l&&e.createElement(pt,{count:g.length,onClick:()=>c(d=>!d)}),!!g.length&&!l&&e.createElement(dt.b,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>c(!0)},t&&g.map((d,C)=>e.createElement("div",{key:C},d)),!t&&e.createElement(e.Fragment,null,e.createElement("div",null,g[0]),g.length>=2&&e.createElement(y.zx,{className:m.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>r(!0)},g.length-1," more ",_()("error",g.length-1)))))}const pt=({count:t,onClick:r})=>{const l=(0,E.wW)(Ve);return e.createElement("div",{className:l.floatRight},e.createElement(Ne.u,{content:"Show all errors",placement:"bottom"},e.createElement(y.zx,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:r},t>1?e.createElement(e.Fragment,null,t," errors"):e.createElement(e.Fragment,null,"1 error"))))},Ve=t=>({moreButton:(0,n.css)`
    padding: 0;
  `,floatRight:(0,n.css)`
    display: flex;
    justify-content: flex-end;
  `,dsLink:(0,n.css)`
    font-weight: ${t.typography.fontWeightBold};
  `});var Qe=a(81456),$e=a(28409),je=a(39017),Ze=a(74602),Je=a(73278),Ye=a(3128),Ae=a(57675),Xe=a(12223),Ue=a(12608),ft=a(32840),Et=a(13916),vt=a(2592),De=a(79493),ke=a(98934),qe=a(38153);function ht({folder:t,onClose:r}){const[l,c]=(0,e.useState)("yaml");return e.createElement(ve.i,{title:`Export ${t.title} rules`,activeTab:l,onTabChange:c,onClose:r,formatProviders:Object.values(ge.uN)},e.createElement(xt,{folder:t,exportFormat:l,onClose:r}))}function xt({folder:t,exportFormat:r,onClose:l}){const{currentData:c="",isFetching:s}=Ee.alertRuleApi.endpoints.exportRules.useQuery({folderUid:t.uid,format:r});if(s)return e.createElement(se.u,{text:"Loading...."});const i=`${t.title}-${t.uid}`;return e.createElement(Ce.u,{format:r,textDefinition:c,downloadFileName:i,onClose:l})}function yt({folderUid:t,groupName:r,onClose:l}){const[c,s]=(0,e.useState)("yaml");return e.createElement(ve.i,{title:`Export ${r} rules`,activeTab:c,onTabChange:s,onClose:l,formatProviders:Object.values(ge.uN)},e.createElement(Rt,{folderUid:t,groupName:r,exportFormat:c,onClose:l}))}function Rt({folderUid:t,groupName:r,exportFormat:l,onClose:c}){const{currentData:s="",isFetching:i}=Ee.alertRuleApi.endpoints.exportRules.useQuery({folderUid:t,group:r,format:l});return i?e.createElement(se.u,{text:"Loading...."}):e.createElement(Ce.u,{format:l,textDefinition:s,downloadFileName:r,onClose:c})}var le=a(57912),Ct=a(79998),St=a(77814),_e=a.n(St),Te=a(86832),We=a(24058),Pt=a(73075),Nt=a(74600),At=a(30391),Dt=a(10162);const Tt=t=>{const{group:r,namespace:l,onClose:c}=t,[s,i]=(0,e.useState)(!1),[u,m]=(0,e.useState)(r.rules),g=(0,E.wW)(we),d=(0,e.useCallback)(S=>{if(!S.destination||S.destination.index===S.source.index)return;const I=Mt(u,S.source.index,S.destination.index);m(I);const A=(0,j.EG)(l.rulesSource),P=(0,Te.compact)(I.map(x=>x.rulerRule));i(!0),(0,Nt.WI)((0,De.tg)({namespaceName:l.name,groupName:r.name,rulesSourceName:A,newRules:P})).unwrap().finally(()=>{i(!1)})},[r.name,l.name,l.rulesSource,u]),C=u.map(S=>({...S,uid:String((0,At.Om)(S.rulerRule))}));return e.createElement(Pt.u,{className:g.modal,isOpen:!0,title:e.createElement(It,{namespace:l,group:r}),onDismiss:c,onClickBackdrop:c},e.createElement(We.Z5,{onDragEnd:d},e.createElement(We.bK,{droppableId:"alert-list",mode:"standard",renderClone:(S,L,I)=>e.createElement(et,{provided:S,rule:C[I.source.index],isClone:!0})},S=>e.createElement("div",{ref:S.innerRef,className:_e()(g.listContainer,s&&g.disabled),...S.droppableProps},C.map((L,I)=>e.createElement(We._l,{key:L.uid,draggableId:L.uid,index:I,isDragDisabled:s},A=>e.createElement(et,{key:L.uid,provided:A,rule:L}))),S.placeholder))))},et=({provided:t,rule:r,isClone:l=!1,isDragging:c=!1})=>{const s=(0,E.wW)(we);return e.createElement("div",{className:_e()(s.listItem,l&&"isClone",c&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps},(0,J.x_)(r.promRule)&&e.createElement(Dt.l,{state:r.promRule.state}),(0,J.OP)(r.promRule)&&e.createElement(Ue.C,{text:"Recording",color:"blue"}),e.createElement("div",{className:s.listItemName},r.name),e.createElement(Y.J,{name:"draggabledots"}))},It=({namespace:t,group:r})=>{const l=(0,E.wW)(we);return e.createElement("div",{className:l.header},e.createElement(Y.J,{name:"folder"}),(0,j.jq)(t.rulesSource)&&e.createElement(Ne.u,{content:t.rulesSource.name,placement:"top"},e.createElement("img",{alt:t.rulesSource.meta.name,className:l.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})),e.createElement("span",null,t.name),e.createElement(Y.J,{name:"angle-right"}),e.createElement("span",null,r.name))},we=t=>({modal:(0,n.css)`
    max-width: 640px;
    max-height: 80%;
    overflow: hidden;
  `,listItem:(0,n.css)`
    display: flex;
    flex-direction: row;
    align-items: center;

    gap: ${t.spacing()};

    background: ${t.colors.background.primary};
    color: ${t.colors.text.secondary};

    border-bottom: solid 1px ${t.colors.border.medium};
    padding: ${t.spacing(1)} ${t.spacing(2)};

    &:last-child {
      border-bottom: none;
    }

    &.isClone {
      border: solid 1px ${t.colors.primary.shade};
    }
  `,listContainer:(0,n.css)`
    user-select: none;
    border: solid 1px ${t.colors.border.medium};
  `,disabled:(0,n.css)`
    opacity: 0.5;
    pointer-events: none;
  `,listItemName:(0,n.css)`
    flex: 1;

    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  `,header:(0,n.css)`
    display: flex;
    align-items: center;

    gap: ${t.spacing(1)};
  `,dataSourceIcon:(0,n.css)`
    width: ${t.spacing(2)};
    height: ${t.spacing(2)};
  `});function Mt(t,r,l){const c=Array.from(t),[s]=c.splice(r,1);return c.splice(l,0,s),c}var tt=a(8896),at=a(72776);const Be=e.memo(({group:t,namespace:r,expandAll:l,viewMode:c})=>{const{rulesSource:s}=r,i=(0,w.useDispatch)(),u=(0,E.wW)(Ot),[m,g]=(0,e.useState)(!1),[d,C]=(0,e.useState)(!1),[S,L]=(0,e.useState)(!1),[I,A]=(0,e.useState)(void 0),[P,x]=(0,e.useState)(!l),{canEditRules:z}=(0,Se.B)();(0,e.useEffect)(()=>{x(!l)},[l]);const{hasRuler:ne,rulerRulesLoaded:H}=(0,vt.h)(),V=t.rules[0]?.rulerRule,k=V&&(0,J.Pc)(V)&&V.grafana_alert.namespace_uid||void 0,{folder:U}=(0,Et.W)(k),b=ne(s)&&H(s)&&!t.rules.find(te=>!!te.rulerRule),W=(0,J.Jq)(t),me=t.rules.some(te=>(0,J.Pc)(te.rulerRule)&&te.rulerRule.grafana_alert.provenance),de=c==="list",B=c==="grouped",ee=()=>{i((0,De.oE)(r,t)),C(!1)},Z=[];if(b)Z.push(e.createElement(Xe.Lh,{key:"is-deleting"},e.createElement($e.$,null),"deleting"));else if(s===j.GC){if(k){const te=(0,pe.HV)(k);U?.canSave&&(B&&!me&&(Z.push(e.createElement(le.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>g(!0)})),Z.push(e.createElement(le.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"reorder rules",className:u.rotate90,onClick:()=>L(!0)}))),de&&(Z.push(e.createElement(le.A,{"aria-label":"go to folder",key:"goto",icon:"folder-open",tooltip:"go to folder",to:te,target:"__blank"})),U?.canAdmin&&Z.push(e.createElement(le.A,{"aria-label":"manage permissions",key:"manage-perms",icon:"lock",tooltip:"manage permissions",to:te+"/permissions",target:"__blank"})))),U&&(de?Z.push(e.createElement(le.A,{"aria-label":"export rule folder","data-testid":"export-folder",key:"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>A("folder")})):B&&Z.push(e.createElement(le.A,{"aria-label":"export rule group","data-testid":"export-group",key:"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>A("group")})))}}else z(s.name)&&ne(s)&&(W||(Z.push(e.createElement(le.A,{"aria-label":"edit rule group","data-testid":"edit-group",key:"edit",icon:"pen",tooltip:"edit rule group",onClick:()=>g(!0)})),Z.push(e.createElement(le.A,{"aria-label":"re-order rules","data-testid":"reorder-group",key:"reorder",icon:"exchange-alt",tooltip:"re-order rules",className:u.rotate90,onClick:()=>L(!0)}))),Z.push(e.createElement(le.A,{"aria-label":"delete rule group","data-testid":"delete-group",key:"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>C(!0)})));const ce=de?e.createElement(qe.V,{namespace:r.name}):e.createElement(qe.V,{namespace:r.name,group:t.name}),ze=(te=!1)=>{te||(0,ue.PN)(R.z7.leavingRuleGroupEdit),g(!1)};return e.createElement("div",{className:u.wrapper,"data-testid":"rule-group"},e.createElement("div",{className:u.header,"data-testid":"rule-group-header"},e.createElement(ke.U,{size:"sm",className:u.collapseToggle,isCollapsed:P,onToggle:x,"data-testid":"group-collapse-toggle"}),e.createElement(Y.J,{name:P?"folder":"folder-open"}),(0,j.jq)(s)&&e.createElement(Ne.u,{content:s.name,placement:"top"},e.createElement("img",{alt:s.meta.name,className:u.dataSourceIcon,src:s.meta.info.logos.small})),e.createElement("div",{className:u.groupName,onClick:()=>x(!P)},W&&e.createElement(Ue.C,{color:"purple",text:"Federated"})," ",ce),e.createElement("div",{className:u.spacer}),e.createElement("div",{className:u.headerStats},e.createElement(tt.Pb,{group:t})),me&&e.createElement(e.Fragment,null,e.createElement("div",{className:u.actionsSeparator},"|"),e.createElement("div",{className:u.actionIcons},e.createElement(Ue.C,{color:"purple",text:"Provisioned"}))),!!Z.length&&e.createElement(e.Fragment,null,e.createElement("div",{className:u.actionsSeparator},"|"),e.createElement("div",{className:u.actionIcons},e.createElement(v.K,{gap:.5},Z)))),!P&&e.createElement(at.i,{showSummaryColumn:!0,className:u.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!t.interval,rules:t.rules}),m&&e.createElement(Ct.vq,{namespace:r,group:t,onClose:()=>ze(),folderUrl:U?.canEdit?(0,pe.aH)(U):void 0}),S&&e.createElement(Tt,{group:t,namespace:r,onClose:()=>L(!1)}),e.createElement(ft.s,{isOpen:d,title:"Delete group",body:e.createElement("div",null,e.createElement("p",null,'Deleting "',e.createElement("strong",null,t.name),'" will permanently remove the group and'," ",t.rules.length," alert ",_()("rule",t.rules.length)," belonging to it."),e.createElement("p",null,"Are you sure you want to delete this group?")),onConfirm:ee,onDismiss:()=>C(!1),confirmText:"Delete"}),U&&I==="folder"&&e.createElement(ht,{folder:U,onClose:()=>A(void 0)}),U&&I==="group"&&e.createElement(yt,{folderUid:U.uid,groupName:t.name,onClose:()=>A(void 0)}))});Be.displayName="RulesGroup";const Ot=t=>({wrapper:(0,n.css)``,header:(0,n.css)`
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: ${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0;
      flex-wrap: nowrap;
      border-bottom: 1px solid ${t.colors.border.weak};

      &:hover {
        background-color: ${t.components.table.rowHoverBackground};
      }
    `,headerStats:(0,n.css)`
      flex-shrink: 0;

      span {
        vertical-align: middle;
      }

      ${t.breakpoints.down("sm")} {
        order: 2;
        width: 100%;
        padding-left: ${t.spacing(1)};
      }
    `,groupName:(0,n.css)`
      margin-left: ${t.spacing(1)};
      margin-bottom: 0;
      cursor: pointer;

      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    `,spacer:(0,n.css)`
      flex: 1;
    `,collapseToggle:(0,n.css)`
      background: none;
      border: none;
      margin-top: -${t.spacing(1)};
      margin-bottom: -${t.spacing(1)};

      svg {
        margin-bottom: 0;
      }
    `,dataSourceIcon:(0,n.css)`
      width: ${t.spacing(2)};
      height: ${t.spacing(2)};
      margin-left: ${t.spacing(2)};
    `,dataSourceOrigin:(0,n.css)`
      margin-right: 1em;
      color: ${t.colors.text.disabled};
    `,actionsSeparator:(0,n.css)`
      margin: 0 ${t.spacing(2)};
    `,actionIcons:(0,n.css)`
      width: 80px;
      align-items: center;

      flex-shrink: 0;
    `,rulesTable:(0,n.css)`
      margin: ${t.spacing(2,0)};
    `,rotate90:(0,n.css)`
      transform: rotate(90deg);
    `});function nt(t){return(0,e.useMemo)(()=>t.flatMap(r=>r.groups.map(l=>({namespace:r,group:l}))),[t])}const Lt=({namespaces:t,expandAll:r})=>{const l=(0,E.wW)(bt),c=(0,oe._)(x=>x.dataSources),s=(0,oe._)(x=>x.promRules),i=(0,e.useMemo)(j.Eu,[]),u=nt(t),m=(0,e.useMemo)(()=>i.filter(x=>(0,Ae.op)(s[x.name])||(0,Ae.op)(c[x.name])),[s,c,i]),g=i.some(x=>!!s[x.name]?.result?.length),d=i.length>0,C=m.length>0,S=t.length>0,{numberOfPages:L,onPageChange:I,page:A,pageItems:P}=(0,Je.h)(u,1,Ze.gN);return e.createElement("section",{className:l.wrapper},e.createElement("div",{className:l.sectionHeader},e.createElement("h5",null,"Mimir / Cortex / Loki"),m.length?e.createElement(se.u,{className:l.loader,text:`Loading rules from ${m.length} ${_()("source",m.length)}`}):e.createElement("div",null)),P.map(({group:x,namespace:z})=>e.createElement(Be,{group:x,key:`${(0,j.v_)(z.rulesSource)}-${z.name}-${x.name}`,namespace:z,expandAll:r,viewMode:"grouped"})),!d&&e.createElement("p",null,"There are no Prometheus or Loki data sources configured."),d&&!C&&!S&&e.createElement("p",null,"No rules found."),!g&&C&&e.createElement($e.$,{size:24,className:l.spinner}),e.createElement(je.t,{className:l.pagination,currentPage:A,numberOfPages:L,onNavigate:I,hideWhenSinglePage:!0}))},bt=t=>({loader:(0,n.css)`
    margin-bottom: 0;
  `,sectionHeader:(0,n.css)`
    display: flex;
    justify-content: space-between;
  `,wrapper:(0,n.css)`
    margin-bottom: ${t.spacing(4)};
  `,spinner:(0,n.css)`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,Ye.Z)(t)});var ye=a(52106);const Ft=({namespaces:t,expandAll:r})=>{const l=(0,E.wW)($t),[c]=(0,T.K)(),{prom:s,ruler:i}=(0,oe._)(P=>({prom:P.promRules[j.GC]||Ae.oq,ruler:P.rulerRules[j.GC]||Ae.oq})),u=s.loading||i.loading,m=!!s.result||!!i.result,g=c.view==="list",d=g?(0,ye.Kd)(t):t,C=nt(d),{numberOfPages:S,onPageChange:L,page:I,pageItems:A}=(0,Je.h)(C,1,Ze.gN);return e.createElement("section",{className:l.wrapper},e.createElement("div",{className:l.sectionHeader},e.createElement("h5",null,"Grafana"),u?e.createElement(se.u,{className:l.loader,text:"Loading..."}):e.createElement("div",null)),A.map(({group:P,namespace:x})=>e.createElement(Be,{group:P,key:`${x.name}-${P.name}`,namespace:x,expandAll:r,viewMode:g?"list":"grouped"})),m&&d?.length===0&&e.createElement("p",null,"No rules found."),!m&&u&&e.createElement($e.$,{size:24,className:l.spinner}),e.createElement(je.t,{className:l.pagination,currentPage:I,numberOfPages:S,onNavigate:L,hideWhenSinglePage:!0}))},$t=t=>({loader:(0,n.css)`
    margin-bottom: 0;
  `,sectionHeader:(0,n.css)`
    display: flex;
    justify-content: space-between;
    margin-bottom: ${t.spacing(1)};
  `,wrapper:(0,n.css)`
    margin-bottom: ${t.spacing(4)};
  `,spinner:(0,n.css)`
    text-align: center;
    padding: ${t.spacing(2)};
  `,pagination:(0,Ye.Z)(t)}),Ut=({namespaces:t,expandAll:r})=>{const[l,c]=(0,e.useMemo)(()=>{const s=t.map(i=>({...i,groups:i.groups.sort((u,m)=>u.name.localeCompare(m.name))})).sort((i,u)=>i.name.localeCompare(u.name));return[s.filter(i=>(0,j.HY)(i.rulesSource)),s.filter(i=>(0,j.jq)(i.rulesSource))]},[t]);return(0,e.useEffect)(()=>{(0,ue.PN)(R.z7.loadedList)},[]),e.createElement(e.Fragment,null,e.createElement(Qe.q,{actions:[ae.hB.ViewAlertRule]},e.createElement(Ft,{namespaces:l,expandAll:r})),e.createElement(Qe.q,{actions:[ae.hB.ViewExternalAlertRule]},e.createElement(Lt,{namespaces:c,expandAll:r})))};var Q=a(17330);const Ge=({rules:t,state:r,defaultCollapsed:l=!1})=>{const[c,s]=(0,e.useState)(l),i=(0,E.wW)(Wt);return e.createElement(e.Fragment,null,e.createElement("h4",{className:i.header},e.createElement(ke.U,{className:i.collapseToggle,size:"xxl",isCollapsed:c,onToggle:()=>s(!c)}),(0,J.SS)(r)," (",t.length,")"),!c&&e.createElement(at.i,{className:i.rulesTable,rules:t,showGroupColumn:!0}))},Wt=t=>({collapseToggle:(0,n.css)`
    vertical-align: middle;
  `,header:(0,n.css)`
    margin-top: ${t.spacing(2)};
  `,rulesTable:(0,n.css)`
    margin-top: ${t.spacing(3)};
  `}),wt=({namespaces:t})=>{const r=(0,pe.lC)((0,T.K)()[0]),l=(0,e.useMemo)(()=>{const c={[Q.x_.Firing]:[],[Q.x_.Inactive]:[],[Q.x_.Pending]:[]};return t.forEach(s=>s.groups.forEach(i=>i.rules.forEach(u=>{u.promRule&&(0,J.x_)(u.promRule)&&c[u.promRule.state].push(u)}))),Object.values(c).forEach(s=>s.sort((i,u)=>i.name.localeCompare(u.name))),c},[t]);return e.createElement(e.Fragment,null,(!r.alertState||r.alertState===Q.x_.Firing)&&e.createElement(Ge,{state:Q.x_.Firing,rules:l[Q.x_.Firing]}),(!r.alertState||r.alertState===Q.x_.Pending)&&e.createElement(Ge,{state:Q.x_.Pending,rules:l[Q.x_.Pending]}),(!r.alertState||r.alertState===Q.x_.Inactive)&&e.createElement(Ge,{defaultCollapsed:r.alertState!==Q.x_.Inactive,state:Q.x_.Inactive,rules:l[Q.x_.Inactive]}))};var Bt=a(14058),rt=a(96227),fe=a(36495),Ie=a(20454),Gt=a(38637),Kt=a(5135),zt=a(35422),lt=a(26205),Re=a(90659),Me=a(14949),Ht=a(75404),Vt=a(88617);function st(){const[t,r]=(0,Vt.j)(),l=t.get("search")??"",c=(0,e.useMemo)(()=>(0,Re.ug)(l),[l]),s=(0,e.useMemo)(()=>Object.values(c).some(m=>!(0,Te.isEmpty)(m)),[c]),i=(0,e.useCallback)(m=>{const g=(0,Re.HY)(l,m);r({search:g})},[l,r]),u=(0,e.useCallback)(m=>{r({search:m})},[r]);return(0,e.useEffect)(()=>{const m={dataSource:t.get("dataSource")??void 0,alertState:t.get("alertState")??void 0,ruleType:t.get("ruleType")??void 0,labels:(0,Me.Zh)(t.get("queryString")??"").map(Me.cm)};Object.values(m).some(d=>!(0,Te.isEmpty)(d))&&(r({dataSource:void 0,alertState:void 0,ruleType:void 0,queryString:void 0}),i((0,zt.Uy)(c,d=>{if(d.dataSourceNames??=m.dataSource?[m.dataSource]:[],m.alertState&&(0,Q.I9)(m.alertState)&&(d.ruleState??=m.alertState),m.ruleType&&(0,J.Wd)(m.ruleType)&&(d.ruleType??=m.ruleType),d.labels.length===0&&m.labels.length>0){const C=m.labels.map(({name:S,operator:L,value:I})=>`${S}${L}${I}`);d.labels.push(...C)}})))},[t,i,c,r]),{filterState:c,hasActiveFilters:s,searchQuery:l,setSearchQuery:u,updateFilters:i}}const Qt=(t,r)=>(0,e.useMemo)(()=>{const l=jt(t,r);return l.forEach(c=>{c.groups.forEach(s=>{s.rules.forEach(i=>{(0,J.x_)(i.promRule)&&(i.instanceTotals=(0,ye.Fm)(i.promRule),i.filteredInstanceTotals=(0,ye.ZP)(i.promRule))}),s.totals=(0,ye.DD)({rules:s.rules.map(i=>i.promRule).filter(i=>!!i)})})}),l},[t,r]),Ke=new Kt.Z({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1}),jt=(t,r={dataSourceNames:[],labels:[],freeFormWords:[]})=>{let l=t;const c=r.dataSourceNames;c.length&&(l=l.filter(({rulesSource:i})=>(0,j.jq)(i)?c.includes(i.name):!0));const s=r.namespace;if(s){const i=l.map(d=>d.name),[u,m,g]=Ke.search(i,s);m&&g?l=g.map(d=>l[m.idx[d]]):u&&(l=u.map(d=>l[d]))}return l.reduce(Zt(r),[])},Zt=t=>(r,l)=>{const c=t.groupName;let s=l.groups;if(c){const i=s.map(d=>d.name),[u,m,g]=Ke.search(i,c);m&&g?s=g.map(d=>s[m.idx[d]]):u&&(s=u.map(d=>s[d]))}return s=s.reduce(Jt(t),[]),s.length&&r.push({...l,groups:s}),r},Jt=t=>{const r=t.ruleName??t.freeFormWords.join(" ");return(l,c)=>{let s=c.rules;if(r){const i=s.map(d=>d.name),[u,m,g]=Ke.search(i,r);m&&g?s=g.map(d=>s[m.idx[d]]):u&&(s=u.map(d=>s[d]))}return s=s.filter(i=>{if(t.ruleType&&t.ruleType!==i.promRule?.type)return!1;const u=(0,J.Pc)(i.rulerRule)&&!Xt(i.rulerRule,t);if(t.dataSourceNames?.length&&u)return!1;if(t.ruleHealth&&i.promRule){const m=(0,J.vU)(i.promRule.health);return t.ruleHealth===m}if(t.labels.length>0){const m=(0,Te.compact)(t.labels.map(Yt)),g=m.length>0&&(0,Me.eD)(i.labels,m),d=m.length>0&&i.promRule&&i.promRule.type===Q.pz.Alerting&&i.promRule.alerts&&i.promRule.alerts.some(C=>(0,Me.eD)(C.labels,m));if(!(g||d))return!1}return!(t.ruleState&&!(i.promRule&&(0,J.x_)(i.promRule)&&i.promRule.state===t.ruleState))}),s.length&&l.push({...c,rules:s}),l}};function Yt(t){try{return(0,Ht.tC)(t)}catch{return{name:t,value:"",isRegex:!0,isEqual:!0}}}const Xt=(t,r)=>r.dataSourceNames?.length?!!t.grafana_alert.data.find(l=>{if(!l.datasourceUid)return!1;const c=(0,lt.F)().getInstanceSettings(l.datasourceUid);return c?.name&&r?.dataSourceNames?.includes(c.name)}):!0;var kt=a(44351),qt=a(47635),_t=a(88227),ot=a(28888),it=a(92743),ea=a(9558),ta=a(45802);const aa=t=>{const r=(0,lt.F)(),[l,c]=(0,e.useState)(),s=(H,V)=>{if(V.action==="clear"&&t.onClear){t.onClear();return}const k=H[H.length-1];let U,b;V.action==="pop-value"||V.action==="remove-value"?(U=V.removedValue?.value,b="remove"):(U=k.value,b="add");const W=r.getInstanceSettings(U);W&&(t.onChange(W,b),c({error:void 0}))},i=()=>{const{current:H,hideTextValue:V,noDefault:k}=t;if(!(!H&&k))return H?.map(U=>{const b=r.getInstanceSettings(U);if(b)return{label:b.name.slice(0,37),value:b.name,imgUrl:b.meta.info.logos.small,hideText:V,meta:b.meta};const W=(0,qt.BT)(U);return W===it.hr.uid||W===it.hr.name?{label:W,value:W,hideText:V}:{label:(W??"no name")+" - not found",value:W??void 0,imgUrl:"",hideText:V}})},u=()=>{const{alerting:H,tracing:V,metrics:k,mixed:U,dashboard:b,variables:W,annotations:me,pluginId:de,type:B,filter:ee,logs:Z}=t,ce=r.getList({alerting:H,tracing:V,metrics:k,logs:Z,dashboard:b,mixed:U,variables:W,annotations:me,pluginId:de,filter:ee,type:B}),ze=ce.filter(j.G_).map(q=>({value:q.name,label:`${q.name}${q.isDefault?" (default)":""}`,imgUrl:q.meta.info.logos.small,meta:q.meta})),te=ce.filter(q=>!(0,j.G_)(q)).map(q=>({value:q.name,label:`${q.name}${q.isDefault?" (default)":""}`,imgUrl:q.meta.info.logos.small,meta:q.meta}));return[{label:"Data sources with configured alert rules",options:ze,expanded:!0},{label:"Other data sources",options:te,expanded:!0}]},{autoFocus:m,onBlur:g,onClear:d,openMenuOnFocus:C,placeholder:S,width:L,inputId:I,disabled:A=!1,isLoading:P=!1}=t,x=u(),z=i(),ne=typeof d=="function";return e.createElement("div",{"data-testid":ot.wl.components.DataSourcePicker.container},e.createElement(ea.NU,{isLoading:P,disabled:A,"data-testid":ot.wl.components.DataSourcePicker.inputV2,inputId:I||"data-source-picker",className:"ds-picker select-container",isClearable:ne,backspaceRemovesValue:!0,onChange:s,options:x,autoFocus:m,onBlur:g,width:L,openMenuOnFocus:C,maxMenuHeight:500,placeholder:S,noOptionsMessage:"No datasources found",value:z??[],invalid:!!l?.error||!!t.invalid,getOptionLabel:H=>H.meta&&(0,_t.x)(H.meta.signature)&&H!==z?e.createElement(Xe.Lh,{align:"center",justify:"space-between",height:"auto"},e.createElement("span",null,H.label)," ",e.createElement(ta.o,{status:H.meta.signature})):H.label||""}))},ct=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],na=[{label:"Alert ",value:Q.pz.Alerting},{label:"Recording ",value:Q.pz.Recording}],ra=[{label:"Ok",value:Re.VG.Ok},{label:"No Data",value:Re.VG.NoData},{label:"Error",value:Re.VG.Error}],la=Object.entries(Q.x_).map(([t,r])=>({label:(0,J.SS)(r),value:r})),sa=({onFilterCleared:t=()=>{}})=>{const r=(0,E.wW)(oa),[l,c]=(0,T.K)(),{filterState:s,hasActiveFilters:i,searchQuery:u,setSearchQuery:m,updateFilters:g}=st(),[d,C]=(0,e.useState)(Math.floor(Math.random()*100)),S=`dataSource-${d}`,L=`queryString-${d}`,I=(0,e.useRef)(null),{handleSubmit:A,register:P,setValue:x}=(0,Bt.cI)({defaultValues:{searchQuery:u}}),{ref:z,...ne}=P("searchQuery");(0,e.useEffect)(()=>{x("searchQuery",u)},[u,x]);const H=(B,ee)=>{const Z=ee==="add"?[...s.dataSourceNames].concat([B.name]):s.dataSourceNames.filter(ce=>ce!==B.name);g({...s,dataSourceNames:Z}),C(ce=>ce+1)},V=()=>{g({...s,dataSourceNames:[]}),C(B=>B+1)},k=B=>{(0,ue.PN)(R.z7.clickingAlertStateFilters),g({...s,ruleState:B}),C(ee=>ee+1)},U=B=>{c({view:B})},b=B=>{g({...s,ruleType:B}),C(ee=>ee+1)},W=B=>{g({...s,ruleHealth:B}),C(ee=>ee+1)},me=()=>{m(void 0),t(),setTimeout(()=>C(d+1),100)},de=e.createElement(Y.J,{name:"search"});return e.createElement("div",{className:r.container},e.createElement(v.K,{direction:"column",gap:1},e.createElement(v.K,{direction:"row",gap:1},e.createElement(rt.g,{className:r.dsPickerContainer,label:e.createElement(fe._,{htmlFor:"data-source-picker"},e.createElement(v.K,{gap:.5},e.createElement("span",null,"Search by data sources"),e.createElement(Ne.u,{content:e.createElement("div",null,e.createElement("p",null,"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."),e.createElement("p",null,"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."))},e.createElement(Y.J,{name:"info-circle",size:"sm"}))))},e.createElement(aa,{key:S,alerting:!0,noDefault:!0,placeholder:"All data sources",current:s.dataSourceNames,onChange:H,onClear:V})),e.createElement("div",null,e.createElement(fe._,null,"State"),e.createElement(Ie.S,{options:la,value:s.ruleState,onChange:k})),e.createElement("div",null,e.createElement(fe._,null,"Rule type"),e.createElement(Ie.S,{options:na,value:s.ruleType,onChange:b})),e.createElement("div",null,e.createElement(fe._,null,"Health"),e.createElement(Ie.S,{options:ra,value:s.ruleHealth,onChange:W}))),e.createElement(v.K,{direction:"column",gap:1},e.createElement(v.K,{direction:"row",gap:1},e.createElement("form",{className:r.searchInput,onSubmit:A(B=>{m(B.searchQuery),I.current?.blur()})},e.createElement(rt.g,{label:e.createElement(fe._,{htmlFor:"rulesSearchInput"},e.createElement(v.K,{gap:.5},e.createElement("span",null,"Search"),e.createElement(kt.z,{content:e.createElement(ia,null)},e.createElement(Y.J,{name:"info-circle",size:"sm",tabIndex:0}))))},e.createElement(Gt.I,{id:"rulesSearchInput",key:L,prefix:de,ref:B=>{z(B),I.current=B},...ne,placeholder:"Search","data-testid":"search-query-input"})),e.createElement("input",{type:"submit",hidden:!0})),e.createElement("div",null,e.createElement(fe._,null,"View as"),e.createElement(Ie.S,{options:ct,value:String(l.view??ct[0].value),onChange:U}))),i&&e.createElement("div",null,e.createElement(y.zx,{fullWidth:!1,icon:"times",variant:"secondary",onClick:me},"Clear filters")))))},oa=t=>({container:(0,n.css)`
      margin-bottom: ${t.spacing(1)};
    `,dsPickerContainer:(0,n.css)`
      width: 550px;
      flex-grow: 0;
      margin: 0;
    `,searchInput:(0,n.css)`
      flex: 1;
      margin: 0;
    `});function ia(){const t=(0,E.wW)(ut);return e.createElement("div",null,e.createElement("div",null,"Search syntax allows to query alert rules by the parameters defined below."),e.createElement("hr",null),e.createElement("div",{className:t.grid},e.createElement("div",null,"Filter type"),e.createElement("div",null,"Expression"),e.createElement(ie,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),e.createElement(ie,{title:"Folder/Namespace",expr:"namespace:global"}),e.createElement(ie,{title:"Group",expr:"group:cpu-usage"}),e.createElement(ie,{title:"Rule",expr:'rule:"cpu 80%"'}),e.createElement(ie,{title:"Labels",expr:"label:team=A label:cluster=a1"}),e.createElement(ie,{title:"State",expr:"state:firing|normal|pending"}),e.createElement(ie,{title:"Type",expr:"type:alerting|recording"}),e.createElement(ie,{title:"Health",expr:"health:ok|nodata|error"})))}function ie({title:t,expr:r}){const l=(0,E.wW)(ut);return e.createElement(e.Fragment,null,e.createElement("div",null,t),e.createElement("code",{className:l.code},r))}const ut=t=>({grid:(0,n.css)`
    display: grid;
    grid-template-columns: max-content auto;
    gap: ${t.spacing(1)};
    align-items: center;
  `,code:(0,n.css)`
    display: block;
    text-align: center;
  `}),ca=sa;var ua=a(63483);const mt={groups:Ut,state:wt},ma=X.gr+1,da=(0,D.Pf)(()=>{const t=(0,w.useDispatch)(),r=(0,E.wW)(ga),l=(0,e.useMemo)(j.mA,[]),[c,s]=(0,e.useState)(!1),i=(0,e.useCallback)(()=>s(!1),[]),[u]=(0,T.K)(),{filterState:m,hasActiveFilters:g}=st(),d=mt[u.view]?u.view:"groups",C=mt[d],S=(0,oe._)(b=>b.promRules),L=(0,oe._)(b=>b.rulerRules),I=l.some(b=>S[b]?.loading||L[b]?.loading),A=Object.entries(S),P=A.every(([b,W])=>W.dispatched&&(W?.result!==void 0||W?.error!==void 0)),x=A.every(([b,W])=>W.dispatched&&W?.result?.length===0),z=g?void 0:ma,[ne,H]=(0,f.Z)(async()=>{I||await t((0,De.ei)(!1,{limitAlerts:z}))},[I,z,t]);(0,e.useEffect)(()=>{(0,R.$I)().catch(()=>{})},[]),(0,e.useEffect)(()=>{t((0,De.ei)(!1,{limitAlerts:z}))},[t,z]),(0,M.Z)(H,ua.p4);const V=P&&x&&A.length>0,k=(0,ye.Zo)(),U=Qt(k,m);return e.createElement(be.J,{pageId:"alert-list",isLoading:!1},e.createElement(gt,null),e.createElement(ca,{onFilterCleared:i}),!V&&e.createElement(e.Fragment,null,e.createElement("div",{className:r.break}),e.createElement("div",{className:r.buttonsContainer},e.createElement("div",{className:r.statsContainer},d==="groups"&&g&&e.createElement(y.zx,{className:r.expandAllButton,icon:c?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>s(!c)},c?"Collapse all":"Expand all"),e.createElement(tt.WN,{namespaces:U})),e.createElement(v.K,{direction:"row",gap:.5},e.createElement(He,null)))),V&&e.createElement(N,null),!V&&e.createElement(C,{expandAll:c,namespaces:U}))},{style:"page"}),ga=t=>({break:(0,n.css)`
    width: 100%;
    height: 0;
    margin-bottom: ${t.spacing(2)};
    border-bottom: solid 1px ${t.colors.border.medium};
  `,buttonsContainer:(0,n.css)`
    margin-bottom: ${t.spacing(2)};
    display: flex;
    justify-content: space-between;
  `,statsContainer:(0,n.css)`
    display: flex;
    flex-direction: row;
    align-items: center;
  `,expandAllButton:(0,n.css)`
    margin-right: ${t.spacing(1)};
  `}),pa=da},81456:(re,G,a)=>{a.d(G,{q:()=>v});var n=a(86832),e=a.n(n),f=a(39953),M=a(18314);const v=({actions:R,children:F})=>{const h=(0,n.filter)(R,T),o=(0,n.filter)(R,w);return h.length?f.createElement(D,{actions:h},F):o.length?f.createElement(E,{actions:o},F):null},D=({actions:R,children:F})=>{const h=(0,M.Mz)();return y(h,R)?f.createElement(f.Fragment,null,F):null},E=({actions:R,children:F})=>{const h=(0,M.cI)();return y(h,R)?f.createElement(f.Fragment,null,F):null};function y(R,F){return(0,n.chain)(R).pick(F).values().value().some(([h,o])=>o===!0)}function T(R){return Object.values(M.oI).includes(R)}function w(R){return Object.values(M.hB).includes(R)}},86992:(re,G,a)=>{a.d(G,{h:()=>y});var n=a(41407),e=a(39953),f=a(27366),M=a(82803),v=a(36884),D=a(12190),E=a(98632);function y({contentText:w,externalLink:R,linkText:F,title:h}){const o=(0,M.wW)(T);return e.createElement(v.P,{content:e.createElement("div",{className:o.mutedText},w),title:e.createElement(f.K,{gap:1,direction:"row"},e.createElement(D.J,{name:"question-circle"}),h),footer:R?e.createElement("a",{href:R,target:"_blank",rel:"noreferrer"},e.createElement(f.K,{direction:"row",gap:.5,alignItems:"center"},e.createElement(E.x,{color:"link"},F," ",e.createElement(D.J,{size:"sm",name:"external-link-alt"})))):void 0,closeButton:!0,placement:"bottom-start"},e.createElement("div",{className:o.helpInfo},e.createElement(f.K,{direction:"row",alignItems:"center",gap:.5},e.createElement(D.J,{name:"question-circle",size:"sm"}),e.createElement(E.x,{variant:"bodySmall",color:"primary"},"Need help?"))))}const T=w=>({mutedText:(0,n.css)`
    color: ${w.colors.text.secondary};
    font-size: ${w.typography.size.sm};
  `,helpInfo:(0,n.css)`
    cursor: pointer;
    text-decoration: underline;
  `})},95941:(re,G,a)=>{a.d(G,{z:()=>E});var n=a(41407),e=a(39953),f=a(27366),M=a(82803),v=a(2827),D=a(98632);const E=({title:T,stepNo:w,children:R,fullWidth:F=!1,description:h})=>{const o=(0,M.wW)(y);return e.createElement("div",{className:o.parent},e.createElement(v.C,{className:(0,n.cx)(F&&o.fullWidth),label:e.createElement(D.x,{variant:"h3"},w,". ",T)},e.createElement(f.K,{direction:"column"},h&&e.createElement("div",{className:o.description},h),R)))},y=T=>({parent:(0,n.css)`
    display: flex;
    flex-direction: row;
    max-width: ${T.breakpoints.values.xl}px;
    border: solid 1px ${T.colors.border.weak};
    border-radius: ${T.shape.radius.default};
    padding: ${T.spacing(2)} ${T.spacing(3)};
  `,description:(0,n.css)`
    margin-top: -${T.spacing(2)};
  `,fullWidth:(0,n.css)`
    width: 100%;
  `})},57912:(re,G,a)=>{a.d(G,{A:()=>M});var n=a(39953),e=a(69865),f=a(4919);const M=({tooltip:v,icon:D,to:E,target:y,onClick:T,className:w,tooltipPlacement:R="top",...F})=>{const h=typeof v=="string"?v:void 0;return n.createElement(e.u,{content:v,placement:R},E?n.createElement(f.Qj,{variant:"secondary",fill:"text",icon:D,href:E,size:"sm",target:y,...F,"aria-label":h}):n.createElement(f.zx,{className:w,variant:"secondary",fill:"text",size:"sm",icon:D,type:"button",onClick:T,...F,"aria-label":h}))}},18314:(re,G,a)=>{a.d(G,{Mz:()=>w,RA:()=>R,cI:()=>T,hB:()=>E,o2:()=>F,oI:()=>D,xC:()=>h});var n=a(39953),e=a(97125),f=a(57721),M=a(328),v=a(60703),D=(o=>(o.ViewExternalConfiguration="view-external-configuration",o.UpdateExternalConfiguration="update-external-configuration",o.CreateContactPoint="create-contact-point",o.ViewContactPoint="view-contact-point",o.UpdateContactPoint="edit-contact-points",o.DeleteContactPoint="delete-contact-point",o.ExportContactPoint="export-contact-point",o.CreateNotificationTemplate="create-notification-template",o.ViewNotificationTemplate="view-notification-template",o.UpdateNotificationTemplate="edit-notification-template",o.DeleteNotificationTemplate="delete-notification-template",o.DecryptSecrets="decrypt-secrets",o.CreateNotificationPolicy="create-notification-policy",o.ViewNotificationPolicyTree="view-notification-policy-tree",o.UpdateNotificationPolicyTree="update-notification-policy-tree",o.DeleteNotificationPolicy="delete-notification-policy",o.ExportNotificationPolicies="export-notification-policies",o.CreateSilence="create-silence",o.ViewSilence="view-silence",o.UpdateSilence="update-silence",o.ViewMuteTiming="view-mute-timing",o.CreateMuteTiming="create-mute-timing",o.UpdateMuteTiming="update-mute-timing",o.DeleteMuteTiming="delete-mute-timing",o))(D||{}),E=(o=>(o.CreateAlertRule="create-alert-rule",o.ViewAlertRule="view-alert-rule",o.UpdateAlertRule="update-alert-rule",o.DeleteAlertRule="delete-alert-rule",o.CreateExternalAlertRule="create-external-alert-rule",o.ViewExternalAlertRule="view-external-alert-rule",o.UpdateExternalAlertRule="update-external-alert-rule",o.DeleteExternalAlertRule="delete-external-alert-rule",o))(E||{});const y=!0;function T(){return{["create-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleCreate)],["view-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleRead)],["update-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleUpdate)],["delete-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleDelete)],["create-external-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleExternalWrite)],["view-external-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleExternalRead)],["update-external-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleExternalWrite)],["delete-external-alert-rule"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingRuleExternalWrite)]}}function w(){const{selectedAlertmanager:o,hasConfigurationAPI:p,isGrafanaAlertmanager:K}=(0,M.ZA)(),O=(0,v.Ko)(o),Y=(0,v.QX)(o);return{["view-external-configuration"]:[y,e.contextSrv.hasPermission(f.AccessControlAction.AlertingNotificationsExternalRead)],["update-external-configuration"]:[p,e.contextSrv.hasPermission(f.AccessControlAction.AlertingNotificationsExternalWrite)],["create-contact-point"]:[p,e.contextSrv.hasPermission(O.create)],["view-contact-point"]:[y,e.contextSrv.hasPermission(O.read)],["edit-contact-points"]:[p,e.contextSrv.hasPermission(O.update)],["delete-contact-point"]:[p,e.contextSrv.hasPermission(O.delete)],["export-contact-point"]:[K,e.contextSrv.hasPermission(O.read)],["create-notification-template"]:[p,e.contextSrv.hasPermission(O.create)],["view-notification-template"]:[y,e.contextSrv.hasPermission(O.read)],["edit-notification-template"]:[p,e.contextSrv.hasPermission(O.update)],["delete-notification-template"]:[p,e.contextSrv.hasPermission(O.delete)],["create-notification-policy"]:[p,e.contextSrv.hasPermission(O.create)],["view-notification-policy-tree"]:[y,e.contextSrv.hasPermission(O.read)],["update-notification-policy-tree"]:[p,e.contextSrv.hasPermission(O.update)],["delete-notification-policy"]:[p,e.contextSrv.hasPermission(O.delete)],["export-notification-policies"]:[K,e.contextSrv.hasPermission(O.read)],["decrypt-secrets"]:[K,e.contextSrv.hasPermission(O.provisioning.readSecrets)],["create-silence"]:[p,e.contextSrv.hasPermission(Y.create)],["view-silence"]:[y,e.contextSrv.hasPermission(Y.read)],["update-silence"]:[p,e.contextSrv.hasPermission(Y.update)],["create-mute-timing"]:[p,e.contextSrv.hasPermission(O.create)],["view-mute-timing"]:[y,e.contextSrv.hasPermission(O.read)],["update-mute-timing"]:[p,e.contextSrv.hasPermission(O.update)],["delete-mute-timing"]:[p,e.contextSrv.hasPermission(O.delete)]}}function R(o){const p=w();return(0,n.useMemo)(()=>p[o],[p,o])}function F(o){const p=w();return(0,n.useMemo)(()=>o.map(K=>p[K]),[p,o])}function h(o){const p=T();return(0,n.useMemo)(()=>p[o],[p,o])}},21891:(re,G,a)=>{a.d(G,{Z:()=>f});var n=a(39953),e=function(M,v){var D=(0,n.useRef)(function(){});(0,n.useEffect)(function(){D.current=M}),(0,n.useEffect)(function(){if(v!==null){var E=setInterval(function(){return D.current()},v||0);return function(){return clearInterval(E)}}},[v])};const f=e}}]);

//# sourceMappingURL=AlertRuleListIndex.76ec9b3b229cace9eeb7.js.map