{"version":3,"file":"DashboardPage.897e8870871601bb37bc.js","mappings":"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","sources":["webpack://grafana/./public/app/features/alerting/getAlertingValidationMessage.ts","webpack://grafana/./public/app/core/navigation/kiosk.ts","webpack://grafana/./public/app/features/plugins/angularDeprecation/AngularDeprecationNotice.tsx","webpack://grafana/./public/app/features/storage/StorageFolderPage.tsx","webpack://grafana/./public/app/features/panel/components/VizTypePicker/VizTypePickerPlugin.tsx","webpack://grafana/./public/app/features/dashboard/components/AddWidgetModal/AddWidgetModal.tsx","webpack://grafana/./public/app/features/library-panels/components/SaveLibraryPanelModal/SaveLibraryPanelModal.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/state/actions.ts","webpack://grafana/./public/app/features/dashboard/components/SaveDashboard/UnsavedChangesModal.tsx","webpack://grafana/./public/app/features/dashboard/components/DashboardPrompt/DashboardPrompt.tsx","webpack://grafana/./public/app/features/dashboard/components/HelpWizard/SupportSnapshotService.ts","webpack://grafana/./public/app/features/dashboard/components/HelpWizard/HelpWizard.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/usePanelLatestData.ts","webpack://grafana/./public/app/features/inspector/InspectMetadataTab.tsx","webpack://grafana/./public/app/features/dashboard/components/Inspector/InspectContent.tsx","webpack://grafana/./public/app/features/dashboard/components/Inspector/PanelInspector.tsx","webpack://grafana/./public/app/features/variables/pickers/PickerRenderer.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/SubMenuItems.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/state/utils.ts","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/AngularPanelOptions.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/DynamicConfigValueEditor.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/OverrideCategoryTitle.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/getFieldOverrideElements.tsx","webpack://grafana/./public/app/features/library-panels/components/LibraryPanelInfo/LibraryPanelInfo.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/getLibraryPanelOptions.tsx","webpack://grafana/./public/app/features/dashboard/components/GenAI/GenAIPanelDescriptionButton.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/getPanelFrameOptions.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/state/OptionSearchEngine.ts","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/state/getRecentOptions.ts","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/OptionsPaneOptions.tsx","webpack://grafana/./public/app/features/dashboard/state/selectors.ts","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/VisualizationButton.tsx","webpack://grafana/./public/app/features/library-panels/components/ChangeLibraryPanelModal/ChangeLibraryPanelModal.tsx","webpack://grafana/./public/app/features/library-panels/components/PanelLibraryOptionsGroup/PanelLibraryOptionsGroup.tsx","webpack://grafana/./public/app/features/panel/state/getAllSuggestions.ts","webpack://grafana/./public/app/features/panel/components/VizTypePicker/VisualizationSuggestionCard.tsx","webpack://grafana/./public/app/features/panel/components/VizTypePicker/VisualizationSuggestions.tsx","webpack://grafana/./public/app/features/panel/components/VizTypePicker/VizTypePicker.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/VisualizationSelectPane.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/OptionsPane.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelHeaderCorner.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelEditorTableView.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelNotSupported.tsx","webpack://grafana/./public/app/features/alerting/StateHistory.tsx","webpack://grafana/./public/app/features/alerting/TestRuleResult.tsx","webpack://grafana/./public/app/features/alerting/AlertTab.tsx","webpack://grafana/./public/app/features/alerting/unified/components/panel-alerts-tab/NewRuleFromPanelButton.tsx","webpack://grafana/./public/app/features/alerting/unified/hooks/usePanelCombinedRules.ts","webpack://grafana/./public/app/features/alerting/unified/PanelAlertTabContent.tsx","webpack://grafana/./public/app/features/alerting/AlertTabIndex.tsx","webpack://grafana/./public/app/features/alerting/unified/PanelAlertTab.tsx","webpack://grafana/./public/app/core/utils/docsLinks.ts","webpack://grafana/./public/app/features/dashboard/components/TransformationsEditor/TransformationEditor.tsx","webpack://grafana/./public/app/features/dashboard/components/TransformationsEditor/TransformationFilter.tsx","webpack://grafana/./public/app/features/dashboard/components/TransformationsEditor/TransformationOperationRow.tsx","webpack://grafana/./public/app/features/dashboard/components/TransformationsEditor/TransformationOperationRows.tsx","webpack://grafana/./public/app/features/dashboard/components/TransformationsEditor/TransformationsEditor.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelEditorQueries.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelEditorTabs.tsx","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/state/selectors.ts","webpack://grafana/./public/app/features/dashboard/components/PanelEditor/PanelEditor.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/AnnotationPicker.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/Annotations.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/DashboardLinksDashboard.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/DashboardLinks.tsx","webpack://grafana/./public/app/features/dashboard/components/SubMenu/SubMenu.tsx","webpack://grafana/./public/app/features/dashboard/containers/DashboardPage.tsx","webpack://grafana/./public/app/features/dashboard/containers/NewDashboardWithDS.tsx","webpack://grafana/./public/app/features/storage/storage.ts","webpack://grafana/./public/app/plugins/panel/geomap/editor/FrameSelectionEditor.tsx"],"sourcesContent":["import { DataQuery, DataSourceRef, DataTransformerConfig } from '@grafana/data';\nimport { DataSourceSrv } from '@grafana/runtime';\n\nexport const getDefaultCondition = () => ({\n  type: 'query',\n  query: { params: ['A', '5m', 'now'] },\n  reducer: { type: 'avg', params: [] as any[] },\n  evaluator: { type: 'gt', params: [null] as any[] },\n  operator: { type: 'and' },\n});\n\nexport const getAlertingValidationMessage = async (\n  transformations: DataTransformerConfig[] | undefined,\n  targets: DataQuery[],\n  datasourceSrv: DataSourceSrv,\n  datasource: DataSourceRef | null\n): Promise<string> => {\n  if (targets.length === 0) {\n    return 'Could not find any metric queries';\n  }\n\n  if (transformations && transformations.length) {\n    return 'Transformations are not supported in alert queries';\n  }\n\n  let alertingNotSupported = 0;\n  let templateVariablesNotSupported = 0;\n\n  for (const target of targets) {\n    const dsRef = target.datasource || datasource;\n    const ds = await datasourceSrv.get(dsRef);\n    if (!ds.meta.alerting) {\n      alertingNotSupported++;\n    } else if (ds.targetContainsTemplate && ds.targetContainsTemplate(target)) {\n      templateVariablesNotSupported++;\n    }\n  }\n\n  if (alertingNotSupported === targets.length) {\n    return 'The datasource does not support alerting queries';\n  }\n\n  if (templateVariablesNotSupported === targets.length) {\n    return 'Template variables are not supported in alert queries';\n  }\n\n  return '';\n};\n","import { UrlQueryMap } from '@grafana/data';\n\nimport { KioskMode } from '../../types';\n\n// TODO Remove after topnav feature toggle is permanent and old NavBar is removed\nexport function getKioskMode(queryParams: UrlQueryMap): KioskMode | null {\n  switch (queryParams.kiosk) {\n    case 'tv':\n      return KioskMode.TV;\n    //  legacy support\n    case '1':\n    case true:\n      return KioskMode.Full;\n    default:\n      return null;\n  }\n}\n","import React from 'react';\n\nimport { reportInteraction } from '@grafana/runtime';\nimport { Alert } from '@grafana/ui';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\n\nconst LOCAL_STORAGE_KEY_PREFIX = 'grafana.angularDeprecation.dashboardNotice.isDismissed';\n\nfunction localStorageKey(dashboardUid: string): string {\n  return LOCAL_STORAGE_KEY_PREFIX + '.' + dashboardUid;\n}\n\nexport interface Props {\n  dashboardUid: string;\n}\n\nexport function AngularDeprecationNotice({ dashboardUid }: Props) {\n  return (\n    <LocalStorageValueProvider<boolean> storageKey={localStorageKey(dashboardUid)} defaultValue={false}>\n      {(isDismissed, onDismiss) => {\n        if (isDismissed) {\n          return null;\n        }\n        return (\n          <div>\n            <Alert\n              severity=\"warning\"\n              title=\"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.\"\n              onRemove={() => {\n                reportInteraction('angular_deprecation_notice_dismissed');\n                onDismiss(true);\n              }}\n            >\n              <div className=\"markdown-html\">\n                <ul>\n                  <li>\n                    <a\n                      href=\"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/\"\n                      className=\"external-link\"\n                      target=\"_blank\"\n                      rel=\"noreferrer\"\n                    >\n                      Read our deprecation notice and migration advice.\n                    </a>\n                  </li>\n                </ul>\n              </div>\n            </Alert>\n          </div>\n        );\n      }}\n    </LocalStorageValueProvider>\n  );\n}\n","import React from 'react';\nimport { useAsync } from 'react-use';\n\nimport { DataFrame, NavModel, NavModelItem } from '@grafana/data';\nimport { Card, Icon, Spinner } from '@grafana/ui';\nimport { Page } from 'app/core/components/Page/Page';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\n\nimport { getGrafanaStorage } from './storage';\n\nexport interface Props extends GrafanaRouteComponentProps<{ slug: string }> {}\n\nexport function StorageFolderPage(props: Props) {\n  const slug = props.match.params.slug ?? '';\n  const listing = useAsync((): Promise<DataFrame | undefined> => {\n    return getGrafanaStorage().list('content/' + slug);\n  }, [slug]);\n\n  const childRoot = slug.length > 0 ? `g/${slug}/` : 'g/';\n  const pageNav = getPageNavFromSlug(slug);\n\n  const renderListing = () => {\n    if (listing.value) {\n      const names = listing.value.fields[0].values;\n      return names.map((item: string) => {\n        let name = item;\n        const isFolder = name.indexOf('.') < 0;\n        const isDash = !isFolder && name.endsWith('.json');\n        const url = `${childRoot}${name}`;\n\n        return (\n          <Card key={name} href={isFolder || isDash ? url : undefined}>\n            <Card.Heading>{name}</Card.Heading>\n            <Card.Figure>\n              <Icon name={isFolder ? 'folder' : isDash ? 'gf-grid' : 'file-alt'} size=\"sm\" />\n            </Card.Figure>\n          </Card>\n        );\n      });\n    }\n    if (listing.loading) {\n      return <Spinner />;\n    }\n    return <div>?</div>;\n  };\n\n  const navModel = getRootContentNavModel();\n\n  return (\n    <Page navModel={navModel} pageNav={pageNav}>\n      {renderListing()}\n    </Page>\n  );\n}\n\nexport function getPageNavFromSlug(slug: string) {\n  const parts = slug.split('/');\n  let pageNavs: NavModelItem[] = [];\n  let url = 'g';\n  let lastPageNav: NavModelItem | undefined;\n\n  for (let i = 0; i < parts.length; i++) {\n    url += `/${parts[i]}`;\n    pageNavs.push({ text: parts[i], url, parentItem: lastPageNav });\n    lastPageNav = pageNavs[pageNavs.length - 1];\n  }\n\n  return lastPageNav;\n}\n\nexport function getRootContentNavModel(): NavModel {\n  return { main: { text: 'C:' }, node: { text: 'Content', url: '/g' } };\n}\n\nexport default StorageFolderPage;\n","import React, { MouseEventHandler } from 'react';\n\nimport { PanelPluginMeta } from '@grafana/data';\n\nimport { PanelTypeCard } from './PanelTypeCard';\n\ninterface Props {\n  isCurrent: boolean;\n  plugin: PanelPluginMeta;\n  onClick: MouseEventHandler<HTMLDivElement>;\n  disabled: boolean;\n}\n\nexport const VizTypePickerPlugin = ({ isCurrent, plugin, onClick, disabled }: Props) => {\n  return (\n    <PanelTypeCard\n      title={plugin.name}\n      plugin={plugin}\n      description={plugin.info.description}\n      onClick={onClick}\n      isCurrent={isCurrent}\n      disabled={disabled}\n      showBadge={true}\n    />\n  );\n};\n\nVizTypePickerPlugin.displayName = 'VizTypePickerPlugin';\n","import { css } from '@emotion/css';\nimport React, { useMemo, useState } from 'react';\n\nimport { GrafanaTheme2, PanelPluginMeta } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { CustomScrollbar, Icon, Input, Modal, useStyles2 } from '@grafana/ui';\nimport { onCreateNewWidgetPanel } from 'app/features/dashboard/utils/dashboard';\nimport { VizTypePickerPlugin } from 'app/features/panel/components/VizTypePicker/VizTypePickerPlugin';\nimport { filterPluginList, getWidgetPluginMeta } from 'app/features/panel/state/util';\nimport { useSelector } from 'app/types';\n\nexport const AddWidgetModal = () => {\n  const styles = useStyles2(getStyles);\n  const [searchQuery, setSearchQuery] = useState('');\n  const dashboard = useSelector((state) => state.dashboard.getModel());\n\n  const widgetsList: PanelPluginMeta[] = useMemo(() => {\n    return getWidgetPluginMeta();\n  }, []);\n\n  const filteredWidgetsTypes = useMemo((): PanelPluginMeta[] => {\n    return filterPluginList(widgetsList, searchQuery);\n  }, [widgetsList, searchQuery]);\n\n  const onDismiss = () => {\n    locationService.partial({ addWidget: null });\n  };\n\n  return (\n    <Modal\n      title=\"Select widget type\"\n      closeOnEscape\n      closeOnBackdropClick\n      isOpen\n      className={styles.modal}\n      onClickBackdrop={onDismiss}\n      onDismiss={onDismiss}\n    >\n      <Input\n        type=\"search\"\n        autoFocus\n        className={styles.searchInput}\n        value={searchQuery}\n        prefix={<Icon name=\"search\" />}\n        placeholder=\"Search widget\"\n        onChange={(e) => {\n          setSearchQuery(e.currentTarget.value);\n        }}\n      />\n      <CustomScrollbar>\n        <div className={styles.grid}>\n          {filteredWidgetsTypes.map((plugin, index) => (\n            <VizTypePickerPlugin\n              disabled={false}\n              key={plugin.id}\n              isCurrent={false}\n              plugin={plugin}\n              onClick={(e) => {\n                const id = onCreateNewWidgetPanel(dashboard!, plugin.id);\n                locationService.partial({ editPanel: id, addWidget: null });\n              }}\n            />\n          ))}\n        </div>\n      </CustomScrollbar>\n    </Modal>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  modal: css`\n    width: 65%;\n    max-width: 960px;\n\n    ${theme.breakpoints.down('md')} {\n      width: 100%;\n    }\n  `,\n  searchInput: css`\n    margin-bottom: ${theme.spacing(2)};\n  `,\n  grid: css`\n    display: grid;\n    grid-gap: ${theme.spacing(1)};\n  `,\n});\n","import React, { useCallback, useState } from 'react';\nimport { useAsync, useDebounce } from 'react-use';\n\nimport { Button, Icon, Input, Modal, useStyles2 } from '@grafana/ui';\n\nimport { getConnectedDashboards } from '../../state/api';\nimport { getModalStyles } from '../../styles';\nimport { PanelModelWithLibraryPanel } from '../../types';\nimport { usePanelSave } from '../../utils/usePanelSave';\n\ninterface Props {\n  panel: PanelModelWithLibraryPanel;\n  folderUid: string;\n  isUnsavedPrompt?: boolean;\n  onConfirm: () => void;\n  onDismiss: () => void;\n  onDiscard: () => void;\n}\n\nexport const SaveLibraryPanelModal = ({\n  panel,\n  folderUid,\n  isUnsavedPrompt,\n  onDismiss,\n  onConfirm,\n  onDiscard,\n}: Props) => {\n  const [searchString, setSearchString] = useState('');\n  const dashState = useAsync(async () => {\n    const searchHits = await getConnectedDashboards(panel.libraryPanel.uid);\n    if (searchHits.length > 0) {\n      return searchHits.map((dash) => dash.title);\n    }\n\n    return [];\n  }, [panel.libraryPanel.uid]);\n\n  const [filteredDashboards, setFilteredDashboards] = useState<string[]>([]);\n  useDebounce(\n    () => {\n      if (!dashState.value) {\n        return setFilteredDashboards([]);\n      }\n\n      return setFilteredDashboards(\n        dashState.value.filter((dashName) => dashName.toLowerCase().includes(searchString.toLowerCase()))\n      );\n    },\n    300,\n    [dashState.value, searchString]\n  );\n\n  const { saveLibraryPanel } = usePanelSave();\n  const styles = useStyles2(getModalStyles);\n  const discardAndClose = useCallback(() => {\n    onDiscard();\n  }, [onDiscard]);\n\n  const title = isUnsavedPrompt ? 'Unsaved library panel changes' : 'Save library panel';\n\n  return (\n    <Modal title={title} icon=\"save\" onDismiss={onDismiss} isOpen={true}>\n      <div>\n        <p className={styles.textInfo}>\n          {'This update will affect '}\n          <strong>\n            {panel.libraryPanel.meta?.connectedDashboards}{' '}\n            {panel.libraryPanel.meta?.connectedDashboards === 1 ? 'dashboard' : 'dashboards'}.\n          </strong>\n          The following dashboards using the panel will be affected:\n        </p>\n        <Input\n          className={styles.dashboardSearch}\n          prefix={<Icon name=\"search\" />}\n          placeholder=\"Search affected dashboards\"\n          value={searchString}\n          onChange={(e) => setSearchString(e.currentTarget.value)}\n        />\n        {dashState.loading ? (\n          <p>Loading connected dashboards...</p>\n        ) : (\n          <table className={styles.myTable}>\n            <thead>\n              <tr>\n                <th>Dashboard name</th>\n              </tr>\n            </thead>\n            <tbody>\n              {filteredDashboards.map((dashName, i) => (\n                <tr key={`dashrow-${i}`}>\n                  <td>{dashName}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        )}\n        <Modal.ButtonRow>\n          <Button variant=\"secondary\" onClick={onDismiss} fill=\"outline\">\n            Cancel\n          </Button>\n          {isUnsavedPrompt && (\n            <Button variant=\"destructive\" onClick={discardAndClose}>\n              Discard\n            </Button>\n          )}\n          <Button\n            onClick={() => {\n              saveLibraryPanel(panel, folderUid).then(() => {\n                onConfirm();\n              });\n            }}\n          >\n            Update all\n          </Button>\n        </Modal.ButtonRow>\n      </div>\n    </Modal>\n  );\n};\n","import { pick } from 'lodash';\n\nimport store from 'app/core/store';\nimport { removePanel } from 'app/features/dashboard/utils/panel';\nimport { cleanUpPanelState } from 'app/features/panel/state/actions';\nimport { panelModelAndPluginReady } from 'app/features/panel/state/reducers';\nimport { ThunkResult } from 'app/types';\n\nimport { DashboardModel, PanelModel } from '../../../state';\n\nimport {\n  closeEditor,\n  PANEL_EDITOR_UI_STATE_STORAGE_KEY,\n  PanelEditorUIState,\n  setDiscardChanges,\n  setPanelEditorUIState,\n  updateEditorInitState,\n} from './reducers';\n\nexport function initPanelEditor(sourcePanel: PanelModel, dashboard: DashboardModel): ThunkResult<void> {\n  return async (dispatch) => {\n    const panel = dashboard.initEditPanel(sourcePanel);\n\n    dispatch(\n      updateEditorInitState({\n        panel,\n        sourcePanel,\n      })\n    );\n  };\n}\n\nexport function discardPanelChanges(): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const { getPanel } = getStore().panelEditor;\n    getPanel().configRev = 0;\n    dispatch(setDiscardChanges(true));\n  };\n}\n\nexport function updateDuplicateLibraryPanels(\n  modifiedPanel: PanelModel,\n  dashboard: DashboardModel | null\n): ThunkResult<void> {\n  return (dispatch) => {\n    if (modifiedPanel.libraryPanel?.uid === undefined || !dashboard) {\n      return;\n    }\n\n    const modifiedSaveModel = modifiedPanel.getSaveModel();\n    for (const panel of dashboard.panels) {\n      if (skipPanelUpdate(modifiedPanel, panel)) {\n        continue;\n      }\n\n      panel.restoreModel({\n        ...modifiedSaveModel,\n        ...pick(panel, 'gridPos', 'id'),\n      });\n\n      // Loaded plugin is not included in the persisted properties\n      // So is not handled by restoreModel\n      const pluginChanged = panel.plugin?.meta.id !== modifiedPanel.plugin?.meta.id;\n      panel.plugin = modifiedPanel.plugin;\n      panel.configRev++;\n\n      if (pluginChanged) {\n        panel.generateNewKey();\n\n        dispatch(panelModelAndPluginReady({ key: panel.key, plugin: panel.plugin! }));\n      }\n\n      // Resend last query result on source panel query runner\n      // But do this after the panel edit editor exit process has completed\n      setTimeout(() => {\n        panel.getQueryRunner().useLastResultFrom(modifiedPanel.getQueryRunner());\n      }, 20);\n    }\n\n    if (modifiedPanel.repeat) {\n      // We skip any repeated library panels so we need to update them by calling processRepeats\n      // But do this after the panel edit editor exit process has completed\n      setTimeout(() => dashboard.processRepeats(), 20);\n    }\n  };\n}\n\nexport function skipPanelUpdate(modifiedPanel: PanelModel, panelToUpdate: PanelModel): boolean {\n  // don't update library panels that aren't of the same type\n  if (panelToUpdate.libraryPanel?.uid !== modifiedPanel.libraryPanel!.uid) {\n    return true;\n  }\n\n  // don't update the modifiedPanel twice\n  if (panelToUpdate.id && panelToUpdate.id === modifiedPanel.id) {\n    return true;\n  }\n\n  // don't update library panels that are repeated\n  if (panelToUpdate.repeatPanelId) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function exitPanelEditor(): ThunkResult<void> {\n  return async (dispatch, getStore) => {\n    const dashboard = getStore().dashboard.getModel();\n    const { getPanel, getSourcePanel, shouldDiscardChanges } = getStore().panelEditor;\n    const panel = getPanel();\n\n    if (dashboard) {\n      dashboard.exitPanelEditor();\n    }\n\n    const sourcePanel = getSourcePanel();\n    if (hasPanelChangedInPanelEdit(panel) && !shouldDiscardChanges) {\n      const modifiedSaveModel = panel.getSaveModel();\n      const panelTypeChanged = sourcePanel.type !== panel.type;\n\n      dispatch(updateDuplicateLibraryPanels(panel, dashboard));\n\n      sourcePanel.restoreModel(modifiedSaveModel);\n      sourcePanel.configRev++; // force check the configs\n\n      if (panelTypeChanged) {\n        // Loaded plugin is not included in the persisted properties so is not handled by restoreModel\n        sourcePanel.plugin = panel.plugin;\n        sourcePanel.generateNewKey();\n\n        await dispatch(panelModelAndPluginReady({ key: sourcePanel.key, plugin: panel.plugin! }));\n      }\n\n      // Resend last query result on source panel query runner\n      // But do this after the panel edit editor exit process has completed\n      setTimeout(() => {\n        sourcePanel.getQueryRunner().useLastResultFrom(panel.getQueryRunner());\n        sourcePanel.render();\n\n        // If all changes where saved then reset configRev after applying changes\n        if (panel.hasSavedPanelEditChange && !panel.hasChanged) {\n          sourcePanel.configRev = 0;\n        }\n      }, 20);\n    }\n\n    // A new panel is only new until the first time we exit the panel editor\n    if (sourcePanel.isNew) {\n      if (!shouldDiscardChanges) {\n        delete sourcePanel.isNew;\n      } else {\n        dashboard && removePanel(dashboard, sourcePanel, true);\n      }\n    }\n\n    dispatch(cleanUpPanelState(panel.key));\n    dispatch(closeEditor());\n  };\n}\n\nfunction hasPanelChangedInPanelEdit(panel: PanelModel) {\n  return panel.hasChanged || panel.hasSavedPanelEditChange || panel.isAngularPlugin();\n}\n\nexport function updatePanelEditorUIState(uiState: Partial<PanelEditorUIState>): ThunkResult<void> {\n  return (dispatch, getStore) => {\n    const nextState = { ...getStore().panelEditor.ui, ...uiState };\n    dispatch(setPanelEditorUIState(nextState));\n    try {\n      store.setObject(PANEL_EDITOR_UI_STATE_STORAGE_KEY, nextState);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { Button, Modal } from '@grafana/ui';\n\nimport { DashboardModel } from '../../state';\n\nimport { SaveDashboardButton } from './SaveDashboardButton';\n\ninterface UnsavedChangesModalProps {\n  dashboard: DashboardModel;\n  onDiscard: () => void;\n  onDismiss: () => void;\n  onSaveSuccess?: () => void;\n}\n\nexport const UnsavedChangesModal = ({ dashboard, onSaveSuccess, onDiscard, onDismiss }: UnsavedChangesModalProps) => {\n  return (\n    <Modal\n      isOpen={true}\n      title=\"Unsaved changes\"\n      onDismiss={onDismiss}\n      icon=\"exclamation-triangle\"\n      className={css`\n        width: 500px;\n      `}\n    >\n      <h5>Do you want to save your changes?</h5>\n      <Modal.ButtonRow>\n        <Button variant=\"secondary\" onClick={onDismiss} fill=\"outline\">\n          Cancel\n        </Button>\n        <Button variant=\"destructive\" onClick={onDiscard}>\n          Discard\n        </Button>\n        <SaveDashboardButton dashboard={dashboard} onSaveSuccess={onSaveSuccess} />\n      </Modal.ButtonRow>\n    </Modal>\n  );\n};\n","import * as H from 'history';\nimport { find } from 'lodash';\nimport React, { useContext, useEffect, useState } from 'react';\nimport { Prompt } from 'react-router-dom';\n\nimport { locationService } from '@grafana/runtime';\nimport { Dashboard } from '@grafana/schema';\nimport { ModalsContext } from '@grafana/ui';\nimport { appEvents } from 'app/core/app_events';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { SaveLibraryPanelModal } from 'app/features/library-panels/components/SaveLibraryPanelModal/SaveLibraryPanelModal';\nimport { PanelModelWithLibraryPanel } from 'app/features/library-panels/types';\nimport { useDispatch } from 'app/types';\nimport { DashboardSavedEvent } from 'app/types/events';\n\nimport { DashboardModel } from '../../state/DashboardModel';\nimport { discardPanelChanges, exitPanelEditor } from '../PanelEditor/state/actions';\nimport { UnsavedChangesModal } from '../SaveDashboard/UnsavedChangesModal';\n\nexport interface Props {\n  dashboard: DashboardModel;\n}\n\ninterface State {\n  original: object | null;\n  originalPath?: string;\n}\n\nexport const DashboardPrompt = React.memo(({ dashboard }: Props) => {\n  const [state, setState] = useState<State>({ original: null });\n  const dispatch = useDispatch();\n  const { original, originalPath } = state;\n  const { showModal, hideModal } = useContext(ModalsContext);\n\n  useEffect(() => {\n    // This timeout delay is to wait for panels to load and migrate scheme before capturing the original state\n    // This is to minimize unsaved changes warnings due to automatic schema migrations\n    const timeoutId = setTimeout(() => {\n      const originalPath = locationService.getLocation().pathname;\n      const original = dashboard.getSaveModelCloneOld();\n      setState({ originalPath, original });\n    }, 1000);\n\n    const savedEventUnsub = appEvents.subscribe(DashboardSavedEvent, () => {\n      const original = dashboard.getSaveModelCloneOld();\n      setState({ originalPath, original });\n    });\n\n    return () => {\n      clearTimeout(timeoutId);\n      savedEventUnsub.unsubscribe();\n    };\n  }, [dashboard, originalPath]);\n\n  useEffect(() => {\n    const handleUnload = (event: BeforeUnloadEvent) => {\n      if (ignoreChanges(dashboard, original)) {\n        return;\n      }\n      if (hasChanges(dashboard, original)) {\n        event.preventDefault();\n        // No browser actually displays this message anymore.\n        // But Chrome requires it to be defined else the popup won't show.\n        event.returnValue = '';\n      }\n    };\n    window.addEventListener('beforeunload', handleUnload);\n    return () => window.removeEventListener('beforeunload', handleUnload);\n  }, [dashboard, original]);\n\n  const onHistoryBlock = (location: H.Location) => {\n    const panelInEdit = dashboard.panelInEdit;\n    const search = new URLSearchParams(location.search);\n\n    // Are we leaving panel edit & library panel?\n    if (panelInEdit && panelInEdit.libraryPanel && panelInEdit.hasChanged && !search.has('editPanel')) {\n      showModal(SaveLibraryPanelModal, {\n        isUnsavedPrompt: true,\n        panel: dashboard.panelInEdit as PanelModelWithLibraryPanel,\n        folderUid: dashboard.meta.folderUid ?? '',\n        onConfirm: () => {\n          hideModal();\n          moveToBlockedLocationAfterReactStateUpdate(location);\n        },\n        onDiscard: () => {\n          dispatch(discardPanelChanges());\n          moveToBlockedLocationAfterReactStateUpdate(location);\n          hideModal();\n        },\n        onDismiss: hideModal,\n      });\n      return false;\n    }\n\n    // Are we still on the same dashboard?\n    if (originalPath === location.pathname || !original) {\n      // This is here due to timing reasons we want the exit panel editor state changes to happen before router update\n      if (panelInEdit && !search.has('editPanel')) {\n        dispatch(exitPanelEditor());\n      }\n\n      return true;\n    }\n\n    if (ignoreChanges(dashboard, original)) {\n      return true;\n    }\n\n    if (!hasChanges(dashboard, original)) {\n      return true;\n    }\n\n    showModal(UnsavedChangesModal, {\n      dashboard: dashboard,\n      onSaveSuccess: () => {\n        hideModal();\n        moveToBlockedLocationAfterReactStateUpdate(location);\n      },\n      onDiscard: () => {\n        setState({ ...state, original: null });\n        hideModal();\n        moveToBlockedLocationAfterReactStateUpdate(location);\n      },\n      onDismiss: hideModal,\n    });\n\n    return false;\n  };\n\n  return <Prompt when={true} message={onHistoryBlock} />;\n});\n\nDashboardPrompt.displayName = 'DashboardPrompt';\n\nfunction moveToBlockedLocationAfterReactStateUpdate(location?: H.Location | null) {\n  if (location) {\n    setTimeout(() => locationService.push(location), 10);\n  }\n}\n\n/**\n * For some dashboards and users changes should be ignored *\n */\nexport function ignoreChanges(current: DashboardModel | null, original: object | null) {\n  if (!original) {\n    return true;\n  }\n\n  // Ignore changes if original is unsaved\n  if ((original as DashboardModel).version === 0) {\n    return true;\n  }\n\n  // Ignore changes if the user has been signed out\n  if (!contextSrv.isSignedIn) {\n    return true;\n  }\n\n  if (!current) {\n    return true;\n  }\n\n  const { canSave, fromScript, fromFile } = current.meta;\n  if (!contextSrv.isEditor && !canSave) {\n    return true;\n  }\n\n  return !canSave || fromScript || fromFile;\n}\n\n/**\n * Remove stuff that should not count in diff\n */\nfunction cleanDashboardFromIgnoredChanges(dashData: Dashboard) {\n  // need to new up the domain model class to get access to expand / collapse row logic\n  const model = new DashboardModel(dashData);\n\n  // Expand all rows before making comparison. This is required because row expand / collapse\n  // change order of panel array and panel positions.\n  model.expandRows();\n\n  const dash = model.getSaveModelClone();\n\n  // ignore time and refresh\n  delete dash.time;\n  dash.refresh = '';\n  dash.schemaVersion = 0;\n  delete dash.timezone;\n\n  dash.panels = [];\n\n  // ignore template variable values\n  if (dash.templating?.list) {\n    for (const variable of dash.templating.list) {\n      delete variable.current;\n      delete variable.options;\n      // @ts-expect-error\n      delete variable.filters;\n    }\n  }\n\n  return dash;\n}\n\n// TODO: Adapt original to be Dashboard type instead\nexport function hasChanges(current: DashboardModel, original: unknown) {\n  if (current.hasUnsavedChanges()) {\n    return true;\n  }\n  // TODO: Make getSaveModelClone return Dashboard type instead\n  const currentClean = cleanDashboardFromIgnoredChanges(current.getSaveModelCloneOld() as unknown as Dashboard);\n  const originalClean = cleanDashboardFromIgnoredChanges(original as Dashboard);\n\n  const currentTimepicker = find((currentClean as any).nav, { type: 'timepicker' });\n  const originalTimepicker = find((originalClean as any).nav, { type: 'timepicker' });\n\n  if (currentTimepicker && originalTimepicker) {\n    currentTimepicker.now = originalTimepicker.now;\n  }\n\n  const currentJson = JSON.stringify(currentClean, null);\n  const originalJson = JSON.stringify(originalClean, null);\n\n  return currentJson !== originalJson;\n}\n","import saveAs from 'file-saver';\n\nimport { dateTimeFormat, formattedValueToString, getValueFormat, SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { SceneObject } from '@grafana/scenes';\nimport { StateManagerBase } from 'app/core/services/StateManagerBase';\nimport { createDashboardSceneFromDashboardModel } from 'app/features/dashboard-scene/serialization/transformSaveModelToScene';\n\nimport { getTimeSrv } from '../../services/TimeSrv';\nimport { DashboardModel, PanelModel } from '../../state';\nimport { setDashboardToFetchFromLocalStorage } from '../../state/initDashboard';\n\nimport { Randomize } from './randomizer';\nimport { getDebugDashboard, getGithubMarkdown } from './utils';\n\ninterface SupportSnapshotState {\n  currentTab: SnapshotTab;\n  showMessage: ShowMessage;\n  options: Array<SelectableValue<ShowMessage>>;\n  snapshotText: string;\n  markdownText: string;\n  snapshotSize?: string;\n  randomize: Randomize;\n  loading?: boolean;\n  error?: {\n    title: string;\n    message: string;\n  };\n  panel: PanelModel;\n  panelTitle: string;\n\n  // eslint-disable-next-line\n  snapshot?: any;\n  snapshotUpdate: number;\n  scene?: SceneObject;\n}\n\nexport enum SnapshotTab {\n  Support,\n  Data,\n}\n\nexport enum ShowMessage {\n  PanelSnapshot,\n  GithubComment,\n}\n\nexport class SupportSnapshotService extends StateManagerBase<SupportSnapshotState> {\n  constructor(panel: PanelModel) {\n    super({\n      panel,\n      panelTitle: panel.replaceVariables(panel.title, undefined, 'text') || 'Panel',\n      currentTab: SnapshotTab.Support,\n      showMessage: ShowMessage.GithubComment,\n      snapshotText: '',\n      markdownText: '',\n      randomize: {},\n      snapshotUpdate: 0,\n      options: [\n        {\n          label: 'GitHub comment',\n          description: 'Copy and paste this message into a GitHub issue or comment',\n          value: ShowMessage.GithubComment,\n        },\n        {\n          label: 'Panel support snapshot',\n          description: 'Dashboard JSON used to help troubleshoot visualization issues',\n          value: ShowMessage.PanelSnapshot,\n        },\n      ],\n    });\n  }\n\n  async buildDebugDashboard() {\n    const { panel, randomize, snapshotUpdate } = this.state;\n    const snapshot = await getDebugDashboard(panel, randomize, getTimeSrv().timeRange());\n    const snapshotText = JSON.stringify(snapshot, null, 2);\n    const markdownText = getGithubMarkdown(panel, snapshotText);\n    const snapshotSize = formattedValueToString(getValueFormat('bytes')(snapshotText?.length ?? 0));\n\n    let scene: SceneObject | undefined = undefined;\n\n    if (!panel.isAngularPlugin()) {\n      try {\n        const oldModel = new DashboardModel(snapshot);\n        const dash = createDashboardSceneFromDashboardModel(oldModel);\n        scene = dash.state.body; // skip the wrappers\n      } catch (ex) {\n        console.log('Error creating scene:', ex);\n      }\n    }\n\n    this.setState({ snapshot, snapshotText, markdownText, snapshotSize, snapshotUpdate: snapshotUpdate + 1, scene });\n  }\n\n  onCurrentTabChange = (value: SnapshotTab) => {\n    this.setState({ currentTab: value });\n  };\n\n  onShowMessageChange = (value: SelectableValue<ShowMessage>) => {\n    this.setState({ showMessage: value.value! });\n  };\n\n  onGetMarkdownForClipboard = () => {\n    const { markdownText } = this.state;\n    const maxLen = Math.pow(1024, 2) * 1.5; // 1.5MB\n\n    if (markdownText.length > maxLen) {\n      this.setState({\n        error: {\n          title: 'Copy to clipboard failed',\n          message: 'Snapshot is too large, consider download and attaching a file instead',\n        },\n      });\n\n      return '';\n    }\n\n    return markdownText;\n  };\n\n  onDownloadDashboard = () => {\n    const { snapshotText, panelTitle } = this.state;\n    const blob = new Blob([snapshotText], {\n      type: 'text/plain',\n    });\n    const fileName = `debug-${panelTitle}-${dateTimeFormat(new Date())}.json.txt`;\n    saveAs(blob, fileName);\n  };\n\n  onSetSnapshotText = (snapshotText: string) => {\n    this.setState({ snapshotText });\n  };\n\n  onToggleRandomize = (k: keyof Randomize) => {\n    const { randomize } = this.state;\n    this.setState({ randomize: { ...randomize, [k]: !randomize[k] } });\n  };\n\n  onPreviewDashboard = () => {\n    const { snapshot } = this.state;\n    if (snapshot) {\n      setDashboardToFetchFromLocalStorage({ meta: {}, dashboard: snapshot });\n      global.open(config.appUrl + 'dashboard/new', '_blank');\n    }\n  };\n}\n","import { css } from '@emotion/css';\nimport React, { useMemo, useEffect } from 'react';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { PanelPlugin, GrafanaTheme2, FeatureState } from '@grafana/data';\nimport { Stack } from '@grafana/experimental';\nimport { config } from '@grafana/runtime';\nimport {\n  Drawer,\n  Tab,\n  TabsBar,\n  CodeEditor,\n  useStyles2,\n  Field,\n  HorizontalGroup,\n  InlineSwitch,\n  Button,\n  Spinner,\n  Alert,\n  FeatureBadge,\n  Select,\n  ClipboardButton,\n  Icon,\n} from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { PanelModel } from 'app/features/dashboard/state';\nimport { AccessControlAction } from 'app/types';\n\nimport { ShowMessage, SnapshotTab, SupportSnapshotService } from './SupportSnapshotService';\n\ninterface Props {\n  panel: PanelModel;\n  plugin?: PanelPlugin | null;\n  onClose: () => void;\n}\n\nexport function HelpWizard({ panel, plugin, onClose }: Props) {\n  const styles = useStyles2(getStyles);\n  const service = useMemo(() => new SupportSnapshotService(panel), [panel]);\n\n  const {\n    currentTab,\n    loading,\n    error,\n    options,\n    showMessage,\n    snapshotSize,\n    markdownText,\n    snapshotText,\n    randomize,\n    panelTitle,\n    scene,\n  } = service.useState();\n\n  useEffect(() => {\n    service.buildDebugDashboard();\n  }, [service, plugin, randomize]);\n\n  if (!plugin) {\n    return null;\n  }\n\n  const tabs = [\n    { label: 'Snapshot', value: SnapshotTab.Support },\n    { label: 'Data', value: SnapshotTab.Data },\n  ];\n\n  const hasSupportBundleAccess =\n    config.supportBundlesEnabled && contextSrv.hasPermission(AccessControlAction.ActionSupportBundlesCreate);\n\n  return (\n    <Drawer\n      title={`Get help with this panel`}\n      size=\"lg\"\n      onClose={onClose}\n      subtitle={\n        <Stack direction=\"column\" gap={1}>\n          <Stack direction=\"row\" gap={1}>\n            <FeatureBadge featureState={FeatureState.beta} />\n            <a\n              href=\"https://grafana.com/docs/grafana/latest/troubleshooting/\"\n              target=\"blank\"\n              className=\"external-link\"\n              rel=\"noopener noreferrer\"\n            >\n              Troubleshooting docs <Icon name=\"external-link-alt\" />\n            </a>\n          </Stack>\n          <span className=\"muted\">\n            To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The\n            snapshot contains query response data and panel settings.\n          </span>\n          {hasSupportBundleAccess && (\n            <span className=\"muted\">\n              You can also retrieve a support bundle containing information concerning your Grafana instance and\n              configured datasources in the <a href=\"/support-bundles\">support bundles section</a>.\n            </span>\n          )}\n        </Stack>\n      }\n      tabs={\n        <TabsBar>\n          {tabs.map((t, index) => (\n            <Tab\n              key={`${t.value}-${index}`}\n              label={t.label}\n              active={t.value === currentTab}\n              onChangeTab={() => service.onCurrentTabChange(t.value!)}\n            />\n          ))}\n        </TabsBar>\n      }\n    >\n      {loading && <Spinner />}\n      {error && <Alert title={error.title}>{error.message}</Alert>}\n\n      {currentTab === SnapshotTab.Data && (\n        <div className={styles.code}>\n          <div className={styles.opts}>\n            <Field label=\"Template\" className={styles.field}>\n              <Select options={options} value={showMessage} onChange={service.onShowMessageChange} />\n            </Field>\n\n            {showMessage === ShowMessage.GithubComment ? (\n              <ClipboardButton icon=\"copy\" getText={service.onGetMarkdownForClipboard}>\n                Copy to clipboard\n              </ClipboardButton>\n            ) : (\n              <Button icon=\"download-alt\" onClick={service.onDownloadDashboard}>\n                Download ({snapshotSize})\n              </Button>\n            )}\n          </div>\n          <AutoSizer disableWidth>\n            {({ height }) => (\n              <CodeEditor\n                width=\"100%\"\n                height={height}\n                language={showMessage === ShowMessage.GithubComment ? 'markdown' : 'json'}\n                showLineNumbers={true}\n                showMiniMap={true}\n                value={showMessage === ShowMessage.GithubComment ? markdownText : snapshotText}\n                readOnly={false}\n                onBlur={service.onSetSnapshotText}\n              />\n            )}\n          </AutoSizer>\n        </div>\n      )}\n      {currentTab === SnapshotTab.Support && (\n        <>\n          <Field\n            label=\"Randomize data\"\n            description=\"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal.\"\n          >\n            <HorizontalGroup>\n              <InlineSwitch\n                label=\"Labels\"\n                id=\"randomize-labels\"\n                showLabel={true}\n                value={Boolean(randomize.labels)}\n                onChange={() => service.onToggleRandomize('labels')}\n              />\n              <InlineSwitch\n                label=\"Field names\"\n                id=\"randomize-field-names\"\n                showLabel={true}\n                value={Boolean(randomize.names)}\n                onChange={() => service.onToggleRandomize('names')}\n              />\n              <InlineSwitch\n                label=\"String values\"\n                id=\"randomize-string-values\"\n                showLabel={true}\n                value={Boolean(randomize.values)}\n                onChange={() => service.onToggleRandomize('values')}\n              />\n            </HorizontalGroup>\n          </Field>\n\n          <Field label=\"Support snapshot\" description={`Panel: ${panelTitle}`}>\n            <Stack>\n              <Button icon=\"download-alt\" onClick={service.onDownloadDashboard}>\n                Dashboard ({snapshotSize})\n              </Button>\n              <ClipboardButton\n                icon=\"github\"\n                getText={service.onGetMarkdownForClipboard}\n                title=\"Copy a complete GitHub comment to the clipboard\"\n              >\n                Copy to clipboard\n              </ClipboardButton>\n              <Button\n                onClick={service.onPreviewDashboard}\n                variant=\"secondary\"\n                title=\"Open support snapshot dashboard in a new tab\"\n              >\n                Preview\n              </Button>\n            </Stack>\n          </Field>\n\n          <AutoSizer disableWidth>\n            {({ height }) => (\n              <div style={{ height, overflow: 'auto' }}>{scene && <scene.Component model={scene} />}</div>\n            )}\n          </AutoSizer>\n        </>\n      )}\n    </Drawer>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  code: css`\n    flex-grow: 1;\n    height: 100%;\n    overflow: scroll;\n  `,\n  field: css`\n    width: 100%;\n  `,\n  opts: css`\n    display: flex;\n    display: flex;\n    width: 100%;\n    flex-grow: 0;\n    align-items: center;\n    justify-content: flex-end;\n\n    button {\n      margin-left: 8px;\n    }\n  `,\n});\n","import { useEffect, useRef, useState } from 'react';\nimport { Unsubscribable } from 'rxjs';\n\nimport { LoadingState, PanelData } from '@grafana/data';\n\nimport { GetDataOptions } from '../../../query/state/PanelQueryRunner';\nimport { PanelModel } from '../../state';\n\ninterface UsePanelLatestData {\n  data?: PanelData;\n  hasError: boolean;\n  isLoading: boolean;\n  hasSeries: boolean;\n}\n\n/**\n * Subscribes and returns latest panel data from PanelQueryRunner\n */\nexport const usePanelLatestData = (\n  panel: PanelModel,\n  options: GetDataOptions,\n  checkSchema?: boolean\n): UsePanelLatestData => {\n  const querySubscription = useRef<Unsubscribable>();\n  const [latestData, setLatestData] = useState<PanelData>();\n\n  useEffect(() => {\n    let lastRev = -1;\n    let lastUpdate = 0;\n\n    querySubscription.current = panel\n      .getQueryRunner()\n      // We apply field config later\n      .getData({ withTransforms: options.withTransforms, withFieldConfig: false })\n      .subscribe({\n        next: (data) => {\n          if (checkSchema) {\n            if (lastRev === data.structureRev) {\n              const now = Date.now();\n              const elapsed = now - lastUpdate;\n              if (elapsed < 10000) {\n                return; // avoid updates if the schema has not changed for 10s\n              }\n              lastUpdate = now;\n            }\n            lastRev = data.structureRev ?? -1;\n          }\n          setLatestData(data);\n        },\n      });\n\n    return () => {\n      if (querySubscription.current) {\n        querySubscription.current.unsubscribe();\n      }\n    };\n    /**\n     * Adding separate options to dependencies array to avoid additional hook for comparing previous options with current.\n     * Otherwise, passing different references to the same object might cause troubles.\n     */\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [panel, options.withTransforms]);\n\n  return {\n    data: latestData,\n    isLoading: latestData?.state === LoadingState.Loading,\n    hasSeries: latestData ? !!latestData.series : false,\n    hasError: Boolean(\n      latestData && (latestData.error || latestData?.errors?.length || latestData.state === LoadingState.Error)\n    ),\n  };\n};\n","import React from 'react';\n\nimport { DataSourceApi, PanelData } from '@grafana/data';\nimport { Trans } from 'app/core/internationalization';\n\ninterface InspectMetadataTabProps {\n  data: PanelData;\n  metadataDatasource?: DataSourceApi;\n}\nexport const InspectMetadataTab = ({ data, metadataDatasource }: InspectMetadataTabProps) => {\n  if (!metadataDatasource || !metadataDatasource.components?.MetadataInspector) {\n    return <Trans i18nKey=\"dashboard.inspect-meta.no-inspector\">No Metadata Inspector</Trans>;\n  }\n  return <metadataDatasource.components.MetadataInspector datasource={metadataDatasource} data={data.series} />;\n};\n","import { isEmpty } from 'lodash';\nimport React, { useState } from 'react';\n\nimport {\n  CoreApp,\n  DataSourceApi,\n  formattedValueToString,\n  getValueFormat,\n  PanelData,\n  PanelPlugin,\n  LoadingState,\n  DataQueryError,\n} from '@grafana/data';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { Drawer, Tab, TabsBar } from '@grafana/ui';\nimport { t, Trans } from 'app/core/internationalization';\nimport { InspectDataTab } from 'app/features/inspector/InspectDataTab';\nimport { InspectErrorTab } from 'app/features/inspector/InspectErrorTab';\nimport { InspectJSONTab } from 'app/features/inspector/InspectJSONTab';\nimport { InspectMetadataTab } from 'app/features/inspector/InspectMetadataTab';\nimport { InspectStatsTab } from 'app/features/inspector/InspectStatsTab';\nimport { QueryInspector } from 'app/features/inspector/QueryInspector';\nimport { InspectTab } from 'app/features/inspector/types';\n\nimport { GetDataOptions } from '../../../query/state/PanelQueryRunner';\nimport { DashboardModel, PanelModel } from '../../state';\n\ninterface Props {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n  plugin?: PanelPlugin | null;\n  defaultTab?: InspectTab;\n  tabs: Array<{ label: string; value: InspectTab }>;\n  // The last raw response\n  data?: PanelData;\n  isDataLoading: boolean;\n  dataOptions: GetDataOptions;\n  // If the datasource supports custom metadata\n  metadataDatasource?: DataSourceApi;\n  onDataOptionsChange: (options: GetDataOptions) => void;\n  onClose: () => void;\n}\n\nexport const InspectContent = ({\n  panel,\n  plugin,\n  dashboard,\n  tabs,\n  data,\n  isDataLoading,\n  dataOptions,\n  metadataDatasource,\n  defaultTab,\n  onDataOptionsChange,\n  onClose,\n}: Props) => {\n  const [currentTab, setCurrentTab] = useState(defaultTab ?? InspectTab.Data);\n\n  if (!plugin) {\n    return null;\n  }\n\n  let errors = getErrors(data);\n\n  // Validate that the active tab is actually valid and allowed\n  let activeTab = currentTab;\n  if (!tabs.find((item) => item.value === currentTab)) {\n    activeTab = InspectTab.JSON;\n  }\n\n  const panelTitle = getTemplateSrv().replace(panel.title, panel.scopedVars, 'text') || 'Panel';\n  const title = t('dashboard.inspect.title', 'Inspect: {{panelTitle}}', { panelTitle });\n\n  return (\n    <Drawer\n      title={title}\n      subtitle={data && formatStats(data)}\n      onClose={onClose}\n      tabs={\n        <TabsBar>\n          {tabs.map((tab, index) => {\n            return (\n              <Tab\n                key={`${tab.value}-${index}`}\n                label={tab.label}\n                active={tab.value === activeTab}\n                onChangeTab={() => setCurrentTab(tab.value || InspectTab.Data)}\n              />\n            );\n          })}\n        </TabsBar>\n      }\n    >\n      {activeTab === InspectTab.Data && (\n        <InspectDataTab\n          dataName={panel.getDisplayTitle()}\n          panelPluginId={panel.type}\n          fieldConfig={panel.fieldConfig}\n          hasTransformations={Boolean(panel.transformations?.length)}\n          data={data && data.series}\n          isLoading={isDataLoading}\n          options={dataOptions}\n          onOptionsChange={onDataOptionsChange}\n          timeZone={dashboard.timezone}\n          app={CoreApp.Dashboard}\n        />\n      )}\n      {data && activeTab === InspectTab.Meta && (\n        <InspectMetadataTab data={data} metadataDatasource={metadataDatasource} />\n      )}\n\n      {activeTab === InspectTab.JSON && (\n        <InspectJSONTab panel={panel} dashboard={dashboard} data={data} onClose={onClose} />\n      )}\n      {activeTab === InspectTab.Error && <InspectErrorTab errors={errors} />}\n      {data && activeTab === InspectTab.Stats && <InspectStatsTab data={data} timeZone={dashboard.getTimezone()} />}\n      {data && activeTab === InspectTab.Query && <QueryInspector data={data} onRefreshQuery={() => panel.refresh()} />}\n    </Drawer>\n  );\n};\n\n// This will combine\nfunction getErrors(data: PanelData | undefined): DataQueryError[] {\n  let errors = data?.errors ?? [];\n  if (data?.error && !errors.includes(data.error)) {\n    errors = [data.error, ...errors];\n  }\n  if (!errors.length && data?.state === LoadingState.Error) {\n    return [\n      {\n        message: 'Error loading data',\n      },\n    ];\n  }\n  return errors;\n}\n\nfunction formatStats(data: PanelData) {\n  const { request } = data;\n\n  if (!request || isEmpty(request)) {\n    return '';\n  }\n\n  const queryCount = request.targets.length;\n  const requestTime = request.endTime ? request.endTime - request.startTime : 0;\n  const formatted = formattedValueToString(getValueFormat('ms')(requestTime));\n\n  return (\n    <Trans i18nKey=\"dashboard.inspect.subtitle\">\n      {{ queryCount }} queries with total query time of {{ formatted }}\n    </Trans>\n  );\n}\n","import React, { useState } from 'react';\nimport { connect, MapStateToProps } from 'react-redux';\nimport { useLocation } from 'react-router-dom';\n\nimport { PanelPlugin } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { DashboardModel, PanelModel } from 'app/features/dashboard/state';\nimport { InspectTab } from 'app/features/inspector/types';\nimport { getPanelStateForModel } from 'app/features/panel/state/selectors';\nimport { StoreState } from 'app/types';\n\nimport { GetDataOptions } from '../../../query/state/PanelQueryRunner';\nimport { HelpWizard } from '../HelpWizard/HelpWizard';\nimport { usePanelLatestData } from '../PanelEditor/usePanelLatestData';\n\nimport { InspectContent } from './InspectContent';\nimport { useDatasourceMetadata, useInspectTabs } from './hooks';\n\ninterface OwnProps {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n}\n\nexport interface ConnectedProps {\n  plugin?: PanelPlugin | null;\n}\n\nexport type Props = OwnProps & ConnectedProps;\n\nconst PanelInspectorUnconnected = ({ panel, dashboard, plugin }: Props) => {\n  const location = useLocation();\n  const defaultTab = new URLSearchParams(location.search).get('inspectTab') as InspectTab;\n  const [dataOptions, setDataOptions] = useState<GetDataOptions>({\n    withTransforms: defaultTab === InspectTab.Error,\n    withFieldConfig: true,\n  });\n\n  const { data, isLoading, hasError } = usePanelLatestData(panel, dataOptions, false);\n  const metaDs = useDatasourceMetadata(data);\n  const tabs = useInspectTabs(panel, dashboard, plugin, hasError, metaDs);\n\n  const onClose = () => {\n    locationService.partial({\n      inspect: null,\n      inspectTab: null,\n    });\n  };\n\n  if (!plugin) {\n    return null;\n  }\n\n  if (defaultTab === InspectTab.Help) {\n    return <HelpWizard panel={panel} plugin={plugin} onClose={onClose} />;\n  }\n\n  return (\n    <InspectContent\n      dashboard={dashboard}\n      panel={panel}\n      plugin={plugin}\n      defaultTab={defaultTab}\n      tabs={tabs}\n      data={data}\n      isDataLoading={isLoading}\n      dataOptions={dataOptions}\n      onDataOptionsChange={setDataOptions}\n      metadataDatasource={metaDs}\n      onClose={onClose}\n    />\n  );\n};\n\nconst mapStateToProps: MapStateToProps<ConnectedProps, OwnProps, StoreState> = (state, props) => {\n  const panelState = getPanelStateForModel(state, props.panel);\n  if (!panelState) {\n    return { plugin: null };\n  }\n\n  return {\n    plugin: panelState.plugin,\n  };\n};\n\nexport const PanelInspector = connect(mapStateToProps)(PanelInspectorUnconnected);\n","import React, { PropsWithChildren, ReactElement, useMemo } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Tooltip } from '@grafana/ui';\n\nimport { variableAdapters } from '../adapters';\nimport { VARIABLE_PREFIX } from '../constants';\nimport { VariableHide, VariableModel } from '../types';\n\ninterface Props {\n  variable: VariableModel;\n  readOnly?: boolean;\n}\n\nexport const PickerRenderer = (props: Props) => {\n  const PickerToRender = useMemo(() => variableAdapters.get(props.variable.type).picker, [props.variable]);\n\n  if (!props.variable) {\n    return <div>Couldn&apos;t load variable</div>;\n  }\n\n  return (\n    <div className=\"gf-form\">\n      <PickerLabel variable={props.variable} />\n      {props.variable.hide !== VariableHide.hideVariable && PickerToRender && (\n        <PickerToRender variable={props.variable} readOnly={props.readOnly ?? false} />\n      )}\n    </div>\n  );\n};\n\nfunction PickerLabel({ variable }: PropsWithChildren<Props>): ReactElement | null {\n  const labelOrName = useMemo(() => variable.label || variable.name, [variable]);\n\n  if (variable.hide !== VariableHide.dontHide) {\n    return null;\n  }\n\n  const elementId = VARIABLE_PREFIX + variable.id;\n  if (variable.description) {\n    return (\n      <Tooltip content={variable.description} placement={'bottom'}>\n        <label\n          className=\"gf-form-label gf-form-label--variable\"\n          data-testid={selectors.pages.Dashboard.SubMenu.submenuItemLabels(labelOrName)}\n          htmlFor={elementId}\n        >\n          {labelOrName}\n        </label>\n      </Tooltip>\n    );\n  }\n\n  return (\n    <label\n      className=\"gf-form-label gf-form-label--variable\"\n      data-testid={selectors.pages.Dashboard.SubMenu.submenuItemLabels(labelOrName)}\n      htmlFor={elementId}\n    >\n      {labelOrName}\n    </label>\n  );\n}\n","import React, { useEffect, useState } from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\n\nimport { PickerRenderer } from '../../../variables/pickers/PickerRenderer';\nimport { VariableHide, VariableModel } from '../../../variables/types';\n\ninterface Props {\n  variables: VariableModel[];\n  readOnly?: boolean;\n}\n\nexport const SubMenuItems = ({ variables, readOnly }: Props) => {\n  const [visibleVariables, setVisibleVariables] = useState<VariableModel[]>([]);\n\n  useEffect(() => {\n    setVisibleVariables(variables.filter((state) => state.hide !== VariableHide.hideVariable));\n  }, [variables]);\n\n  if (visibleVariables.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {visibleVariables.map((variable) => {\n        return (\n          <div\n            key={variable.id}\n            className=\"submenu-item gf-form-inline\"\n            data-testid={selectors.pages.Dashboard.SubMenu.submenuItem}\n          >\n            <PickerRenderer variable={variable} readOnly={readOnly} />\n          </div>\n        );\n      })}\n    </>\n  );\n};\n","import store from 'app/core/store';\n\nexport function saveSectionOpenState(id: string, isOpen: boolean) {\n  store.set(`panel-edit-section-${id}`, isOpen ? 'true' : 'false');\n}\n\nexport function getSectionOpenState(id: string, defaultValue: boolean) {\n  return store.getBool(`panel-edit-section-${id}`, defaultValue);\n}\n","import React, { PureComponent } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport { PanelPlugin, PanelPluginMeta } from '@grafana/data';\nimport { AngularComponent, getAngularLoader } from '@grafana/runtime';\nimport { PanelCtrl } from 'app/angular/panel/panel_ctrl';\nimport { changePanelPlugin } from 'app/features/panel/state/actions';\nimport { getPanelStateForModel } from 'app/features/panel/state/selectors';\nimport { StoreState } from 'app/types';\n\nimport { PanelModel, DashboardModel } from '../../state';\n\nimport { getSectionOpenState, saveSectionOpenState } from './state/utils';\n\ninterface OwnProps {\n  panel: PanelModel;\n  dashboard: DashboardModel;\n  plugin: PanelPlugin;\n}\n\nconst mapStateToProps = (state: StoreState, props: OwnProps) => ({\n  angularPanelComponent: getPanelStateForModel(state, props.panel)?.angularComponent,\n});\n\nconst mapDispatchToProps = { changePanelPlugin };\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\ntype Props = ConnectedProps<typeof connector> & OwnProps;\n\nexport class AngularPanelOptionsUnconnected extends PureComponent<Props> {\n  element?: HTMLElement | null;\n  angularOptions?: AngularComponent | null;\n\n  constructor(props: Props) {\n    super(props);\n  }\n\n  componentDidMount() {\n    this.loadAngularOptions();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (\n      this.props.plugin !== prevProps.plugin ||\n      this.props.angularPanelComponent !== prevProps.angularPanelComponent\n    ) {\n      this.cleanUpAngularOptions();\n    }\n\n    this.loadAngularOptions();\n  }\n\n  componentWillUnmount() {\n    this.cleanUpAngularOptions();\n  }\n\n  cleanUpAngularOptions() {\n    if (this.angularOptions) {\n      this.angularOptions.destroy();\n      this.angularOptions = null;\n    }\n  }\n\n  loadAngularOptions() {\n    const { panel, angularPanelComponent, changePanelPlugin } = this.props;\n\n    if (!this.element || !angularPanelComponent || this.angularOptions) {\n      return;\n    }\n\n    const scope = angularPanelComponent.getScope();\n\n    // When full page reloading in edit mode the angular panel has on fully compiled and instantiated yet\n    if (!scope.$$childHead) {\n      setTimeout(() => {\n        this.forceUpdate();\n      });\n      return;\n    }\n\n    const panelCtrl: PanelCtrl = scope.$$childHead.ctrl;\n    panelCtrl.initEditMode();\n    panelCtrl.onPluginTypeChange = (plugin: PanelPluginMeta) => {\n      changePanelPlugin({ panel, pluginId: plugin.id });\n    };\n\n    let template = '';\n    for (let i = 0; i < panelCtrl.editorTabs.length; i++) {\n      const tab = panelCtrl.editorTabs[i];\n      tab.isOpen = getSectionOpenState(tab.title, i === 0);\n\n      template += `\n      <div class=\"panel-options-group\" ng-cloak>\n        <div class=\"panel-options-group__header\" ng-click=\"toggleOptionGroup(${i})\" aria-label=\"${tab.title} section\">\n          <div class=\"panel-options-group__icon\">\n            <icon name=\"ctrl.editorTabs[${i}].isOpen ? 'angle-down' : 'angle-right'\"></icon>\n          </div>\n          <div class=\"panel-options-group__title\">${tab.title}</div>\n        </div>\n        <div class=\"panel-options-group__body\" ng-if=\"ctrl.editorTabs[${i}].isOpen\">\n          <panel-editor-tab editor-tab=\"ctrl.editorTabs[${i}]\" ctrl=\"ctrl\"></panel-editor-tab>\n        </div>\n      </div>\n      `;\n    }\n\n    const loader = getAngularLoader();\n    const scopeProps = {\n      ctrl: panelCtrl,\n      toggleOptionGroup: (index: number) => {\n        const tab = panelCtrl.editorTabs[index];\n        tab.isOpen = !tab.isOpen;\n        saveSectionOpenState(tab.title, Boolean(tab.isOpen));\n      },\n    };\n\n    this.angularOptions = loader.load(this.element, scopeProps, template);\n    this.angularOptions.digest();\n  }\n\n  render() {\n    return <div ref={(elem) => (this.element = elem)} />;\n  }\n}\n\nexport const AngularPanelOptions = connect(mapStateToProps, mapDispatchToProps)(AngularPanelOptionsUnconnected);\n","import { css, cx } from '@emotion/css';\nimport React, { useId } from 'react';\nimport Highlighter from 'react-highlight-words';\n\nimport {\n  DynamicConfigValue,\n  FieldConfigOptionsRegistry,\n  FieldConfigProperty,\n  FieldOverrideContext,\n  GrafanaTheme2,\n} from '@grafana/data';\nimport { Counter, Field, HorizontalGroup, IconButton, Label, useStyles2 } from '@grafana/ui';\n\nimport { OptionsPaneCategory } from './OptionsPaneCategory';\n\ninterface DynamicConfigValueEditorProps {\n  property: DynamicConfigValue;\n  registry: FieldConfigOptionsRegistry;\n  onChange: (value: DynamicConfigValue) => void;\n  context: FieldOverrideContext;\n  onRemove: () => void;\n  isSystemOverride?: boolean;\n  searchQuery: string;\n}\n\nexport const DynamicConfigValueEditor = ({\n  property,\n  context,\n  registry,\n  onChange,\n  onRemove,\n  isSystemOverride,\n  searchQuery,\n}: DynamicConfigValueEditorProps) => {\n  const styles = useStyles2(getStyles);\n  const item = registry?.getIfExists(property.id);\n\n  const componentId = useId();\n\n  if (!item) {\n    return null;\n  }\n\n  const isCollapsible =\n    Array.isArray(property.value) ||\n    property.id === FieldConfigProperty.Thresholds ||\n    property.id === FieldConfigProperty.Links ||\n    property.id === FieldConfigProperty.Mappings;\n\n  const labelCategory = item.category?.filter((c) => c !== item.name);\n  let editor;\n\n  /* eslint-disable react/display-name */\n  const renderLabel =\n    (includeDescription = true, includeCounter = false) =>\n    (isExpanded = false) => (\n      <HorizontalGroup justify=\"space-between\">\n        <Label\n          category={labelCategory}\n          description={includeDescription ? item.description : undefined}\n          htmlFor={componentId}\n        >\n          <Highlighter\n            textToHighlight={item.name}\n            searchWords={[searchQuery]}\n            highlightClassName={'search-fragment-highlight'}\n          />\n          {!isExpanded && includeCounter && item.getItemsCount && (\n            <Counter value={item.getItemsCount(property.value)} />\n          )}\n        </Label>\n        {!isSystemOverride && (\n          <div>\n            <IconButton name=\"times\" onClick={onRemove} tooltip=\"Remove label\" />\n          </div>\n        )}\n      </HorizontalGroup>\n    );\n  /* eslint-enable react/display-name */\n\n  if (isCollapsible) {\n    editor = (\n      <OptionsPaneCategory\n        id={item.name}\n        renderTitle={renderLabel(false, true)}\n        className={css`\n          padding-left: 0;\n          padding-right: 0;\n        `}\n        isNested\n        isOpenDefault={property.value !== undefined}\n      >\n        <item.override\n          value={property.value}\n          onChange={(value) => {\n            onChange(value);\n          }}\n          item={item}\n          context={context}\n        />\n      </OptionsPaneCategory>\n    );\n  } else {\n    editor = (\n      <div>\n        <Field label={renderLabel()()} description={item.description}>\n          <item.override\n            value={property.value}\n            onChange={(value) => {\n              onChange(value);\n            }}\n            item={item}\n            context={context}\n            id={componentId}\n          />\n        </Field>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={cx(\n        isCollapsible && styles.collapsibleOverrideEditor,\n        !isCollapsible && 'dynamicConfigValueEditor--nonCollapsible'\n      )}\n    >\n      {editor}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    collapsibleOverrideEditor: css`\n      label: collapsibleOverrideEditor;\n      & + .dynamicConfigValueEditor--nonCollapsible {\n        margin-top: ${theme.spacing(1)};\n      }\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { FieldConfigOptionsRegistry, GrafanaTheme2, ConfigOverrideRule } from '@grafana/data';\nimport { HorizontalGroup, Icon, IconButton, useStyles2 } from '@grafana/ui';\nimport { FieldMatcherUIRegistryItem } from '@grafana/ui/src/components/MatchersUI/types';\n\ninterface Props {\n  isExpanded: boolean;\n  registry: FieldConfigOptionsRegistry;\n  matcherUi: FieldMatcherUIRegistryItem<any>;\n  override: ConfigOverrideRule;\n  overrideName: string;\n  onOverrideRemove: () => void;\n}\nexport const OverrideCategoryTitle = ({\n  isExpanded,\n  registry,\n  matcherUi,\n  overrideName,\n  override,\n  onOverrideRemove,\n}: Props) => {\n  const styles = useStyles2(getStyles);\n  const properties = override.properties.map((p) => registry.getIfExists(p.id)).filter((prop) => !!prop);\n  const propertyNames = properties.map((p) => p?.name).join(', ');\n  const matcherOptions = matcherUi.optionsToLabel(override.matcher.options);\n\n  return (\n    <div>\n      <HorizontalGroup justify=\"space-between\">\n        <div>{overrideName}</div>\n        <IconButton name=\"trash-alt\" onClick={onOverrideRemove} tooltip=\"Remove override\" />\n      </HorizontalGroup>\n      {!isExpanded && (\n        <div className={styles.overrideDetails}>\n          <div className={styles.options} title={matcherOptions}>\n            {matcherOptions} <Icon name=\"angle-right\" /> {propertyNames}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nOverrideCategoryTitle.displayName = 'OverrideTitle';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    matcherUi: css`\n      padding: ${theme.spacing(1)};\n    `,\n    propertyPickerWrapper: css`\n      margin-top: ${theme.spacing(2)};\n    `,\n    overrideDetails: css`\n      font-size: ${theme.typography.bodySmall.fontSize};\n      color: ${theme.colors.text.secondary};\n      font-weight: ${theme.typography.fontWeightRegular};\n    `,\n    options: css`\n      overflow: hidden;\n      padding-right: ${theme.spacing(4)};\n    `,\n    unknownLabel: css`\n      margin-bottom: 0;\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport { cloneDeep } from 'lodash';\nimport React from 'react';\n\nimport {\n  FieldConfigOptionsRegistry,\n  SelectableValue,\n  isSystemOverride as isSystemOverrideGuard,\n  VariableSuggestionsScope,\n  DynamicConfigValue,\n  ConfigOverrideRule,\n  GrafanaTheme2,\n  fieldMatchers,\n} from '@grafana/data';\nimport { fieldMatchersUI, useStyles2, ValuePicker } from '@grafana/ui';\nimport { getDataLinksVariableSuggestions } from 'app/features/panel/panellinks/link_srv';\n\nimport { DynamicConfigValueEditor } from './DynamicConfigValueEditor';\nimport { OptionsPaneCategoryDescriptor } from './OptionsPaneCategoryDescriptor';\nimport { OptionsPaneItemDescriptor } from './OptionsPaneItemDescriptor';\nimport { OverrideCategoryTitle } from './OverrideCategoryTitle';\nimport { OptionPaneRenderProps } from './types';\n\nexport function getFieldOverrideCategories(\n  props: OptionPaneRenderProps,\n  searchQuery: string\n): OptionsPaneCategoryDescriptor[] {\n  const categories: OptionsPaneCategoryDescriptor[] = [];\n  const currentFieldConfig = props.panel.fieldConfig;\n  const registry = props.plugin.fieldConfigRegistry;\n  const data = props.data?.series ?? [];\n\n  if (registry.isEmpty()) {\n    return [];\n  }\n\n  const onOverrideChange = (index: number, override: ConfigOverrideRule) => {\n    let overrides = cloneDeep(currentFieldConfig.overrides);\n    overrides[index] = override;\n    props.onFieldConfigsChange({ ...currentFieldConfig, overrides });\n  };\n\n  const onOverrideRemove = (overrideIndex: number) => {\n    let overrides = cloneDeep(currentFieldConfig.overrides);\n    overrides.splice(overrideIndex, 1);\n    props.onFieldConfigsChange({ ...currentFieldConfig, overrides });\n  };\n\n  const onOverrideAdd = (value: SelectableValue<string>) => {\n    const info = fieldMatchers.get(value.value!);\n    if (!info) {\n      return;\n    }\n\n    props.onFieldConfigsChange({\n      ...currentFieldConfig,\n      overrides: [\n        ...currentFieldConfig.overrides,\n        {\n          matcher: {\n            id: info.id,\n            options: info.defaultOptions,\n          },\n          properties: [],\n        },\n      ],\n    });\n  };\n\n  const context = {\n    data,\n    getSuggestions: (scope?: VariableSuggestionsScope) => getDataLinksVariableSuggestions(data, scope),\n    isOverride: true,\n  };\n\n  /**\n   * Main loop through all override rules\n   */\n  for (let idx = 0; idx < currentFieldConfig.overrides.length; idx++) {\n    const override = currentFieldConfig.overrides[idx];\n    const overrideName = `Override ${idx + 1}`;\n    const matcherUi = fieldMatchersUI.get(override.matcher.id);\n    const configPropertiesOptions = getOverrideProperties(registry);\n    const isSystemOverride = isSystemOverrideGuard(override);\n    // A way to force open new override categories\n    const forceOpen = override.properties.length === 0 ? 1 : 0;\n\n    const category = new OptionsPaneCategoryDescriptor({\n      title: overrideName,\n      id: overrideName,\n      forceOpen,\n      renderTitle: function renderOverrideTitle(isExpanded: boolean) {\n        return (\n          <OverrideCategoryTitle\n            override={override}\n            isExpanded={isExpanded}\n            registry={registry}\n            overrideName={overrideName}\n            matcherUi={matcherUi}\n            onOverrideRemove={() => onOverrideRemove(idx)}\n          />\n        );\n      },\n    });\n\n    const onMatcherConfigChange = (options: any) => {\n      override.matcher.options = options;\n      onOverrideChange(idx, override);\n    };\n\n    const onDynamicConfigValueAdd = (o: ConfigOverrideRule, value: SelectableValue<string>) => {\n      const registryItem = registry.get(value.value!);\n      const propertyConfig: DynamicConfigValue = {\n        id: registryItem.id,\n        value: registryItem.defaultValue,\n      };\n\n      if (override.properties) {\n        o.properties.push(propertyConfig);\n      } else {\n        o.properties = [propertyConfig];\n      }\n\n      onOverrideChange(idx, o);\n    };\n\n    /**\n     * Add override matcher UI element\n     */\n    category.addItem(\n      new OptionsPaneItemDescriptor({\n        title: matcherUi.name,\n        render: function renderMatcherUI() {\n          return (\n            <matcherUi.component\n              id={`${matcherUi.matcher.id}-${idx}`}\n              matcher={matcherUi.matcher}\n              data={props.data?.series ?? []}\n              options={override.matcher.options}\n              onChange={onMatcherConfigChange}\n            />\n          );\n        },\n      })\n    );\n\n    /**\n     * Loop through all override properties\n     */\n    for (let propIdx = 0; propIdx < override.properties.length; propIdx++) {\n      const property = override.properties[propIdx];\n      const registryItemForProperty = registry.getIfExists(property.id);\n\n      if (!registryItemForProperty) {\n        continue;\n      }\n\n      const onPropertyChange = (value: DynamicConfigValue) => {\n        override.properties[propIdx].value = value;\n        onOverrideChange(idx, override);\n      };\n\n      const onPropertyRemove = () => {\n        override.properties.splice(propIdx, 1);\n        onOverrideChange(idx, override);\n      };\n\n      /**\n       * Add override property item\n       */\n      category.addItem(\n        new OptionsPaneItemDescriptor({\n          title: registryItemForProperty.name,\n          skipField: true,\n          render: function renderPropertyEditor() {\n            return (\n              <DynamicConfigValueEditor\n                key={`${property.id}/${propIdx}`}\n                isSystemOverride={isSystemOverride}\n                onChange={onPropertyChange}\n                onRemove={onPropertyRemove}\n                property={property}\n                registry={registry}\n                context={context}\n                searchQuery={searchQuery}\n              />\n            );\n          },\n        })\n      );\n    }\n\n    /**\n     * Add button that adds new overrides\n     */\n    if (!isSystemOverride && override.matcher.options) {\n      category.addItem(\n        new OptionsPaneItemDescriptor({\n          title: '----------',\n          skipField: true,\n          render: function renderAddPropertyButton() {\n            return (\n              <ValuePicker\n                key=\"Add override property\"\n                label=\"Add override property\"\n                variant=\"secondary\"\n                isFullWidth={true}\n                icon=\"plus\"\n                menuPlacement=\"auto\"\n                options={configPropertiesOptions}\n                onChange={(v) => onDynamicConfigValueAdd(override, v)}\n              />\n            );\n          },\n        })\n      );\n    }\n\n    categories.push(category);\n  }\n\n  categories.push(\n    new OptionsPaneCategoryDescriptor({\n      title: 'add button',\n      id: 'add button',\n      customRender: function renderAddButton() {\n        return (\n          <AddOverrideButtonContainer key=\"Add override\">\n            <ValuePicker\n              icon=\"plus\"\n              label=\"Add field override\"\n              variant=\"secondary\"\n              menuPlacement=\"auto\"\n              isFullWidth={true}\n              size=\"md\"\n              options={fieldMatchersUI\n                .list()\n                .filter((o) => !o.excludeFromPicker)\n                .map<SelectableValue<string>>((i) => ({ label: i.name, value: i.id, description: i.description }))}\n              onChange={(value) => onOverrideAdd(value)}\n            />\n          </AddOverrideButtonContainer>\n        );\n      },\n    })\n  );\n\n  return categories;\n}\n\nfunction getOverrideProperties(registry: FieldConfigOptionsRegistry) {\n  return registry\n    .list()\n    .filter((o) => !o.hideFromOverrides)\n    .map((item) => {\n      let label = item.name;\n      if (item.category) {\n        label = [...item.category, item.name].join(' > ');\n      }\n      return {\n        label,\n        value: item.id,\n        description: item.description,\n      };\n    });\n}\n\nfunction AddOverrideButtonContainer({ children }: { children: React.ReactNode }) {\n  const styles = useStyles2(getBorderTopStyles);\n  return <div className={styles}>{children}</div>;\n}\n\nfunction getBorderTopStyles(theme: GrafanaTheme2) {\n  return css({\n    borderTop: `1px solid ${theme.colors.border.weak}`,\n    padding: `${theme.spacing(2)}`,\n    display: 'flex',\n  });\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { DateTimeInput, GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { PanelModelWithLibraryPanel } from '../../types';\n\ninterface Props {\n  panel: PanelModelWithLibraryPanel;\n  formatDate?: (dateString: DateTimeInput, format?: string) => string;\n}\n\nexport const LibraryPanelInformation = ({ panel, formatDate }: Props) => {\n  const styles = useStyles2(getStyles);\n\n  const meta = panel.libraryPanel?.meta;\n  if (!meta) {\n    return null;\n  }\n\n  return (\n    <div className={styles.info}>\n      <div className={styles.libraryPanelInfo}>\n        {`Used on ${meta.connectedDashboards} `}\n        {meta.connectedDashboards === 1 ? 'dashboard' : 'dashboards'}\n      </div>\n      <div className={styles.libraryPanelInfo}>\n        Last edited on {formatDate?.(meta.updated, 'L') ?? meta.updated} by\n        {meta.updatedBy.avatarUrl && (\n          <img\n            width=\"22\"\n            height=\"22\"\n            className={styles.userAvatar}\n            src={meta.updatedBy.avatarUrl}\n            alt={`Avatar for ${meta.updatedBy.name}`}\n          />\n        )}\n        {meta.updatedBy.name}\n      </div>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    info: css`\n      line-height: 1;\n    `,\n    libraryPanelInfo: css`\n      color: ${theme.colors.text.secondary};\n      font-size: ${theme.typography.bodySmall.fontSize};\n    `,\n    userAvatar: css`\n      border-radius: ${theme.shape.radius.circle};\n      box-sizing: content-box;\n      width: 22px;\n      height: 22px;\n      padding-left: ${theme.spacing(1)};\n      padding-right: ${theme.spacing(1)};\n    `,\n  };\n};\n","import React from 'react';\n\nimport { Input } from '@grafana/ui';\nimport { LibraryPanelInformation } from 'app/features/library-panels/components/LibraryPanelInfo/LibraryPanelInfo';\n\nimport { isPanelModelLibraryPanel } from '../../../library-panels/guard';\n\nimport { OptionsPaneCategoryDescriptor } from './OptionsPaneCategoryDescriptor';\nimport { OptionsPaneItemDescriptor } from './OptionsPaneItemDescriptor';\nimport { OptionPaneRenderProps } from './types';\n\nexport function getLibraryPanelOptionsCategory(props: OptionPaneRenderProps): OptionsPaneCategoryDescriptor {\n  const { panel, onPanelConfigChange, dashboard } = props;\n  const descriptor = new OptionsPaneCategoryDescriptor({\n    title: 'Library panel options',\n    id: 'Library panel options',\n    isOpenDefault: true,\n  });\n\n  if (isPanelModelLibraryPanel(panel)) {\n    descriptor\n      .addItem(\n        new OptionsPaneItemDescriptor({\n          title: 'Name',\n          value: panel.libraryPanel.name,\n          popularRank: 1,\n          render: function renderName() {\n            return (\n              <Input\n                id=\"LibraryPanelFrameName\"\n                defaultValue={panel.libraryPanel.name}\n                onBlur={(e) =>\n                  onPanelConfigChange('libraryPanel', { ...panel.libraryPanel, name: e.currentTarget.value })\n                }\n              />\n            );\n          },\n        })\n      )\n      .addItem(\n        new OptionsPaneItemDescriptor({\n          title: 'Information',\n          render: function renderLibraryPanelInformation() {\n            return <LibraryPanelInformation panel={panel} formatDate={dashboard.formatDate} />;\n          },\n        })\n      );\n  }\n\n  return descriptor;\n}\n","import React from 'react';\n\nimport { getDashboardSrv } from '../../services/DashboardSrv';\nimport { PanelModel } from '../../state';\n\nimport { GenAIButton } from './GenAIButton';\nimport { EventTrackingSrc } from './tracking';\nimport { Message, Role } from './utils';\n\ninterface GenAIPanelDescriptionButtonProps {\n  onGenerate: (description: string) => void;\n  panel: PanelModel;\n}\n\nconst DESCRIPTION_GENERATION_STANDARD_PROMPT =\n  'You are an expert in creating Grafana Panels.\\n' +\n  'You will be given the title and description of the dashboard the panel is in as well as the JSON for the panel.\\n' +\n  'Your goal is to write a descriptive and concise panel description.\\n' +\n  'The panel description is meant to explain the purpose of the panel, not just its attributes.\\n' +\n  'Do not refer to the panel; simply describe its purpose.\\n' +\n  'There should be no numbers in the description except for thresholds.\\n' +\n  'The description should be, at most, 140 characters.';\n\nexport const GenAIPanelDescriptionButton = ({ onGenerate, panel }: GenAIPanelDescriptionButtonProps) => {\n  const messages = React.useMemo(() => getMessages(panel), [panel]);\n\n  return (\n    <GenAIButton\n      messages={messages}\n      onGenerate={onGenerate}\n      loadingText={'Generating description'}\n      eventTrackingSrc={EventTrackingSrc.panelDescription}\n      toggleTipTitle={'Improve your panel description'}\n    />\n  );\n};\n\nfunction getMessages(panel: PanelModel): Message[] {\n  const dashboard = getDashboardSrv().getCurrent()!;\n\n  return [\n    {\n      content: DESCRIPTION_GENERATION_STANDARD_PROMPT,\n      role: Role.system,\n    },\n    {\n      content: `The panel is part of a dashboard with the title: ${dashboard.title}`,\n      role: Role.system,\n    },\n    {\n      content: `The panel is part of a dashboard with the description: ${dashboard.title}`,\n      role: Role.system,\n    },\n    {\n      content: `This is the JSON which defines the panel: ${JSON.stringify(panel.getSaveModel())}`,\n      role: Role.user,\n    },\n  ];\n}\n","import React from 'react';\n\nimport { config } from '@grafana/runtime';\nimport { DataLinksInlineEditor, Input, RadioButtonGroup, Select, Switch, TextArea } from '@grafana/ui';\nimport { getPanelLinksVariableSuggestions } from 'app/features/panel/panellinks/link_srv';\n\nimport { GenAIPanelDescriptionButton } from '../GenAI/GenAIPanelDescriptionButton';\nimport { GenAIPanelTitleButton } from '../GenAI/GenAIPanelTitleButton';\nimport { RepeatRowSelect } from '../RepeatRowSelect/RepeatRowSelect';\n\nimport { OptionsPaneCategoryDescriptor } from './OptionsPaneCategoryDescriptor';\nimport { OptionsPaneItemDescriptor } from './OptionsPaneItemDescriptor';\nimport { OptionPaneRenderProps } from './types';\n\nexport function getPanelFrameCategory(props: OptionPaneRenderProps): OptionsPaneCategoryDescriptor {\n  const { panel, onPanelConfigChange } = props;\n  const descriptor = new OptionsPaneCategoryDescriptor({\n    title: 'Panel options',\n    id: 'Panel options',\n    isOpenDefault: true,\n  });\n\n  const setPanelTitle = (title: string) => {\n    const input = document.getElementById('PanelFrameTitle');\n    if (input instanceof HTMLInputElement) {\n      input.value = title;\n      onPanelConfigChange('title', title);\n    }\n  };\n\n  const setPanelDescription = (description: string) => {\n    const input = document.getElementById('description-text-area');\n    if (input instanceof HTMLTextAreaElement) {\n      input.value = description;\n      onPanelConfigChange('description', description);\n    }\n  };\n\n  return descriptor\n    .addItem(\n      new OptionsPaneItemDescriptor({\n        title: 'Title',\n        value: panel.title,\n        popularRank: 1,\n        render: function renderTitle() {\n          return (\n            <Input\n              id=\"PanelFrameTitle\"\n              defaultValue={panel.title}\n              onBlur={(e) => onPanelConfigChange('title', e.currentTarget.value)}\n            />\n          );\n        },\n        addon: config.featureToggles.dashgpt && <GenAIPanelTitleButton onGenerate={setPanelTitle} panel={panel} />,\n      })\n    )\n    .addItem(\n      new OptionsPaneItemDescriptor({\n        title: 'Description',\n        description: panel.description,\n        value: panel.description,\n        render: function renderDescription() {\n          return (\n            <TextArea\n              id=\"description-text-area\"\n              defaultValue={panel.description}\n              onBlur={(e) => onPanelConfigChange('description', e.currentTarget.value)}\n            />\n          );\n        },\n        addon: config.featureToggles.dashgpt && (\n          <GenAIPanelDescriptionButton onGenerate={setPanelDescription} panel={panel} />\n        ),\n      })\n    )\n    .addItem(\n      new OptionsPaneItemDescriptor({\n        title: 'Transparent background',\n        render: function renderTransparent() {\n          return (\n            <Switch\n              value={panel.transparent}\n              id=\"transparent-background\"\n              onChange={(e) => onPanelConfigChange('transparent', e.currentTarget.checked)}\n            />\n          );\n        },\n      })\n    )\n    .addCategory(\n      new OptionsPaneCategoryDescriptor({\n        title: 'Panel links',\n        id: 'Panel links',\n        isOpenDefault: false,\n        itemsCount: panel.links?.length,\n      }).addItem(\n        new OptionsPaneItemDescriptor({\n          title: 'Panel links',\n          render: function renderLinks() {\n            return (\n              <DataLinksInlineEditor\n                links={panel.links}\n                onChange={(links) => onPanelConfigChange('links', links)}\n                getSuggestions={getPanelLinksVariableSuggestions}\n                data={[]}\n              />\n            );\n          },\n        })\n      )\n    )\n    .addCategory(\n      new OptionsPaneCategoryDescriptor({\n        title: 'Repeat options',\n        id: 'Repeat options',\n        isOpenDefault: false,\n      })\n        .addItem(\n          new OptionsPaneItemDescriptor({\n            title: 'Repeat by variable',\n            description:\n              'Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.',\n            render: function renderRepeatOptions() {\n              return (\n                <RepeatRowSelect\n                  id=\"repeat-by-variable-select\"\n                  repeat={panel.repeat}\n                  onChange={(value?: string | null) => {\n                    onPanelConfigChange('repeat', value);\n                  }}\n                />\n              );\n            },\n          })\n        )\n        .addItem(\n          new OptionsPaneItemDescriptor({\n            title: 'Repeat direction',\n            showIf: () => !!panel.repeat,\n            render: function renderRepeatOptions() {\n              const directionOptions = [\n                { label: 'Horizontal', value: 'h' },\n                { label: 'Vertical', value: 'v' },\n              ];\n\n              return (\n                <RadioButtonGroup\n                  options={directionOptions}\n                  value={panel.repeatDirection || 'h'}\n                  onChange={(value) => onPanelConfigChange('repeatDirection', value)}\n                />\n              );\n            },\n          })\n        )\n        .addItem(\n          new OptionsPaneItemDescriptor({\n            title: 'Max per row',\n            showIf: () => Boolean(panel.repeat && panel.repeatDirection === 'h'),\n            render: function renderOption() {\n              const maxPerRowOptions = [2, 3, 4, 6, 8, 12].map((value) => ({ label: value.toString(), value }));\n              return (\n                <Select\n                  options={maxPerRowOptions}\n                  value={panel.maxPerRow}\n                  onChange={(value) => onPanelConfigChange('maxPerRow', value.value)}\n                />\n              );\n            },\n          })\n        )\n    );\n}\n","import { OptionsPaneCategoryDescriptor } from '../OptionsPaneCategoryDescriptor';\nimport { OptionsPaneItemDescriptor } from '../OptionsPaneItemDescriptor';\n\nexport interface OptionSearchResults {\n  optionHits: OptionsPaneItemDescriptor[];\n  overrideHits: OptionsPaneCategoryDescriptor[];\n  totalCount: number;\n}\n\nexport class OptionSearchEngine {\n  constructor(\n    private categories: OptionsPaneCategoryDescriptor[],\n    private overrides: OptionsPaneCategoryDescriptor[]\n  ) {}\n\n  search(query: string): OptionSearchResults {\n    const searchRegex = new RegExp(query, 'i');\n\n    const optionHits = this.collectHits(this.categories, searchRegex, []);\n    const sortedHits = optionHits.sort(compareHit).map((x) => x.item);\n\n    const overrideHits = this.collectHits(this.overrides, searchRegex, []);\n    const sortedOverridesHits = overrideHits.sort(compareHit).map((x) => x.item);\n\n    return {\n      optionHits: sortedHits,\n      overrideHits: this.buildOverrideHitCategories(sortedOverridesHits),\n      totalCount: this.getAllOptionsCount(this.categories),\n    };\n  }\n\n  private collectHits(categories: OptionsPaneCategoryDescriptor[], searchRegex: RegExp, hits: SearchHit[]) {\n    for (const category of categories) {\n      const categoryNameMatch = searchRegex.test(category.props.title);\n\n      for (const item of category.items) {\n        if (searchRegex.test(item.props.title)) {\n          hits.push({ item: item, rank: 1 });\n          continue;\n        }\n        if (item.props.description && searchRegex.test(item.props.description)) {\n          hits.push({ item: item, rank: 2 });\n          continue;\n        }\n        if (categoryNameMatch) {\n          hits.push({ item: item, rank: 3 });\n        }\n      }\n\n      if (category.categories.length > 0) {\n        this.collectHits(category.categories, searchRegex, hits);\n      }\n    }\n\n    return hits;\n  }\n\n  getAllOptionsCount(categories: OptionsPaneCategoryDescriptor[]) {\n    let total = 0;\n\n    for (const category of categories) {\n      total += category.items.length;\n\n      if (category.categories.length > 0) {\n        total += this.getAllOptionsCount(category.categories);\n      }\n    }\n\n    return total;\n  }\n\n  buildOverrideHitCategories(hits: OptionsPaneItemDescriptor[]): OptionsPaneCategoryDescriptor[] {\n    const categories: Record<string, OptionsPaneCategoryDescriptor> = {};\n\n    for (const hit of hits) {\n      let category = categories[hit.parent.props.title];\n\n      if (!category) {\n        category = categories[hit.parent.props.title] = new OptionsPaneCategoryDescriptor(hit.parent.props);\n        // Add matcher item as that should always be shown\n        category.addItem(hit.parent.items[0]);\n      }\n\n      // Prevent adding matcher twice since it's automatically added for every override\n      if (category.items[0].props.title !== hit.props.title) {\n        category.addItem(hit);\n      }\n    }\n\n    return Object.values(categories);\n  }\n}\n\ninterface SearchHit {\n  item: OptionsPaneItemDescriptor;\n  rank: number;\n}\n\nfunction compareHit(left: SearchHit, right: SearchHit) {\n  return left.rank - right.rank;\n}\n","import { OptionsPaneCategoryDescriptor } from '../OptionsPaneCategoryDescriptor';\nimport { OptionsPaneItemDescriptor } from '../OptionsPaneItemDescriptor';\n\nexport function getRecentOptions(allOptions: OptionsPaneCategoryDescriptor[]) {\n  const popularOptions: OptionsPaneItemDescriptor[] = [];\n\n  for (const category of allOptions) {\n    for (const item of category.items) {\n      if (item.props.title === 'Unit') {\n        item.props.popularRank = 2;\n      }\n      if (item.props.title === 'Min') {\n        item.props.popularRank = 3;\n      }\n      if (item.props.title === 'Max') {\n        item.props.popularRank = 4;\n      }\n      if (item.props.title === 'Display name') {\n        item.props.popularRank = 5;\n      }\n\n      if (item.props.popularRank) {\n        popularOptions.push(item);\n      }\n    }\n  }\n\n  return popularOptions.sort((left, right) => left.props.popularRank! - right.props.popularRank!);\n}\n","import { css } from '@emotion/css';\nimport React, { useMemo, useState } from 'react';\n\nimport { GrafanaTheme2, SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { CustomScrollbar, FilterInput, RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport { AngularDeprecationPluginNotice } from 'app/features/plugins/angularDeprecation/AngularDeprecationPluginNotice';\n\nimport { isPanelModelLibraryPanel } from '../../../library-panels/guard';\n\nimport { AngularPanelOptions } from './AngularPanelOptions';\nimport { OptionsPaneCategory } from './OptionsPaneCategory';\nimport { OptionsPaneCategoryDescriptor } from './OptionsPaneCategoryDescriptor';\nimport { getFieldOverrideCategories } from './getFieldOverrideElements';\nimport { getLibraryPanelOptionsCategory } from './getLibraryPanelOptions';\nimport { getPanelFrameCategory } from './getPanelFrameOptions';\nimport { getVisualizationOptions } from './getVisualizationOptions';\nimport { OptionSearchEngine } from './state/OptionSearchEngine';\nimport { getRecentOptions } from './state/getRecentOptions';\nimport { OptionPaneRenderProps } from './types';\n\nexport const OptionsPaneOptions = (props: OptionPaneRenderProps) => {\n  const { plugin, dashboard, panel } = props;\n  const [searchQuery, setSearchQuery] = useState('');\n  const [listMode, setListMode] = useState(OptionFilter.All);\n  const styles = useStyles2(getStyles);\n\n  const [panelFrameOptions, vizOptions, libraryPanelOptions] = useMemo(\n    () => [getPanelFrameCategory(props), getVisualizationOptions(props), getLibraryPanelOptionsCategory(props)],\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [panel.configRev, props.data, props.instanceState, searchQuery]\n  );\n\n  const justOverrides = useMemo(\n    () => getFieldOverrideCategories(props, searchQuery),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [panel.configRev, props.data, props.instanceState, searchQuery]\n  );\n\n  const mainBoxElements: React.ReactNode[] = [];\n  const isSearching = searchQuery.length > 0;\n  const optionRadioFilters = useMemo(getOptionRadioFilters, []);\n\n  const allOptions = isPanelModelLibraryPanel(panel)\n    ? [libraryPanelOptions, panelFrameOptions, ...vizOptions]\n    : [panelFrameOptions, ...vizOptions];\n\n  if (isSearching) {\n    mainBoxElements.push(renderSearchHits(allOptions, justOverrides, searchQuery));\n\n    // If searching for angular panel, then we need to add notice that results are limited\n    if (props.plugin.angularPanelCtrl) {\n      mainBoxElements.push(\n        <div className={styles.searchNotice} key=\"Search notice\">\n          This is an old visualization type that does not support searching all options.\n        </div>\n      );\n    }\n  } else {\n    switch (listMode) {\n      case OptionFilter.All:\n        if (isPanelModelLibraryPanel(panel)) {\n          // Library Panel options first\n          mainBoxElements.push(libraryPanelOptions.render());\n        }\n        // Panel frame options second\n        mainBoxElements.push(panelFrameOptions.render());\n        // If angular add those options next\n        if (props.plugin.angularPanelCtrl) {\n          mainBoxElements.push(\n            <AngularPanelOptions plugin={plugin} dashboard={dashboard} panel={panel} key=\"AngularOptions\" />\n          );\n        }\n        // Then add all panel and field defaults\n        for (const item of vizOptions) {\n          mainBoxElements.push(item.render());\n        }\n\n        for (const item of justOverrides) {\n          mainBoxElements.push(item.render());\n        }\n        break;\n      case OptionFilter.Overrides:\n        for (const override of justOverrides) {\n          mainBoxElements.push(override.render());\n        }\n        break;\n      case OptionFilter.Recent:\n        mainBoxElements.push(\n          <OptionsPaneCategory id=\"Recent options\" title=\"Recent options\" key=\"Recent options\" forceOpen={1}>\n            {getRecentOptions(allOptions).map((item) => item.render())}\n          </OptionsPaneCategory>\n        );\n        break;\n    }\n  }\n\n  // only show radio buttons if we are searching or if the plugin has field config\n  const showSearchRadioButtons = !isSearching && !plugin.fieldConfigRegistry.isEmpty();\n\n  return (\n    <div className={styles.wrapper}>\n      <div className={styles.formBox}>\n        {panel.isAngularPlugin() && (\n          <AngularDeprecationPluginNotice\n            className={styles.angularDeprecationWrapper}\n            showPluginDetailsLink={true}\n            pluginId={plugin.meta.id}\n            pluginType={plugin.meta.type}\n            angularSupportEnabled={config?.angularSupportEnabled}\n            interactionElementId=\"panel-options\"\n          />\n        )}\n        <div className={styles.formRow}>\n          <FilterInput width={0} value={searchQuery} onChange={setSearchQuery} placeholder={'Search options'} />\n        </div>\n        {showSearchRadioButtons && (\n          <div className={styles.formRow}>\n            <RadioButtonGroup options={optionRadioFilters} value={listMode} fullWidth onChange={setListMode} />\n          </div>\n        )}\n      </div>\n      <div className={styles.scrollWrapper}>\n        <CustomScrollbar autoHeightMin=\"100%\">\n          <div className={styles.mainBox}>{mainBoxElements}</div>\n        </CustomScrollbar>\n      </div>\n    </div>\n  );\n};\n\nfunction getOptionRadioFilters(): Array<SelectableValue<OptionFilter>> {\n  return [\n    { label: OptionFilter.All, value: OptionFilter.All },\n    { label: OptionFilter.Overrides, value: OptionFilter.Overrides },\n  ];\n}\n\nexport enum OptionFilter {\n  All = 'All',\n  Overrides = 'Overrides',\n  Recent = 'Recent',\n}\n\nfunction renderSearchHits(\n  allOptions: OptionsPaneCategoryDescriptor[],\n  overrides: OptionsPaneCategoryDescriptor[],\n  searchQuery: string\n) {\n  const engine = new OptionSearchEngine(allOptions, overrides);\n  const { optionHits, totalCount, overrideHits } = engine.search(searchQuery);\n\n  return (\n    <div key=\"search results\">\n      <OptionsPaneCategory\n        id=\"Found options\"\n        title={`Matched ${optionHits.length}/${totalCount} options`}\n        key=\"Normal options\"\n        forceOpen={1}\n      >\n        {optionHits.map((hit) => hit.render(searchQuery))}\n      </OptionsPaneCategory>\n      {overrideHits.map((override) => override.render(searchQuery))}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css`\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    flex: 1 1 0;\n\n    .search-fragment-highlight {\n      color: ${theme.colors.warning.text};\n      background: transparent;\n    }\n  `,\n  searchBox: css`\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n  `,\n  formRow: css`\n    margin-bottom: ${theme.spacing(1)};\n  `,\n  formBox: css`\n    padding: ${theme.spacing(1)};\n    background: ${theme.colors.background.primary};\n    border: 1px solid ${theme.components.panel.borderColor};\n    border-top-left-radius: ${theme.shape.borderRadius(1.5)};\n    border-bottom: none;\n  `,\n  closeButton: css`\n    margin-left: ${theme.spacing(1)};\n  `,\n  searchHits: css`\n    padding: ${theme.spacing(1, 1, 0, 1)};\n  `,\n  scrollWrapper: css`\n    flex-grow: 1;\n    min-height: 0;\n  `,\n  searchNotice: css`\n    font-size: ${theme.typography.size.sm};\n    color: ${theme.colors.text.secondary};\n    padding: ${theme.spacing(1)};\n    text-align: center;\n  `,\n  mainBox: css`\n    background: ${theme.colors.background.primary};\n    border: 1px solid ${theme.components.panel.borderColor};\n    border-top: none;\n    flex-grow: 1;\n  `,\n  angularDeprecationWrapper: css`\n    padding: ${theme.spacing(1)};\n  `,\n});\n","import { PanelPlugin } from '@grafana/data';\nimport { StoreState } from 'app/types';\n\nimport { getPanelPluginNotFound } from '../../panel/components/PanelPluginError';\n\nexport const getPanelPluginWithFallback =\n  (panelType: string) =>\n  (state: StoreState): PanelPlugin => {\n    const plugin = state.plugins.panels[panelType];\n    return plugin || getPanelPluginNotFound(`Panel plugin not found (${panelType})`, true);\n  };\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { selectors } from '@grafana/e2e-selectors';\nimport { ToolbarButton, ButtonGroup } from '@grafana/ui';\nimport { useDispatch, useSelector } from 'app/types';\n\nimport { PanelModel } from '../../state';\nimport { getPanelPluginWithFallback } from '../../state/selectors';\n\nimport { updatePanelEditorUIState } from './state/actions';\nimport { toggleVizPicker } from './state/reducers';\n\ntype Props = {\n  panel: PanelModel;\n};\n\nexport const VisualizationButton = ({ panel }: Props) => {\n  const dispatch = useDispatch();\n  const plugin = useSelector(getPanelPluginWithFallback(panel.type));\n  const isPanelOptionsVisible = useSelector((state) => state.panelEditor.ui.isPanelOptionsVisible);\n  const isVizPickerOpen = useSelector((state) => state.panelEditor.isVizPickerOpen);\n\n  const onToggleOpen = () => {\n    dispatch(toggleVizPicker(!isVizPickerOpen));\n  };\n\n  const onToggleOptionsPane = () => {\n    dispatch(updatePanelEditorUIState({ isPanelOptionsVisible: !isPanelOptionsVisible }));\n  };\n\n  if (!plugin) {\n    return null;\n  }\n\n  return (\n    <div className={styles.wrapper}>\n      <ButtonGroup>\n        <ToolbarButton\n          className={styles.vizButton}\n          tooltip=\"Click to change visualization\"\n          imgSrc={plugin.meta.info.logos.small}\n          isOpen={isVizPickerOpen}\n          onClick={onToggleOpen}\n          data-testid={selectors.components.PanelEditor.toggleVizPicker}\n          aria-label=\"Change Visualization\"\n          variant=\"canvas\"\n          fullWidth\n        >\n          {plugin.meta.name}\n        </ToolbarButton>\n        <ToolbarButton\n          tooltip={isPanelOptionsVisible ? 'Close options pane' : 'Show options pane'}\n          icon={isPanelOptionsVisible ? 'angle-right' : 'angle-left'}\n          onClick={onToggleOptionsPane}\n          variant=\"canvas\"\n          data-testid={selectors.components.PanelEditor.toggleVizOptions}\n          aria-label={isPanelOptionsVisible ? 'Close options pane' : 'Show options pane'}\n        />\n      </ButtonGroup>\n    </div>\n  );\n};\n\nVisualizationButton.displayName = 'VisualizationTab';\n\nconst styles = {\n  wrapper: css`\n    display: flex;\n    flex-direction: column;\n  `,\n  vizButton: css`\n    text-align: left;\n  `,\n};\n","import React from 'react';\n\nimport { ConfirmModal } from '@grafana/ui';\n\nimport { PanelModel } from '../../../dashboard/state';\nimport { isPanelModelLibraryPanel } from '../../guard';\n\nexport interface ChangeLibraryPanelModalProps {\n  panel: PanelModel;\n  onConfirm: () => void;\n  onDismiss: () => void;\n}\n\nexport const ChangeLibraryPanelModal = ({ onConfirm, onDismiss, panel }: ChangeLibraryPanelModalProps): JSX.Element => {\n  const isLibraryPanel = isPanelModelLibraryPanel(panel);\n  const title = `${isLibraryPanel ? 'Changing' : 'Replace with'} library panel`;\n  const body = `${\n    isLibraryPanel ? 'Changing' : 'Replacing with a'\n  } library panel will remove any changes since last save.`;\n  return (\n    <ConfirmModal\n      onConfirm={onConfirm}\n      onDismiss={onDismiss}\n      confirmText={isLibraryPanel ? 'Change' : 'Replace'}\n      title={title}\n      body={body}\n      dismissText=\"Cancel\"\n      isOpen={true}\n    />\n  );\n};\n","import { css } from '@emotion/css';\nimport React, { useCallback, useState } from 'react';\n\nimport { PanelPluginMeta } from '@grafana/data';\nimport { Button, VerticalGroup } from '@grafana/ui';\nimport { getDashboardSrv } from 'app/features/dashboard/services/DashboardSrv';\nimport { PanelModel } from 'app/features/dashboard/state';\nimport { changeToLibraryPanel } from 'app/features/panel/state/actions';\nimport { useDispatch } from 'app/types';\n\nimport { PanelTypeFilter } from '../../../../core/components/PanelTypeFilter/PanelTypeFilter';\nimport { LibraryElementDTO } from '../../types';\nimport { AddLibraryPanelModal } from '../AddLibraryPanelModal/AddLibraryPanelModal';\nimport { ChangeLibraryPanelModal } from '../ChangeLibraryPanelModal/ChangeLibraryPanelModal';\nimport { LibraryPanelsView } from '../LibraryPanelsView/LibraryPanelsView';\n\ninterface Props {\n  panel: PanelModel;\n  searchQuery: string;\n  isWidget?: boolean;\n}\n\nexport const PanelLibraryOptionsGroup = ({ panel, searchQuery, isWidget = false }: Props) => {\n  const [showingAddPanelModal, setShowingAddPanelModal] = useState(false);\n  const [changeToPanel, setChangeToPanel] = useState<LibraryElementDTO | undefined>(undefined);\n  const [panelFilter, setPanelFilter] = useState<string[]>([]);\n  const onPanelFilterChange = useCallback(\n    (plugins: PanelPluginMeta[]) => {\n      setPanelFilter(plugins.map((p) => p.id));\n    },\n    [setPanelFilter]\n  );\n  const dashboard = getDashboardSrv().getCurrent();\n  const dispatch = useDispatch();\n\n  const useLibraryPanel = async () => {\n    if (!changeToPanel) {\n      return;\n    }\n\n    setChangeToPanel(undefined);\n    dispatch(changeToLibraryPanel(panel, changeToPanel));\n  };\n\n  const onAddToPanelLibrary = () => setShowingAddPanelModal(true);\n  const onDismissChangeToPanel = () => setChangeToPanel(undefined);\n  return (\n    <VerticalGroup spacing=\"md\">\n      {!panel.libraryPanel && (\n        <VerticalGroup align=\"center\">\n          <Button icon=\"plus\" onClick={onAddToPanelLibrary} variant=\"secondary\" fullWidth>\n            Create new library panel\n          </Button>\n        </VerticalGroup>\n      )}\n\n      <PanelTypeFilter onChange={onPanelFilterChange} isWidget={isWidget} />\n\n      <div className={styles.libraryPanelsView}>\n        <LibraryPanelsView\n          currentPanelId={panel.libraryPanel?.uid}\n          searchString={searchQuery}\n          panelFilter={panelFilter}\n          onClickCard={setChangeToPanel}\n          showSecondaryActions\n          isWidget={isWidget}\n        />\n      </div>\n\n      {showingAddPanelModal && (\n        <AddLibraryPanelModal\n          panel={panel}\n          onDismiss={() => setShowingAddPanelModal(false)}\n          initialFolderUid={dashboard?.meta.folderUid}\n          isOpen={showingAddPanelModal}\n        />\n      )}\n\n      {changeToPanel && (\n        <ChangeLibraryPanelModal panel={panel} onDismiss={onDismissChangeToPanel} onConfirm={useLibraryPanel} />\n      )}\n    </VerticalGroup>\n  );\n};\n\nconst styles = {\n  libraryPanelsView: css`\n    width: 100%;\n  `,\n};\n","import {\n  PanelData,\n  VisualizationSuggestion,\n  VisualizationSuggestionsBuilder,\n  PanelModel,\n  VisualizationSuggestionScore,\n} from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { importPanelPlugin } from 'app/features/plugins/importPanelPlugin';\n\nexport const panelsToCheckFirst = [\n  'timeseries',\n  'barchart',\n  'gauge',\n  'stat',\n  'piechart',\n  'bargauge',\n  'table',\n  'state-timeline',\n  'status-history',\n  'logs',\n  'candlestick',\n  'flamegraph',\n];\n\nexport async function getAllSuggestions(data?: PanelData, panel?: PanelModel): Promise<VisualizationSuggestion[]> {\n  const builder = new VisualizationSuggestionsBuilder(data, panel);\n\n  for (const pluginId of panelsToCheckFirst) {\n    const plugin = await importPanelPlugin(pluginId);\n    const supplier = plugin.getSuggestionsSupplier();\n\n    if (supplier) {\n      supplier.getSuggestionsForData(builder);\n    }\n  }\n\n  const list = builder.getList();\n\n  if (!config.featureToggles.vizAndWidgetSplit && builder.dataSummary.fieldCount === 0) {\n    for (const plugin of Object.values(config.panels)) {\n      if (!plugin.skipDataQuery || plugin.hideFromList) {\n        continue;\n      }\n\n      list.push({\n        name: plugin.name,\n        pluginId: plugin.id,\n        description: plugin.info.description,\n        cardOptions: {\n          imgSrc: plugin.info.logos.small,\n        },\n      });\n    }\n  }\n\n  return list.sort((a, b) => {\n    if (builder.dataSummary.preferredVisualisationType) {\n      if (a.pluginId === builder.dataSummary.preferredVisualisationType) {\n        return -1;\n      }\n      if (b.pluginId === builder.dataSummary.preferredVisualisationType) {\n        return 1;\n      }\n    }\n    return (b.score ?? VisualizationSuggestionScore.OK) - (a.score ?? VisualizationSuggestionScore.OK);\n  });\n}\n","import { css, cx } from '@emotion/css';\nimport { cloneDeep } from 'lodash';\nimport React, { CSSProperties } from 'react';\n\nimport { GrafanaTheme2, PanelData, VisualizationSuggestion } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Tooltip, useStyles2 } from '@grafana/ui';\n\nimport { PanelRenderer } from '../PanelRenderer';\n\nimport { VizTypeChangeDetails } from './types';\n\nexport interface Props {\n  data: PanelData;\n  width: number;\n  suggestion: VisualizationSuggestion;\n  onChange: (details: VizTypeChangeDetails) => void;\n}\n\nexport function VisualizationSuggestionCard({ data, suggestion, onChange, width }: Props) {\n  const styles = useStyles2(getStyles);\n  const { innerStyles, outerStyles, renderWidth, renderHeight } = getPreviewDimensionsAndStyles(width);\n  const cardOptions = suggestion.cardOptions ?? {};\n\n  const commonButtonProps = {\n    'aria-label': suggestion.name,\n    className: styles.vizBox,\n    'data-testid': selectors.components.VisualizationPreview.card(suggestion.name),\n    style: outerStyles,\n    onClick: () => {\n      onChange({\n        pluginId: suggestion.pluginId,\n        options: suggestion.options,\n        fieldConfig: suggestion.fieldConfig,\n      });\n    },\n  };\n\n  if (cardOptions.imgSrc) {\n    return (\n      <Tooltip content={suggestion.description ?? suggestion.name}>\n        <button {...commonButtonProps} className={cx(styles.vizBox, styles.imgBox)}>\n          <div className={styles.name}>{suggestion.name}</div>\n          <img className={styles.img} src={cardOptions.imgSrc} alt={suggestion.name} />\n        </button>\n      </Tooltip>\n    );\n  }\n\n  let preview = suggestion;\n  if (suggestion.cardOptions?.previewModifier) {\n    preview = cloneDeep(suggestion);\n    suggestion.cardOptions.previewModifier(preview);\n  }\n\n  return (\n    <button {...commonButtonProps}>\n      <Tooltip content={suggestion.name}>\n        <div style={innerStyles} className={styles.renderContainer}>\n          <PanelRenderer\n            title=\"\"\n            data={data}\n            pluginId={suggestion.pluginId}\n            width={renderWidth}\n            height={renderHeight}\n            options={preview.options}\n            fieldConfig={preview.fieldConfig}\n          />\n          <div className={styles.hoverPane} />\n        </div>\n      </Tooltip>\n    </button>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    hoverPane: css({\n      position: 'absolute',\n      top: 0,\n      right: 0,\n      left: 0,\n      borderRadius: theme.spacing(2),\n      bottom: 0,\n    }),\n    vizBox: css`\n      position: relative;\n      background: none;\n      border-radius: ${theme.shape.radius.default};\n      cursor: pointer;\n      border: 1px solid ${theme.colors.border.medium};\n\n      transition: ${theme.transitions.create(['background'], {\n        duration: theme.transitions.duration.short,\n      })};\n\n      &:hover {\n        background: ${theme.colors.background.secondary};\n      }\n    `,\n    imgBox: css`\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      justify-self: center;\n      color: ${theme.colors.text.primary};\n      width: 100%;\n      display: flex;\n\n      justify-content: center;\n      align-items: center;\n      text-align: center;\n    `,\n    name: css`\n      padding-bottom: ${theme.spacing(0.5)};\n      margin-top: ${theme.spacing(-1)};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      white-space: nowrap;\n      overflow: hidden;\n      color: ${theme.colors.text.secondary};\n      font-weight: ${theme.typography.fontWeightMedium};\n      text-overflow: ellipsis;\n    `,\n    img: css`\n      max-width: ${theme.spacing(8)};\n      max-height: ${theme.spacing(8)};\n    `,\n    renderContainer: css`\n      position: absolute;\n      transform-origin: left top;\n      top: 6px;\n      left: 6px;\n    `,\n  };\n};\n\ninterface PreviewDimensionsAndStyles {\n  renderWidth: number;\n  renderHeight: number;\n  innerStyles: CSSProperties;\n  outerStyles: CSSProperties;\n}\n\nfunction getPreviewDimensionsAndStyles(width: number): PreviewDimensionsAndStyles {\n  const aspectRatio = 16 / 10;\n  const showWidth = width;\n  const showHeight = width * (1 / aspectRatio);\n  const renderWidth = 350;\n  const renderHeight = renderWidth * (1 / aspectRatio);\n\n  const padding = 6;\n  const widthFactor = (showWidth - padding * 2) / renderWidth;\n  const heightFactor = (showHeight - padding * 2) / renderHeight;\n\n  return {\n    renderHeight,\n    renderWidth,\n    outerStyles: { width: showWidth, height: showHeight },\n    innerStyles: {\n      width: renderWidth,\n      height: renderHeight,\n      transform: `scale(${widthFactor}, ${heightFactor})`,\n    },\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\nimport { useAsync } from 'react-use';\nimport AutoSizer from 'react-virtualized-auto-sizer';\n\nimport { GrafanaTheme2, PanelData, PanelPluginMeta, PanelModel, VisualizationSuggestion } from '@grafana/data';\nimport { useStyles2 } from '@grafana/ui';\n\nimport { getAllSuggestions } from '../../state/getAllSuggestions';\n\nimport { VisualizationSuggestionCard } from './VisualizationSuggestionCard';\nimport { VizTypeChangeDetails } from './types';\n\nexport interface Props {\n  current: PanelPluginMeta;\n  data?: PanelData;\n  panel?: PanelModel;\n  onChange: (options: VizTypeChangeDetails) => void;\n  searchQuery: string;\n  onClose: () => void;\n}\n\nexport function VisualizationSuggestions({ onChange, data, panel, searchQuery }: Props) {\n  const styles = useStyles2(getStyles);\n  const { value: suggestions } = useAsync(() => getAllSuggestions(data, panel), [data, panel]);\n  const filteredSuggestions = filterSuggestionsBySearch(searchQuery, suggestions);\n\n  return (\n    <AutoSizer disableHeight style={{ width: '100%', height: '100%' }}>\n      {({ width }) => {\n        if (!width) {\n          return null;\n        }\n\n        const columnCount = Math.floor(width / 170);\n        const spaceBetween = 8 * (columnCount! - 1);\n        const previewWidth = (width - spaceBetween) / columnCount!;\n\n        return (\n          <div>\n            <div className={styles.filterRow}>\n              <div className={styles.infoText}>Based on current data</div>\n            </div>\n            <div className={styles.grid} style={{ gridTemplateColumns: `repeat(auto-fill, ${previewWidth - 1}px)` }}>\n              {filteredSuggestions.map((suggestion, index) => (\n                <VisualizationSuggestionCard\n                  key={index}\n                  data={data!}\n                  suggestion={suggestion}\n                  onChange={onChange}\n                  width={previewWidth}\n                />\n              ))}\n              {searchQuery && filteredSuggestions.length === 0 && (\n                <div className={styles.infoText}>No results matched your query</div>\n              )}\n            </div>\n          </div>\n        );\n      }}\n    </AutoSizer>\n  );\n}\n\nfunction filterSuggestionsBySearch(\n  searchQuery: string,\n  suggestions?: VisualizationSuggestion[]\n): VisualizationSuggestion[] {\n  if (!searchQuery || !suggestions) {\n    return suggestions || [];\n  }\n\n  const regex = new RegExp(searchQuery, 'i');\n\n  return suggestions.filter((s) => regex.test(s.name) || regex.test(s.pluginId));\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    heading: css({\n      ...theme.typography.h5,\n      margin: theme.spacing(0, 0.5, 1),\n    }),\n    filterRow: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'space-around',\n      alignItems: 'center',\n      paddingBottom: '8px',\n    }),\n    infoText: css({\n      fontSize: theme.typography.bodySmall.fontSize,\n      color: theme.colors.text.secondary,\n      fontStyle: 'italic',\n    }),\n    grid: css({\n      display: 'grid',\n      gridGap: theme.spacing(1),\n      gridTemplateColumns: 'repeat(auto-fill, 144px)',\n      marginBottom: theme.spacing(1),\n      justifyContent: 'space-evenly',\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useMemo } from 'react';\n\nimport { GrafanaTheme2, PanelData, PanelPluginMeta } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { EmptySearchResult, useStyles2 } from '@grafana/ui';\n\nimport { filterPluginList, getAllPanelPluginMeta, getVizPluginMeta, getWidgetPluginMeta } from '../../state/util';\n\nimport { VizTypePickerPlugin } from './VizTypePickerPlugin';\nimport { VizTypeChangeDetails } from './types';\n\nexport interface Props {\n  current: PanelPluginMeta;\n  data?: PanelData;\n  onChange: (options: VizTypeChangeDetails) => void;\n  searchQuery: string;\n  onClose: () => void;\n  isWidget?: boolean;\n}\n\nexport function VizTypePicker({ searchQuery, onChange, current, data, isWidget = false }: Props) {\n  const styles = useStyles2(getStyles);\n  const pluginsList: PanelPluginMeta[] = useMemo(() => {\n    if (config.featureToggles.vizAndWidgetSplit) {\n      if (isWidget) {\n        return getWidgetPluginMeta();\n      }\n      return getVizPluginMeta();\n    }\n    return getAllPanelPluginMeta();\n  }, [isWidget]);\n\n  const filteredPluginTypes = useMemo((): PanelPluginMeta[] => {\n    return filterPluginList(pluginsList, searchQuery, current);\n  }, [current, pluginsList, searchQuery]);\n\n  if (filteredPluginTypes.length === 0) {\n    return <EmptySearchResult>Could not find anything matching your query</EmptySearchResult>;\n  }\n\n  return (\n    <div className={styles.grid}>\n      {filteredPluginTypes.map((plugin, index) => (\n        <VizTypePickerPlugin\n          disabled={false}\n          key={plugin.id}\n          isCurrent={plugin.id === current.id}\n          plugin={plugin}\n          onClick={(e) =>\n            onChange({\n              pluginId: plugin.id,\n              withModKey: Boolean(e.metaKey || e.ctrlKey || e.altKey),\n            })\n          }\n        />\n      ))}\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    grid: css`\n      max-width: 100%;\n      display: grid;\n      grid-gap: ${theme.spacing(0.5)};\n    `,\n    heading: css({\n      ...theme.typography.h5,\n      margin: theme.spacing(0, 0.5, 1),\n    }),\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useCallback, useRef, useState } from 'react';\nimport { useLocalStorage } from 'react-use';\n\nimport { GrafanaTheme2, PanelData, SelectableValue } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { config } from '@grafana/runtime';\nimport { Button, CustomScrollbar, FilterInput, RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport { Field } from '@grafana/ui/src/components/Forms/Field';\nimport { LS_VISUALIZATION_SELECT_TAB_KEY, LS_WIDGET_SELECT_TAB_KEY } from 'app/core/constants';\nimport { PanelLibraryOptionsGroup } from 'app/features/library-panels/components/PanelLibraryOptionsGroup/PanelLibraryOptionsGroup';\nimport { VisualizationSuggestions } from 'app/features/panel/components/VizTypePicker/VisualizationSuggestions';\nimport { VizTypeChangeDetails } from 'app/features/panel/components/VizTypePicker/types';\nimport { useDispatch, useSelector } from 'app/types';\n\nimport { VizTypePicker } from '../../../panel/components/VizTypePicker/VizTypePicker';\nimport { changePanelPlugin } from '../../../panel/state/actions';\nimport { PanelModel } from '../../state/PanelModel';\nimport { getPanelPluginWithFallback } from '../../state/selectors';\n\nimport { toggleVizPicker } from './state/reducers';\nimport { VisualizationSelectPaneTab } from './types';\n\ninterface Props {\n  panel: PanelModel;\n  data?: PanelData;\n}\n\nexport const VisualizationSelectPane = ({ panel, data }: Props) => {\n  const plugin = useSelector(getPanelPluginWithFallback(panel.type));\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Add support to show widgets in the visualization picker\n  const isWidget = !!plugin.meta.skipDataQuery;\n  const isWidgetEnabled = Boolean(isWidget && config.featureToggles.vizAndWidgetSplit);\n\n  const tabKey = isWidgetEnabled ? LS_WIDGET_SELECT_TAB_KEY : LS_VISUALIZATION_SELECT_TAB_KEY;\n  const defaultTab = isWidgetEnabled ? VisualizationSelectPaneTab.Widgets : VisualizationSelectPaneTab.Visualizations;\n\n  const [listMode, setListMode] = useLocalStorage(tabKey, defaultTab);\n\n  const dispatch = useDispatch();\n  const styles = useStyles2(getStyles);\n  const searchRef = useRef<HTMLInputElement | null>(null);\n\n  const onVizChange = useCallback(\n    (pluginChange: VizTypeChangeDetails) => {\n      dispatch(changePanelPlugin({ panel: panel, ...pluginChange }));\n\n      // close viz picker unless a mod key is pressed while clicking\n      if (!pluginChange.withModKey) {\n        dispatch(toggleVizPicker(false));\n      }\n    },\n    [dispatch, panel]\n  );\n\n  const onCloseVizPicker = () => {\n    dispatch(toggleVizPicker(false));\n  };\n\n  if (!plugin) {\n    return null;\n  }\n\n  const radioOptions: Array<SelectableValue<VisualizationSelectPaneTab>> = [\n    { label: 'Visualizations', value: VisualizationSelectPaneTab.Visualizations },\n    { label: 'Suggestions', value: VisualizationSelectPaneTab.Suggestions },\n    {\n      label: 'Library panels',\n      value: VisualizationSelectPaneTab.LibraryPanels,\n      description: 'Reusable panels you can share between multiple dashboards.',\n    },\n  ];\n\n  const radioOptionsWidgetFlow: Array<SelectableValue<VisualizationSelectPaneTab>> = [\n    { label: 'Widgets', value: VisualizationSelectPaneTab.Widgets },\n    {\n      label: 'Library panels',\n      value: VisualizationSelectPaneTab.LibraryPanels,\n      description: 'Reusable panels you can share between multiple dashboards.',\n    },\n  ];\n\n  return (\n    <div className={styles.openWrapper}>\n      <div className={styles.formBox}>\n        <div className={styles.searchRow}>\n          <FilterInput\n            value={searchQuery}\n            onChange={setSearchQuery}\n            ref={searchRef}\n            autoFocus={true}\n            placeholder=\"Search for...\"\n          />\n          <Button\n            title=\"Close\"\n            variant=\"secondary\"\n            icon=\"angle-up\"\n            className={styles.closeButton}\n            aria-label={selectors.components.PanelEditor.toggleVizPicker}\n            onClick={onCloseVizPicker}\n          />\n        </div>\n        <Field className={styles.customFieldMargin}>\n          <RadioButtonGroup\n            options={isWidgetEnabled ? radioOptionsWidgetFlow : radioOptions}\n            value={listMode}\n            onChange={setListMode}\n            fullWidth\n          />\n        </Field>\n      </div>\n      <div className={styles.scrollWrapper}>\n        <CustomScrollbar autoHeightMin=\"100%\">\n          <div className={styles.scrollContent}>\n            {listMode === VisualizationSelectPaneTab.Visualizations && (\n              <VizTypePicker\n                current={plugin.meta}\n                onChange={onVizChange}\n                searchQuery={searchQuery}\n                data={data}\n                onClose={() => {}}\n              />\n            )}\n            {listMode === VisualizationSelectPaneTab.Widgets && (\n              <VizTypePicker\n                current={plugin.meta}\n                onChange={onVizChange}\n                searchQuery={searchQuery}\n                data={data}\n                onClose={() => {}}\n                isWidget\n              />\n            )}\n\n            {listMode === VisualizationSelectPaneTab.Suggestions && (\n              <VisualizationSuggestions\n                current={plugin.meta}\n                onChange={onVizChange}\n                searchQuery={searchQuery}\n                panel={panel}\n                data={data}\n                onClose={() => {}}\n              />\n            )}\n            {listMode === VisualizationSelectPaneTab.LibraryPanels && (\n              <PanelLibraryOptionsGroup\n                searchQuery={searchQuery}\n                panel={panel}\n                key=\"Panel Library\"\n                isWidget={isWidget}\n              />\n            )}\n          </div>\n        </CustomScrollbar>\n      </div>\n    </div>\n  );\n};\n\nVisualizationSelectPane.displayName = 'VisualizationSelectPane';\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    icon: css`\n      color: ${theme.v1.palette.gray33};\n    `,\n    wrapper: css`\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 0;\n      height: 100%;\n    `,\n    vizButton: css`\n      text-align: left;\n    `,\n    scrollWrapper: css`\n      flex-grow: 1;\n      min-height: 0;\n    `,\n    scrollContent: css`\n      padding: ${theme.spacing(1)};\n    `,\n    openWrapper: css`\n      display: flex;\n      flex-direction: column;\n      flex: 1 1 100%;\n      height: 100%;\n      background: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.weak};\n    `,\n    searchRow: css`\n      display: flex;\n      margin-bottom: ${theme.spacing(1)};\n    `,\n    closeButton: css`\n      margin-left: ${theme.spacing(1)};\n    `,\n    customFieldMargin: css`\n      margin-bottom: ${theme.spacing(1)};\n    `,\n    formBox: css`\n      padding: ${theme.spacing(1)};\n      padding-bottom: 0;\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { useStyles2 } from '@grafana/ui';\nimport { useSelector } from 'app/types';\n\nimport { OptionsPaneOptions } from './OptionsPaneOptions';\nimport { VisualizationButton } from './VisualizationButton';\nimport { VisualizationSelectPane } from './VisualizationSelectPane';\nimport { OptionPaneRenderProps } from './types';\nimport { usePanelLatestData } from './usePanelLatestData';\n\nexport const OptionsPane = ({\n  plugin,\n  panel,\n  onFieldConfigsChange,\n  onPanelOptionsChanged,\n  onPanelConfigChange,\n  dashboard,\n  instanceState,\n}: OptionPaneRenderProps) => {\n  const styles = useStyles2(getStyles);\n  const isVizPickerOpen = useSelector((state) => state.panelEditor.isVizPickerOpen);\n  const { data } = usePanelLatestData(panel, { withTransforms: true, withFieldConfig: false }, true);\n\n  return (\n    <div className={styles.wrapper} aria-label={selectors.components.PanelEditor.OptionsPane.content}>\n      {!isVizPickerOpen && (\n        <>\n          <div className={styles.vizButtonWrapper}>\n            <VisualizationButton panel={panel} />\n          </div>\n          <div className={styles.optionsWrapper}>\n            <OptionsPaneOptions\n              panel={panel}\n              dashboard={dashboard}\n              plugin={plugin}\n              instanceState={instanceState}\n              data={data}\n              onFieldConfigsChange={onFieldConfigsChange}\n              onPanelOptionsChanged={onPanelOptionsChanged}\n              onPanelConfigChange={onPanelConfigChange}\n            />\n          </div>\n        </>\n      )}\n      {isVizPickerOpen && <VisualizationSelectPane panel={panel} data={data} />}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      height: 100%;\n      width: 100%;\n      display: flex;\n      flex: 1 1 0;\n      flex-direction: column;\n      padding: 0;\n    `,\n    optionsWrapper: css`\n      flex-grow: 1;\n      min-height: 0;\n    `,\n    vizButtonWrapper: css`\n      padding: 0 ${theme.spacing(2, 2)} 0;\n    `,\n    legacyOptions: css`\n      label: legacy-options;\n      .panel-options-grid {\n        display: flex;\n        flex-direction: column;\n      }\n      .panel-options-group {\n        margin-bottom: 0;\n      }\n      .panel-options-group__body {\n        padding: ${theme.spacing(2)} 0;\n      }\n\n      .section {\n        display: block;\n        margin: ${theme.spacing(2)} 0;\n\n        &:first-child {\n          margin-top: 0;\n        }\n      }\n    `,\n  };\n};\n","import React, { Component } from 'react';\n\nimport { renderMarkdown, LinkModelSupplier, ScopedVars } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { locationService, getTemplateSrv } from '@grafana/runtime';\nimport { Tooltip, PopoverContent } from '@grafana/ui';\nimport { getTimeSrv, TimeSrv } from 'app/features/dashboard/services/TimeSrv';\nimport { PanelModel } from 'app/features/dashboard/state/PanelModel';\nimport { InspectTab } from 'app/features/inspector/types';\n\nenum InfoMode {\n  Error = 'Error',\n  Info = 'Info',\n  Links = 'Links',\n}\n\nexport interface Props {\n  panel: PanelModel;\n  title?: string;\n  description?: string;\n  scopedVars?: ScopedVars;\n  links?: LinkModelSupplier<PanelModel>;\n  error?: string;\n}\n\nexport class PanelHeaderCorner extends Component<Props> {\n  timeSrv: TimeSrv = getTimeSrv();\n\n  getInfoMode = () => {\n    const { panel, error } = this.props;\n    if (error) {\n      return InfoMode.Error;\n    }\n    if (!!panel.description) {\n      return InfoMode.Info;\n    }\n    if (panel.links && panel.links.length) {\n      return InfoMode.Links;\n    }\n\n    return undefined;\n  };\n\n  getInfoContent = (): JSX.Element => {\n    const { panel } = this.props;\n    const markdown = panel.description || '';\n    const interpolatedMarkdown = getTemplateSrv().replace(markdown, panel.scopedVars);\n    const markedInterpolatedMarkdown = renderMarkdown(interpolatedMarkdown);\n    const links = this.props.links && this.props.links.getLinks(panel.replaceVariables);\n\n    return (\n      <div className=\"panel-info-content markdown-html\">\n        <div dangerouslySetInnerHTML={{ __html: markedInterpolatedMarkdown }} />\n\n        {links && links.length > 0 && (\n          <ul className=\"panel-info-corner-links\">\n            {links.map((link, idx) => {\n              return (\n                <li key={idx}>\n                  <a className=\"panel-info-corner-links__item\" href={link.href} target={link.target}>\n                    {link.title}\n                  </a>\n                </li>\n              );\n            })}\n          </ul>\n        )}\n      </div>\n    );\n  };\n\n  /**\n   * Open the Panel Inspector when we click on an error\n   */\n  onClickError = () => {\n    locationService.partial({\n      inspect: this.props.panel.id,\n      inspectTab: InspectTab.Error,\n    });\n  };\n\n  renderCornerType(infoMode: InfoMode, content: PopoverContent, onClick?: () => void) {\n    const theme = infoMode === InfoMode.Error ? 'error' : 'info';\n    const className = `panel-info-corner panel-info-corner--${infoMode.toLowerCase()}`;\n    const ariaLabel = selectors.components.Panels.Panel.headerCornerInfo(infoMode.toLowerCase());\n\n    return (\n      <Tooltip content={content} placement=\"top-start\" theme={theme} interactive>\n        <button type=\"button\" className={className} onClick={onClick} aria-label={ariaLabel}>\n          <i aria-hidden className=\"fa\" />\n          <span className=\"panel-info-corner-inner\" />\n        </button>\n      </Tooltip>\n    );\n  }\n\n  render() {\n    const { error } = this.props;\n    const infoMode: InfoMode | undefined = this.getInfoMode();\n\n    if (!infoMode) {\n      return null;\n    }\n\n    if (infoMode === InfoMode.Error && error) {\n      return this.renderCornerType(infoMode, error, this.onClickError);\n    }\n\n    if (infoMode === InfoMode.Info || infoMode === InfoMode.Links) {\n      return this.renderCornerType(infoMode, this.getInfoContent);\n    }\n\n    return null;\n  }\n}\n\nexport default PanelHeaderCorner;\n","import React, { useEffect, useState } from 'react';\n\nimport { RefreshEvent } from '@grafana/runtime';\nimport { PanelChrome } from '@grafana/ui';\nimport { applyPanelTimeOverrides } from 'app/features/dashboard/utils/panel';\nimport { PanelRenderer } from 'app/features/panel/components/PanelRenderer';\nimport { Options } from 'app/plugins/panel/table/panelcfg.gen';\n\nimport { getTimeSrv } from '../../services/TimeSrv';\nimport { DashboardModel, PanelModel } from '../../state';\n\nimport PanelHeaderCorner from './PanelHeaderCorner';\nimport { usePanelLatestData } from './usePanelLatestData';\n\nexport interface Props {\n  width: number;\n  height: number;\n  panel: PanelModel;\n  dashboard: DashboardModel;\n}\n\nexport function PanelEditorTableView({ width, height, panel, dashboard }: Props) {\n  const { data } = usePanelLatestData(panel, { withTransforms: true, withFieldConfig: false }, false);\n  const [options, setOptions] = useState<Options>({\n    frameIndex: 0,\n    showHeader: true,\n    showTypeIcons: true,\n  });\n\n  // Subscribe to panel event\n  useEffect(() => {\n    const timeSrv = getTimeSrv();\n\n    const sub = panel.events.subscribe(RefreshEvent, () => {\n      const timeData = applyPanelTimeOverrides(panel, timeSrv.timeRange());\n      panel.runAllPanelQueries({\n        dashboardUID: dashboard.uid,\n        dashboardTimezone: dashboard.getTimezone(),\n        timeData,\n        width,\n      });\n    });\n    return () => {\n      sub.unsubscribe();\n    };\n  }, [panel, dashboard, width]);\n\n  if (!data) {\n    return null;\n  }\n\n  const errorMessage = data?.errors\n    ? data.errors.length > 1\n      ? 'Multiple errors found. Click for more details'\n      : data.errors[0].message\n    : data?.error?.message;\n  return (\n    <PanelChrome width={width} height={height} padding=\"none\">\n      {(innerWidth, innerHeight) => (\n        <>\n          <PanelHeaderCorner panel={panel} error={errorMessage} />\n          <PanelRenderer\n            title=\"Raw data\"\n            pluginId=\"table\"\n            width={innerWidth}\n            height={innerHeight}\n            data={data}\n            options={options}\n            onOptionsChange={setOptions}\n          />\n        </>\n      )}\n    </PanelChrome>\n  );\n}\n","import React, { useCallback } from 'react';\n\nimport { locationService } from '@grafana/runtime';\nimport { Button, VerticalGroup } from '@grafana/ui';\nimport { Layout } from '@grafana/ui/src/components/Layout/Layout';\n\nimport { PanelEditorTabId } from './types';\n\nexport interface Props {\n  message: string;\n}\n\nexport function PanelNotSupported({ message }: Props): JSX.Element {\n  const onBackToQueries = useCallback(() => {\n    locationService.partial({ tab: PanelEditorTabId.Query });\n  }, []);\n\n  return (\n    <Layout justify=\"center\" style={{ marginTop: '100px' }}>\n      <VerticalGroup spacing=\"md\">\n        <h2>{message}</h2>\n        <div>\n          <Button size=\"md\" variant=\"secondary\" icon=\"arrow-left\" onClick={onBackToQueries}>\n            Go back to Queries\n          </Button>\n        </div>\n      </VerticalGroup>\n    </Layout>\n  );\n}\n","import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Icon, ConfirmButton, Button } from '@grafana/ui';\n\nimport { DashboardModel } from '../dashboard/state/DashboardModel';\n\nimport alertDef from './state/alertDef';\n\ninterface Props {\n  dashboard: DashboardModel;\n  panelId: number;\n  onRefresh: () => void;\n}\n\ninterface State {\n  stateHistoryItems: any[];\n}\n\nclass StateHistory extends PureComponent<Props, State> {\n  state: State = {\n    stateHistoryItems: [],\n  };\n\n  componentDidMount(): void {\n    const { dashboard, panelId } = this.props;\n\n    getBackendSrv()\n      .get(\n        `/api/annotations?dashboardId=${dashboard.id}&panelId=${panelId}&limit=50&type=alert`,\n        {},\n        `state-history-${dashboard.id}-${panelId}`\n      )\n      .then((data) => {\n        const items = data.map((item: any) => {\n          return {\n            stateModel: alertDef.getStateDisplayModel(item.newState),\n            time: dashboard.formatDate(item.time, 'MMM D, YYYY HH:mm:ss'),\n            info: alertDef.getAlertAnnotationInfo(item),\n          };\n        });\n\n        this.setState({\n          stateHistoryItems: items,\n        });\n      });\n  }\n\n  clearHistory = async () => {\n    const { dashboard, panelId, onRefresh } = this.props;\n\n    await getBackendSrv().post('/api/annotations/mass-delete', {\n      dashboardId: dashboard.id,\n      panelId: panelId,\n    });\n\n    this.setState({ stateHistoryItems: [] });\n    onRefresh();\n  };\n\n  render() {\n    const { stateHistoryItems } = this.state;\n\n    return (\n      <div>\n        {stateHistoryItems.length > 0 && (\n          <div className=\"p-b-1\">\n            <span className=\"muted\">Last 50 state changes</span>\n            <ConfirmButton onConfirm={this.clearHistory} confirmVariant=\"destructive\" confirmText=\"Clear\">\n              <Button\n                className={css`\n                  direction: ltr;\n                `}\n                variant=\"destructive\"\n                icon=\"trash-alt\"\n              >\n                Clear history\n              </Button>\n            </ConfirmButton>\n          </div>\n        )}\n        <ol className=\"alert-rule-list\">\n          {stateHistoryItems.length > 0 ? (\n            stateHistoryItems.map((item, index) => {\n              return (\n                <li className=\"alert-rule-item\" key={`${item.time}-${index}`}>\n                  <div className={`alert-rule-item__icon ${item.stateModel.stateClass}`}>\n                    <Icon name={item.stateModel.iconClass} size=\"xl\" />\n                  </div>\n                  <div className=\"alert-rule-item__body\">\n                    <div className=\"alert-rule-item__header\">\n                      <p className=\"alert-rule-item__name\">{item.alertName}</p>\n                      <div className=\"alert-rule-item__text\">\n                        <span className={`${item.stateModel.stateClass}`}>{item.stateModel.text}</span>\n                      </div>\n                    </div>\n                    {item.info}\n                  </div>\n                  <div className=\"alert-rule-item__time\">{item.time}</div>\n                </li>\n              );\n            })\n          ) : (\n            <i>No state changes recorded</i>\n          )}\n        </ol>\n      </div>\n    );\n  }\n}\n\nexport default StateHistory;\n","import React, { PureComponent } from 'react';\n\nimport { getBackendSrv } from '@grafana/runtime';\nimport {\n  LoadingPlaceholder,\n  JSONFormatter,\n  Icon,\n  HorizontalGroup,\n  ClipboardButton,\n  clearButtonStyles,\n  withTheme2,\n  Themeable2,\n} from '@grafana/ui';\n\nimport { DashboardModel, PanelModel } from '../dashboard/state';\n\nexport interface Props extends Themeable2 {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n}\n\ninterface State {\n  isLoading: boolean;\n  allNodesExpanded: boolean | null;\n  testRuleResponse: {};\n}\n\nclass UnThemedTestRuleResult extends PureComponent<Props, State> {\n  readonly state: State = {\n    isLoading: false,\n    allNodesExpanded: null,\n    testRuleResponse: {},\n  };\n\n  formattedJson: any;\n  clipboard: any;\n\n  componentDidMount() {\n    this.testRule();\n  }\n\n  async testRule() {\n    const { dashboard, panel } = this.props;\n\n    // dashboard save model\n    const model = dashboard.getSaveModelCloneOld();\n\n    // now replace panel to get current edits\n    model.panels = model.panels.map((dashPanel) => {\n      return dashPanel.id === panel.id ? panel.getSaveModel() : dashPanel;\n    });\n\n    const payload = { dashboard: model, panelId: panel.id };\n\n    this.setState({ isLoading: true });\n    const testRuleResponse = await getBackendSrv().post(`/api/alerts/test`, payload);\n    this.setState({ isLoading: false, testRuleResponse });\n  }\n\n  setFormattedJson = (formattedJson: any) => {\n    this.formattedJson = formattedJson;\n  };\n\n  getTextForClipboard = () => {\n    return JSON.stringify(this.formattedJson, null, 2);\n  };\n\n  onToggleExpand = () => {\n    this.setState((prevState) => ({\n      ...prevState,\n      allNodesExpanded: !this.state.allNodesExpanded,\n    }));\n  };\n\n  getNrOfOpenNodes = () => {\n    if (this.state.allNodesExpanded === null) {\n      return 3; // 3 is default, ie when state is null\n    } else if (this.state.allNodesExpanded) {\n      return 20;\n    }\n    return 1;\n  };\n\n  renderExpandCollapse = () => {\n    const { allNodesExpanded } = this.state;\n\n    const collapse = (\n      <>\n        <Icon name=\"minus-circle\" /> Collapse All\n      </>\n    );\n    const expand = (\n      <>\n        <Icon name=\"plus-circle\" /> Expand All\n      </>\n    );\n    return allNodesExpanded ? collapse : expand;\n  };\n\n  render() {\n    const { testRuleResponse, isLoading } = this.state;\n    const clearButton = clearButtonStyles(this.props.theme);\n\n    if (isLoading === true) {\n      return <LoadingPlaceholder text=\"Evaluating rule\" />;\n    }\n\n    const openNodes = this.getNrOfOpenNodes();\n\n    return (\n      <>\n        <div className=\"pull-right\">\n          <HorizontalGroup spacing=\"md\">\n            <button type=\"button\" className={clearButton} onClick={this.onToggleExpand}>\n              {this.renderExpandCollapse()}\n            </button>\n            <ClipboardButton getText={this.getTextForClipboard} icon=\"copy\">\n              Copy to Clipboard\n            </ClipboardButton>\n          </HorizontalGroup>\n        </div>\n\n        <JSONFormatter json={testRuleResponse} open={openNodes} onDidRender={this.setFormattedJson} />\n      </>\n    );\n  }\n}\n\nexport const TestRuleResult = withTheme2(UnThemedTestRuleResult);\n","import React, { PureComponent } from 'react';\nimport { connect, MapDispatchToProps, MapStateToProps } from 'react-redux';\n\nimport { EventBusSrv } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { AngularComponent, config, getAngularLoader, getDataSourceSrv } from '@grafana/runtime';\nimport { Alert, Button, ConfirmModal, Container, CustomScrollbar, HorizontalGroup, Modal } from '@grafana/ui';\nimport EmptyListCTA from 'app/core/components/EmptyListCTA/EmptyListCTA';\nimport { getPanelStateForModel } from 'app/features/panel/state/selectors';\nimport { AppNotificationSeverity, StoreState } from 'app/types';\n\nimport { AlertState } from '../../plugins/datasource/alertmanager/types';\nimport { PanelNotSupported } from '../dashboard/components/PanelEditor/PanelNotSupported';\nimport { DashboardModel } from '../dashboard/state/DashboardModel';\nimport { PanelModel } from '../dashboard/state/PanelModel';\n\nimport StateHistory from './StateHistory';\nimport { TestRuleResult } from './TestRuleResult';\nimport { getAlertingValidationMessage } from './getAlertingValidationMessage';\n\ninterface AngularPanelController {\n  _enableAlert: () => void;\n  alertState: AlertState | null;\n  render: () => void;\n  refresh: () => void;\n}\n\ninterface OwnProps {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n}\n\ninterface ConnectedProps {\n  angularPanelComponent?: AngularComponent | null;\n}\n\ninterface DispatchProps {}\n\nexport type Props = OwnProps & ConnectedProps & DispatchProps;\n\ninterface State {\n  validationMessage: string;\n  showStateHistory: boolean;\n  showDeleteConfirmation: boolean;\n  showTestRule: boolean;\n}\n\nclass UnConnectedAlertTab extends PureComponent<Props, State> {\n  element?: HTMLDivElement | null;\n  component?: AngularComponent;\n  panelCtrl?: AngularPanelController;\n\n  state: State = {\n    validationMessage: '',\n    showStateHistory: false,\n    showDeleteConfirmation: false,\n    showTestRule: false,\n  };\n\n  async componentDidMount() {\n    if (config.angularSupportEnabled) {\n      await import(/* webpackChunkName: \"AlertTabCtrl\" */ 'app/features/alerting/AlertTabCtrl');\n      this.loadAlertTab();\n    } else {\n      // TODO probably need to migrate AlertTab to react\n      alert('Angular support disabled, legacy alerting cannot function without angular support');\n    }\n  }\n\n  onAngularPanelUpdated = () => {\n    this.forceUpdate();\n  };\n\n  componentDidUpdate(prevProps: Props) {\n    this.loadAlertTab();\n  }\n\n  componentWillUnmount() {\n    if (this.component) {\n      this.component.destroy();\n    }\n  }\n\n  async loadAlertTab() {\n    const { panel, angularPanelComponent } = this.props;\n\n    if (!this.element || this.component) {\n      return;\n    }\n\n    if (angularPanelComponent) {\n      const scope = angularPanelComponent.getScope();\n\n      // When full page reloading in edit mode the angular panel has on fully compiled & instantiated yet\n      if (!scope.$$childHead) {\n        setTimeout(() => {\n          this.forceUpdate();\n        });\n        return;\n      }\n\n      this.panelCtrl = scope.$$childHead.ctrl;\n    } else {\n      this.panelCtrl = this.getReactAlertPanelCtrl();\n    }\n\n    const loader = getAngularLoader();\n    const template = '<alert-tab />';\n    const scopeProps = { ctrl: this.panelCtrl };\n\n    this.component = loader.load(this.element, scopeProps, template);\n\n    const validationMessage = await getAlertingValidationMessage(\n      panel.transformations,\n      panel.targets,\n      getDataSourceSrv(),\n      panel.datasource\n    );\n\n    if (validationMessage) {\n      this.setState({ validationMessage });\n    }\n  }\n\n  getReactAlertPanelCtrl() {\n    return {\n      panel: this.props.panel,\n      events: new EventBusSrv(),\n      render: () => {\n        this.props.panel.render();\n      },\n    } as any;\n  }\n\n  onAddAlert = () => {\n    this.panelCtrl?._enableAlert();\n    this.component?.digest();\n    this.forceUpdate();\n  };\n\n  onToggleModal = (prop: keyof Omit<State, 'validationMessage'>) => {\n    const value = this.state[prop];\n    this.setState({ ...this.state, [prop]: !value });\n  };\n\n  renderTestRule = () => {\n    if (!this.state.showTestRule) {\n      return null;\n    }\n\n    const { panel, dashboard } = this.props;\n    const onDismiss = () => this.onToggleModal('showTestRule');\n\n    return (\n      <Modal isOpen={true} icon=\"bug\" title=\"Testing rule\" onDismiss={onDismiss} onClickBackdrop={onDismiss}>\n        <TestRuleResult panel={panel} dashboard={dashboard} />\n      </Modal>\n    );\n  };\n\n  renderDeleteConfirmation = () => {\n    if (!this.state.showDeleteConfirmation) {\n      return null;\n    }\n\n    const { panel } = this.props;\n    const onDismiss = () => this.onToggleModal('showDeleteConfirmation');\n\n    return (\n      <ConfirmModal\n        isOpen={true}\n        icon=\"trash-alt\"\n        title=\"Delete\"\n        body={\n          <div>\n            Are you sure you want to delete this alert rule?\n            <br />\n            <small>You need to save dashboard for the delete to take effect.</small>\n          </div>\n        }\n        confirmText=\"Delete alert\"\n        onDismiss={onDismiss}\n        onConfirm={() => {\n          delete panel.alert;\n          panel.thresholds = [];\n          if (this.panelCtrl) {\n            this.panelCtrl.alertState = null;\n            this.panelCtrl.render();\n          }\n          this.component?.digest();\n          onDismiss();\n        }}\n      />\n    );\n  };\n\n  renderStateHistory = () => {\n    if (!this.state.showStateHistory) {\n      return null;\n    }\n\n    const { panel, dashboard } = this.props;\n    const onDismiss = () => this.onToggleModal('showStateHistory');\n\n    return (\n      <Modal isOpen={true} icon=\"history\" title=\"State history\" onDismiss={onDismiss} onClickBackdrop={onDismiss}>\n        <StateHistory dashboard={dashboard} panelId={panel.id} onRefresh={() => this.panelCtrl?.refresh()} />\n      </Modal>\n    );\n  };\n\n  render() {\n    const { alert, transformations } = this.props.panel;\n    const { validationMessage } = this.state;\n    const hasTransformations = transformations && transformations.length > 0;\n\n    if (!alert && validationMessage) {\n      return <PanelNotSupported message={validationMessage} />;\n    }\n\n    const model = {\n      title: 'Panel has no alert rule defined',\n      buttonIcon: 'bell' as const,\n      onClick: this.onAddAlert,\n      buttonTitle: 'Create Alert',\n    };\n\n    return (\n      <>\n        <CustomScrollbar autoHeightMin=\"100%\">\n          <Container padding=\"md\">\n            <div aria-label={selectors.components.AlertTab.content}>\n              {alert && hasTransformations && (\n                <Alert\n                  severity={AppNotificationSeverity.Error}\n                  title=\"Transformations are not supported in alert queries\"\n                />\n              )}\n\n              <div ref={(element) => (this.element = element)} />\n              {alert && (\n                <HorizontalGroup>\n                  <Button onClick={() => this.onToggleModal('showStateHistory')} variant=\"secondary\">\n                    State history\n                  </Button>\n                  <Button onClick={() => this.onToggleModal('showTestRule')} variant=\"secondary\">\n                    Test rule\n                  </Button>\n                  <Button onClick={() => this.onToggleModal('showDeleteConfirmation')} variant=\"destructive\">\n                    Delete\n                  </Button>\n                </HorizontalGroup>\n              )}\n              {!alert && !validationMessage && <EmptyListCTA {...model} />}\n            </div>\n          </Container>\n        </CustomScrollbar>\n\n        {this.renderTestRule()}\n        {this.renderDeleteConfirmation()}\n        {this.renderStateHistory()}\n      </>\n    );\n  }\n}\n\nconst mapStateToProps: MapStateToProps<ConnectedProps, OwnProps, StoreState> = (state, props) => {\n  return {\n    angularPanelComponent: getPanelStateForModel(state, props.panel)?.angularComponent,\n  };\n};\n\nconst mapDispatchToProps: MapDispatchToProps<DispatchProps, OwnProps> = {};\n\nexport const AlertTab = connect(mapStateToProps, mapDispatchToProps)(UnConnectedAlertTab);\n","import React from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { useAsync } from 'react-use';\n\nimport { urlUtil } from '@grafana/data';\nimport { logInfo } from '@grafana/runtime';\nimport { Alert, Button, LinkButton } from '@grafana/ui';\nimport { DashboardModel, PanelModel } from 'app/features/dashboard/state';\nimport { useSelector } from 'app/types';\n\nimport { LogMessages } from '../../Analytics';\nimport { panelToRuleFormValues } from '../../utils/rule-form';\n\ninterface Props {\n  panel: PanelModel;\n  dashboard: DashboardModel;\n  className?: string;\n}\n\nexport const NewRuleFromPanelButton = ({ dashboard, panel, className }: Props) => {\n  const templating = useSelector((state) => {\n    return state.templating;\n  });\n\n  const location = useLocation();\n\n  const { loading, value: formValues } = useAsync(\n    () => panelToRuleFormValues(panel, dashboard),\n    // Templating variables are required to update formValues on each variable's change. It's used implicitly by the templating engine\n    [panel, dashboard, templating]\n  );\n\n  if (loading) {\n    return <Button disabled={true}>Create alert rule from this panel</Button>;\n  }\n\n  if (!formValues) {\n    return (\n      <Alert severity=\"info\" title=\"No alerting capable query found\">\n        Cannot create alerts from this panel because no query to an alerting capable datasource is found.\n      </Alert>\n    );\n  }\n\n  const ruleFormUrl = urlUtil.renderUrl('alerting/new', {\n    defaults: JSON.stringify(formValues),\n    returnTo: location.pathname + location.search,\n  });\n\n  return (\n    <LinkButton\n      icon=\"bell\"\n      onClick={() => logInfo(LogMessages.alertRuleFromPanel)}\n      href={ruleFormUrl}\n      className={className}\n      data-testid=\"create-alert-rule-button\"\n    >\n      Create alert rule from this panel\n    </LinkButton>\n  );\n};\n","import { SerializedError } from '@reduxjs/toolkit';\nimport { useEffect, useMemo } from 'react';\n\nimport { DashboardModel, PanelModel } from 'app/features/dashboard/state';\nimport { useDispatch } from 'app/types';\nimport { CombinedRule } from 'app/types/unified-alerting';\n\nimport { fetchPromRulesAction, fetchRulerRulesAction } from '../state/actions';\nimport { Annotation, RULE_LIST_POLL_INTERVAL_MS } from '../utils/constants';\nimport { GRAFANA_RULES_SOURCE_NAME } from '../utils/datasource';\nimport { initialAsyncRequestState } from '../utils/redux';\n\nimport { useCombinedRuleNamespaces } from './useCombinedRuleNamespaces';\nimport { useUnifiedAlertingSelector } from './useUnifiedAlertingSelector';\n\ninterface Options {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n\n  poll?: boolean;\n}\n\ninterface ReturnBag {\n  errors: SerializedError[];\n  rules: CombinedRule[];\n\n  loading?: boolean;\n}\n\nexport function usePanelCombinedRules({ dashboard, panel, poll = false }: Options): ReturnBag {\n  const dispatch = useDispatch();\n\n  const promRuleRequest =\n    useUnifiedAlertingSelector((state) => state.promRules[GRAFANA_RULES_SOURCE_NAME]) ?? initialAsyncRequestState;\n  const rulerRuleRequest =\n    useUnifiedAlertingSelector((state) => state.rulerRules[GRAFANA_RULES_SOURCE_NAME]) ?? initialAsyncRequestState;\n\n  // fetch rules, then poll every RULE_LIST_POLL_INTERVAL_MS\n  useEffect(() => {\n    const fetch = () => {\n      dispatch(\n        fetchPromRulesAction({\n          rulesSourceName: GRAFANA_RULES_SOURCE_NAME,\n          filter: { dashboardUID: dashboard.uid, panelId: panel.id },\n        })\n      );\n      dispatch(\n        fetchRulerRulesAction({\n          rulesSourceName: GRAFANA_RULES_SOURCE_NAME,\n          filter: { dashboardUID: dashboard.uid, panelId: panel.id },\n        })\n      );\n    };\n    fetch();\n    if (poll) {\n      const interval = setInterval(fetch, RULE_LIST_POLL_INTERVAL_MS);\n      return () => {\n        clearInterval(interval);\n      };\n    }\n    return () => {};\n  }, [dispatch, poll, panel.id, dashboard.uid]);\n\n  const loading = promRuleRequest.loading || rulerRuleRequest.loading;\n  const errors = [promRuleRequest.error, rulerRuleRequest.error].filter(\n    (err: SerializedError | undefined): err is SerializedError => !!err\n  );\n\n  const combinedNamespaces = useCombinedRuleNamespaces(GRAFANA_RULES_SOURCE_NAME);\n\n  // filter out rules that are relevant to this panel\n  const rules = useMemo(\n    (): CombinedRule[] =>\n      combinedNamespaces\n        .flatMap((ns) => ns.groups)\n        .flatMap((group) => group.rules)\n        .filter(\n          (rule) =>\n            rule.annotations[Annotation.dashboardUID] === dashboard.uid &&\n            rule.annotations[Annotation.panelID] === String(panel.id)\n        ),\n    [combinedNamespaces, dashboard, panel]\n  );\n\n  return {\n    rules,\n    errors,\n    loading,\n  };\n}\n","import { css } from '@emotion/css';\nimport React from 'react';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Alert, CustomScrollbar, LoadingPlaceholder, useStyles2 } from '@grafana/ui';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { DashboardModel, PanelModel } from 'app/features/dashboard/state';\n\nimport { NewRuleFromPanelButton } from './components/panel-alerts-tab/NewRuleFromPanelButton';\nimport { RulesTable } from './components/rules/RulesTable';\nimport { usePanelCombinedRules } from './hooks/usePanelCombinedRules';\nimport { getRulesPermissions } from './utils/access-control';\n\ninterface Props {\n  dashboard: DashboardModel;\n  panel: PanelModel;\n}\n\nexport const PanelAlertTabContent = ({ dashboard, panel }: Props) => {\n  const styles = useStyles2(getStyles);\n  const { errors, loading, rules } = usePanelCombinedRules({\n    dashboard,\n    panel,\n    poll: true,\n  });\n  const permissions = getRulesPermissions('grafana');\n  const canCreateRules = contextSrv.hasPermission(permissions.create);\n\n  const alert = errors.length ? (\n    <Alert title=\"Errors loading rules\" severity=\"error\">\n      {errors.map((error, index) => (\n        <div key={index}>Failed to load Grafana rules state: {error.message || 'Unknown error.'}</div>\n      ))}\n    </Alert>\n  ) : null;\n\n  if (loading && !rules.length) {\n    return (\n      <div className={styles.innerWrapper}>\n        {alert}\n        <LoadingPlaceholder text=\"Loading rules...\" />\n      </div>\n    );\n  }\n\n  if (rules.length) {\n    return (\n      <CustomScrollbar autoHeightMin=\"100%\">\n        <div className={styles.innerWrapper}>\n          {alert}\n          <RulesTable rules={rules} />\n          {!!dashboard.meta.canSave && canCreateRules && (\n            <NewRuleFromPanelButton className={styles.newButton} panel={panel} dashboard={dashboard} />\n          )}\n        </div>\n      </CustomScrollbar>\n    );\n  }\n\n  return (\n    <div aria-label={selectors.components.PanelAlertTabContent.content} className={styles.noRulesWrapper}>\n      {alert}\n      {!!dashboard.uid && (\n        <>\n          <p>There are no alert rules linked to this panel.</p>\n          {!!dashboard.meta.canSave && canCreateRules && <NewRuleFromPanelButton panel={panel} dashboard={dashboard} />}\n        </>\n      )}\n      {!dashboard.uid && !!dashboard.meta.canSave && (\n        <Alert severity=\"info\" title=\"Dashboard not saved\">\n          Dashboard must be saved before alerts can be added.\n        </Alert>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  newButton: css`\n    margin-top: ${theme.spacing(3)};\n  `,\n  innerWrapper: css`\n    padding: ${theme.spacing(2)};\n  `,\n  noRulesWrapper: css`\n    margin: ${theme.spacing(2)};\n    background-color: ${theme.colors.background.secondary};\n    padding: ${theme.spacing(3)};\n  `,\n});\n","import { config } from '@grafana/runtime';\n\nimport { AlertTab } from './AlertTab';\nimport { PanelAlertTabContent } from './unified/PanelAlertTabContent';\n\n// route between unified and \"old\" alerting pages based on feature flag\n\nexport default config.unifiedAlertingEnabled ? PanelAlertTabContent : AlertTab;\n","import React from 'react';\n\nimport { Tab, TabProps } from '@grafana/ui/src/components/Tabs/Tab';\nimport { DashboardModel, PanelModel } from 'app/features/dashboard/state';\n\nimport { usePanelCombinedRules } from './hooks/usePanelCombinedRules';\n\ninterface Props extends Omit<TabProps, 'counter' | 'ref'> {\n  panel: PanelModel;\n  dashboard: DashboardModel;\n}\n\n// it will load rule count from backend\nexport const PanelAlertTab = ({ panel, dashboard, ...otherProps }: Props) => {\n  const { rules, loading } = usePanelCombinedRules({ panel, dashboard });\n  return <Tab {...otherProps} counter={loading ? null : rules.length} />;\n};\n","import { DocsId } from '@grafana/data';\n\n// TODO: Documentation links\nconst DOCS_LINKS: Record<DocsId, string> = {\n  [DocsId.Transformations]: 'https://grafana.com/docs/grafana/latest/panels/transformations',\n  [DocsId.FieldConfig]: 'https://grafana.com/docs/grafana/latest/panels/field-configuration-options/',\n  [DocsId.FieldConfigOverrides]:\n    'https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field',\n};\n\nexport const getDocsLink = (id: DocsId) => DOCS_LINKS[id];\n","import { css } from '@emotion/css';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { mergeMap } from 'rxjs/operators';\n\nimport {\n  DataFrame,\n  DataTransformerConfig,\n  GrafanaTheme2,\n  transformDataFrame,\n  TransformerRegistryItem,\n  getFrameMatchers,\n  DataTransformContext,\n} from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { getTemplateSrv } from '@grafana/runtime';\nimport { Icon, JSONFormatter, useStyles2 } from '@grafana/ui';\n\nimport { TransformationsEditorTransformation } from './types';\n\ninterface TransformationEditorProps {\n  debugMode?: boolean;\n  index: number;\n  data: DataFrame[];\n  uiConfig: TransformerRegistryItem<any>;\n  configs: TransformationsEditorTransformation[];\n  onChange: (index: number, config: DataTransformerConfig) => void;\n}\n\nexport const TransformationEditor = ({\n  debugMode,\n  index,\n  data,\n  uiConfig,\n  configs,\n  onChange,\n}: TransformationEditorProps) => {\n  const styles = useStyles2(getStyles);\n  const [input, setInput] = useState<DataFrame[]>([]);\n  const [output, setOutput] = useState<DataFrame[]>([]);\n  const config = useMemo(() => configs[index], [configs, index]);\n\n  useEffect(() => {\n    const config = configs[index].transformation;\n    const matcher = config.filter?.options ? getFrameMatchers(config.filter) : undefined;\n    const inputTransforms = configs.slice(0, index).map((t) => t.transformation);\n    const outputTransforms = configs.slice(index, index + 1).map((t) => t.transformation);\n\n    const ctx: DataTransformContext = {\n      interpolate: (v: string) => getTemplateSrv().replace(v),\n    };\n\n    const inputSubscription = transformDataFrame(inputTransforms, data, ctx).subscribe((v) => {\n      if (matcher) {\n        v = data.filter((v) => matcher(v));\n      }\n      setInput(v);\n    });\n    const outputSubscription = transformDataFrame(inputTransforms, data, ctx)\n      .pipe(mergeMap((before) => transformDataFrame(outputTransforms, before, ctx)))\n      .subscribe(setOutput);\n\n    return function unsubscribe() {\n      inputSubscription.unsubscribe();\n      outputSubscription.unsubscribe();\n    };\n  }, [index, data, configs]);\n\n  const editor = useMemo(\n    () =>\n      React.createElement(uiConfig.editor, {\n        options: { ...uiConfig.transformation.defaultOptions, ...config.transformation.options },\n        input,\n        onChange: (opts) => {\n          onChange(index, {\n            ...config.transformation,\n            options: opts,\n          });\n        },\n      }),\n    [uiConfig.editor, uiConfig.transformation.defaultOptions, config.transformation, input, onChange, index]\n  );\n\n  return (\n    <div className={styles.editor} data-testid={selectors.components.TransformTab.transformationEditor(uiConfig.name)}>\n      {editor}\n      {debugMode && (\n        <div\n          className={styles.debugWrapper}\n          data-testid={selectors.components.TransformTab.transformationEditorDebugger(uiConfig.name)}\n        >\n          <div className={styles.debug}>\n            <div className={styles.debugTitle}>Transformation input data</div>\n            <div className={styles.debugJson}>\n              <JSONFormatter json={input} />\n            </div>\n          </div>\n          <div className={styles.debugSeparator}>\n            <Icon name=\"arrow-right\" />\n          </div>\n          <div className={styles.debug}>\n            <div className={styles.debugTitle}>Transformation output data</div>\n            <div className={styles.debugJson}>{output && <JSONFormatter json={output} />}</div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const debugBorder = theme.isLight ? theme.v1.palette.gray85 : theme.v1.palette.gray15;\n\n  return {\n    title: css`\n      display: flex;\n      padding: 4px 8px 4px 8px;\n      position: relative;\n      height: 35px;\n      border-radius: 4px 4px 0 0;\n      flex-wrap: nowrap;\n      justify-content: space-between;\n      align-items: center;\n    `,\n    name: css`\n      font-weight: ${theme.typography.fontWeightMedium};\n      color: ${theme.colors.primary.text};\n    `,\n    iconRow: css`\n      display: flex;\n    `,\n    icon: css`\n      background: transparent;\n      border: none;\n      box-shadow: none;\n      cursor: pointer;\n      color: ${theme.colors.text.secondary};\n      margin-left: ${theme.spacing(1)};\n      &:hover {\n        color: ${theme.colors.text};\n      }\n    `,\n    editor: css``,\n    debugWrapper: css`\n      display: flex;\n      flex-direction: row;\n    `,\n    debugSeparator: css`\n      width: 48px;\n      min-height: 300px;\n      display: flex;\n      align-items: center;\n      align-self: stretch;\n      justify-content: center;\n      margin: 0 ${theme.spacing(0.5)};\n      color: ${theme.colors.primary.text};\n    `,\n    debugTitle: css`\n      padding: ${theme.spacing(1)} ${theme.spacing(0.25)};\n      font-family: ${theme.typography.fontFamilyMonospace};\n      font-size: ${theme.typography.bodySmall.fontSize};\n      color: ${theme.colors.text};\n      border-bottom: 1px solid ${debugBorder};\n      flex-grow: 0;\n      flex-shrink: 1;\n    `,\n\n    debug: css`\n      margin-top: ${theme.spacing(1)};\n      padding: 0 ${theme.spacing(1, 1, 1)};\n      border: 1px solid ${debugBorder};\n      background: ${theme.isLight ? theme.v1.palette.white : theme.v1.palette.gray05};\n      border-radius: ${theme.shape.radius.default};\n      width: 100%;\n      min-height: 300px;\n      display: flex;\n      flex-direction: column;\n      align-self: stretch;\n    `,\n    debugJson: css`\n      flex-grow: 1;\n      height: 100%;\n      overflow: hidden;\n      padding: ${theme.spacing(0.5)};\n    `,\n  };\n};\n","import { css } from '@emotion/css';\nimport React, { useMemo } from 'react';\n\nimport {\n  DataFrame,\n  DataTransformerConfig,\n  GrafanaTheme2,\n  StandardEditorContext,\n  StandardEditorsRegistryItem,\n} from '@grafana/data';\nimport { Field, useStyles2 } from '@grafana/ui';\nimport { FrameSelectionEditor } from 'app/plugins/panel/geomap/editor/FrameSelectionEditor';\n\ninterface TransformationFilterProps {\n  index: number;\n  config: DataTransformerConfig;\n  data: DataFrame[];\n  onChange: (index: number, config: DataTransformerConfig) => void;\n}\n\nexport const TransformationFilter = ({ index, data, config, onChange }: TransformationFilterProps) => {\n  const styles = useStyles2(getStyles);\n  const context = useMemo(() => {\n    // eslint-disable-next-line\n    return { data } as StandardEditorContext<unknown>;\n  }, [data]);\n\n  return (\n    <div className={styles.wrapper}>\n      <Field label=\"Apply transformation to\">\n        <FrameSelectionEditor\n          value={config.filter!}\n          context={context}\n          // eslint-disable-next-line\n          item={{} as StandardEditorsRegistryItem}\n          onChange={(filter) => onChange(index, { ...config, filter })}\n        />\n      </Field>\n    </div>\n  );\n};\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  const borderRadius = theme.shape.radius.default;\n\n  return {\n    wrapper: css`\n      padding: ${theme.spacing(2)};\n      border: 2px solid ${theme.colors.background.secondary};\n      border-top: none;\n      border-radius: 0 0 ${borderRadius} ${borderRadius};\n      position: relative;\n      top: -4px;\n    `,\n  };\n};\n","import React, { useCallback } from 'react';\nimport { useToggle } from 'react-use';\n\nimport { DataFrame, DataTransformerConfig, TransformerRegistryItem, FrameMatcherID } from '@grafana/data';\nimport { reportInteraction } from '@grafana/runtime';\nimport { ConfirmModal } from '@grafana/ui';\nimport { OperationRowHelp } from 'app/core/components/QueryOperationRow/OperationRowHelp';\nimport {\n  QueryOperationAction,\n  QueryOperationToggleAction,\n} from 'app/core/components/QueryOperationRow/QueryOperationAction';\nimport {\n  QueryOperationRow,\n  QueryOperationRowRenderProps,\n} from 'app/core/components/QueryOperationRow/QueryOperationRow';\nimport config from 'app/core/config';\nimport { PluginStateInfo } from 'app/features/plugins/components/PluginStateInfo';\n\nimport { TransformationEditor } from './TransformationEditor';\nimport { TransformationFilter } from './TransformationFilter';\nimport { TransformationsEditorTransformation } from './types';\n\ninterface TransformationOperationRowProps {\n  id: string;\n  index: number;\n  data: DataFrame[];\n  uiConfig: TransformerRegistryItem<null>;\n  configs: TransformationsEditorTransformation[];\n  onRemove: (index: number) => void;\n  onChange: (index: number, config: DataTransformerConfig) => void;\n}\n\nexport const TransformationOperationRow = ({\n  onRemove,\n  index,\n  id,\n  data,\n  configs,\n  uiConfig,\n  onChange,\n}: TransformationOperationRowProps) => {\n  const [showDeleteModal, setShowDeleteModal] = useToggle(false);\n  const [showDebug, toggleShowDebug] = useToggle(false);\n  const [showHelp, toggleShowHelp] = useToggle(false);\n  const disabled = !!configs[index].transformation.disabled;\n  const filter = configs[index].transformation.filter != null;\n  const showFilter = filter || data.length > 1;\n\n  const onDisableToggle = useCallback(\n    (index: number) => {\n      const current = configs[index].transformation;\n      onChange(index, {\n        ...current,\n        disabled: current.disabled ? undefined : true,\n      });\n    },\n    [onChange, configs]\n  );\n\n  const toggleExpand = useCallback(() => {\n    if (showHelp) {\n      return true;\n    }\n\n    // We return `undefined` here since the QueryOperationRow component ignores an `undefined` value for the `isOpen` prop.\n    // If we returned `false` here, the row would be collapsed when the user toggles off `showHelp`, which is not what we want.\n    return undefined;\n  }, [showHelp]);\n\n  // Adds or removes the frame filter\n  const toggleFilter = useCallback(() => {\n    let current = { ...configs[index].transformation };\n    if (current.filter) {\n      delete current.filter;\n    } else {\n      current.filter = {\n        id: FrameMatcherID.byRefId,\n        options: '', // empty string will not do anything\n      };\n    }\n    onChange(index, current);\n  }, [onChange, index, configs]);\n\n  // Instrument toggle callback\n  const instrumentToggleCallback = useCallback(\n    (callback: (e: React.MouseEvent) => void, toggleId: string, active: boolean | undefined) =>\n      (e: React.MouseEvent) => {\n        let eventName = 'panel_editor_tabs_transformations_toggle';\n        if (config.featureToggles.transformationsRedesign) {\n          eventName = 'transformations_redesign_' + eventName;\n        }\n\n        reportInteraction(eventName, {\n          action: active ? 'off' : 'on',\n          toggleId,\n          transformationId: configs[index].transformation.id,\n        });\n\n        callback(e);\n      },\n    [configs, index]\n  );\n\n  const renderActions = ({ isOpen }: QueryOperationRowRenderProps) => {\n    return (\n      <>\n        {uiConfig.state && <PluginStateInfo state={uiConfig.state} />}\n        <QueryOperationToggleAction\n          title=\"Show transform help\"\n          icon=\"info-circle\"\n          // `instrumentToggleCallback` expects a function that takes a MouseEvent, is unused in the state setter. Instead, we simply toggle the state.\n          onClick={instrumentToggleCallback((_e) => toggleShowHelp(!showHelp), 'help', showHelp)}\n          active={!!showHelp}\n        />\n        {showFilter && (\n          <QueryOperationToggleAction\n            title=\"Filter\"\n            icon=\"filter\"\n            onClick={instrumentToggleCallback(toggleFilter, 'filter', filter)}\n            active={filter}\n          />\n        )}\n        <QueryOperationToggleAction\n          title=\"Debug\"\n          disabled={!isOpen}\n          icon=\"bug\"\n          onClick={instrumentToggleCallback(toggleShowDebug, 'debug', showDebug)}\n          active={showDebug}\n        />\n        <QueryOperationToggleAction\n          title=\"Disable transformation\"\n          icon={disabled ? 'eye-slash' : 'eye'}\n          onClick={instrumentToggleCallback(() => onDisableToggle(index), 'disabled', disabled)}\n          active={disabled}\n        />\n        <QueryOperationAction\n          title=\"Remove\"\n          icon=\"trash-alt\"\n          onClick={() => (config.featureToggles.transformationsRedesign ? setShowDeleteModal(true) : onRemove(index))}\n        />\n\n        {config.featureToggles.transformationsRedesign && (\n          <ConfirmModal\n            isOpen={showDeleteModal}\n            title={`Delete ${uiConfig.name}?`}\n            body=\"Note that removing one transformation may break others. If there is only a single transformation, you will go back to the main selection screen.\"\n            confirmText=\"Delete\"\n            onConfirm={() => {\n              setShowDeleteModal(false);\n              onRemove(index);\n            }}\n            onDismiss={() => setShowDeleteModal(false)}\n          />\n        )}\n      </>\n    );\n  };\n\n  return (\n    <QueryOperationRow\n      id={id}\n      index={index}\n      title={`${index + 1} - ${uiConfig.name}`}\n      draggable\n      actions={renderActions}\n      disabled={disabled}\n      isOpen={toggleExpand()}\n      // Assure that showHelp is untoggled when the row becomes collapsed.\n      onClose={() => toggleShowHelp(false)}\n      expanderMessages={{\n        close: 'Collapse transformation row',\n        open: 'Expand transformation row',\n      }}\n    >\n      {showHelp && <OperationRowHelp markdown={prepMarkdown(uiConfig)} />}\n      {filter && (\n        <TransformationFilter index={index} config={configs[index].transformation} data={data} onChange={onChange} />\n      )}\n      <TransformationEditor\n        debugMode={showDebug}\n        index={index}\n        data={data}\n        configs={configs}\n        uiConfig={uiConfig}\n        onChange={onChange}\n      />\n    </QueryOperationRow>\n  );\n};\n\nfunction prepMarkdown(uiConfig: TransformerRegistryItem<null>) {\n  let helpMarkdown = uiConfig.help ?? uiConfig.description;\n\n  return `\n${helpMarkdown}\n\nGo the <a href=\"https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana\" target=\"_blank\" rel=\"noreferrer\">\ntransformation documentation\n</a> for more.\n`;\n}\n","import React from 'react';\n\nimport { DataFrame, DataTransformerConfig, standardTransformersRegistry } from '@grafana/data';\n\nimport { TransformationOperationRow } from './TransformationOperationRow';\nimport { TransformationsEditorTransformation } from './types';\n\ninterface TransformationOperationRowsProps {\n  data: DataFrame[];\n  configs: TransformationsEditorTransformation[];\n  onRemove: (index: number) => void;\n  onChange: (index: number, config: DataTransformerConfig) => void;\n}\n\nexport const TransformationOperationRows = ({\n  data,\n  onChange,\n  onRemove,\n  configs,\n}: TransformationOperationRowsProps) => {\n  return (\n    <>\n      {configs.map((t, i) => {\n        const uiConfig = standardTransformersRegistry.getIfExists(t.transformation.id);\n        if (!uiConfig) {\n          return null;\n        }\n\n        return (\n          <TransformationOperationRow\n            index={i}\n            id={`${t.id}`}\n            key={`${t.id}`}\n            data={data}\n            configs={configs}\n            uiConfig={uiConfig}\n            onRemove={onRemove}\n            onChange={onChange}\n          />\n        );\n      })}\n    </>\n  );\n};\n","import { cx, css } from '@emotion/css';\nimport React, { ChangeEvent } from 'react';\nimport { DragDropContext, Droppable, DropResult } from 'react-beautiful-dnd';\nimport { Unsubscribable } from 'rxjs';\n\nimport {\n  DataFrame,\n  DataTransformerConfig,\n  DocsId,\n  GrafanaTheme2,\n  PanelData,\n  SelectableValue,\n  standardTransformersRegistry,\n  TransformerRegistryItem,\n  TransformerCategory,\n  DataTransformerID,\n  TransformationApplicabilityLevels,\n} from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { reportInteraction } from '@grafana/runtime';\nimport {\n  Alert,\n  Button,\n  ConfirmModal,\n  Container,\n  CustomScrollbar,\n  FilterPill,\n  Themeable,\n  VerticalGroup,\n  withTheme,\n  Input,\n  Icon,\n  IconButton,\n  useStyles2,\n  Card,\n  Switch,\n} from '@grafana/ui';\nimport { LocalStorageValueProvider } from 'app/core/components/LocalStorageValueProvider';\nimport config from 'app/core/config';\nimport { getDocsLink } from 'app/core/utils/docsLinks';\nimport { PluginStateInfo } from 'app/features/plugins/components/PluginStateInfo';\nimport { categoriesLabels } from 'app/features/transformers/utils';\n\nimport { AppNotificationSeverity } from '../../../../types';\nimport { PanelModel } from '../../state';\nimport { PanelNotSupported } from '../PanelEditor/PanelNotSupported';\n\nimport { TransformationOperationRows } from './TransformationOperationRows';\nimport { TransformationsEditorTransformation } from './types';\n\nconst LOCAL_STORAGE_KEY = 'dashboard.components.TransformationEditor.featureInfoBox.isDismissed';\n\ninterface TransformationsEditorProps extends Themeable {\n  panel: PanelModel;\n}\n\ntype viewAllType = 'viewAll';\nconst viewAllValue = 'viewAll';\nconst viewAllLabel = 'View all';\n\ntype FilterCategory = TransformerCategory | viewAllType;\n\nconst filterCategoriesLabels: Array<[FilterCategory, string]> = [\n  [viewAllValue, viewAllLabel],\n  ...(Object.entries(categoriesLabels) as Array<[FilterCategory, string]>),\n];\n\ninterface State {\n  data: DataFrame[];\n  transformations: TransformationsEditorTransformation[];\n  search: string;\n  showPicker?: boolean;\n  scrollTop?: number;\n  showRemoveAllModal?: boolean;\n  selectedFilter?: FilterCategory;\n  showIllustrations?: boolean;\n}\n\nclass UnThemedTransformationsEditor extends React.PureComponent<TransformationsEditorProps, State> {\n  subscription?: Unsubscribable;\n\n  constructor(props: TransformationsEditorProps) {\n    super(props);\n    const transformations = props.panel.transformations || [];\n\n    const ids = this.buildTransformationIds(transformations);\n    this.state = {\n      transformations: transformations.map((t, i) => ({\n        transformation: t,\n        id: ids[i],\n      })),\n      data: [],\n      search: '',\n      selectedFilter: viewAllValue,\n      showIllustrations: true,\n    };\n  }\n\n  onSearchChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ search: event.target.value });\n  };\n\n  onSearchKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\n    if (event.key === 'Enter') {\n      const { search } = this.state;\n      if (search) {\n        const lower = search.toLowerCase();\n        const filtered = standardTransformersRegistry.list().filter((t) => {\n          const txt = (t.name + t.description).toLowerCase();\n          return txt.indexOf(lower) >= 0;\n        });\n        if (filtered.length > 0) {\n          this.onTransformationAdd({ value: filtered[0].id });\n        }\n      }\n    } else if (event.keyCode === 27) {\n      // Escape key\n      this.setState({ search: '', showPicker: false });\n      event.stopPropagation(); // don't exit the editor\n    }\n  };\n\n  buildTransformationIds(transformations: DataTransformerConfig[]) {\n    const transformationCounters: Record<string, number> = {};\n    const transformationIds: string[] = [];\n\n    for (let i = 0; i < transformations.length; i++) {\n      const transformation = transformations[i];\n      if (transformationCounters[transformation.id] === undefined) {\n        transformationCounters[transformation.id] = 0;\n      } else {\n        transformationCounters[transformation.id] += 1;\n      }\n      transformationIds.push(`${transformations[i].id}-${transformationCounters[transformations[i].id]}`);\n    }\n    return transformationIds;\n  }\n\n  componentDidMount() {\n    this.subscription = this.props.panel\n      .getQueryRunner()\n      .getData({ withTransforms: false, withFieldConfig: false })\n      .subscribe({\n        next: (panelData: PanelData) => this.setState({ data: panelData.series }),\n      });\n  }\n\n  componentWillUnmount() {\n    if (this.subscription) {\n      this.subscription.unsubscribe();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<TransformationsEditorProps>, prevState: Readonly<State>): void {\n    if (config.featureToggles.transformationsRedesign) {\n      const prevHasTransforms = prevState.transformations.length > 0;\n      const prevShowPicker = !prevHasTransforms || prevState.showPicker;\n\n      const currentHasTransforms = this.state.transformations.length > 0;\n      const currentShowPicker = !currentHasTransforms || this.state.showPicker;\n\n      if (prevShowPicker !== currentShowPicker) {\n        // kindOfZero will be a random number between 0 and 0.5. It will be rounded to 0 by the scrollable component.\n        // We cannot always use 0 as it will not trigger a rerender of the scrollable component consistently\n        // due to React changes detection algo.\n        const kindOfZero = Math.random() / 2;\n\n        this.setState({ scrollTop: currentShowPicker ? kindOfZero : Number.MAX_SAFE_INTEGER });\n      }\n    }\n  }\n\n  onChange(transformations: TransformationsEditorTransformation[]) {\n    this.setState({ transformations });\n    this.props.panel.setTransformations(transformations.map((t) => t.transformation));\n  }\n\n  // Transformation UIDs are stored in a name-X form. name is NOT unique hence we need to parse the IDs and increase X\n  // for transformations with the same name\n  getTransformationNextId = (name: string) => {\n    const { transformations } = this.state;\n    let nextId = 0;\n    const existingIds = transformations.filter((t) => t.id.startsWith(name)).map((t) => t.id);\n\n    if (existingIds.length !== 0) {\n      nextId = Math.max(...existingIds.map((i) => parseInt(i.match(/\\d+/)![0], 10))) + 1;\n    }\n\n    return `${name}-${nextId}`;\n  };\n\n  onTransformationAdd = (selectable: SelectableValue<string>) => {\n    let eventName = 'panel_editor_tabs_transformations_management';\n    if (config.featureToggles.transformationsRedesign) {\n      eventName = 'transformations_redesign_' + eventName;\n    }\n\n    reportInteraction(eventName, {\n      action: 'add',\n      transformationId: selectable.value,\n    });\n    const { transformations } = this.state;\n\n    const nextId = this.getTransformationNextId(selectable.value!);\n    this.setState({ search: '', showPicker: false });\n    this.onChange([\n      ...transformations,\n      {\n        id: nextId,\n        transformation: {\n          id: selectable.value as string,\n          options: {},\n        },\n      },\n    ]);\n  };\n\n  onTransformationChange = (idx: number, dataConfig: DataTransformerConfig) => {\n    const { transformations } = this.state;\n    const next = Array.from(transformations);\n    let eventName = 'panel_editor_tabs_transformations_management';\n    if (config.featureToggles.transformationsRedesign) {\n      eventName = 'transformations_redesign_' + eventName;\n    }\n\n    reportInteraction(eventName, {\n      action: 'change',\n      transformationId: next[idx].transformation.id,\n    });\n    next[idx].transformation = dataConfig;\n    this.onChange(next);\n  };\n\n  onTransformationRemove = (idx: number) => {\n    const { transformations } = this.state;\n    const next = Array.from(transformations);\n    let eventName = 'panel_editor_tabs_transformations_management';\n    if (config.featureToggles.transformationsRedesign) {\n      eventName = 'transformations_redesign_' + eventName;\n    }\n\n    reportInteraction(eventName, {\n      action: 'remove',\n      transformationId: next[idx].transformation.id,\n    });\n    next.splice(idx, 1);\n    this.onChange(next);\n  };\n\n  onTransformationRemoveAll = () => {\n    this.onChange([]);\n    this.setState({ showRemoveAllModal: false });\n  };\n\n  onDragEnd = (result: DropResult) => {\n    const { transformations } = this.state;\n\n    if (!result || !result.destination) {\n      return;\n    }\n\n    const startIndex = result.source.index;\n    const endIndex = result.destination.index;\n    if (startIndex === endIndex) {\n      return;\n    }\n    const update = Array.from(transformations);\n    const [removed] = update.splice(startIndex, 1);\n    update.splice(endIndex, 0, removed);\n    this.onChange(update);\n  };\n\n  renderTransformationEditors = () => {\n    const styles = getStyles(config.theme2);\n    const { data, transformations, showPicker } = this.state;\n    const hide = config.featureToggles.transformationsRedesign && showPicker;\n\n    return (\n      <div className={cx({ [styles.hide]: hide })}>\n        <DragDropContext onDragEnd={this.onDragEnd}>\n          <Droppable droppableId=\"transformations-list\" direction=\"vertical\">\n            {(provided) => {\n              return (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  <TransformationOperationRows\n                    configs={transformations}\n                    data={data}\n                    onRemove={this.onTransformationRemove}\n                    onChange={this.onTransformationChange}\n                  />\n                  {provided.placeholder}\n                </div>\n              );\n            }}\n          </Droppable>\n        </DragDropContext>\n      </div>\n    );\n  };\n\n  renderTransformsPicker() {\n    const styles = getStyles(config.theme2);\n    const { transformations, search } = this.state;\n    let suffix: React.ReactNode = null;\n    let xforms = standardTransformersRegistry.list().sort((a, b) => (a.name > b.name ? 1 : b.name > a.name ? -1 : 0));\n\n    if (this.state.selectedFilter !== viewAllValue) {\n      xforms = xforms.filter(\n        (t) =>\n          t.categories &&\n          this.state.selectedFilter &&\n          t.categories.has(this.state.selectedFilter as TransformerCategory)\n      );\n    }\n\n    if (search) {\n      const lower = search.toLowerCase();\n      const filtered = xforms.filter((t) => {\n        const txt = (t.name + t.description).toLowerCase();\n        return txt.indexOf(lower) >= 0;\n      });\n\n      suffix = (\n        <>\n          {filtered.length} / {xforms.length} &nbsp;&nbsp;\n          <IconButton\n            name=\"times\"\n            onClick={() => {\n              this.setState({ search: '' });\n            }}\n            tooltip=\"Clear search\"\n          />\n        </>\n      );\n\n      xforms = filtered;\n    }\n\n    const noTransforms = !transformations?.length;\n    const showPicker = noTransforms || this.state.showPicker;\n\n    if (!suffix && showPicker && !noTransforms) {\n      suffix = (\n        <IconButton\n          name=\"times\"\n          onClick={() => {\n            this.setState({ showPicker: false });\n          }}\n          tooltip=\"Close picker\"\n        />\n      );\n    }\n\n    return (\n      <>\n        {noTransforms && !config.featureToggles.transformationsRedesign && (\n          <Container grow={1}>\n            <LocalStorageValueProvider<boolean> storageKey={LOCAL_STORAGE_KEY} defaultValue={false}>\n              {(isDismissed, onDismiss) => {\n                if (isDismissed) {\n                  return null;\n                }\n\n                return (\n                  <Alert\n                    title=\"Transformations\"\n                    severity=\"info\"\n                    onRemove={() => {\n                      onDismiss(true);\n                    }}\n                  >\n                    <p>\n                      Transformations allow you to join, calculate, re-order, hide, and rename your query results before\n                      they are visualized. <br />\n                      Many transforms are not suitable if you&apos;re using the Graph visualization, as it currently\n                      only supports time series data. <br />\n                      It can help to switch to the Table visualization to understand what a transformation is doing.{' '}\n                    </p>\n                    <a\n                      href={getDocsLink(DocsId.Transformations)}\n                      className=\"external-link\"\n                      target=\"_blank\"\n                      rel=\"noreferrer\"\n                    >\n                      Read more\n                    </a>\n                  </Alert>\n                );\n              }}\n            </LocalStorageValueProvider>\n          </Container>\n        )}\n        {showPicker ? (\n          <>\n            {config.featureToggles.transformationsRedesign && (\n              <>\n                {!noTransforms && (\n                  <Button\n                    variant=\"secondary\"\n                    fill=\"text\"\n                    icon=\"angle-left\"\n                    onClick={() => {\n                      this.setState({ showPicker: false });\n                    }}\n                  >\n                    Go back to&nbsp;<i>Transformations in use</i>\n                  </Button>\n                )}\n                <div className={styles.pickerInformationLine}>\n                  <a\n                    href={getDocsLink(DocsId.Transformations)}\n                    className=\"external-link\"\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    <span className={styles.pickerInformationLineHighlight}>Transformations</span>{' '}\n                    <Icon name=\"external-link-alt\" />\n                  </a>\n                  &nbsp;allow you to manipulate your data before a visualization is applied.\n                </div>\n              </>\n            )}\n            <VerticalGroup>\n              {!config.featureToggles.transformationsRedesign && (\n                <Input\n                  data-testid={selectors.components.Transforms.searchInput}\n                  value={search ?? ''}\n                  autoFocus={!noTransforms}\n                  placeholder=\"Search for transformation\"\n                  onChange={this.onSearchChange}\n                  onKeyDown={this.onSearchKeyDown}\n                  suffix={suffix}\n                />\n              )}\n\n              {!config.featureToggles.transformationsRedesign &&\n                xforms.map((t) => {\n                  return (\n                    <TransformationCard\n                      key={t.name}\n                      transform={t}\n                      onClick={() => {\n                        this.onTransformationAdd({ value: t.id });\n                      }}\n                    />\n                  );\n                })}\n\n              {config.featureToggles.transformationsRedesign && (\n                <div className={styles.searchWrapper}>\n                  <Input\n                    data-testid={selectors.components.Transforms.searchInput}\n                    className={styles.searchInput}\n                    value={search ?? ''}\n                    autoFocus={!noTransforms}\n                    placeholder=\"Search for transformation\"\n                    onChange={this.onSearchChange}\n                    onKeyDown={this.onSearchKeyDown}\n                    suffix={suffix}\n                  />\n                  <div className={styles.showImages}>\n                    <span className={styles.illustationSwitchLabel}>Show images</span>{' '}\n                    <Switch\n                      value={this.state.showIllustrations}\n                      onChange={() => this.setState({ showIllustrations: !this.state.showIllustrations })}\n                    />\n                  </div>\n                </div>\n              )}\n\n              {config.featureToggles.transformationsRedesign && (\n                <div className={styles.filterWrapper}>\n                  {filterCategoriesLabels.map(([slug, label]) => {\n                    return (\n                      <FilterPill\n                        key={slug}\n                        onClick={() => this.setState({ selectedFilter: slug })}\n                        label={label}\n                        selected={this.state.selectedFilter === slug}\n                      />\n                    );\n                  })}\n                </div>\n              )}\n\n              {config.featureToggles.transformationsRedesign && (\n                <TransformationsGrid\n                  showIllustrations={this.state.showIllustrations}\n                  transformations={xforms}\n                  data={this.state.data}\n                  onClick={(id) => {\n                    this.onTransformationAdd({ value: id });\n                  }}\n                />\n              )}\n            </VerticalGroup>\n          </>\n        ) : (\n          <Button\n            icon=\"plus\"\n            variant=\"secondary\"\n            onClick={() => {\n              this.setState({ showPicker: true });\n            }}\n            data-testid={selectors.components.Transforms.addTransformationButton}\n          >\n            Add{config.featureToggles.transformationsRedesign ? ' another ' : ' '}transformation\n          </Button>\n        )}\n      </>\n    );\n  }\n\n  render() {\n    const styles = getStyles(config.theme2);\n    const {\n      panel: { alert },\n    } = this.props;\n    const { transformations } = this.state;\n\n    const hasTransforms = transformations.length > 0;\n\n    if (!hasTransforms && alert) {\n      return <PanelNotSupported message=\"Transformations can't be used on a panel with existing alerts\" />;\n    }\n\n    return (\n      <CustomScrollbar scrollTop={this.state.scrollTop} autoHeightMin=\"100%\">\n        <Container padding=\"lg\">\n          <div data-testid={selectors.components.TransformTab.content}>\n            {hasTransforms && alert ? (\n              <Alert\n                severity={AppNotificationSeverity.Error}\n                title=\"Transformations can't be used on a panel with alerts\"\n              />\n            ) : null}\n            {hasTransforms && config.featureToggles.transformationsRedesign && !this.state.showPicker && (\n              <div className={styles.listInformationLineWrapper}>\n                <span className={styles.listInformationLineText}>Transformations in use</span>{' '}\n                <Button\n                  size=\"sm\"\n                  variant=\"secondary\"\n                  onClick={() => {\n                    this.setState({ showRemoveAllModal: true });\n                  }}\n                >\n                  Delete all transformations\n                </Button>\n                <ConfirmModal\n                  isOpen={Boolean(this.state.showRemoveAllModal)}\n                  title=\"Delete all transformations?\"\n                  body=\"By deleting all transformations, you will go back to the main selection screen.\"\n                  confirmText=\"Delete all\"\n                  onConfirm={() => this.onTransformationRemoveAll()}\n                  onDismiss={() => this.setState({ showRemoveAllModal: false })}\n                />\n              </div>\n            )}\n            {hasTransforms && this.renderTransformationEditors()}\n            {this.renderTransformsPicker()}\n          </div>\n        </Container>\n      </CustomScrollbar>\n    );\n  }\n}\n\ninterface TransformationCardProps {\n  transform: TransformerRegistryItem<any>;\n  onClick: () => void;\n}\n\nfunction TransformationCard({ transform, onClick }: TransformationCardProps) {\n  const styles = useStyles2(getStyles);\n  return (\n    <Card\n      className={styles.card}\n      data-testid={selectors.components.TransformTab.newTransform(transform.name)}\n      onClick={onClick}\n    >\n      <Card.Heading>{transform.name}</Card.Heading>\n      <Card.Description>{transform.description}</Card.Description>\n      {transform.state && (\n        <Card.Tags>\n          <PluginStateInfo state={transform.state} />\n        </Card.Tags>\n      )}\n    </Card>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    hide: css({\n      display: 'none',\n    }),\n    card: css({\n      margin: '0',\n      padding: `${theme.spacing(1)}`,\n    }),\n    grid: css({\n      display: 'grid',\n      gridTemplateColumns: 'repeat(auto-fill, minmax(220px, 1fr))',\n      gridAutoRows: '1fr',\n      gap: `${theme.spacing(2)} ${theme.spacing(1)}`,\n      width: '100%',\n    }),\n    newCard: css({\n      gridTemplateRows: 'min-content 0 1fr 0',\n    }),\n    cardDisabled: css({\n      backgroundColor: 'rgb(204, 204, 220, 0.045)',\n      color: `${theme.colors.text.disabled} !important`,\n    }),\n    heading: css`\n      font-weight: 400,\n      > button: {\n        width: '100%',\n        display: 'flex',\n        justify-content: 'space-between',\n        align-items: 'center',\n        flex-wrap: 'no-wrap',\n      },\n    `,\n    description: css({\n      fontSize: '12px',\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'space-between',\n    }),\n    image: css({\n      display: 'block',\n      maxEidth: '100%`',\n      marginTop: `${theme.spacing(2)}`,\n    }),\n    searchWrapper: css({\n      display: 'flex',\n      flexWrap: 'wrap',\n      columnGap: '27px',\n      rowGap: '16px',\n      width: '100%',\n    }),\n    searchInput: css({\n      flexGrow: '1',\n      width: 'initial',\n    }),\n    showImages: css({\n      flexBasis: '0',\n      display: 'flex',\n      gap: '8px',\n      alignItems: 'center',\n    }),\n    pickerInformationLine: css({\n      fontSize: '16px',\n      marginBottom: `${theme.spacing(2)}`,\n    }),\n    pickerInformationLineHighlight: css({\n      verticalAlign: 'middle',\n    }),\n    illustationSwitchLabel: css({\n      whiteSpace: 'nowrap',\n    }),\n    filterWrapper: css({\n      padding: `${theme.spacing(1)} 0`,\n      display: 'flex',\n      flexWrap: 'wrap',\n      rowGap: `${theme.spacing(1)}`,\n      columnGap: `${theme.spacing(0.5)}`,\n    }),\n    listInformationLineWrapper: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      marginBottom: '24px',\n    }),\n    listInformationLineText: css({\n      fontSize: '16px',\n    }),\n    pluginStateInfoWrapper: css({\n      marginLeft: '5px',\n    }),\n    cardApplicableInfo: css({\n      position: 'absolute',\n      bottom: `${theme.spacing(1)}`,\n      right: `${theme.spacing(1)}`,\n    }),\n  };\n};\n\ninterface TransformationsGridProps {\n  transformations: Array<TransformerRegistryItem<any>>;\n  showIllustrations?: boolean;\n  onClick: (id: string) => void;\n  data: DataFrame[];\n}\n\nfunction TransformationsGrid({ showIllustrations, transformations, onClick, data }: TransformationsGridProps) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.grid}>\n      {transformations.map((transform) => {\n        // Check to see if the transform\n        // is applicable to the given data\n        let applicabilityScore = TransformationApplicabilityLevels.Applicable;\n        if (transform.transformation.isApplicable !== undefined) {\n          applicabilityScore = transform.transformation.isApplicable(data);\n        }\n        const isApplicable = applicabilityScore > 0;\n\n        let applicabilityDescription = null;\n        if (transform.transformation.isApplicableDescription !== undefined) {\n          if (typeof transform.transformation.isApplicableDescription === 'function') {\n            applicabilityDescription = transform.transformation.isApplicableDescription(data);\n          } else {\n            applicabilityDescription = transform.transformation.isApplicableDescription;\n          }\n        }\n\n        // Add disabled styles to disabled\n        let cardClasses = styles.newCard;\n        if (!isApplicable) {\n          cardClasses = cx(styles.newCard, styles.cardDisabled);\n        }\n\n        return (\n          <Card\n            className={cardClasses}\n            data-testid={selectors.components.TransformTab.newTransform(transform.name)}\n            onClick={() => onClick(transform.id)}\n            key={transform.id}\n          >\n            <Card.Heading className={styles.heading}>\n              <>\n                <span>{transform.name}</span>\n                <span className={styles.pluginStateInfoWrapper}>\n                  <PluginStateInfo state={transform.state} />\n                </span>\n              </>\n            </Card.Heading>\n            <Card.Description className={styles.description}>\n              <>\n                <span>{getTransformationsRedesignDescriptions(transform.id)}</span>\n                {showIllustrations && (\n                  <span>\n                    <img\n                      className={styles.image}\n                      src={getImagePath(transform.id, !isApplicable)}\n                      alt={transform.name}\n                    />\n                  </span>\n                )}\n                {!isApplicable && applicabilityDescription !== null && (\n                  <IconButton\n                    className={styles.cardApplicableInfo}\n                    name=\"info-circle\"\n                    tooltip={applicabilityDescription}\n                  />\n                )}\n              </>\n            </Card.Description>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n\nconst getImagePath = (id: string, disabled: boolean) => {\n  let folder = null;\n  if (!disabled) {\n    folder = config.theme2.isDark ? 'dark' : 'light';\n  } else {\n    folder = 'disabled';\n  }\n\n  return `public/img/transformations/${folder}/${id}.svg`;\n};\n\nconst getTransformationsRedesignDescriptions = (id: string): string => {\n  const overrides: { [key: string]: string } = {\n    [DataTransformerID.concatenate]: 'Combine all fields into a single frame.',\n    [DataTransformerID.configFromData]: 'Set unit, min, max and more.',\n    [DataTransformerID.fieldLookup]: 'Use a field value to lookup countries, states, or airports.',\n    [DataTransformerID.filterFieldsByName]: 'Remove parts of the query results using a regex pattern.',\n    [DataTransformerID.filterByRefId]: 'Remove rows from the data based on origin query',\n    [DataTransformerID.filterByValue]: 'Remove rows from the query results using user-defined filters.',\n    [DataTransformerID.groupBy]: 'Group data by a field value and create aggregate data.',\n    [DataTransformerID.groupingToMatrix]: 'Summarize and reorganize data based on three fields.',\n    [DataTransformerID.joinByField]: 'Combine rows from 2+ tables, based on a related field.',\n    [DataTransformerID.labelsToFields]: 'Group series by time and return labels or tags as fields.',\n    [DataTransformerID.merge]: 'Merge multiple series. Values will be combined into one row.',\n    [DataTransformerID.organize]: 'Re-order, hide, or rename fields.',\n    [DataTransformerID.partitionByValues]: 'Split a one-frame dataset into multiple series.',\n    [DataTransformerID.prepareTimeSeries]: 'Stretch data frames from the wide format into the long format.',\n    [DataTransformerID.reduce]: 'Reduce all rows or data points to a single value (ex. max, mean).',\n    [DataTransformerID.renameByRegex]:\n      'Rename parts of the query results using a regular expression and replacement pattern.',\n    [DataTransformerID.seriesToRows]: 'Merge multiple series. Return time, metric and values as a row.',\n  };\n\n  return overrides[id] || standardTransformersRegistry.getIfExists(id)?.description || '';\n};\n\nexport const TransformationsEditor = withTheme(UnThemedTransformationsEditor);\n","import React, { PureComponent } from 'react';\n\nimport { DataQuery, getDataSourceRef } from '@grafana/data';\nimport { locationService } from '@grafana/runtime';\nimport { getDatasourceSrv } from 'app/features/plugins/datasource_srv';\nimport { QueryGroup } from 'app/features/query/components/QueryGroup';\nimport { MIXED_DATASOURCE_NAME } from 'app/plugins/datasource/mixed/MixedDataSource';\nimport { QueryGroupDataSource, QueryGroupOptions } from 'app/types';\n\nimport { getDashboardSrv } from '../../services/DashboardSrv';\nimport { PanelModel } from '../../state';\nimport {\n  getLastUsedDatasourceFromStorage,\n  initLastUsedDatasourceKeyForDashboard,\n  setLastUsedDatasourceKeyForDashboard,\n} from '../../utils/dashboard';\n\ninterface Props {\n  /** Current panel */\n  panel: PanelModel;\n  /** Added here to make component re-render when queries change from outside */\n  queries: DataQuery[];\n}\n\nexport class PanelEditorQueries extends PureComponent<Props> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  // store last used datasource in local storage\n  updateLastUsedDatasource = (datasource: QueryGroupDataSource) => {\n    if (!datasource.uid) {\n      return;\n    }\n\n    const dashboardUid = getDashboardSrv().getCurrent()?.uid ?? '';\n    // if datasource is MIXED reset datasource uid in storage, because Mixed datasource can contain multiple ds\n    if (datasource.uid === MIXED_DATASOURCE_NAME) {\n      return initLastUsedDatasourceKeyForDashboard(dashboardUid!);\n    }\n    setLastUsedDatasourceKeyForDashboard(dashboardUid, datasource.uid);\n  };\n\n  buildQueryOptions(panel: PanelModel): QueryGroupOptions {\n    const dataSource: QueryGroupDataSource = panel.datasource ?? {\n      default: true,\n    };\n    const datasourceSettings = getDatasourceSrv().getInstanceSettings(dataSource);\n\n    // store last datasource used in local storage\n    this.updateLastUsedDatasource(dataSource);\n    return {\n      cacheTimeout: datasourceSettings?.meta.queryOptions?.cacheTimeout ? panel.cacheTimeout : undefined,\n      dataSource: {\n        default: datasourceSettings?.isDefault,\n        type: datasourceSettings?.type,\n        uid: datasourceSettings?.uid,\n      },\n      queryCachingTTL: datasourceSettings?.cachingConfig?.enabled ? panel.queryCachingTTL : undefined,\n      queries: panel.targets,\n      maxDataPoints: panel.maxDataPoints,\n      minInterval: panel.interval,\n      timeRange: {\n        from: panel.timeFrom,\n        shift: panel.timeShift,\n        hide: panel.hideTimeOverride,\n      },\n    };\n  }\n\n  async componentDidMount() {\n    const { panel } = this.props;\n\n    // If the panel model has no datasource property load the default data source property and update the persisted model\n    // Because this part of the panel model is not in redux yet we do a forceUpdate.\n    if (!panel.datasource) {\n      let ds;\n      // check if we have last used datasource from local storage\n      // get dashboard uid\n      const dashboardUid = getDashboardSrv().getCurrent()?.uid ?? '';\n      const lastUsedDatasource = getLastUsedDatasourceFromStorage(dashboardUid!);\n      // do we have a last used datasource for this dashboard\n      if (lastUsedDatasource?.datasourceUid !== null) {\n        // get datasource from uid\n        ds = getDatasourceSrv().getInstanceSettings(lastUsedDatasource?.datasourceUid);\n      }\n      // else load default datasource\n      if (!ds) {\n        ds = getDatasourceSrv().getInstanceSettings(null);\n      }\n      panel.datasource = getDataSourceRef(ds!);\n      this.forceUpdate();\n    }\n  }\n\n  onRunQueries = () => {\n    this.props.panel.refresh();\n  };\n\n  onOpenQueryInspector = () => {\n    locationService.partial({\n      inspect: this.props.panel.id,\n      inspectTab: 'query',\n    });\n  };\n\n  onOptionsChange = (options: QueryGroupOptions) => {\n    const { panel } = this.props;\n\n    panel.updateQueries(options);\n\n    if (options.dataSource.uid !== panel.datasource?.uid) {\n      // trigger queries when changing data source\n      setTimeout(this.onRunQueries, 10);\n    }\n\n    this.forceUpdate();\n  };\n\n  render() {\n    const { panel } = this.props;\n\n    // If no panel data soruce set, wait with render. Will be set to default in componentDidMount\n    if (!panel.datasource) {\n      return null;\n    }\n\n    const options = this.buildQueryOptions(panel);\n\n    return (\n      <QueryGroup\n        options={options}\n        queryRunner={panel.getQueryRunner()}\n        onRunQueries={this.onRunQueries}\n        onOpenQueryInspector={this.onOpenQueryInspector}\n        onOptionsChange={this.onOptionsChange}\n      />\n    );\n  }\n}\n","import { css } from '@emotion/css';\nimport React, { useEffect, useCallback } from 'react';\nimport { Subscription } from 'rxjs';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\nimport { Tab, TabContent, TabsBar, toIconName, useForceUpdate, useStyles2 } from '@grafana/ui';\nimport AlertTabIndex from 'app/features/alerting/AlertTabIndex';\nimport { PanelAlertTab } from 'app/features/alerting/unified/PanelAlertTab';\nimport { PanelQueriesChangedEvent, PanelTransformationsChangedEvent } from 'app/types/events';\n\nimport { DashboardModel, PanelModel } from '../../state';\nimport { TransformationsEditor } from '../TransformationsEditor/TransformationsEditor';\n\nimport { PanelEditorQueries } from './PanelEditorQueries';\nimport { PanelEditorTab, PanelEditorTabId } from './types';\n\ninterface PanelEditorTabsProps {\n  panel: PanelModel;\n  dashboard: DashboardModel;\n  tabs: PanelEditorTab[];\n  onChangeTab: (tab: PanelEditorTab) => void;\n}\n\nexport const PanelEditorTabs = React.memo(({ panel, dashboard, tabs, onChangeTab }: PanelEditorTabsProps) => {\n  const forceUpdate = useForceUpdate();\n  const styles = useStyles2(getStyles);\n\n  const instrumentedOnChangeTab = useCallback(\n    (tab: PanelEditorTab) => {\n      let eventName = 'panel_editor_tabs_changed';\n      if (config.featureToggles.transformationsRedesign) {\n        eventName = 'transformations_redesign_' + eventName;\n      }\n\n      if (!tab.active) {\n        reportInteraction(eventName, { tab_id: tab.id });\n      }\n\n      onChangeTab(tab);\n    },\n    [onChangeTab]\n  );\n\n  useEffect(() => {\n    const eventSubs = new Subscription();\n    eventSubs.add(panel.events.subscribe(PanelQueriesChangedEvent, forceUpdate));\n    eventSubs.add(panel.events.subscribe(PanelTransformationsChangedEvent, forceUpdate));\n    return () => eventSubs.unsubscribe();\n  }, [panel, dashboard, forceUpdate]);\n\n  const activeTab = tabs.find((item) => item.active)!;\n\n  if (tabs.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={styles.wrapper}>\n      <TabsBar className={styles.tabBar} hideBorder>\n        {tabs.map((tab) => {\n          if (tab.id === PanelEditorTabId.Alert) {\n            return renderAlertTab(tab, panel, dashboard, instrumentedOnChangeTab);\n          }\n          return (\n            <Tab\n              key={tab.id}\n              label={tab.text}\n              active={tab.active}\n              onChangeTab={() => instrumentedOnChangeTab(tab)}\n              icon={toIconName(tab.icon)}\n              counter={getCounter(panel, tab)}\n            />\n          );\n        })}\n      </TabsBar>\n      <TabContent className={styles.tabContent}>\n        {activeTab.id === PanelEditorTabId.Query && <PanelEditorQueries panel={panel} queries={panel.targets} />}\n        {activeTab.id === PanelEditorTabId.Alert && <AlertTabIndex panel={panel} dashboard={dashboard} />}\n        {activeTab.id === PanelEditorTabId.Transform && <TransformationsEditor panel={panel} />}\n      </TabContent>\n    </div>\n  );\n});\n\nPanelEditorTabs.displayName = 'PanelEditorTabs';\n\nfunction getCounter(panel: PanelModel, tab: PanelEditorTab) {\n  switch (tab.id) {\n    case PanelEditorTabId.Query:\n      return panel.targets.length;\n    case PanelEditorTabId.Alert:\n      return panel.alert ? 1 : 0;\n    case PanelEditorTabId.Transform:\n      const transformations = panel.getTransformations() ?? [];\n      return transformations.length;\n  }\n\n  return null;\n}\n\nfunction renderAlertTab(\n  tab: PanelEditorTab,\n  panel: PanelModel,\n  dashboard: DashboardModel,\n  onChangeTab: (tab: PanelEditorTab) => void\n) {\n  const alertingDisabled = !config.alertingEnabled && !config.unifiedAlertingEnabled;\n\n  if (alertingDisabled) {\n    return null;\n  }\n\n  if (config.unifiedAlertingEnabled) {\n    return (\n      <PanelAlertTab\n        key={tab.id}\n        label={tab.text}\n        active={tab.active}\n        onChangeTab={() => onChangeTab(tab)}\n        icon={toIconName(tab.icon)}\n        panel={panel}\n        dashboard={dashboard}\n      />\n    );\n  }\n\n  if (config.alertingEnabled) {\n    return (\n      <Tab\n        key={tab.id}\n        label={tab.text}\n        active={tab.active}\n        onChangeTab={() => onChangeTab(tab)}\n        icon={toIconName(tab.icon)}\n        counter={getCounter(panel, tab)}\n      />\n    );\n  }\n\n  return null;\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    wrapper: css`\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n    `,\n    tabBar: css`\n      padding-left: ${theme.spacing(2)};\n    `,\n    tabContent: css`\n      padding: 0;\n      display: flex;\n      flex-direction: column;\n      flex: 1;\n      min-height: 0;\n      background: ${theme.colors.background.primary};\n      border: 1px solid ${theme.components.panel.borderColor};\n      border-left: none;\n      border-bottom: none;\n      border-top-right-radius: ${theme.shape.borderRadius(1.5)};\n    `,\n  };\n};\n","import memoizeOne from 'memoize-one';\n\nimport { PanelPlugin } from '@grafana/data';\nimport { getConfig } from 'app/core/config';\nimport { contextSrv } from 'app/core/services/context_srv';\nimport { getRulesPermissions } from 'app/features/alerting/unified/utils/access-control';\nimport { GRAFANA_RULES_SOURCE_NAME } from 'app/features/alerting/unified/utils/datasource';\n\nimport { PanelEditorTab, PanelEditorTabId } from '../types';\n\nexport const getPanelEditorTabs = memoizeOne((tab?: string, plugin?: PanelPlugin) => {\n  const tabs: PanelEditorTab[] = [];\n\n  if (!plugin) {\n    return tabs;\n  }\n\n  let defaultTab = PanelEditorTabId.Visualize;\n\n  if (plugin.meta.skipDataQuery) {\n    return [];\n  }\n\n  if (!plugin.meta.skipDataQuery) {\n    defaultTab = PanelEditorTabId.Query;\n\n    tabs.push({\n      id: PanelEditorTabId.Query,\n      text: 'Query',\n      icon: 'database',\n      active: false,\n    });\n\n    tabs.push({\n      id: PanelEditorTabId.Transform,\n      text: 'Transform data',\n      icon: 'process',\n      active: false,\n    });\n  }\n\n  const { alertingEnabled, unifiedAlertingEnabled } = getConfig();\n  const hasRuleReadPermissions = contextSrv.hasPermission(getRulesPermissions(GRAFANA_RULES_SOURCE_NAME).read);\n  const isAlertingAvailable = alertingEnabled || (unifiedAlertingEnabled && hasRuleReadPermissions);\n\n  const isGraph = plugin.meta.id === 'graph';\n  const isTimeseries = plugin.meta.id === 'timeseries';\n\n  if ((isAlertingAvailable && isGraph) || isTimeseries) {\n    tabs.push({\n      id: PanelEditorTabId.Alert,\n      text: 'Alert',\n      icon: 'bell',\n      active: false,\n    });\n  }\n\n  const activeTab = tabs.find((item) => item.id === (tab || defaultTab)) ?? tabs[0];\n  activeTab.active = true;\n\n  return tabs;\n});\n","import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\nimport AutoSizer from 'react-virtualized-auto-sizer';\nimport { Subscription } from 'rxjs';\n\nimport { FieldConfigSource, GrafanaTheme2, NavModel, NavModelItem, PageLayoutType } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Stack } from '@grafana/experimental';\nimport { locationService } from '@grafana/runtime';\nimport {\n  Button,\n  HorizontalGroup,\n  InlineSwitch,\n  ModalsController,\n  RadioButtonGroup,\n  stylesFactory,\n  Themeable2,\n  ToolbarButton,\n  ToolbarButtonRow,\n  withTheme2,\n} from '@grafana/ui';\nimport { AppChromeUpdate } from 'app/core/components/AppChrome/AppChromeUpdate';\nimport { Page } from 'app/core/components/Page/Page';\nimport { SplitPaneWrapper } from 'app/core/components/SplitPaneWrapper/SplitPaneWrapper';\nimport { appEvents } from 'app/core/core';\nimport { SubMenuItems } from 'app/features/dashboard/components/SubMenu/SubMenuItems';\nimport { SaveLibraryPanelModal } from 'app/features/library-panels/components/SaveLibraryPanelModal/SaveLibraryPanelModal';\nimport { PanelModelWithLibraryPanel } from 'app/features/library-panels/types';\nimport { getPanelStateForModel } from 'app/features/panel/state/selectors';\nimport { updateTimeZoneForSession } from 'app/features/profile/state/reducers';\nimport { StoreState } from 'app/types';\nimport { PanelOptionsChangedEvent, ShowModalReactEvent } from 'app/types/events';\n\nimport { notifyApp } from '../../../../core/actions';\nimport { UnlinkModal } from '../../../library-panels/components/UnlinkModal/UnlinkModal';\nimport { isPanelModelLibraryPanel } from '../../../library-panels/guard';\nimport { getVariablesByKey } from '../../../variables/state/selectors';\nimport { DashboardPanel } from '../../dashgrid/DashboardPanel';\nimport { DashboardModel, PanelModel } from '../../state';\nimport { DashNavTimeControls } from '../DashNav/DashNavTimeControls';\nimport { SaveDashboardDrawer } from '../SaveDashboard/SaveDashboardDrawer';\n\nimport { OptionsPane } from './OptionsPane';\nimport { PanelEditorTableView } from './PanelEditorTableView';\nimport { PanelEditorTabs } from './PanelEditorTabs';\nimport { VisualizationButton } from './VisualizationButton';\nimport { discardPanelChanges, initPanelEditor, updatePanelEditorUIState } from './state/actions';\nimport { PanelEditorUIState, toggleTableView } from './state/reducers';\nimport { getPanelEditorTabs } from './state/selectors';\nimport { DisplayMode, displayModes, PanelEditorTab } from './types';\nimport { calculatePanelSize } from './utils';\n\ninterface OwnProps {\n  dashboard: DashboardModel;\n  sourcePanel: PanelModel;\n  sectionNav: NavModel;\n  pageNav: NavModelItem;\n  className?: string;\n  tab?: string;\n}\n\nconst mapStateToProps = (state: StoreState, ownProps: OwnProps) => {\n  const panel = state.panelEditor.getPanel();\n  const panelState = getPanelStateForModel(state, panel);\n\n  return {\n    panel,\n    plugin: panelState?.plugin,\n    instanceState: panelState?.instanceState,\n    initDone: state.panelEditor.initDone,\n    uiState: state.panelEditor.ui,\n    tableViewEnabled: state.panelEditor.tableViewEnabled,\n    variables: getVariablesByKey(ownProps.dashboard.uid, state),\n  };\n};\n\nconst mapDispatchToProps = {\n  initPanelEditor,\n  discardPanelChanges,\n  updatePanelEditorUIState,\n  updateTimeZoneForSession,\n  toggleTableView,\n  notifyApp,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\ntype Props = OwnProps & ConnectedProps<typeof connector> & Themeable2;\n\ninterface State {\n  showSaveLibraryPanelModal?: boolean;\n}\n\nexport class PanelEditorUnconnected extends PureComponent<Props> {\n  private eventSubs?: Subscription;\n\n  state: State = {\n    showSaveLibraryPanelModal: false,\n  };\n\n  componentDidMount() {\n    this.props.initPanelEditor(this.props.sourcePanel, this.props.dashboard);\n  }\n\n  componentDidUpdate() {\n    const { panel, initDone } = this.props;\n\n    if (initDone && !this.eventSubs) {\n      this.eventSubs = new Subscription();\n      this.eventSubs.add(panel.events.subscribe(PanelOptionsChangedEvent, this.triggerForceUpdate));\n    }\n  }\n\n  componentWillUnmount() {\n    // redux action exitPanelEditor is called on location change from DashboardPrompt\n    this.eventSubs?.unsubscribe();\n  }\n\n  triggerForceUpdate = () => {\n    this.forceUpdate();\n  };\n\n  onBack = () => {\n    locationService.partial({\n      editPanel: null,\n      tab: null,\n      showCategory: null,\n    });\n  };\n\n  onDiscard = () => {\n    this.props.discardPanelChanges();\n    this.onBack();\n  };\n\n  onSaveDashboard = () => {\n    appEvents.publish(\n      new ShowModalReactEvent({\n        component: SaveDashboardDrawer,\n        props: { dashboard: this.props.dashboard },\n      })\n    );\n  };\n\n  onSaveLibraryPanel = async () => {\n    if (!isPanelModelLibraryPanel(this.props.panel)) {\n      // New library panel, no need to display modal\n      return;\n    }\n\n    this.setState({ showSaveLibraryPanelModal: true });\n  };\n\n  onChangeTab = (tab: PanelEditorTab) => {\n    locationService.partial({\n      tab: tab.id,\n    });\n  };\n\n  onFieldConfigChange = (config: FieldConfigSource) => {\n    // we do not need to trigger force update here as the function call below\n    // fires PanelOptionsChangedEvent which we subscribe to above\n    this.props.panel.updateFieldConfig({\n      ...config,\n    });\n  };\n\n  onPanelOptionsChanged = (options: PanelModel['options']) => {\n    // we do not need to trigger force update here as the function call below\n    // fires PanelOptionsChangedEvent which we subscribe to above\n    this.props.panel.updateOptions(options);\n  };\n\n  onPanelConfigChanged = (configKey: keyof PanelModel, value: unknown) => {\n    this.props.panel.setProperty(configKey, value);\n    this.props.panel.render();\n    this.forceUpdate();\n  };\n\n  onDisplayModeChange = (mode?: DisplayMode) => {\n    const { updatePanelEditorUIState } = this.props;\n    if (this.props.tableViewEnabled) {\n      this.props.toggleTableView();\n    }\n    updatePanelEditorUIState({\n      mode: mode,\n    });\n  };\n\n  onToggleTableView = () => {\n    this.props.toggleTableView();\n  };\n\n  renderPanel(styles: EditorStyles, isOnlyPanel: boolean) {\n    const { dashboard, panel, uiState, tableViewEnabled, theme } = this.props;\n\n    return (\n      <div className={styles.mainPaneWrapper} key=\"panel\">\n        {this.renderPanelToolbar(styles)}\n        <div className={styles.panelWrapper}>\n          <AutoSizer>\n            {({ width, height }) => {\n              if (width < 3 || height < 3) {\n                return null;\n              }\n\n              // If no tabs limit height so panel does not extend to edge\n              if (isOnlyPanel) {\n                height -= theme.spacing.gridSize * 2;\n              }\n\n              if (tableViewEnabled) {\n                return <PanelEditorTableView width={width} height={height} panel={panel} dashboard={dashboard} />;\n              }\n\n              const panelSize = calculatePanelSize(uiState.mode, width, height, panel);\n\n              return (\n                <div className={styles.centeringContainer} style={{ width, height }}>\n                  <div style={panelSize} data-panelid={panel.id}>\n                    <DashboardPanel\n                      key={panel.key}\n                      stateKey={panel.key}\n                      dashboard={dashboard}\n                      panel={panel}\n                      isEditing={true}\n                      isViewing={false}\n                      lazy={false}\n                      width={panelSize.width}\n                      height={panelSize.height}\n                    />\n                  </div>\n                </div>\n              );\n            }}\n          </AutoSizer>\n        </div>\n      </div>\n    );\n  }\n\n  renderPanelAndEditor(uiState: PanelEditorUIState, styles: EditorStyles) {\n    const { panel, dashboard, plugin, tab } = this.props;\n    const tabs = getPanelEditorTabs(tab, plugin);\n    const isOnlyPanel = tabs.length === 0;\n    const panelPane = this.renderPanel(styles, isOnlyPanel);\n\n    if (tabs.length === 0) {\n      return <div className={styles.onlyPanel}>{panelPane}</div>;\n    }\n\n    return (\n      <SplitPaneWrapper\n        splitOrientation=\"horizontal\"\n        maxSize={-200}\n        paneSize={uiState.topPaneSize}\n        primary=\"first\"\n        secondaryPaneStyle={{ minHeight: 0 }}\n        onDragFinished={(size) => {\n          if (size) {\n            updatePanelEditorUIState({ topPaneSize: size / window.innerHeight });\n          }\n        }}\n      >\n        {panelPane}\n        <div\n          className={styles.tabsWrapper}\n          aria-label={selectors.components.PanelEditor.DataPane.content}\n          key=\"panel-editor-tabs\"\n        >\n          <PanelEditorTabs\n            key={panel.key}\n            panel={panel}\n            dashboard={dashboard}\n            tabs={tabs}\n            onChangeTab={this.onChangeTab}\n          />\n        </div>\n      </SplitPaneWrapper>\n    );\n  }\n\n  renderTemplateVariables(styles: EditorStyles) {\n    const { variables } = this.props;\n\n    if (!variables.length) {\n      return null;\n    }\n\n    return (\n      <div className={styles.variablesWrapper}>\n        <SubMenuItems variables={variables} />\n      </div>\n    );\n  }\n\n  renderPanelToolbar(styles: EditorStyles) {\n    const { dashboard, uiState, variables, updateTimeZoneForSession, panel, tableViewEnabled } = this.props;\n\n    return (\n      <div className={styles.panelToolbar}>\n        <HorizontalGroup justify={variables.length > 0 ? 'space-between' : 'flex-end'} align=\"flex-start\">\n          {this.renderTemplateVariables(styles)}\n          <Stack gap={1}>\n            <InlineSwitch\n              label=\"Table view\"\n              showLabel={true}\n              id=\"table-view\"\n              value={tableViewEnabled}\n              onClick={this.onToggleTableView}\n              aria-label={selectors.components.PanelEditor.toggleTableView}\n            />\n            <RadioButtonGroup value={uiState.mode} options={displayModes} onChange={this.onDisplayModeChange} />\n            <DashNavTimeControls dashboard={dashboard} onChangeTimeZone={updateTimeZoneForSession} isOnCanvas={true} />\n            {!uiState.isPanelOptionsVisible && <VisualizationButton panel={panel} />}\n          </Stack>\n        </HorizontalGroup>\n      </div>\n    );\n  }\n\n  renderEditorActions() {\n    const size = 'sm';\n    let editorActions = [\n      <Button\n        onClick={this.onDiscard}\n        title=\"Undo all changes\"\n        key=\"discard\"\n        size={size}\n        variant=\"destructive\"\n        fill=\"outline\"\n      >\n        Discard\n      </Button>,\n      this.props.panel.libraryPanel ? (\n        <Button\n          onClick={this.onSaveLibraryPanel}\n          variant=\"primary\"\n          size={size}\n          title=\"Apply changes and save library panel\"\n          key=\"save-panel\"\n        >\n          Save library panel\n        </Button>\n      ) : (\n        <Button\n          onClick={this.onSaveDashboard}\n          title=\"Apply changes and save dashboard\"\n          key=\"save\"\n          size={size}\n          variant=\"secondary\"\n        >\n          Save\n        </Button>\n      ),\n      <Button\n        onClick={this.onBack}\n        variant=\"primary\"\n        title=\"Apply changes and go back to dashboard\"\n        data-testid={selectors.components.PanelEditor.applyButton}\n        key=\"apply\"\n        size={size}\n      >\n        Apply\n      </Button>,\n    ];\n\n    if (this.props.panel.libraryPanel) {\n      editorActions.splice(\n        1,\n        0,\n        <ModalsController key=\"unlink-controller\">\n          {({ showModal, hideModal }) => {\n            return (\n              <ToolbarButton\n                onClick={() => {\n                  showModal(UnlinkModal, {\n                    onConfirm: () => {\n                      this.props.panel.unlinkLibraryPanel();\n                      this.forceUpdate();\n                    },\n                    onDismiss: hideModal,\n                    isOpen: true,\n                  });\n                }}\n                title=\"Disconnects this panel from the library panel so that you can edit it regularly.\"\n                key=\"unlink\"\n              >\n                Unlink\n              </ToolbarButton>\n            );\n          }}\n        </ModalsController>\n      );\n\n      // Remove \"Apply\" button\n      editorActions.pop();\n    }\n\n    return editorActions;\n  }\n\n  renderOptionsPane() {\n    const { plugin, dashboard, panel, instanceState } = this.props;\n\n    if (!plugin) {\n      return <div />;\n    }\n\n    return (\n      <OptionsPane\n        plugin={plugin}\n        dashboard={dashboard}\n        panel={panel}\n        instanceState={instanceState}\n        onFieldConfigsChange={this.onFieldConfigChange}\n        onPanelOptionsChanged={this.onPanelOptionsChanged}\n        onPanelConfigChange={this.onPanelConfigChanged}\n      />\n    );\n  }\n\n  onGoBackToDashboard = () => {\n    locationService.partial({ editPanel: null, tab: null, showCategory: null });\n  };\n\n  onConfirmAndDismissLibarayPanelModel = () => {\n    this.setState({ showSaveLibraryPanelModal: false });\n  };\n\n  render() {\n    const { initDone, uiState, theme, sectionNav, pageNav, className, updatePanelEditorUIState } = this.props;\n    const styles = getStyles(theme, this.props);\n\n    if (!initDone) {\n      return null;\n    }\n\n    return (\n      <Page\n        navModel={sectionNav}\n        pageNav={pageNav}\n        aria-label={selectors.components.PanelEditor.General.content}\n        layout={PageLayoutType.Custom}\n        className={className}\n      >\n        <AppChromeUpdate\n          actions={<ToolbarButtonRow alignment=\"right\">{this.renderEditorActions()}</ToolbarButtonRow>}\n        />\n        <div className={styles.wrapper}>\n          <div className={styles.verticalSplitPanesWrapper}>\n            {!uiState.isPanelOptionsVisible ? (\n              this.renderPanelAndEditor(uiState, styles)\n            ) : (\n              <SplitPaneWrapper\n                splitOrientation=\"vertical\"\n                maxSize={-300}\n                paneSize={uiState.rightPaneSize}\n                primary=\"second\"\n                onDragFinished={(size) => {\n                  if (size) {\n                    updatePanelEditorUIState({ rightPaneSize: size / window.innerWidth });\n                  }\n                }}\n              >\n                {this.renderPanelAndEditor(uiState, styles)}\n                {this.renderOptionsPane()}\n              </SplitPaneWrapper>\n            )}\n          </div>\n          {this.state.showSaveLibraryPanelModal && (\n            <SaveLibraryPanelModal\n              panel={this.props.panel as PanelModelWithLibraryPanel}\n              folderUid={this.props.dashboard.meta.folderUid ?? ''}\n              onConfirm={this.onConfirmAndDismissLibarayPanelModel}\n              onDiscard={this.onDiscard}\n              onDismiss={this.onConfirmAndDismissLibarayPanelModel}\n            />\n          )}\n        </div>\n      </Page>\n    );\n  }\n}\n\nexport const PanelEditor = withTheme2(connector(PanelEditorUnconnected));\n\n/*\n * Styles\n */\nexport const getStyles = stylesFactory((theme: GrafanaTheme2, props: Props) => {\n  const { uiState } = props;\n  const paneSpacing = theme.spacing(2);\n\n  return {\n    wrapper: css({\n      width: '100%',\n      flexGrow: 1,\n      minHeight: 0,\n      display: 'flex',\n      paddingTop: theme.spacing(2),\n    }),\n    verticalSplitPanesWrapper: css`\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      width: 100%;\n      position: relative;\n    `,\n    mainPaneWrapper: css`\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      width: 100%;\n      padding-right: ${uiState.isPanelOptionsVisible ? 0 : paneSpacing};\n    `,\n    variablesWrapper: css`\n      label: variablesWrapper;\n      display: flex;\n      flex-grow: 1;\n      flex-wrap: wrap;\n      gap: ${theme.spacing(1, 2)};\n    `,\n    panelWrapper: css`\n      flex: 1 1 0;\n      min-height: 0;\n      width: 100%;\n      padding-left: ${paneSpacing};\n    `,\n    tabsWrapper: css`\n      height: 100%;\n      width: 100%;\n    `,\n    panelToolbar: css`\n      display: flex;\n      padding: 0 0 ${paneSpacing} ${paneSpacing};\n      justify-content: space-between;\n      flex-wrap: wrap;\n    `,\n    angularWarning: css`\n      display: flex;\n      height: theme.spacing(4);\n      align-items: center;\n    `,\n    toolbarLeft: css`\n      padding-left: ${theme.spacing(1)};\n    `,\n    centeringContainer: css`\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      position: relative;\n      flex-direction: column;\n    `,\n    onlyPanel: css`\n      height: 100%;\n      position: absolute;\n      overflow: hidden;\n      width: 100%;\n    `,\n  };\n});\n\ntype EditorStyles = ReturnType<typeof getStyles>;\n","import { css } from '@emotion/css';\nimport React, { useEffect, useState } from 'react';\n\nimport { AnnotationQuery, EventBus, GrafanaTheme2 } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { InlineField, InlineFieldRow, InlineSwitch, useStyles2 } from '@grafana/ui';\nimport { LoadingIndicator } from '@grafana/ui/src/components/PanelChrome/LoadingIndicator';\n\nimport { AnnotationQueryFinished, AnnotationQueryStarted } from '../../../../types/events';\nimport { getDashboardQueryRunner } from '../../../query/state/DashboardQueryRunner/DashboardQueryRunner';\n\nexport interface AnnotationPickerProps {\n  events: EventBus;\n  annotation: AnnotationQuery;\n  onEnabledChanged: (annotation: AnnotationQuery) => void;\n}\n\nexport const AnnotationPicker = ({ annotation, events, onEnabledChanged }: AnnotationPickerProps): JSX.Element => {\n  const [loading, setLoading] = useState(false);\n  const styles = useStyles2(getStyles);\n  const onCancel = () => getDashboardQueryRunner().cancel(annotation);\n\n  useEffect(() => {\n    const started = events.getStream(AnnotationQueryStarted).subscribe({\n      next: (event) => {\n        if (event.payload === annotation) {\n          setLoading(true);\n        }\n      },\n    });\n    const stopped = events.getStream(AnnotationQueryFinished).subscribe({\n      next: (event) => {\n        if (event.payload === annotation) {\n          setLoading(false);\n        }\n      },\n    });\n\n    return () => {\n      started.unsubscribe();\n      stopped.unsubscribe();\n    };\n  });\n\n  return (\n    <div key={annotation.name} className={styles.annotation}>\n      <InlineFieldRow>\n        <InlineField\n          label={annotation.name}\n          disabled={loading}\n          data-testid={selectors.pages.Dashboard.SubMenu.Annotations.annotationLabel(annotation.name)}\n        >\n          <InlineSwitch\n            label={annotation.name}\n            value={annotation.enable}\n            onChange={() => onEnabledChanged(annotation)}\n            disabled={loading}\n            data-testid={selectors.pages.Dashboard.SubMenu.Annotations.annotationToggle(annotation.name)}\n          />\n        </InlineField>\n        <div className={styles.indicator}>\n          <LoadingIndicator loading={loading} onCancel={onCancel} />\n        </div>\n      </InlineFieldRow>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    annotation: css`\n      display: inline-block;\n      margin-right: ${theme.spacing(1)};\n\n      .fa-caret-down {\n        font-size: 75%;\n        padding-left: ${theme.spacing(1)};\n      }\n\n      .gf-form-inline .gf-form {\n        margin-bottom: 0;\n      }\n    `,\n    indicator: css`\n      align-self: center;\n      padding: 0 ${theme.spacing(0.5)};\n    `,\n  };\n}\n","import React, { useEffect, useState } from 'react';\n\nimport { AnnotationQuery, DataQuery, EventBus } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\n\nimport { AnnotationPicker } from './AnnotationPicker';\n\ninterface Props {\n  events: EventBus;\n  annotations: AnnotationQuery[];\n  onAnnotationChanged: (annotation: AnnotationQuery<DataQuery>) => void;\n}\n\nexport const Annotations = ({ annotations, onAnnotationChanged, events }: Props) => {\n  const [visibleAnnotations, setVisibleAnnotations] = useState<AnnotationQuery[]>([]);\n  useEffect(() => {\n    setVisibleAnnotations(annotations.filter((annotation) => annotation.hide !== true));\n  }, [annotations]);\n\n  if (visibleAnnotations.length === 0) {\n    return null;\n  }\n\n  return (\n    <div data-testid={selectors.pages.Dashboard.SubMenu.Annotations.annotationsWrapper}>\n      {visibleAnnotations.map((annotation) => (\n        <AnnotationPicker\n          events={events}\n          annotation={annotation}\n          onEnabledChanged={onAnnotationChanged}\n          key={annotation.name}\n        />\n      ))}\n    </div>\n  );\n};\n","import { css, cx } from '@emotion/css';\nimport React, { useRef, useState, useLayoutEffect } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { GrafanaTheme2 } from '@grafana/data';\nimport { sanitize, sanitizeUrl } from '@grafana/data/src/text/sanitize';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { Icon, ToolbarButton, Tooltip, useStyles2 } from '@grafana/ui';\nimport { getBackendSrv } from 'app/core/services/backend_srv';\nimport { DashboardSearchItem } from 'app/features/search/types';\n\nimport { getLinkSrv } from '../../../panel/panellinks/link_srv';\nimport { DashboardLink } from '../../state/DashboardModel';\n\ninterface Props {\n  link: DashboardLink;\n  linkInfo: { title: string; href: string };\n  dashboardUID: string;\n}\n\nexport const DashboardLinksDashboard = (props: Props) => {\n  const { link, linkInfo } = props;\n  const listRef = useRef<HTMLUListElement>(null);\n  const [dropdownCssClass, setDropdownCssClass] = useState('invisible');\n  const [opened, setOpened] = useState(0);\n  const resolvedLinks = useResolvedLinks(props, opened);\n  const styles = useStyles2(getStyles);\n\n  useLayoutEffect(() => {\n    setDropdownCssClass(getDropdownLocationCssClass(listRef.current));\n  }, [resolvedLinks]);\n\n  if (link.asDropdown) {\n    return (\n      <LinkElement link={link} key=\"dashlinks-dropdown\" data-testid={selectors.components.DashboardLinks.dropDown}>\n        <>\n          <ToolbarButton\n            onClick={() => setOpened(Date.now())}\n            className={cx('gf-form-label gf-form-label--dashlink', styles.button)}\n            data-placement=\"bottom\"\n            data-toggle=\"dropdown\"\n            aria-expanded={!!opened}\n            aria-controls=\"dropdown-list\"\n            aria-haspopup=\"menu\"\n          >\n            <Icon aria-hidden name=\"bars\" className={styles.iconMargin} />\n            <span>{linkInfo.title}</span>\n          </ToolbarButton>\n          <ul\n            id=\"dropdown-list\"\n            className={`dropdown-menu ${styles.dropdown} ${dropdownCssClass}`}\n            role=\"menu\"\n            ref={listRef}\n          >\n            {resolvedLinks.length > 0 &&\n              resolvedLinks.map((resolvedLink, index) => {\n                return (\n                  <li role=\"none\" key={`dashlinks-dropdown-item-${resolvedLink.uid}-${index}`}>\n                    <a\n                      role=\"menuitem\"\n                      href={resolvedLink.url}\n                      target={link.targetBlank ? '_blank' : undefined}\n                      rel=\"noreferrer\"\n                      data-testid={selectors.components.DashboardLinks.link}\n                      aria-label={`${resolvedLink.title} dashboard`}\n                    >\n                      {resolvedLink.title}\n                    </a>\n                  </li>\n                );\n              })}\n          </ul>\n        </>\n      </LinkElement>\n    );\n  }\n\n  return (\n    <>\n      {resolvedLinks.length > 0 &&\n        resolvedLinks.map((resolvedLink, index) => {\n          return (\n            <LinkElement\n              link={link}\n              key={`dashlinks-list-item-${resolvedLink.uid}-${index}`}\n              data-testid={selectors.components.DashboardLinks.container}\n            >\n              <a\n                className=\"gf-form-label gf-form-label--dashlink\"\n                href={resolvedLink.url}\n                target={link.targetBlank ? '_blank' : undefined}\n                rel=\"noreferrer\"\n                data-testid={selectors.components.DashboardLinks.link}\n                aria-label={`${resolvedLink.title} dashboard`}\n              >\n                <Icon aria-hidden name=\"apps\" style={{ marginRight: '4px' }} />\n                <span>{resolvedLink.title}</span>\n              </a>\n            </LinkElement>\n          );\n        })}\n    </>\n  );\n};\n\ninterface LinkElementProps {\n  link: DashboardLink;\n  key: string;\n  children: JSX.Element;\n}\n\nconst LinkElement = (props: LinkElementProps) => {\n  const { link, children, ...rest } = props;\n\n  return (\n    <div {...rest} className=\"gf-form\">\n      {link.tooltip && <Tooltip content={link.tooltip}>{children}</Tooltip>}\n      {!link.tooltip && <>{children}</>}\n    </div>\n  );\n};\n\nconst useResolvedLinks = ({ link, dashboardUID }: Props, opened: number): ResolvedLinkDTO[] => {\n  const { tags } = link;\n  const result = useAsync(() => searchForTags(tags), [tags, opened]);\n  if (!result.value) {\n    return [];\n  }\n  return resolveLinks(dashboardUID, link, result.value);\n};\n\ninterface ResolvedLinkDTO {\n  uid: string;\n  url: string;\n  title: string;\n}\n\nexport async function searchForTags(\n  tags: string[],\n  dependencies: { getBackendSrv: typeof getBackendSrv } = { getBackendSrv }\n): Promise<DashboardSearchItem[]> {\n  const limit = 100;\n  const searchHits: DashboardSearchItem[] = await dependencies.getBackendSrv().search({ tag: tags, limit });\n\n  return searchHits;\n}\n\nexport function resolveLinks(\n  dashboardUID: string,\n  link: DashboardLink,\n  searchHits: DashboardSearchItem[],\n  dependencies: { getLinkSrv: typeof getLinkSrv; sanitize: typeof sanitize; sanitizeUrl: typeof sanitizeUrl } = {\n    getLinkSrv,\n    sanitize,\n    sanitizeUrl,\n  }\n): ResolvedLinkDTO[] {\n  return searchHits\n    .filter((searchHit) => searchHit.uid !== dashboardUID)\n    .map((searchHit) => {\n      const uid = searchHit.uid;\n      const title = dependencies.sanitize(searchHit.title);\n      const resolvedLink = dependencies.getLinkSrv().getLinkUrl({ ...link, url: searchHit.url });\n      const url = dependencies.sanitizeUrl(resolvedLink);\n\n      return { uid, title, url };\n    });\n}\n\nfunction getDropdownLocationCssClass(element: HTMLElement | null) {\n  if (!element) {\n    return 'invisible';\n  }\n\n  const wrapperPos = element.parentElement!.getBoundingClientRect();\n  const pos = element.getBoundingClientRect();\n\n  if (pos.width === 0) {\n    return 'invisible';\n  }\n\n  if (wrapperPos.left + pos.width + 10 > window.innerWidth) {\n    return 'pull-left';\n  } else {\n    return 'pull-right';\n  }\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    iconMargin: css({\n      marginRight: theme.spacing(0.5),\n    }),\n    dropdown: css({\n      maxWidth: 'max(30vw, 300px)',\n      maxHeight: '70vh',\n      overflowY: 'auto',\n      a: {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n      },\n    }),\n    button: css({\n      color: theme.colors.text.primary,\n    }),\n  };\n}\n","import React from 'react';\nimport { useEffectOnce } from 'react-use';\n\nimport { sanitizeUrl } from '@grafana/data/src/text/sanitize';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { TimeRangeUpdatedEvent } from '@grafana/runtime';\nimport { Icon, Tooltip, useForceUpdate } from '@grafana/ui';\n\nimport { getLinkSrv } from '../../../panel/panellinks/link_srv';\nimport { DashboardModel } from '../../state';\nimport { DashboardLink } from '../../state/DashboardModel';\nimport { linkIconMap } from '../LinksSettings/LinkSettingsEdit';\n\nimport { DashboardLinksDashboard } from './DashboardLinksDashboard';\n\nexport interface Props {\n  dashboard: DashboardModel;\n  links: DashboardLink[];\n}\n\nexport const DashboardLinks = ({ dashboard, links }: Props) => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    const sub = dashboard.events.subscribe(TimeRangeUpdatedEvent, forceUpdate);\n    return () => sub.unsubscribe();\n  });\n\n  if (!links.length) {\n    return null;\n  }\n\n  return (\n    <>\n      {links.map((link: DashboardLink, index: number) => {\n        const linkInfo = getLinkSrv().getAnchorInfo(link);\n        const key = `${link.title}-$${index}`;\n\n        if (link.type === 'dashboards') {\n          return <DashboardLinksDashboard key={key} link={link} linkInfo={linkInfo} dashboardUID={dashboard.uid} />;\n        }\n\n        const icon = linkIconMap[link.icon];\n\n        const linkElement = (\n          <a\n            className=\"gf-form-label gf-form-label--dashlink\"\n            href={sanitizeUrl(linkInfo.href)}\n            target={link.targetBlank ? '_blank' : undefined}\n            rel=\"noreferrer\"\n            data-testid={selectors.components.DashboardLinks.link}\n          >\n            {icon && <Icon aria-hidden name={icon} style={{ marginRight: '4px' }} />}\n            <span>{linkInfo.title}</span>\n          </a>\n        );\n\n        return (\n          <div key={key} className=\"gf-form\" data-testid={selectors.components.DashboardLinks.container}>\n            {link.tooltip ? <Tooltip content={linkInfo.tooltip}>{linkElement}</Tooltip> : linkElement}\n          </div>\n        );\n      })}\n    </>\n  );\n};\n","import { css } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { connect, MapStateToProps } from 'react-redux';\n\nimport { AnnotationQuery, DataQuery, GrafanaTheme2 } from '@grafana/data';\nimport { stylesFactory, Themeable2, withTheme2 } from '@grafana/ui';\n\nimport { StoreState } from '../../../../types';\nimport { getSubMenuVariables, getVariablesState } from '../../../variables/state/selectors';\nimport { VariableModel } from '../../../variables/types';\nimport { DashboardModel } from '../../state';\nimport { DashboardLink } from '../../state/DashboardModel';\n\nimport { Annotations } from './Annotations';\nimport { DashboardLinks } from './DashboardLinks';\nimport { SubMenuItems } from './SubMenuItems';\n\ninterface OwnProps extends Themeable2 {\n  dashboard: DashboardModel;\n  links: DashboardLink[];\n  annotations: AnnotationQuery[];\n}\n\ninterface ConnectedProps {\n  variables: VariableModel[];\n}\n\ninterface DispatchProps {}\n\ntype Props = OwnProps & ConnectedProps & DispatchProps;\n\nclass SubMenuUnConnected extends PureComponent<Props> {\n  onAnnotationStateChanged = (updatedAnnotation: AnnotationQuery<DataQuery>) => {\n    // we're mutating dashboard state directly here until annotations are in Redux.\n    for (let index = 0; index < this.props.dashboard.annotations.list.length; index++) {\n      const annotation = this.props.dashboard.annotations.list[index];\n      if (annotation.name === updatedAnnotation.name) {\n        annotation.enable = !annotation.enable;\n        break;\n      }\n    }\n    this.props.dashboard.startRefresh();\n    this.forceUpdate();\n  };\n\n  disableSubmitOnEnter = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n  };\n\n  render() {\n    const { dashboard, variables, links, annotations, theme } = this.props;\n\n    const styles = getStyles(theme);\n\n    if (!dashboard.isSubMenuVisible()) {\n      return null;\n    }\n\n    const readOnlyVariables = dashboard.meta.isSnapshot ?? false;\n\n    return (\n      <div className={styles.submenu}>\n        <form aria-label=\"Template variables\" className={styles.formStyles} onSubmit={this.disableSubmitOnEnter}>\n          <SubMenuItems variables={variables} readOnly={readOnlyVariables} />\n        </form>\n        <Annotations\n          annotations={annotations}\n          onAnnotationChanged={this.onAnnotationStateChanged}\n          events={dashboard.events}\n        />\n        <div className={styles.spacer} />\n        {dashboard && <DashboardLinks dashboard={dashboard} links={links} />}\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps: MapStateToProps<ConnectedProps, OwnProps, StoreState> = (state, ownProps) => {\n  const { uid } = ownProps.dashboard;\n  const templatingState = getVariablesState(uid, state);\n  return {\n    variables: getSubMenuVariables(uid, templatingState.variables),\n  };\n};\n\nconst getStyles = stylesFactory((theme: GrafanaTheme2) => {\n  return {\n    formStyles: css`\n      display: flex;\n      flex-wrap: wrap;\n      display: contents;\n    `,\n    submenu: css`\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      align-content: flex-start;\n      align-items: flex-start;\n      gap: ${theme.spacing(1)} ${theme.spacing(2)};\n      padding: 0 0 ${theme.spacing(1)} 0;\n    `,\n    spacer: css({\n      flexGrow: 1,\n    }),\n  };\n});\n\nexport const SubMenu = withTheme2(connect(mapStateToProps)(SubMenuUnConnected));\n\nSubMenu.displayName = 'SubMenu';\n","import { cx } from '@emotion/css';\nimport React, { PureComponent } from 'react';\nimport { connect, ConnectedProps } from 'react-redux';\n\nimport { NavModel, NavModelItem, TimeRange, PageLayoutType, locationUtil } from '@grafana/data';\nimport { selectors } from '@grafana/e2e-selectors';\nimport { config, locationService } from '@grafana/runtime';\nimport { Themeable2, withTheme2 } from '@grafana/ui';\nimport { notifyApp } from 'app/core/actions';\nimport { Page } from 'app/core/components/Page/Page';\nimport { EntityNotFound } from 'app/core/components/PageNotFound/EntityNotFound';\nimport { GrafanaContext, GrafanaContextType } from 'app/core/context/GrafanaContext';\nimport { createErrorNotification } from 'app/core/copy/appNotification';\nimport { getKioskMode } from 'app/core/navigation/kiosk';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { getNavModel } from 'app/core/selectors/navModel';\nimport { newBrowseDashboardsEnabled } from 'app/features/browse-dashboards/featureFlag';\nimport { PanelModel } from 'app/features/dashboard/state';\nimport { dashboardWatcher } from 'app/features/live/dashboard/dashboardWatcher';\nimport { AngularDeprecationNotice } from 'app/features/plugins/angularDeprecation/AngularDeprecationNotice';\nimport { getPageNavFromSlug, getRootContentNavModel } from 'app/features/storage/StorageFolderPage';\nimport { DashboardRoutes, KioskMode, StoreState } from 'app/types';\nimport { PanelEditEnteredEvent, PanelEditExitedEvent } from 'app/types/events';\n\nimport { cancelVariables, templateVarsChangedInUrl } from '../../variables/state/actions';\nimport { findTemplateVarChanges } from '../../variables/utils';\nimport { AddWidgetModal } from '../components/AddWidgetModal/AddWidgetModal';\nimport { DashNav } from '../components/DashNav';\nimport { DashboardFailed } from '../components/DashboardLoading/DashboardFailed';\nimport { DashboardLoading } from '../components/DashboardLoading/DashboardLoading';\nimport { DashboardPrompt } from '../components/DashboardPrompt/DashboardPrompt';\nimport { DashboardSettings } from '../components/DashboardSettings';\nimport { PanelInspector } from '../components/Inspector/PanelInspector';\nimport { PanelEditor } from '../components/PanelEditor/PanelEditor';\nimport { SubMenu } from '../components/SubMenu/SubMenu';\nimport { DashboardGrid } from '../dashgrid/DashboardGrid';\nimport { liveTimer } from '../dashgrid/liveTimer';\nimport { getTimeSrv } from '../services/TimeSrv';\nimport { cleanUpDashboardAndVariables } from '../state/actions';\nimport { initDashboard } from '../state/initDashboard';\nimport { calculateNewPanelGridPos } from '../utils/panel';\n\nexport interface DashboardPageRouteParams {\n  uid?: string;\n  type?: string;\n  slug?: string;\n  accessToken?: string;\n}\n\nexport type DashboardPageRouteSearchParams = {\n  tab?: string;\n  folderUid?: string;\n  editPanel?: string;\n  viewPanel?: string;\n  editview?: string;\n  addWidget?: boolean;\n  panelType?: string;\n  inspect?: string;\n  from?: string;\n  to?: string;\n  refresh?: string;\n  kiosk?: string | true;\n};\n\nexport const mapStateToProps = (state: StoreState) => ({\n  initPhase: state.dashboard.initPhase,\n  initError: state.dashboard.initError,\n  dashboard: state.dashboard.getModel(),\n  navIndex: state.navIndex,\n});\n\nconst mapDispatchToProps = {\n  initDashboard,\n  cleanUpDashboardAndVariables,\n  notifyApp,\n  cancelVariables,\n  templateVarsChangedInUrl,\n};\n\nconst connector = connect(mapStateToProps, mapDispatchToProps);\n\nexport type Props = Themeable2 &\n  GrafanaRouteComponentProps<DashboardPageRouteParams, DashboardPageRouteSearchParams> &\n  ConnectedProps<typeof connector>;\n\nexport interface State {\n  editPanel: PanelModel | null;\n  viewPanel: PanelModel | null;\n  updateScrollTop?: number;\n  rememberScrollTop?: number;\n  showLoadingState: boolean;\n  panelNotFound: boolean;\n  editPanelAccessDenied: boolean;\n  scrollElement?: HTMLDivElement;\n  pageNav?: NavModelItem;\n  sectionNav?: NavModel;\n}\n\nexport class UnthemedDashboardPage extends PureComponent<Props, State> {\n  declare context: GrafanaContextType;\n  static contextType = GrafanaContext;\n\n  private forceRouteReloadCounter = 0;\n  state: State = this.getCleanState();\n\n  getCleanState(): State {\n    return {\n      editPanel: null,\n      viewPanel: null,\n      showLoadingState: false,\n      panelNotFound: false,\n      editPanelAccessDenied: false,\n    };\n  }\n\n  componentDidMount() {\n    this.initDashboard();\n    this.forceRouteReloadCounter = (this.props.history.location.state as any)?.routeReloadCounter || 0;\n  }\n\n  componentWillUnmount() {\n    this.closeDashboard();\n  }\n\n  closeDashboard() {\n    this.props.cleanUpDashboardAndVariables();\n    this.setState(this.getCleanState());\n  }\n\n  initDashboard() {\n    const { dashboard, match, queryParams } = this.props;\n\n    if (dashboard) {\n      this.closeDashboard();\n    }\n\n    this.props.initDashboard({\n      urlSlug: match.params.slug,\n      urlUid: match.params.uid,\n      urlType: match.params.type,\n      urlFolderUid: queryParams.folderUid,\n      panelType: queryParams.panelType,\n      routeName: this.props.route.routeName,\n      fixUrl: true,\n      accessToken: match.params.accessToken,\n      keybindingSrv: this.context.keybindings,\n    });\n\n    // small delay to start live updates\n    setTimeout(this.updateLiveTimer, 250);\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: State) {\n    const { dashboard, match, templateVarsChangedInUrl } = this.props;\n    const routeReloadCounter = (this.props.history.location.state as any)?.routeReloadCounter;\n\n    if (!dashboard) {\n      return;\n    }\n\n    if (\n      prevProps.match.params.uid !== match.params.uid ||\n      (routeReloadCounter !== undefined && this.forceRouteReloadCounter !== routeReloadCounter)\n    ) {\n      this.initDashboard();\n      this.forceRouteReloadCounter = routeReloadCounter;\n      return;\n    }\n\n    if (prevProps.location.search !== this.props.location.search) {\n      const prevUrlParams = prevProps.queryParams;\n      const urlParams = this.props.queryParams;\n\n      if (urlParams?.from !== prevUrlParams?.from || urlParams?.to !== prevUrlParams?.to) {\n        getTimeSrv().updateTimeRangeFromUrl();\n        this.updateLiveTimer();\n      }\n\n      if (!prevUrlParams?.refresh && urlParams?.refresh) {\n        getTimeSrv().setAutoRefresh(urlParams.refresh);\n      }\n\n      const templateVarChanges = findTemplateVarChanges(this.props.queryParams, prevProps.queryParams);\n\n      if (templateVarChanges) {\n        templateVarsChangedInUrl(dashboard.uid, templateVarChanges);\n      }\n    }\n\n    // entering edit mode\n    if (this.state.editPanel && !prevState.editPanel) {\n      dashboardWatcher.setEditingState(true);\n\n      // Some panels need to be notified when entering edit mode\n      this.props.dashboard?.events.publish(new PanelEditEnteredEvent(this.state.editPanel.id));\n    }\n\n    // leaving edit mode\n    if (!this.state.editPanel && prevState.editPanel) {\n      dashboardWatcher.setEditingState(false);\n\n      // Some panels need kicked when leaving edit mode\n      this.props.dashboard?.events.publish(new PanelEditExitedEvent(prevState.editPanel.id));\n    }\n\n    if (this.state.editPanelAccessDenied) {\n      this.props.notifyApp(createErrorNotification('Permission to edit panel denied'));\n      locationService.partial({ editPanel: null });\n    }\n\n    if (this.state.panelNotFound) {\n      this.props.notifyApp(createErrorNotification(`Panel not found`));\n      locationService.partial({ editPanel: null, viewPanel: null });\n    }\n  }\n\n  updateLiveTimer = () => {\n    let tr: TimeRange | undefined = undefined;\n    if (this.props.dashboard?.liveNow) {\n      tr = getTimeSrv().timeRange();\n    }\n    liveTimer.setLiveTimeRange(tr);\n  };\n\n  static getDerivedStateFromProps(props: Props, state: State) {\n    const { dashboard, queryParams } = props;\n\n    const urlEditPanelId = queryParams.editPanel;\n    const urlViewPanelId = queryParams.viewPanel;\n\n    if (!dashboard) {\n      return state;\n    }\n\n    const updatedState = { ...state };\n\n    // Entering edit mode\n    if (!state.editPanel && urlEditPanelId) {\n      const panel = dashboard.getPanelByUrlId(urlEditPanelId);\n      if (panel) {\n        if (dashboard.canEditPanel(panel)) {\n          updatedState.editPanel = panel;\n          updatedState.rememberScrollTop = state.scrollElement?.scrollTop;\n        } else {\n          updatedState.editPanelAccessDenied = true;\n        }\n      } else {\n        updatedState.panelNotFound = true;\n      }\n    }\n    // Leaving edit mode\n    else if (state.editPanel && !urlEditPanelId) {\n      updatedState.editPanel = null;\n      updatedState.updateScrollTop = state.rememberScrollTop;\n    }\n\n    // Entering view mode\n    if (!state.viewPanel && urlViewPanelId) {\n      const panel = dashboard.getPanelByUrlId(urlViewPanelId);\n      if (panel) {\n        // This mutable state feels wrong to have in getDerivedStateFromProps\n        // Should move this state out of dashboard in the future\n        dashboard.initViewPanel(panel);\n        updatedState.viewPanel = panel;\n        updatedState.rememberScrollTop = state.scrollElement?.scrollTop;\n        updatedState.updateScrollTop = 0;\n      } else {\n        updatedState.panelNotFound = true;\n      }\n    }\n    // Leaving view mode\n    else if (state.viewPanel && !urlViewPanelId) {\n      // This mutable state feels wrong to have in getDerivedStateFromProps\n      // Should move this state out of dashboard in the future\n      dashboard.exitViewPanel(state.viewPanel);\n      updatedState.viewPanel = null;\n      updatedState.updateScrollTop = state.rememberScrollTop;\n    }\n\n    // if we removed url edit state, clear any panel not found state\n    if (state.panelNotFound || (state.editPanelAccessDenied && !urlEditPanelId)) {\n      updatedState.panelNotFound = false;\n      updatedState.editPanelAccessDenied = false;\n    }\n\n    return updateStatePageNavFromProps(props, updatedState);\n  }\n\n  // Todo: Remove this when we remove the emptyDashboardPage toggle\n  onAddPanel = () => {\n    const { dashboard } = this.props;\n\n    if (!dashboard) {\n      return;\n    }\n\n    // Return if the \"Add panel\" exists already\n    if (dashboard.panels.length > 0 && dashboard.panels[0].type === 'add-panel') {\n      return;\n    }\n\n    dashboard.addPanel({\n      type: 'add-panel',\n      gridPos: calculateNewPanelGridPos(dashboard),\n      title: 'Panel Title',\n    });\n\n    // scroll to top after adding panel\n    this.setState({ updateScrollTop: 0 });\n  };\n\n  setScrollRef = (scrollElement: HTMLDivElement): void => {\n    this.setState({ scrollElement });\n  };\n\n  getInspectPanel() {\n    const { dashboard, queryParams } = this.props;\n\n    const inspectPanelId = queryParams.inspect;\n\n    if (!dashboard || !inspectPanelId) {\n      return null;\n    }\n\n    const inspectPanel = dashboard.getPanelById(parseInt(inspectPanelId, 10));\n\n    // cannot inspect panels plugin is not already loaded\n    if (!inspectPanel) {\n      return null;\n    }\n\n    return inspectPanel;\n  }\n\n  render() {\n    const { dashboard, initError, queryParams } = this.props;\n    const { editPanel, viewPanel, updateScrollTop, pageNav, sectionNav } = this.state;\n    const kioskMode = getKioskMode(this.props.queryParams);\n\n    if (!dashboard || !pageNav || !sectionNav) {\n      return <DashboardLoading initPhase={this.props.initPhase} />;\n    }\n\n    const inspectPanel = this.getInspectPanel();\n    const showSubMenu = !editPanel && !kioskMode && !this.props.queryParams.editview;\n\n    const showToolbar = kioskMode !== KioskMode.Full && !queryParams.editview;\n\n    const pageClassName = cx({\n      'panel-in-fullscreen': Boolean(viewPanel),\n      'page-hidden': Boolean(queryParams.editview || editPanel),\n    });\n\n    if (dashboard.meta.dashboardNotFound) {\n      return (\n        <Page navId=\"dashboards/browse\" layout={PageLayoutType.Canvas} pageNav={{ text: 'Not found' }}>\n          <EntityNotFound entity=\"Dashboard\" />\n        </Page>\n      );\n    }\n\n    return (\n      <>\n        <Page\n          navModel={sectionNav}\n          pageNav={pageNav}\n          layout={PageLayoutType.Canvas}\n          className={pageClassName}\n          scrollRef={this.setScrollRef}\n          scrollTop={updateScrollTop}\n        >\n          {showToolbar && (\n            <header data-testid={selectors.pages.Dashboard.DashNav.navV2}>\n              <DashNav\n                dashboard={dashboard}\n                title={dashboard.title}\n                folderTitle={dashboard.meta.folderTitle}\n                isFullscreen={!!viewPanel}\n                onAddPanel={this.onAddPanel}\n                kioskMode={kioskMode}\n                hideTimePicker={dashboard.timepicker.hidden}\n              />\n            </header>\n          )}\n          <DashboardPrompt dashboard={dashboard} />\n          {initError && <DashboardFailed />}\n          {showSubMenu && (\n            <section aria-label={selectors.pages.Dashboard.SubMenu.submenu}>\n              <SubMenu dashboard={dashboard} annotations={dashboard.annotations.list} links={dashboard.links} />\n            </section>\n          )}\n          {config.featureToggles.angularDeprecationUI && dashboard.hasAngularPlugins() && dashboard.uid !== null && (\n            <AngularDeprecationNotice dashboardUid={dashboard.uid} />\n          )}\n          <DashboardGrid\n            dashboard={dashboard}\n            isEditable={!!dashboard.meta.canEdit}\n            viewPanel={viewPanel}\n            editPanel={editPanel}\n          />\n\n          {inspectPanel && <PanelInspector dashboard={dashboard} panel={inspectPanel} />}\n        </Page>\n        {editPanel && (\n          <PanelEditor\n            dashboard={dashboard}\n            sourcePanel={editPanel}\n            tab={this.props.queryParams.tab}\n            sectionNav={sectionNav}\n            pageNav={pageNav}\n          />\n        )}\n        {queryParams.editview && (\n          <DashboardSettings\n            dashboard={dashboard}\n            editview={queryParams.editview}\n            pageNav={pageNav}\n            sectionNav={sectionNav}\n          />\n        )}\n        {queryParams.addWidget && config.featureToggles.vizAndWidgetSplit && <AddWidgetModal />}\n      </>\n    );\n  }\n}\n\nfunction updateStatePageNavFromProps(props: Props, state: State): State {\n  const { dashboard, navIndex } = props;\n\n  if (!dashboard) {\n    return state;\n  }\n\n  let pageNav = state.pageNav;\n  let sectionNav = state.sectionNav;\n\n  if (!pageNav || dashboard.title !== pageNav.text || dashboard.meta.folderUrl !== pageNav.parentItem?.url) {\n    pageNav = {\n      text: dashboard.title,\n      url: locationUtil.getUrlForPartial(props.history.location, {\n        editview: null,\n        editPanel: null,\n        viewPanel: null,\n      }),\n    };\n  }\n\n  const { folderTitle, folderUid } = dashboard.meta;\n  if (folderUid && pageNav) {\n    if (newBrowseDashboardsEnabled()) {\n      const folderNavModel = getNavModel(navIndex, `folder-dashboards-${folderUid}`).main;\n      // If the folder hasn't loaded (maybe user doesn't have permission on it?) then\n      // don't show the \"page not found\" breadcrumb\n      if (folderNavModel.id !== 'not-found') {\n        pageNav = {\n          ...pageNav,\n          parentItem: folderNavModel,\n        };\n      }\n    } else {\n      // Check if folder changed\n      if (folderTitle && pageNav.parentItem?.text !== folderTitle) {\n        pageNav = {\n          ...pageNav,\n          parentItem: {\n            text: folderTitle,\n            url: `/dashboards/f/${dashboard.meta.folderUid}`,\n          },\n        };\n      }\n    }\n  }\n\n  if (props.route.routeName === DashboardRoutes.Path) {\n    sectionNav = getRootContentNavModel();\n    const pageNav = getPageNavFromSlug(props.match.params.slug!);\n    if (pageNav?.parentItem) {\n      pageNav.parentItem = pageNav.parentItem;\n    }\n  } else {\n    sectionNav = getNavModel(props.navIndex, 'dashboards/browse');\n  }\n\n  if (state.editPanel || state.viewPanel) {\n    pageNav = {\n      ...pageNav,\n      text: `${state.editPanel ? 'Edit' : 'View'} panel`,\n      parentItem: pageNav,\n      url: undefined,\n    };\n  }\n\n  if (state.pageNav === pageNav && state.sectionNav === sectionNav) {\n    return state;\n  }\n\n  return {\n    ...state,\n    pageNav,\n    sectionNav,\n  };\n}\n\nexport const DashboardPage = withTheme2(UnthemedDashboardPage);\nDashboardPage.displayName = 'DashboardPage';\nexport default connector(DashboardPage);\n","import React, { useEffect, useState } from 'react';\n\nimport { config, getDataSourceSrv, locationService } from '@grafana/runtime';\nimport { Page } from 'app/core/components/Page/Page';\nimport { GrafanaRouteComponentProps } from 'app/core/navigation/types';\nimport { useDispatch } from 'app/types';\n\nimport { getNewDashboardModelData, setDashboardToFetchFromLocalStorage } from '../state/initDashboard';\nimport { setInitialDatasource } from '../state/reducers';\n\nexport default function NewDashboardWithDS(props: GrafanaRouteComponentProps<{ datasourceUid: string }>) {\n  const [error, setError] = useState<string | null>(null);\n  const { datasourceUid } = props.match.params;\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const ds = getDataSourceSrv().getInstanceSettings(datasourceUid);\n    if (!ds) {\n      setError('Data source not found');\n      return;\n    }\n\n    if (!config.featureToggles.emptyDashboardPage) {\n      const newDashboard = getNewDashboardModelData();\n      const { dashboard } = newDashboard;\n      dashboard.panels[0] = {\n        ...dashboard.panels[0],\n        datasource: {\n          uid: ds.uid,\n          type: ds.type,\n        },\n      };\n\n      setDashboardToFetchFromLocalStorage(newDashboard);\n    } else {\n      dispatch(setInitialDatasource(datasourceUid));\n    }\n\n    locationService.replace('/dashboard/new');\n  }, [datasourceUid, dispatch]);\n\n  if (error) {\n    return (\n      <Page navId=\"dashboards\">\n        <Page.Contents>\n          <div>Data source with UID &quot;{datasourceUid}&quot; not found.</div>\n        </Page.Contents>\n      </Page>\n    );\n  }\n\n  return null;\n}\n","import { DataFrame, dataFrameFromJSON, DataFrameJSON, getDisplayProcessor } from '@grafana/data';\nimport { config, getBackendSrv } from '@grafana/runtime';\nimport { backendSrv } from 'app/core/services/backend_srv';\n\nimport { UploadResponse, StorageInfo, ItemOptions, WriteValueRequest, WriteValueResponse } from './types';\n\n// Likely should be built into the search interface!\nexport interface GrafanaStorage {\n  get: <T = any>(path: string) => Promise<T>;\n  list: (path: string) => Promise<DataFrame | undefined>;\n  upload: (folder: string, file: File, overwriteExistingFile: boolean) => Promise<UploadResponse>;\n  createFolder: (path: string) => Promise<{ error?: string }>;\n  delete: (path: { isFolder: boolean; path: string }) => Promise<{ error?: string }>;\n\n  /** Admin only */\n  getConfig: () => Promise<StorageInfo[]>;\n\n  /** Called before save */\n  getOptions: (path: string) => Promise<ItemOptions>;\n\n  /** Saves dashboards */\n  write: (path: string, options: WriteValueRequest) => Promise<WriteValueResponse>;\n}\n\nclass SimpleStorage implements GrafanaStorage {\n  constructor() {}\n\n  async get<T = any>(path: string): Promise<T> {\n    const storagePath = `api/storage/read/${path}`.replace('//', '/');\n    return getBackendSrv().get<T>(storagePath);\n  }\n\n  async list(path: string): Promise<DataFrame | undefined> {\n    let url = 'api/storage/list/';\n    if (path) {\n      url += path + '/';\n    }\n    const rsp = await getBackendSrv().get<DataFrameJSON>(url);\n    if (rsp?.data) {\n      const f = dataFrameFromJSON(rsp);\n      for (const field of f.fields) {\n        field.display = getDisplayProcessor({ field, theme: config.theme2 });\n      }\n      return f;\n    }\n    return undefined;\n  }\n\n  async createFolder(path: string): Promise<{ error?: string }> {\n    const res = await getBackendSrv().post<{ success: boolean; message: string }>(\n      '/api/storage/createFolder',\n      JSON.stringify({ path })\n    );\n\n    if (!res.success) {\n      return {\n        error: res.message ?? 'unknown error',\n      };\n    }\n\n    return {};\n  }\n\n  async deleteFolder(req: { path: string; force: boolean }): Promise<{ error?: string }> {\n    const res = await getBackendSrv().post<{ success: boolean; message: string }>(\n      `/api/storage/deleteFolder`,\n      JSON.stringify(req)\n    );\n\n    if (!res.success) {\n      return {\n        error: res.message ?? 'unknown error',\n      };\n    }\n\n    return {};\n  }\n\n  async deleteFile(req: { path: string }): Promise<{ error?: string }> {\n    const res = await getBackendSrv().post<{ success: boolean; message: string }>(`/api/storage/delete/${req.path}`);\n\n    if (!res.success) {\n      return {\n        error: res.message ?? 'unknown error',\n      };\n    }\n\n    return {};\n  }\n\n  async delete(req: { isFolder: boolean; path: string }): Promise<{ error?: string }> {\n    return req.isFolder ? this.deleteFolder({ path: req.path, force: true }) : this.deleteFile({ path: req.path });\n  }\n\n  async upload(folder: string, file: File, overwriteExistingFile: boolean): Promise<UploadResponse> {\n    const formData = new FormData();\n    formData.append('folder', folder);\n    formData.append('file', file);\n    formData.append('overwriteExistingFile', String(overwriteExistingFile));\n    const res = await fetch('/api/storage/upload', {\n      method: 'POST',\n      body: formData,\n    });\n\n    let body: UploadResponse = await res.json();\n    if (!body) {\n      body = {} as any;\n    }\n    body.status = res.status;\n    body.statusText = res.statusText;\n    if (res.status !== 200 && !body.err) {\n      body.err = true;\n    }\n    return body;\n  }\n\n  async write(path: string, options: WriteValueRequest): Promise<WriteValueResponse> {\n    return backendSrv.post<WriteValueResponse>(`/api/storage/write/${path}`, options);\n  }\n\n  async getConfig() {\n    return getBackendSrv().get<StorageInfo[]>('/api/storage/config');\n  }\n\n  async getOptions(path: string) {\n    return getBackendSrv().get<ItemOptions>(`/api/storage/options/${path}`);\n  }\n}\n\nexport function filenameAlreadyExists(folderName: string, fileNames: string[]) {\n  const lowerCase = folderName.toLowerCase();\n  const trimmedLowerCase = lowerCase.trim();\n  const existingTrimmedLowerCaseNames = fileNames.map((f) => f.trim().toLowerCase());\n\n  return existingTrimmedLowerCaseNames.includes(trimmedLowerCase);\n}\n\nlet storage: GrafanaStorage | undefined;\n\nexport function getGrafanaStorage() {\n  if (!storage) {\n    storage = new SimpleStorage();\n  }\n  return storage;\n}\n","import React, { useCallback } from 'react';\n\nimport { FrameMatcherID, MatcherConfig, StandardEditorProps } from '@grafana/data';\nimport { RefIDPicker } from '@grafana/ui/src/components/MatchersUI/FieldsByFrameRefIdMatcher';\n\ntype Props = StandardEditorProps<MatcherConfig>;\n\nexport const FrameSelectionEditor = ({ value, context, onChange }: Props) => {\n  const onFilterChange = useCallback(\n    (v: string) => {\n      onChange(\n        v?.length\n          ? {\n              id: FrameMatcherID.byRefId,\n              options: v,\n            }\n          : undefined\n      );\n    },\n    [onChange]\n  );\n\n  return (\n    <RefIDPicker value={value?.options} onChange={onFilterChange} data={context.data} placeholder=\"Change filter\" />\n  );\n};\n"],"names":["getDefaultCondition","getAlertingValidationMessage","transformations","targets","datasourceSrv","datasource","alertingNotSupported","templateVariablesNotSupported","target","dsRef","ds","getKioskMode","queryParams","LOCAL_STORAGE_KEY_PREFIX","localStorageKey","dashboardUid","AngularDeprecationNotice","LocalStorageValueProvider","isDismissed","onDismiss","Alert","StorageFolderPage","props","slug","listing","childRoot","pageNav","getPageNavFromSlug","renderListing","item","name","isFolder","isDash","url","navModel","getRootContentNavModel","parts","pageNavs","lastPageNav","VizTypePickerPlugin","isCurrent","plugin","onClick","disabled","PanelTypeCard","AddWidgetModal","styles","getStyles","searchQuery","setSearchQuery","dashboard","state","widgetsList","filteredWidgetsTypes","Modal","Input","e","CustomScrollbar","index","id","theme","SaveLibraryPanelModal","panel","folderUid","isUnsavedPrompt","onConfirm","onDiscard","searchString","setSearchString","dashState","searchHits","dash","filteredDashboards","setFilteredDashboards","useDebounce","dashName","saveLibraryPanel","usePanelSave","discardAndClose","title","i","Button","initPanelEditor","sourcePanel","dispatch","discardPanelChanges","getStore","getPanel","updateDuplicateLibraryPanels","modifiedPanel","modifiedSaveModel","skipPanelUpdate","pluginChanged","panelToUpdate","exitPanelEditor","getSourcePanel","shouldDiscardChanges","hasPanelChangedInPanelEdit","panelTypeChanged","updatePanelEditorUIState","uiState","nextState","store","error","UnsavedChangesModal","onSaveSuccess","SaveDashboardButton","DashboardPrompt","setState","original","originalPath","showModal","hideModal","ModalsContext","timeoutId","savedEventUnsub","handleUnload","event","ignoreChanges","hasChanges","onHistoryBlock","location","panelInEdit","search","moveToBlockedLocationAfterReactStateUpdate","current","canSave","fromScript","fromFile","cleanDashboardFromIgnoredChanges","dashData","model","DashboardModel","variable","currentClean","originalClean","currentTimepicker","originalTimepicker","currentJson","originalJson","SnapshotTab","ShowMessage","SupportSnapshotService","StateManagerBase","value","markdownText","maxLen","snapshotText","panelTitle","blob","fileName","k","randomize","snapshot","config","snapshotUpdate","snapshotSize","scene","oldModel","ex","HelpWizard","onClose","service","currentTab","loading","options","showMessage","tabs","hasSupportBundleAccess","Drawer","Stack","TabsBar","t","Tab","Field","Select","ClipboardButton","height","CodeEditor","usePanelLatestData","checkSchema","querySubscription","latestData","setLatestData","lastRev","lastUpdate","data","now","InspectMetadataTab","metadataDatasource","InspectContent","isDataLoading","dataOptions","defaultTab","onDataOptionsChange","setCurrentTab","errors","getErrors","activeTab","formatStats","tab","InspectDataTab","InspectJSONTab","InspectErrorTab","InspectStatsTab","QueryInspector","request","queryCount","requestTime","formatted","PanelInspectorUnconnected","setDataOptions","isLoading","hasError","metaDs","mapStateToProps","panelState","PanelInspector","PickerRenderer","PickerToRender","PickerLabel","labelOrName","elementId","Tooltip","selectors","SubMenuItems","variables","readOnly","visibleVariables","setVisibleVariables","saveSectionOpenState","isOpen","getSectionOpenState","defaultValue","mapDispatchToProps","connector","AngularPanelOptionsUnconnected","prevProps","angularPanelComponent","changePanelPlugin","scope","panelCtrl","template","loader","scopeProps","elem","AngularPanelOptions","DynamicConfigValueEditor","property","context","registry","onChange","onRemove","isSystemOverride","componentId","isCollapsible","labelCategory","c","editor","renderLabel","includeDescription","includeCounter","isExpanded","Label","Counter","IconButton","OptionsPaneCategory","OverrideCategoryTitle","matcherUi","overrideName","override","onOverrideRemove","propertyNames","prop","matcherOptions","getFieldOverrideCategories","categories","currentFieldConfig","onOverrideChange","overrides","overrideIndex","onOverrideAdd","info","idx","fieldMatchersUI","configPropertiesOptions","getOverrideProperties","forceOpen","category","OptionsPaneCategoryDescriptor","onMatcherConfigChange","onDynamicConfigValueAdd","o","registryItem","propertyConfig","OptionsPaneItemDescriptor","propIdx","registryItemForProperty","onPropertyChange","onPropertyRemove","ValuePicker","v","AddOverrideButtonContainer","label","children","getBorderTopStyles","LibraryPanelInformation","formatDate","meta","getLibraryPanelOptionsCategory","onPanelConfigChange","descriptor","DESCRIPTION_GENERATION_STANDARD_PROMPT","GenAIPanelDescriptionButton","onGenerate","messages","getMessages","GenAIButton","getPanelFrameCategory","setPanelTitle","input","setPanelDescription","description","GenAIPanelTitleButton","TextArea","Switch","DataLinksInlineEditor","links","RepeatRowSelect","directionOptions","RadioButtonGroup","maxPerRowOptions","OptionSearchEngine","query","searchRegex","sortedHits","compareHit","x","sortedOverridesHits","hits","categoryNameMatch","total","hit","left","right","getRecentOptions","allOptions","popularOptions","OptionsPaneOptions","listMode","setListMode","panelFrameOptions","vizOptions","libraryPanelOptions","getVisualizationOptions","justOverrides","mainBoxElements","isSearching","optionRadioFilters","getOptionRadioFilters","renderSearchHits","showSearchRadioButtons","AngularDeprecationPluginNotice","FilterInput","OptionFilter","engine","optionHits","totalCount","overrideHits","getPanelPluginWithFallback","panelType","VisualizationButton","isPanelOptionsVisible","isVizPickerOpen","onToggleOpen","onToggleOptionsPane","ButtonGroup","ToolbarButton","ChangeLibraryPanelModal","isLibraryPanel","body","ConfirmModal","PanelLibraryOptionsGroup","isWidget","showingAddPanelModal","setShowingAddPanelModal","changeToPanel","setChangeToPanel","panelFilter","setPanelFilter","onPanelFilterChange","plugins","p","useLibraryPanel","onAddToPanelLibrary","onDismissChangeToPanel","PanelTypeFilter","LibraryPanelsView","AddLibraryPanelModal","panelsToCheckFirst","getAllSuggestions","builder","pluginId","supplier","importPanelPlugin","list","a","b","VisualizationSuggestionCard","suggestion","width","innerStyles","outerStyles","renderWidth","renderHeight","getPreviewDimensionsAndStyles","cardOptions","commonButtonProps","preview","PanelRenderer","showWidth","showHeight","padding","widthFactor","heightFactor","VisualizationSuggestions","suggestions","filteredSuggestions","filterSuggestionsBySearch","columnCount","spaceBetween","previewWidth","regex","VizTypePicker","pluginsList","filteredPluginTypes","EmptySearchResult","VisualizationSelectPane","isWidgetEnabled","tabKey","useLocalStorage","searchRef","onVizChange","pluginChange","onCloseVizPicker","radioOptions","radioOptionsWidgetFlow","OptionsPane","onFieldConfigsChange","onPanelOptionsChanged","instanceState","InfoMode","PanelHeaderCorner","markdown","interpolatedMarkdown","markedInterpolatedMarkdown","link","infoMode","content","className","ariaLabel","PanelEditorTableView","setOptions","timeSrv","sub","timeData","errorMessage","PanelChrome","innerWidth","innerHeight","PanelNotSupported","message","onBackToQueries","Layout","StateHistory","panelId","onRefresh","items","alertDef","stateHistoryItems","ConfirmButton","UnThemedTestRuleResult","formattedJson","prevState","allNodesExpanded","collapse","expand","dashPanel","payload","testRuleResponse","clearButton","LoadingPlaceholder","openNodes","JSONFormatter","TestRuleResult","UnConnectedAlertTab","validationMessage","EventBus","alert","hasTransformations","element","EmptyListCTA","AlertTab","NewRuleFromPanelButton","templating","formValues","ruleFormUrl","usePanelCombinedRules","poll","promRuleRequest","useUnifiedAlertingSelector","rulerRuleRequest","fetch","interval","err","combinedNamespaces","useCombinedRuleNamespaces","ns","group","rule","PanelAlertTabContent","rules","permissions","canCreateRules","RulesTable","PanelAlertTab","otherProps","DOCS_LINKS","getDocsLink","TransformationEditor","debugMode","uiConfig","configs","setInput","output","setOutput","matcher","inputTransforms","outputTransforms","ctx","inputSubscription","transformDataFrame","outputSubscription","mergeMap","before","opts","debugBorder","TransformationFilter","FrameSelectionEditor","filter","borderRadius","TransformationOperationRow","showDeleteModal","setShowDeleteModal","useToggle","showDebug","toggleShowDebug","showHelp","toggleShowHelp","showFilter","onDisableToggle","toggleExpand","toggleFilter","instrumentToggleCallback","callback","toggleId","active","eventName","renderActions","PluginStateInfo","_e","QueryOperationAction","QueryOperationRow","OperationRowHelp","prepMarkdown","TransformationOperationRows","standardTransformersRegistry","LOCAL_STORAGE_KEY","viewAllValue","filterCategoriesLabels","UnThemedTransformationsEditor","lower","filtered","nextId","existingIds","selectable","dataConfig","next","result","startIndex","endIndex","update","removed","showPicker","hide","provided","ids","transformationCounters","transformationIds","transformation","panelData","prevShowPicker","currentShowPicker","kindOfZero","suffix","xforms","noTransforms","TransformationCard","FilterPill","TransformationsGrid","hasTransforms","transform","showIllustrations","applicabilityScore","isApplicable","applicabilityDescription","cardClasses","getTransformationsRedesignDescriptions","getImagePath","folder","TransformationsEditor","PanelEditorQueries","dataSource","datasourceSettings","lastUsedDatasource","QueryGroup","PanelEditorTabs","onChangeTab","forceUpdate","useForceUpdate","instrumentedOnChangeTab","eventSubs","Subscription","renderAlertTab","getCounter","TabContent","AlertTabIndex","getPanelEditorTabs","alertingEnabled","unifiedAlertingEnabled","hasRuleReadPermissions","isAlertingAvailable","isGraph","isTimeseries","ownProps","PanelEditorUnconnected","SaveDashboardDrawer","configKey","mode","initDone","isOnlyPanel","tableViewEnabled","panelSize","DashboardPanel","panelPane","SplitPaneWrapper","size","updateTimeZoneForSession","DashNavTimeControls","editorActions","UnlinkModal","sectionNav","AppChromeUpdate","ToolbarButtonRow","PanelEditor","stylesFactory","paneSpacing","AnnotationPicker","annotation","events","onEnabledChanged","setLoading","onCancel","started","stopped","InlineFieldRow","InlineField","LoadingIndicator","Annotations","annotations","onAnnotationChanged","visibleAnnotations","setVisibleAnnotations","DashboardLinksDashboard","linkInfo","listRef","dropdownCssClass","setDropdownCssClass","opened","setOpened","resolvedLinks","useResolvedLinks","getDropdownLocationCssClass","LinkElement","resolvedLink","rest","dashboardUID","tags","searchForTags","resolveLinks","dependencies","searchHit","uid","wrapperPos","pos","DashboardLinks","useEffectOnce","key","icon","linkElement","sanitize","SubMenuUnConnected","updatedAnnotation","readOnlyVariables","templatingState","SubMenu","UnthemedDashboardPage","tr","liveTimer","scrollElement","match","templateVarsChangedInUrl","routeReloadCounter","prevUrlParams","urlParams","templateVarChanges","dashboardWatcher","urlEditPanelId","urlViewPanelId","updatedState","updateStatePageNavFromProps","inspectPanelId","inspectPanel","initError","editPanel","viewPanel","updateScrollTop","kioskMode","DashboardLoading","showSubMenu","showToolbar","pageClassName","EntityNotFound","DashNav","DashboardFailed","DashboardGrid","DashboardSettings","GrafanaContext","navIndex","folderTitle","folderNavModel","DashboardPage","NewDashboardWithDS","setError","datasourceUid","newDashboard","SimpleStorage","path","storagePath","rsp","f","field","res","req","file","overwriteExistingFile","formData","filenameAlreadyExists","folderName","fileNames","trimmedLowerCase","storage","getGrafanaStorage","onFilterChange"],"sourceRoot":""}