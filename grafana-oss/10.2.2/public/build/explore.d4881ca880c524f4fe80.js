"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9782],{88981:(qt,Pe,u)=>{u.r(Pe),u.d(Pe,{default:()=>ci});var h=u(41407),t=u(39953),Q=u(32688),F=u(82803),te=u(41393),ot=u(49712),Ae=u(61205),Kt=u(83450),w=u(57721),Kn=u(53721),Jt=u(61450),Jn=function(e,o){e===void 0&&(e=!0);var n=(0,t.useCallback)(function(s){var a=typeof e=="function"?e():!0;if(a)return s.preventDefault(),o&&(s.returnValue=o),o},[e,o]);(0,t.useEffect)(function(){if(e)return(0,Jt.on)(window,"beforeunload",n),function(){return(0,Jt.S1)(window,"beforeunload",n)}},[e,n])};const Xn=Jn;var _n=u(17548),Rt=u(91249),z=u(72639),Xt=u(12223),we=u(69865),Ce=u(12190),P=u(4919),Me=u(73075);const eo=({onSave:e,onDiscard:o,onCancel:n})=>t.createElement(Me.u,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,h.css)({width:"500px"})},t.createElement("h5",null,"Do you want to save changes to this Correlation?"),t.createElement(Me.u.ButtonRow,null,t.createElement(P.zx,{variant:"secondary",onClick:n,fill:"outline"},"Cancel"),t.createElement(P.zx,{variant:"destructive",onClick:o},"Discard correlation"),t.createElement(P.zx,{variant:"primary",onClick:e},"Save correlation")));var to=u(61708),Ue=u(76152),Ee=u(89394),A=u(60930),D=u(43759),K=u(99022);const no=({panes:e})=>{const o=(0,w.useDispatch)(),n=(0,F.wW)(oo),s=(0,w.useSelector)(K.z7),[a,r]=(0,t.useState)(!1);Xn(s?.dirty||!1,"Save correlation?"),(0,t.useEffect)(()=>{s?.isExiting&&s?.dirty?r(!0):s?.isExiting&&!s?.dirty&&o((0,A.Hg)({editorMode:!1,dirty:!1,isExiting:!1}))},[s?.dirty,s?.isExiting,o]),(0,_n.Z)(()=>{o((0,A.Hg)({editorMode:!1,isExiting:!1,dirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(p=>{o((0,Ee.Oj)({exploreId:p[0],correlationEditorHelperData:void 0})),o((0,D.aA)({exploreId:p[0]}))})});const i=p=>{r(!1),o((0,A.YV)(p)),(0,z.ff)("grafana_explore_split_view_closed"),o((0,A.Hg)({editorMode:!0,isExiting:!1,dirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(g=>{o((0,Ee.Oj)({exploreId:g[0],correlationEditorHelperData:void 0})),o((0,D.aA)({exploreId:g[0]}))})},l=(p,g)=>{r(!1),o((0,Ue.zU)(p,g,{importQueries:!0})),o((0,A.Hg)({editorMode:!0,isExiting:!1,dirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(d=>{o((0,Ee.Oj)({exploreId:d[0],correlationEditorHelperData:void 0}))})},c=p=>{if(o((0,to.Q)(s?.label,s?.description)),!p&&s?.postConfirmAction!==void 0){const{exploreId:g,action:d,changeDatasourceUid:f}=s?.postConfirmAction;d===w.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?i(g):d===w.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&f!==void 0&&l(g,f)}else o((0,A.Hg)({editorMode:!1,dirty:!1,isExiting:!1}))};return t.createElement(t.Fragment,null,t.createElement(Kn.NL,{message:p=>p.pathname!=="/explore"&&s?.editorMode&&s?.dirty?"You have unsaved correlation data. Continue?":!0}),a&&t.createElement(eo,{onDiscard:()=>{if(s?.postConfirmAction!==void 0){const{exploreId:p,action:g,changeDatasourceUid:d}=s?.postConfirmAction;g===w.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?i(p):g===w.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&d!==void 0&&l(p,d)}else o((0,A.Hg)({editorMode:!1,dirty:!1,isExiting:!1}))},onCancel:()=>{o((0,A.Hg)({isExiting:!1})),r(!1)},onSave:()=>{c(!1)}}),t.createElement("div",{className:n.correlationEditorTop},t.createElement(Xt.Lh,{spacing:"md",justify:"flex-end"},t.createElement(we.u,{content:"Correlations editor in Explore is an experimental feature."},t.createElement(Ce.J,{className:n.iconColor,name:"info-circle",size:"xl"})),t.createElement(P.zx,{variant:"secondary",disabled:!s?.canSave,fill:"outline",className:s?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{c(!0)}},"Save"),t.createElement(P.zx,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{o((0,A.Hg)({isExiting:!0})),(0,z.ff)("grafana_explore_correlation_editor_exit_pressed")}},"Exit correlation editor"))))},oo=e=>{const o=e.colors.getContrastText(e.colors.primary.main),n=Rt.lighten(e.colors.primary.main,.1),s=Rt.darken(e.colors.primary.main,.2),a=Rt.darken(o,.2);return{correlationEditorTop:(0,h.css)({backgroundColor:e.colors.primary.main,marginTop:"3px",padding:e.spacing(1)}),iconColor:(0,h.css)({color:o}),buttonColor:(0,h.css)({color:o,borderColor:o,"&:hover":{color:o,borderColor:o,backgroundColor:n}}),disabledButtonColor:(0,h.css)({color:`${a} !important`,backgroundColor:`${s} !important`})}};var Tt=u(56425),st=u(97125),Lt=u(24677);const so=()=>{const[e,o]=(0,t.useState)([]),{query:n}=(0,Tt.useKBar)(),s=(0,w.useDispatch)(),a=(0,w.useSelector)(K.Ky),r=(0,w.useSelector)(K.pd),i=st.contextSrv.hasPermission(w.AccessControlAction.DataSourcesWrite);return(0,t.useEffect)(()=>{const l=Object.keys(a),c={name:"Explore",priority:Tt.Priority.HIGH+1},p=[];if(r)p.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{s((0,D.aA)({exploreId:l[0]}))},section:c}),a[1],p.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{s((0,D.aA)({exploreId:l[1]}))},section:c}),p.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{s((0,A.YV)(l[0]))},section:c}),p.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{s((0,A.YV)(l[1]))},section:c});else{const g=Object.values(a).some(d=>d?.datasourceInstance?.uid===Lt.D);Q.config.featureToggles.correlations&&i&&!g&&p.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{s((0,A.Hg)({editorMode:!0})),s((0,D.aA)({exploreId:l[0]}))},section:c}),p.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{s((0,D.aA)({exploreId:l[0]}))},section:c}),p.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{s((0,A.bW)())},section:c})}o(p)},[a,r,n,s,i]),(0,Tt.useRegisterActions)(n?e:[],[e,n]),null};var de=u(89772),zt=u(91395),at=u(28888),rt=u(64447),ce=u(44951),$=u(86832),Fe=u(16360),ao=u(19977),V=u(69323),B=u(10694),$e=u(26205),Ft=u(41804),_t=u(87320),je=u(55284),ro=u(30697),it=u(2190),en=u(948);const tn=(0,t.createContext)(void 0),io=({children:e})=>{const[o,n]=(0,t.useState)([]),s=(0,t.useCallback)(({title:r,icon:i,ref:l})=>{const c=(0,$.uniqueId)(`${r}-${i}_`);return n(p=>[...p,{id:c,title:r,icon:i,ref:l}].sort((d,f)=>{if(d.ref&&f.ref){const m=d.ref.compareDocumentPosition(f.ref);if(m===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(m===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0})),c},[]),a=(0,t.useCallback)(r=>{n(i=>i.filter(l=>l.id!==r))},[]);return t.createElement(tn.Provider,{value:{outlineItems:o,register:s,unregister:a}},e)};function nn(){const e=(0,t.useContext)(tn);if(!e)throw new Error("useContentOutlineContext must be used within a ContentOutlineContextProvider");return e}var lo=u(17393);function on({title:e,icon:o,tooltip:n,className:s,...a}){const r=(0,F.wW)(uo),i=(0,h.cx)(r.button,s),l=t.createElement("button",{className:i,"aria-label":n,...a},co(o),e);return n?t.createElement(we.u,{content:n,placement:"bottom"},l):l}function co(e){return e?(0,lo.Mo)(e)?t.createElement(Ce.J,{name:e,size:"lg"}):e:null}const uo=e=>({button:(0,h.css)({label:"content-outline-item-button",display:"flex",flexGrow:1,alignItems:"center",height:e.spacing(e.components.height.md),padding:e.spacing(0,1),gap:e.spacing(1),color:e.colors.text.secondary,background:"transparent",border:"none",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","&:hover":{color:e.colors.text.primary,background:e.colors.background.secondary,textDecoration:"underline"}})}),po=e=>({wrapper:(0,h.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:e.spacing(1),height:"100%",backgroundColor:e.colors.background.primary}),content:(0,h.css)({label:"content",top:0}),buttonStyles:(0,h.css)({textAlign:"left",width:"100%",padding:e.spacing(0,1.5)})});function go({scroller:e,panelId:o}){const[n,s]=(0,en.Z)(!1),a=(0,F.wW)(c=>po(c)),{outlineItems:r}=nn(),i=(c,p)=>{let g=0,d=c;do g+=d?.offsetTop||0,d=d?.offsetParent;while(d&&d!==e);e?.scroll({top:g,behavior:"smooth"}),(0,z.ff)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:p})},l=()=>{s(),(0,z.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n?"minimize":"expand"})};return t.createElement(Ft.l,{className:a.wrapper,id:o},t.createElement(rt.$,null,t.createElement("div",{className:a.content},t.createElement(on,{title:n?"Collapse outline":void 0,icon:n?"angle-left":"angle-right",onClick:l,tooltip:n?void 0:"Expand content outline",className:a.buttonStyles,"aria-expanded":n}),r.map(c=>t.createElement(on,{key:c.id,title:n?c.title:void 0,className:a.buttonStyles,icon:c.icon,onClick:()=>i(c.ref,c.title),tooltip:n?void 0:c.title})))))}function pe({title:e,icon:o,children:n,className:s}){const{register:a,unregister:r}=nn(),i=(0,t.useRef)(null);return(0,t.useEffect)(()=>{const l=a({title:e,icon:o,ref:i.current});return()=>r(l)},[e,o,a,r]),t.createElement("div",{className:s,ref:i},n)}var ho=u(14058),Ge=u(33155),lt=u(62818),ct=u(96227),sn=u(38637);const mo=({correlations:e})=>{const o=(0,w.useDispatch)(),{register:n,watch:s}=(0,ho.cI)(),[a,r]=(0,t.useState)(!1),i=(0,w.useSelector)(K.z7),l=(0,t.useId)();return(0,t.useEffect)(()=>{const c=s(p=>{let g=!1;!i?.dirty&&(p.label!==""||p.description!=="")?g=!0:i?.dirty&&p.label.trim()===""&&p.description.trim()===""&&(g=!1),o((0,A.Hg)({label:p.label,description:p.description,dirty:g}))});return()=>c.unsubscribe()},[i?.dirty,o,s]),(0,t.useEffect)(()=>(o((0,A.Hg)({canSave:!0})),()=>{o((0,A.Hg)({canSave:!1}))}),[o]),t.createElement(Ge.b,{title:"Correlation details",severity:"info"},"The correlation link will appear by the ",t.createElement("code",null,e.resultField)," field. You can use the following variables to set up your correlations:",t.createElement("pre",null,Object.entries(e.vars).map(c=>`\${${c[0]}} = ${c[1]}
`)),t.createElement(lt.U,{collapsible:!0,isOpen:a,onToggle:()=>{r(!a)},label:"Label/Description"},t.createElement(ct.g,{label:"Label",htmlFor:`${l}-label`},t.createElement(sn.I,{...n("label"),id:`${l}-label`})),t.createElement(ct.g,{label:"Description",htmlFor:`${l}-description`},t.createElement(sn.I,{...n("description"),id:`${l}-description`}))))};var ge=u(92403),fo=u(51103),yo=u(31276),Be=u(4185),vo=u(13090),Eo=u(46617);function xo({width:e,height:o,timeZone:n,state:s,pluginId:a,frames:r,absoluteRange:i,splitOpenFn:l,eventBus:c}){const p=(0,t.useMemo)(()=>({from:(0,ge.CQ)(i.from),to:(0,ge.CQ)(i.to),raw:{from:(0,ge.CQ)(i.from),to:(0,ge.CQ)(i.to)}}),[i.from,i.to]),g=(0,vo.pv)(a),f={dataLinkPostProcessor:(0,Eo.v)(l,p),eventBus:c,eventsScope:"explore"};return t.createElement(yo._w,{value:f},t.createElement(Be.fm,{title:g.name,width:e,height:o,loadingState:s},(m,y)=>t.createElement(fo.$,{data:{series:r,state:s,timeRange:p},pluginId:a,title:"",width:m,height:y,timeZone:n})))}var ke=u(96083),k=u(34547),an=u(77514),bo=u(49065),So=function(){var e=function(o,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},e(o,n)};return function(o,n){e(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),X=function(){return X=Object.assign||function(e){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},X.apply(this,arguments)},rn={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},ln={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},ut={width:"20px",height:"20px",position:"absolute"},wo={top:X(X({},rn),{top:"-5px"}),right:X(X({},ln),{left:void 0,right:"-5px"}),bottom:X(X({},rn),{top:void 0,bottom:"-5px"}),left:X(X({},ln),{left:"-5px"}),topRight:X(X({},ut),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:X(X({},ut),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:X(X({},ut),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:X(X({},ut),{left:"-10px",top:"-10px",cursor:"nw-resize"})},Co=function(e){So(o,e);function o(){var n=e!==null&&e.apply(this,arguments)||this;return n.onMouseDown=function(s){n.props.onResizeStart(s,n.props.direction)},n.onTouchStart=function(s){n.props.onResizeStart(s,n.props.direction)},n}return o.prototype.render=function(){return t.createElement("div",{className:this.props.className||"",style:X(X({position:"absolute",userSelect:"none"},wo[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},o}(t.PureComponent),Ro=function(){var e=function(o,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(s[r]=a[r])},e(o,n)};return function(o,n){e(o,n);function s(){this.constructor=o}o.prototype=n===null?Object.create(n):(s.prototype=n.prototype,new s)}}(),he=function(){return he=Object.assign||function(e){for(var o,n=1,s=arguments.length;n<s;n++){o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},he.apply(this,arguments)},To={width:"auto",height:"auto"},dt=function(e,o,n){return Math.max(Math.min(e,n),o)},cn=function(e,o){return Math.round(e/o)*o},We=function(e,o){return new RegExp(e,"i").test(o)},pt=function(e){return!!(e.touches&&e.touches.length)},Lo=function(e){return!!((e.clientX||e.clientX===0)&&(e.clientY||e.clientY===0))},un=function(e,o,n){n===void 0&&(n=0);var s=o.reduce(function(r,i,l){return Math.abs(i-e)<Math.abs(o[r]-e)?l:r},0),a=Math.abs(o[s]-e);return n===0||a<n?o[s]:e},Nt=function(e){return e=e.toString(),e==="auto"||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"},gt=function(e,o,n,s){if(e&&typeof e=="string"){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%")){var a=Number(e.replace("%",""))/100;return o*a}if(e.endsWith("vw")){var a=Number(e.replace("vw",""))/100;return n*a}if(e.endsWith("vh")){var a=Number(e.replace("vh",""))/100;return s*a}}return e},zo=function(e,o,n,s,a,r,i){return s=gt(s,e.width,o,n),a=gt(a,e.height,o,n),r=gt(r,e.width,o,n),i=gt(i,e.height,o,n),{maxWidth:typeof s>"u"?void 0:Number(s),maxHeight:typeof a>"u"?void 0:Number(a),minWidth:typeof r>"u"?void 0:Number(r),minHeight:typeof i>"u"?void 0:Number(i)}},Fo=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],dn="__resizable_base__",No=function(e){Ro(o,e);function o(n){var s=e.call(this,n)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var a=s.parentNode;if(!a)return null;var r=s.window.document.createElement("div");return r.style.width="100%",r.style.height="100%",r.style.position="absolute",r.style.transform="scale(0, 0)",r.style.left="0",r.style.flex="0 0 100%",r.classList?r.classList.add(dn):r.className+=dn,a.appendChild(r),r},s.removeBase=function(a){var r=s.parentNode;r&&r.removeChild(a)},s.ref=function(a){a&&(s.resizable=a)},s.state={isResizing:!1,width:typeof(s.propsSize&&s.propsSize.width)>"u"?"auto":s.propsSize&&s.propsSize.width,height:typeof(s.propsSize&&s.propsSize.height)>"u"?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return Object.defineProperty(o.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||To},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){var n=0,s=0;if(this.resizable&&this.window){var a=this.resizable.offsetWidth,r=this.resizable.offsetHeight,i=this.resizable.style.position;i!=="relative"&&(this.resizable.style.position="relative"),n=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:a,s=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:r,this.resizable.style.position=i}return{width:n,height:s}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sizeStyle",{get:function(){var n=this,s=this.props.size,a=function(l){if(typeof n.state[l]>"u"||n.state[l]==="auto")return"auto";if(n.propsSize&&n.propsSize[l]&&n.propsSize[l].toString().endsWith("%")){if(n.state[l].toString().endsWith("%"))return n.state[l].toString();var c=n.getParentSize(),p=Number(n.state[l].toString().replace("px","")),g=p/c[l]*100;return g+"%"}return Nt(n.state[l])},r=s&&typeof s.width<"u"&&!this.state.isResizing?Nt(s.width):a("width"),i=s&&typeof s.height<"u"&&!this.state.isResizing?Nt(s.height):a("height");return{width:r,height:i}},enumerable:!1,configurable:!0}),o.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var n=this.appendBase();if(!n)return{width:0,height:0};var s=!1,a=this.parentNode.style.flexWrap;a!=="wrap"&&(s=!0,this.parentNode.style.flexWrap="wrap"),n.style.position="relative",n.style.minWidth="100%",n.style.minHeight="100%";var r={width:n.offsetWidth,height:n.offsetHeight};return s&&(this.parentNode.style.flexWrap=a),this.removeBase(n),r},o.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},o.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},o.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var n=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:n.flexBasis!=="auto"?n.flexBasis:void 0})}},o.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},o.prototype.createSizeForCssProperty=function(n,s){var a=this.propsSize&&this.propsSize[s];return this.state[s]==="auto"&&this.state.original[s]===n&&(typeof a>"u"||a==="auto")?"auto":n},o.prototype.calculateNewMaxFromBoundary=function(n,s){var a=this.props.boundsByDirection,r=this.state.direction,i=a&&We("left",r),l=a&&We("top",r),c,p;if(this.props.bounds==="parent"){var g=this.parentNode;g&&(c=i?this.resizableRight-this.parentLeft:g.offsetWidth+(this.parentLeft-this.resizableLeft),p=l?this.resizableBottom-this.parentTop:g.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(c=i?this.resizableRight:this.window.innerWidth-this.resizableLeft,p=l?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(c=i?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),p=l?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return c&&Number.isFinite(c)&&(n=n&&n<c?n:c),p&&Number.isFinite(p)&&(s=s&&s<p?s:p),{maxWidth:n,maxHeight:s}},o.prototype.calculateNewSizeFromDirection=function(n,s){var a=this.props.scale||1,r=this.props.resizeRatio||1,i=this.state,l=i.direction,c=i.original,p=this.props,g=p.lockAspectRatio,d=p.lockAspectRatioExtraHeight,f=p.lockAspectRatioExtraWidth,m=c.width,y=c.height,v=d||0,x=f||0;return We("right",l)&&(m=c.width+(n-c.x)*r/a,g&&(y=(m-x)/this.ratio+v)),We("left",l)&&(m=c.width-(n-c.x)*r/a,g&&(y=(m-x)/this.ratio+v)),We("bottom",l)&&(y=c.height+(s-c.y)*r/a,g&&(m=(y-v)*this.ratio+x)),We("top",l)&&(y=c.height-(s-c.y)*r/a,g&&(m=(y-v)*this.ratio+x)),{newWidth:m,newHeight:y}},o.prototype.calculateNewSizeFromAspectRatio=function(n,s,a,r){var i=this.props,l=i.lockAspectRatio,c=i.lockAspectRatioExtraHeight,p=i.lockAspectRatioExtraWidth,g=typeof r.width>"u"?10:r.width,d=typeof a.width>"u"||a.width<0?n:a.width,f=typeof r.height>"u"?10:r.height,m=typeof a.height>"u"||a.height<0?s:a.height,y=c||0,v=p||0;if(l){var x=(f-y)*this.ratio+v,E=(m-y)*this.ratio+v,b=(g-v)/this.ratio+y,R=(d-v)/this.ratio+y,T=Math.max(g,x),C=Math.min(d,E),I=Math.max(f,b),W=Math.min(m,R);n=dt(n,T,C),s=dt(s,I,W)}else n=dt(n,g,d),s=dt(s,f,m);return{newWidth:n,newHeight:s}},o.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var n=this.parentNode;if(n){var s=n.getBoundingClientRect();this.parentLeft=s.left,this.parentTop=s.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var a=this.props.bounds.getBoundingClientRect();this.targetLeft=a.left,this.targetTop=a.top}if(this.resizable){var r=this.resizable.getBoundingClientRect(),i=r.left,l=r.top,c=r.right,p=r.bottom;this.resizableLeft=i,this.resizableRight=c,this.resizableTop=l,this.resizableBottom=p}},o.prototype.onResizeStart=function(n,s){if(!(!this.resizable||!this.window)){var a=0,r=0;if(n.nativeEvent&&Lo(n.nativeEvent)?(a=n.nativeEvent.clientX,r=n.nativeEvent.clientY):n.nativeEvent&&pt(n.nativeEvent)&&(a=n.nativeEvent.touches[0].clientX,r=n.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var i=this.props.onResizeStart(n,s,this.resizable);if(i===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var l,c=this.window.getComputedStyle(this.resizable);if(c.flexBasis!=="auto"){var p=this.parentNode;if(p){var g=this.window.getComputedStyle(p).flexDirection;this.flexDir=g.startsWith("row")?"row":"column",l=c.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var d={original:{x:a,y:r,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:he(he({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(n.target).cursor||"auto"}),direction:s,flexBasis:l};this.setState(d)}},o.prototype.onMouseMove=function(n){var s=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&pt(n))try{n.preventDefault(),n.stopPropagation()}catch{}var a=this.props,r=a.maxWidth,i=a.maxHeight,l=a.minWidth,c=a.minHeight,p=pt(n)?n.touches[0].clientX:n.clientX,g=pt(n)?n.touches[0].clientY:n.clientY,d=this.state,f=d.direction,m=d.original,y=d.width,v=d.height,x=this.getParentSize(),E=zo(x,this.window.innerWidth,this.window.innerHeight,r,i,l,c);r=E.maxWidth,i=E.maxHeight,l=E.minWidth,c=E.minHeight;var b=this.calculateNewSizeFromDirection(p,g),R=b.newHeight,T=b.newWidth,C=this.calculateNewMaxFromBoundary(r,i);this.props.snap&&this.props.snap.x&&(T=un(T,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(R=un(R,this.props.snap.y,this.props.snapGap));var I=this.calculateNewSizeFromAspectRatio(T,R,{width:C.maxWidth,height:C.maxHeight},{width:l,height:c});if(T=I.newWidth,R=I.newHeight,this.props.grid){var W=cn(T,this.props.grid[0]),Z=cn(R,this.props.grid[1]),U=this.props.snapGap||0;T=U===0||Math.abs(W-T)<=U?W:T,R=U===0||Math.abs(Z-R)<=U?Z:R}var J={width:T-m.width,height:R-m.height};if(y&&typeof y=="string"){if(y.endsWith("%")){var S=T/x.width*100;T=S+"%"}else if(y.endsWith("vw")){var L=T/this.window.innerWidth*100;T=L+"vw"}else if(y.endsWith("vh")){var Y=T/this.window.innerHeight*100;T=Y+"vh"}}if(v&&typeof v=="string"){if(v.endsWith("%")){var S=R/x.height*100;R=S+"%"}else if(v.endsWith("vw")){var L=R/this.window.innerWidth*100;R=L+"vw"}else if(v.endsWith("vh")){var Y=R/this.window.innerHeight*100;R=Y+"vh"}}var O={width:this.createSizeForCssProperty(T,"width"),height:this.createSizeForCssProperty(R,"height")};this.flexDir==="row"?O.flexBasis=O.width:this.flexDir==="column"&&(O.flexBasis=O.height),(0,bo.flushSync)(function(){s.setState(O)}),this.props.onResize&&this.props.onResize(n,f,this.resizable,J)}},o.prototype.onMouseUp=function(n){var s=this.state,a=s.isResizing,r=s.direction,i=s.original;if(!(!a||!this.resizable)){var l={width:this.size.width-i.width,height:this.size.height-i.height};this.props.onResizeStop&&this.props.onResizeStop(n,r,this.resizable,l),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:he(he({},this.state.backgroundStyle),{cursor:"auto"})})}},o.prototype.updateSize=function(n){this.setState({width:n.width,height:n.height})},o.prototype.renderResizer=function(){var n=this,s=this.props,a=s.enable,r=s.handleStyles,i=s.handleClasses,l=s.handleWrapperStyle,c=s.handleWrapperClass,p=s.handleComponent;if(!a)return null;var g=Object.keys(a).map(function(d){return a[d]!==!1?t.createElement(Co,{key:d,direction:d,onResizeStart:n.onResizeStart,replaceStyles:r&&r[d],className:i&&i[d]},p&&p[d]?p[d]:null):null});return t.createElement("div",{className:c,style:l},g)},o.prototype.render=function(){var n=this,s=Object.keys(this.props).reduce(function(i,l){return Fo.indexOf(l)!==-1||(i[l]=n.props[l]),i},{}),a=he(he(he({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(a.flexBasis=this.state.flexBasis);var r=this.props.as||"div";return t.createElement(r,he({ref:this.ref,style:a,className:this.props.className},s),this.state.isResizing&&t.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},o.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},o}(t.PureComponent),Io=u(64084);const Oo=e=>(0,h.keyframes)`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,Ho=(0,Io.B)(e=>({container:(0,h.css)`
      position: fixed !important;
      bottom: 0;
      background: ${e.colors.background.primary};
      border-top: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(0,-2,0,-2)};
      box-shadow: ${e.shadows.z3};
      z-index: ${e.zIndex.navbarFixed};
    `,drawerActive:(0,h.css)`
      opacity: 1;
      animation: 0.5s ease-out ${Oo(e)};
    `,rzHandle:(0,h.css)`
      background: ${e.colors.secondary.main};
      transition: 0.3s background ease-in-out;
      position: relative;
      width: 200px !important;
      height: 7px !important;
      left: calc(50% - 100px) !important;
      top: -4px !important;
      cursor: grab;
      border-radius: ${e.shape.radius.pill};
      &:hover {
        background: ${e.colors.secondary.shade};
      }
    `}));function pn(e){const{width:o,children:n,onResize:s}=e,a=(0,F.l4)(),r=Ho(a),i=`${o+31.5}px`;return t.createElement(No,{className:(0,h.cx)(r.container,r.drawerActive),defaultSize:{width:i,height:`${a.components.horizontalDrawer.defaultHeight}px`},handleClasses:{top:r.rzHandle},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",maxWidth:i,minWidth:i,onResize:s},n)}var Do=u(66155),Po=u(90131),Ao=u(61333),Mo=u(68716),$o=u(69496);function Bo(e){const{width:o,onClose:n,queryResponse:s,timeZone:a}=e,r=s?.series||[];let i=s?.errors;!i?.length&&s?.error&&(i=[s.error]),(0,t.useEffect)(()=>{(0,z.ff)("grafana_explore_query_inspector_opened")},[]);const l={label:"Stats",value:"stats",icon:"chart-line",content:t.createElement(Mo.f,{data:s,timeZone:s?.request?.timezone??k.iT})},c={label:"JSON",value:"json",icon:"brackets-curly",content:t.createElement(Ao.W,{data:s,onClose:n})},p={label:"Data",value:"data",icon:"database",content:t.createElement(Do.E,{data:r,dataName:"Explore",isLoading:s.state===B.Gu.Loading,options:{withTransforms:!1,withFieldConfig:!1},timeZone:a,app:ke.zj.Explore})},g={label:"Query",value:"query",icon:"info-circle",content:t.createElement($o.D,{data:s,onRefreshQuery:()=>e.runQueries({exploreId:e.exploreId})})},d=[l,g,c,p];if(i?.length){const f={label:"Error",value:"error",icon:"exclamation-triangle",content:t.createElement(Po.l,{errors:i})};d.push(f)}return t.createElement(pn,{width:o},t.createElement(an.W,{tabs:d,onClose:n,closeIconTooltip:"Close query inspector"}))}function ko(e,{exploreId:o}){const s=e.explore.panes[o],{queryResponse:a}=s;return{queryResponse:a}}const Wo={runQueries:D.aA},Qo=(0,de.connect)(ko,Wo)(Bo);var Vo=u(45679),Uo=u(44138),re=u(3839),gn=u(48824),ht=u(82563),jo=u(16924),oe=u(62679),It=u(37965),Go=u(92811),Ot=u(69873),ie=u(28804),Ht=u(21308),Zo=u(86276),hn=u(16920),mn=u(77877),Yo=u(74480),fn=u(56858);function qo(e){const{onClick:o,isSynced:n}=e,s=()=>{const{isSynced:a}=e,r=a?"Unsync all views":"Sync all views to this time range";return t.createElement(t.Fragment,null,r)};return t.createElement(we.u,{content:s,placement:"bottom"},t.createElement(re.h,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:o}))}class Ko extends t.Component{constructor(){super(...arguments),this.onMoveTimePicker=o=>{const{range:n,onChangeTime:s,timeZone:a}=this.props,{from:r,to:i}=(0,fn.e)(o,n),l={from:(0,ge.GY)(a,r),to:(0,ge.GY)(a,i)};s(l)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=o=>{const n=mn.isMathString(o.raw.from)?o.raw.from:o.from,s=mn.isMathString(o.raw.to)?o.raw.to:o.to;this.props.onChangeTime({from:n,to:s}),(0,z.ff)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:s})},this.onZoom=()=>{const{range:o,onChangeTime:n,timeZone:s}=this.props,{from:a,to:r}=(0,fn.h)(o,2),i={from:(0,ge.GY)(s,a),to:(0,ge.GY)(s,r)};n(i)}}render(){const{range:o,timeZone:n,fiscalYearStartMonth:s,splitted:a,syncedTimes:r,onChangeTimeSync:i,hideText:l,onChangeTimeZone:c,onChangeFiscalYearStartMonth:p}=this.props,g=a?t.createElement(qo,{onClick:i,isSynced:r}):void 0,d={value:o,timeZone:n,fiscalYearStartMonth:s,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:l};return t.createElement(Yo.a,{isOnCanvas:!0,...d,timeSyncButton:g,isSynced:r,widthOverride:a?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:c,onChangeFiscalYearStartMonth:p})}}var yn=u(17088);function Jo(e){const{start:o,pause:n,resume:s,isLive:a,isPaused:r,stop:i,splitted:l}=e,c=a&&!r?"active":"canvas",p=a?r?s:n:o;return t.createElement(gn.h,null,t.createElement(we.u,{content:a&&!r?t.createElement(t.Fragment,null,"Pause the live stream"):t.createElement(t.Fragment,null,"Start live stream your logs"),placement:"bottom"},t.createElement(re.h,{iconOnly:l,variant:c,icon:!a||r?"play":"pause",onClick:p},a&&r?"Paused":"Live")),t.createElement(yn.Z,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:a,classNames:{enter:mt.stopButtonEnter,enterActive:mt.stopButtonEnterActive,exit:mt.stopButtonExit,exitActive:mt.stopButtonExitActive}},t.createElement(we.u,{content:t.createElement(t.Fragment,null,"Stop and exit the live stream"),placement:"bottom"},t.createElement(re.h,{variant:c,onClick:i,icon:"square-shape"}))))}const mt={stopButtonEnter:(0,h.css)`
    label: stopButtonEnter;
    width: 0;
    opacity: 0;
    overflow: hidden;
  `,stopButtonEnterActive:(0,h.css)`
    label: stopButtonEnterActive;
    opacity: 1;
    width: 32px;
  `,stopButtonExit:(0,h.css)`
    label: stopButtonExit;
    width: 32px;
    opacity: 1;
    overflow: hidden;
  `,stopButtonExitActive:(0,h.css)`
    label: stopButtonExitActive;
    opacity: 0;
    width: 0;
  `};var Xo=u(73),_o=u(41175),es=u(44076),vn=u(58047),ts=u(57837),ns=u(13601);function os(e){const{onDismiss:o,path:n,title:s}=e,a=()=>{u.g.open(ts.u.assureBaseUrl(n),"_blank"),o()},r=()=>ns.E1.push(n);return t.createElement(Me.u,{title:s,isOpen:!0,onDismiss:o},t.createElement(Xt.wc,{spacing:"sm"},t.createElement("p",null,"Do you want to proceed in the current tab or open a new tab?")),t.createElement(Me.u.ButtonRow,null,t.createElement(P.zx,{onClick:o,fill:"outline",variant:"secondary"},"Cancel"),t.createElement(P.zx,{type:"submit",variant:"secondary",onClick:a,icon:"external-link-alt"},"Open in new tab"),t.createElement(P.zx,{type:"submit",variant:"primary",onClick:r,icon:"apps"},"Open")))}var Ne=u(13767),En=u(72137);function ss({extensions:e,onSelect:o}){const{categorised:n,uncategorised:s}=as(e),a=s.length>0&&Object.keys(n).length>0;return t.createElement(Ne.v,null,t.createElement(t.Fragment,null,Object.keys(n).map(r=>t.createElement(Ne.v.Group,{key:r,label:(0,En.ew)(r,25)},xn(n[r],o))),a&&t.createElement(Ne.v.Divider,{key:"divider"}),xn(s,o)))}function xn(e,o){return e.map(n=>t.createElement(Ne.v.Item,{ariaLabel:n.title,icon:n?.icon||"plug",key:n.id,label:(0,En.ew)(n.title,25),onClick:s=>{if(n.path)return o(n);n.onClick?.(s)}}))}function as(e){return(0,t.useMemo)(()=>{const o=[],n={};for(const s of e){if(!s.category){o.push(s);continue}Array.isArray(n[s.category])||(n[s.category]=[]),n[s.category].push(s)}return{uncategorised:o,categorised:n}},[e])}const rs=(0,t.lazy)(()=>u.e(5475).then(u.bind(u,35475)).then(({AddToDashboard:e})=>({default:e})));function is(e){const{exploreId:o,splitted:n}=e,[s,a]=(0,t.useState)(),[r,i]=(0,t.useState)(!1),l=ls(e),c=cs(l),p=(0,K.F9)(o),g=(0,w.useSelector)(p)?.queries?.length;if(c.length<=1)return st.contextSrv.hasPermission(w.AccessControlAction.DashboardsCreate)||st.contextSrv.hasPermission(w.AccessControlAction.DashboardsWrite)?t.createElement(t.Suspense,{fallback:null},t.createElement(rs,{exploreId:o})):null;const d=t.createElement(ss,{extensions:c,onSelect:a});return t.createElement(t.Fragment,null,t.createElement(vn.L,{onVisibleChange:i,placement:"bottom-start",overlay:d},t.createElement(re.h,{"aria-label":"Add",icon:"plus",disabled:!g,variant:"canvas",isOpen:r},n?" ":"Add")),!!s&&!!s.path&&t.createElement(os,{path:s.path,title:s.title,onDismiss:()=>a(void 0)}))}function ls(e){const{exploreId:o,timeZone:n}=e,a=(0,w.useSelector)(K.z7)?.editorMode||!1,{queries:r,queryResponse:i,range:l}=(0,w.useSelector)((0,K.F9)(o)),c=(0,w.useSelector)((0,K.aM)(o)),p=r.map(f=>f?.datasource?.uid).filter(f=>f!==void 0),g=[...new Set(p)].length,d=st.contextSrv.hasPermission(w.AccessControlAction.DataSourcesWrite);return(0,t.useMemo)(()=>({exploreId:o,targets:r,data:i,timeRange:l.raw,timeZone:(0,Xo.Z)({timeZone:n}),shouldShowAddCorrelation:Q.config.featureToggles.correlations===!0&&d&&!a&&c&&g===1}),[o,r,i,l.raw,n,d,a,c,g])}function cs(e){return(0,t.useMemo)(()=>{const{extensions:o}=(0,es.dj)({extensionPointId:_o.y.ExploreToolbarAction,context:e,limitPerPlugin:3});return o},[e])}var ue=u(21141);function us(e){const o=(0,w.useDispatch)(),n=(0,t.useCallback)(()=>{o((0,D.sQ)({exploreId:e,isPaused:!0}))},[e,o]),s=(0,t.useCallback)(()=>{o((0,D.sQ)({exploreId:e,isPaused:!1}))},[e,o]),a=(0,t.useCallback)(()=>{n(),o((0,ue.oz)({exploreId:e,refreshInterval:ht.dP.offOption.value})),o((0,D.aA)({exploreId:e}))},[e,o,n]),r=(0,t.useCallback)(()=>{o((0,ue.oz)({exploreId:e,refreshInterval:ht.dP.liveOption.value}))},[e,o]),i=(0,t.useCallback)(()=>{o((0,D.Sv)({exploreId:e}))},[e,o]);return{pause:n,resume:s,stop:a,start:r,clear:i}}function bn(e){const o=us(e.exploreId);return e.children(o)}const ds=(e,o)=>({rotateIcon:(0,h.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,h.css)({display:"flex",justifyContent:"center",marginRight:e.spacing(.5),width:o&&e.spacing(6)})});function ps({exploreId:e,topOfViewRef:o,onChangeTime:n,onContentOutlineToogle:s,isContentOutlineOpen:a}){const r=(0,ie.I0)(),i=(0,ie.v9)(K.pd),l=(0,F.wW)(ds,i),c=(0,ie.v9)(H=>(0,it.Z)(H.user)),p=(0,ie.v9)(H=>(0,it.i)(H.user)),{refreshInterval:g,datasourceInstance:d,range:f,isLive:m,isPaused:y,syncedTimes:v}=(0,ie.v9)(H=>({...(0,$.pick)(H.explore.panes[e],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:H.explore.syncedTimes}),de.shallowEqual),x=(0,ie.v9)((0,D.$9)(e)),E=(0,ie.v9)(H=>H.explore.largerExploreId===e),b=(0,ie.v9)(H=>i||H.explore.panes[e].containerWidth<1210),R=(0,ie.v9)(H=>H.explore.panes[e].containerWidth<(i?700:800)),T=(0,ie.v9)(K.M),C=(0,ie.v9)(K.z7),I=C?.editorMode||!1,W=(0,ie.v9)((0,K.aM)(e)),Z=(0,t.useMemo)(()=>W&&E||!W&&!E,[W,E]),U=x?(0,oe.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,oe.t)("explore.toolbar.refresh-picker-run","Run query"),J=()=>{(0,It.L)(u.g.location.href),(0,z.ff)("grafana_explore_shortened_link_clicked")},S=async H=>{I?C?.dirty?r((0,A.Hg)({isExiting:!0,postConfirmAction:{exploreId:e,action:Ot.iJ.CHANGE_DATASOURCE,changeDatasourceUid:H.uid}})):(W&&T.forEach(M=>{r((0,Ee.Oj)({exploreId:M[0],correlationEditorHelperData:void 0}))}),r((0,Ue.zU)(e,H.uid,{importQueries:!0}))):r((0,Ue.zU)(e,H.uid,{importQueries:!0}))},L=(H=!1)=>r(H?(0,D.ci)(e):(0,D.aA)({exploreId:e})),Y=H=>r((0,hn.YT)(H)),O=()=>{r((0,A.bW)()),(0,z.ff)("grafana_explore_split_view_opened",{origin:"menu"})},ye=()=>{I?C?.dirty?r((0,A.Hg)({isExiting:!0,postConfirmAction:{exploreId:e,action:Ot.iJ.CLOSE_PANE}})):(T.forEach(H=>{r((0,Ee.Oj)({exploreId:H[0],correlationEditorHelperData:void 0}))}),r((0,A.YV)(e)),(0,z.ff)("grafana_explore_split_view_closed")):(r((0,A.YV)(e)),(0,z.ff)("grafana_explore_split_view_closed"))},ve=()=>{r(E?(0,A.AP)():(0,A.nL)({exploreId:e}))},le=()=>{r((0,ue.mG)(e))},Oe=H=>r((0,hn.rf)(H)),Te=H=>{r((0,ue.oz)({exploreId:e,refreshInterval:H}))},He=[t.createElement(Zo.u,{key:"share",tooltip:(0,oe.t)("explore.toolbar.copy-shortened-link","Copy shortened link"),icon:"share-alt",onClick:J,"aria-label":(0,oe.t)("explore.toolbar.copy-shortened-link","Copy shortened link")}),t.createElement("div",{style:{flex:1},key:"spacer0"})];return t.createElement("div",{ref:o},g&&t.createElement(Vo.F,{func:L,interval:g,loading:x}),t.createElement("div",{ref:o},t.createElement(jo.A,{actions:He})),t.createElement(Uo.X,{"aria-label":(0,oe.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[Q.config.featureToggles.exploreContentOutline&&t.createElement(re.h,{key:"content-outline",variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:i,onClick:s,"aria-expanded":a,"aria-controls":a?"content-outline-container":void 0,className:l.toolbarButton},"Outline"),t.createElement(Go.q,{key:`${e}-ds-picker`,mixed:!I,onChange:S,current:d?.getRef(),hideTextValue:R,width:R?8:void 0})].filter(Boolean),forceShowLeftItems:!0},[i?t.createElement(gn.h,{key:"split-controls"},t.createElement(re.h,{variant:"canvas",tooltip:E?(0,oe.t)("explore.toolbar.split-narrow","Narrow pane"):(0,oe.t)("explore.toolbar.split-widen","Widen pane"),onClick:ve,icon:E?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,h.cx)(Z&&l.rotateIcon)}),t.createElement(re.h,{tooltip:(0,oe.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:ye,icon:"times",variant:"canvas"},t.createElement(oe.cC,{i18nKey:"explore.toolbar.split-close"}," Close "))):t.createElement(re.h,{variant:"canvas",key:"split",tooltip:(0,oe.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:O,icon:"columns",disabled:m},t.createElement(oe.cC,{i18nKey:"explore.toolbar.split-title"},"Split")),t.createElement(is,{splitted:i,key:"toolbar-extension-point",exploreId:e,timeZone:c}),!m&&t.createElement(Ko,{key:"timeControls",exploreId:e,range:f,timeZone:c,fiscalYearStartMonth:p,onChangeTime:n,splitted:i,syncedTimes:v,onChangeTimeSync:le,hideText:b,onChangeTimeZone:Y,onChangeFiscalYearStartMonth:Oe}),t.createElement(ht.dP,{key:"refreshPicker",onIntervalChanged:Te,value:g,isLoading:x,text:b?void 0:U,tooltip:b?U:void 0,intervals:Ht.Vt.getValidIntervals(ht.o5),isLive:m,onRefresh:()=>L(x),noIntervalPicker:m,primary:!0,width:(b?35:108)+"px"}),d?.meta.streaming&&t.createElement(bn,{key:"liveControls",exploreId:e},H=>{const M={...H,start:()=>{(0,z.ff)("grafana_explore_logs_live_tailing_clicked",{datasourceType:d?.type}),H.start()}};return t.createElement(Jo,{splitted:i,isLive:m,isPaused:y,start:M.start,pause:M.pause,resume:M.resume,stop:M.stop})})].filter(Boolean)))}var gs=u(56626);function ft(e,o={}){(0,z.ff)(`grafana_flamegraph_${e}`,{app:ke.zj.Unknown,grafana_version:Q.config.buildInfo.version,...o})}const hs=e=>{const o=(0,F.wW)(n=>ms(n));return t.createElement("div",{className:o.container},t.createElement(gs.Z,{data:e.dataFrames[0],stickyHeader:!0,getTheme:()=>Q.config.theme2,onTableSymbolClick:()=>ft("table_item_selected"),onViewSelected:n=>ft("view_selected",{view:n}),onTextAlignSelected:n=>ft("text_align_selected",{align:n}),onTableSort:n=>ft("table_sort_selected",{sort:n})}))},ms=e=>({container:(0,h.css)`
    background: ${e.colors.background.primary};
    display: flow-root;
    padding: 0 ${e.spacing(1)} ${e.spacing(1)} ${e.spacing(1)};
    border: 1px solid ${e.components.panel.borderColor};
    border-radius: ${e.shape.radius.default};
  `});var fs=u(38476),Ze=u(42512),Sn=u(63374),Dt=u(48069),ys=u(64128),vs=u(6275),me=u(20810),Es=u(21891),xs=u(32566);const wn=150,bs=({resetKey:e,humanize:o,className:n})=>{const[s,a]=(0,t.useState)(0);return(0,Es.Z)(()=>a(s+wn),wn),(0,t.useEffect)(()=>a(0),[e]),t.createElement(xs.q,{timeInMs:s,className:n,humanize:o})};var xe=u(47203);const Ss=e=>({logsRowsLive:(0,h.css)`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:(0,h.css)`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${(0,Sn.Z)(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${(0,Sn.Z)(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:(0,h.css)`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:(0,h.css)`
    margin-right: ${e.spacing(1)};
  `,fullWidth:(0,h.css)`
    width: 100%;
  `});class ws extends t.PureComponent{constructor(o){super(o),this.liveEndDiv=null,this.scrollContainerRef=t.createRef(),this.onScroll=n=>{const{isPaused:s,onPause:a}=this.props,{scrollTop:r,clientHeight:i,scrollHeight:l}=n.currentTarget;l-(r+i)>=5&&!s&&a()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:s=[]}=this.state;return n||(s=(0,me.$u)(s,k.UV.Ascending).slice(-100)),s},this.state={logRowsToRender:o.logRows}}static getDerivedStateFromProps(o,n){return o.isPaused&&o.clearedAtIndex?{logRowsToRender:(0,xe.bG)(o.clearedAtIndex,n.logRowsToRender)}:o.isPaused?null:{logRowsToRender:o.logRows}}render(){const{theme:o,timeZone:n,onPause:s,onResume:a,onClear:r,isPaused:i}=this.props,l=Ss(o),{logsRow:c,logsRowLocalTime:p,logsRowMessage:g}=(0,vs.h)(o);return t.createElement("div",null,t.createElement("table",{className:l.fullWidth},t.createElement("tbody",{onScroll:i?void 0:this.onScroll,className:l.logsRowsLive,ref:this.scrollContainerRef},this.rowsToRender().map(d=>t.createElement("tr",{className:(0,h.cx)(c,l.logsRowFade),key:d.uid},t.createElement("td",{className:p},(0,Dt.dq)(d.timeEpochMs,{timeZone:n})),t.createElement("td",{className:g},d.hasAnsi?t.createElement(ys.Q,{value:d.raw}):d.entry))),t.createElement("tr",{ref:d=>{this.liveEndDiv=d,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!i&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}}))),t.createElement("div",{className:l.logsRowsIndicator},t.createElement(P.zx,{icon:i?"play":"pause",variant:"secondary",onClick:i?a:s,className:l.button},i?"Resume":"Pause"),t.createElement(P.zx,{icon:"trash-alt",variant:"secondary",onClick:r,className:l.button},"Clear logs"),t.createElement(P.zx,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:l.button},"Exit live mode"),i||this.rowsToRender().length>0&&t.createElement("span",null,"Last line received: ",t.createElement(bs,{resetKey:this.props.logRows,humanize:!0})," ago")))}}const Cs=(0,F.HE)(ws);var Cn=u(36316),Pt=u(69307),Rs=u(81626),yt=u(20454),Ts=u(74661),be=u(69171),Re=u(26286),j=u(23062),Ye=u(74600),qe=u(83617),Rn=u(20653);const G={showLabels:"grafana.explore.logs.showLabels",showTime:"grafana.explore.logs.showTime",wrapLogMessage:"grafana.explore.logs.wrapLogMessage",prettifyLogMessage:"grafana.explore.logs.prettifyLogMessage",logsSortOrder:"grafana.explore.logs.sortOrder",logContextWrapLogMessage:"grafana.explore.logs.logContext.wrapLogMessage"};var vt=u(41891),Et=u(28409);const Tn=({place:e})=>{const o=e==="above"?"Loading newer logs...":"Loading older logs...";return t.createElement("div",{className:Ls},t.createElement("div",null,o," ",t.createElement(Et.$,{inline:!0})))},Ls=(0,h.css)`
  display: flex;
  justify-content: center;
`;function zs(e){return{buttons:(0,h.css)({display:"flex",gap:e.spacing(1)})}}const Fs=e=>{const o=(0,F.wW)(zs),{wrapLines:n,onChangeWrapLines:s,onScrollCenterClick:a}=e,r=(0,t.useCallback)(i=>{const l=i.currentTarget.checked;(0,z.ff)("grafana_explore_logs_log_context_toggle_lines_clicked",{state:l}),s(l)},[s]);return t.createElement("div",{className:o.buttons},t.createElement(Re.x,{showLabel:!0,value:n,onChange:r,label:"Wrap lines"}),t.createElement(P.zx,{variant:"secondary",onClick:a},"Center matched line"))},Ns=e=>({modal:(0,h.css)`
      width: 85vw;
      ${e.breakpoints.down("md")} {
        width: 100%;
      }
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    `,sticky:(0,h.css)`
      position: sticky;
      z-index: 1;
      top: -1px;
      bottom: -1px;
    `,entry:(0,h.css)`
      & > td {
        padding: ${e.spacing(1)} 0 ${e.spacing(1)} 0;
      }
      background: ${e.colors.emphasize(e.colors.background.secondary)};

      & > table {
        margin-bottom: 0;
      }

      & .log-row-menu {
        margin-top: -6px;
      }
    `,datasourceUi:(0,h.css)`
      padding-bottom: ${e.spacing(1.25)};
      display: flex;
      align-items: center;
    `,logRowGroups:(0,h.css)`
      overflow: auto;
      max-height: 75%;
      align-self: stretch;
      display: inline-block;
      border: 1px solid ${e.colors.border.weak};
      border-radius: ${e.shape.radius.default};
      & > table {
        min-width: 100%;
      }
    `,flexColumn:(0,h.css)`
      display: flex;
      flex-direction: column;
      padding: 0 ${e.spacing(3)} ${e.spacing(3)} ${e.spacing(3)};
    `,flexRow:(0,h.css)`
      display: flex;
      flex-direction: row;
      align-items: center;
      & > div:last-child {
        margin-left: auto;
      }
    `,noMarginBottom:(0,h.css)`
      & > table {
        margin-bottom: 0;
      }
    `,hidden:(0,h.css)`
      display: none;
    `,paddingTop:(0,h.css)`
      padding-top: ${e.spacing(1)};
    `,paddingBottom:(0,h.css)`
      padding-bottom: ${e.spacing(1)};
    `,link:(0,h.css)`
      color: ${e.colors.text.secondary};
      font-size: ${e.typography.bodySmall.fontSize};
      :hover {
        color: ${e.colors.text.link};
      }
    `,loadingCell:(0,h.css)`
      position: sticky;
      left: 50%;
      display: inline-block;
      transform: translateX(-50%);
    `}),Ln=()=>({above:{loadingState:B.Gu.NotStarted,rows:[]},below:{loadingState:B.Gu.NotStarted,rows:[]}}),Is=(e,o)=>e==="above"&&o===k.UV.Descending||e==="below"&&o===k.UV.Ascending?V.M4.Forward:V.M4.Backward,Os=(e,o)=>({...e,dataFrame:{...e.dataFrame,refId:`context_${o.above}_${o.below}`}}),Hs=(e,o)=>e.some(n=>n.entry===o.entry&&n.timeEpochNs===o.timeEpochNs),Ds=100,Ps=({row:e,open:o,logsSortOrder:n,timeZone:s,getLogRowContextUi:a,getRowContextQuery:r,onClose:i,getRowContext:l})=>{const c=(0,t.useRef)(null),p=(0,t.useRef)(null),g=(0,t.useRef)(null),d=(0,t.useRef)(null),f=(0,t.useRef)(null),m=(0,t.useRef)(null),y=(0,t.useRef)(null),v=(0,t.useRef)({above:0,below:0}),x=(0,w.useDispatch)(),E=(0,F.l4)(),b=Ns(E),[R,T]=(0,t.useState)(!0),[C,I]=(0,t.useState)(Ln()),W=(N,_)=>{I(q=>{const ee={...q};return ee[N]=_(q[N]),ee})},Z=(0,t.useRef)(1),[U,J]=(0,t.useState)(null),[S,L]=(0,t.useState)(j.Z.getBool(G.logContextWrapLogMessage,j.Z.getBool(G.wrapLogMessage,!0))),Y=(0,t.useCallback)(()=>{const{below:N,above:_}=C,q=(0,me.$u)([...N.rows,e,..._.rows],k.UV.Ascending),ee=q[0].timeEpochMs;let ne=q[q.length-1].timeEpochMs;ee===ne&&(ne+=1);const ae=(0,ge.CQ)(ee),De=(0,ge.CQ)(ne);return{from:ae,to:De,raw:{from:ae,to:De}}},[C,e]),O=(0,t.useCallback)(async()=>{const N=r?await r(e):null;J(N)},[e,r]),ye=async()=>{await O(),I(Ln()),v.current={above:0,below:0},Z.current+=1},ve=async(N,_)=>{v.current[N]+=1;const q=_.at(N==="above"?0:-1);if(q==null)throw new Error("should never happen. the array always contains at least 1 item (the middle row)");(0,z.ff)("grafana_explore_logs_log_context_load_more_called",{datasourceType:q.datasourceType,above:v.current.above,below:v.current.below});const ee=Is(N,n),ne=await l(Os(q,v.current),{limit:Ds,direction:ee}),ae=(0,vt.aB)(ne.data).rows;return n===k.UV.Ascending&&ae.reverse(),ae.filter(nt=>!Hs(_,nt))};(0,t.useEffect)(()=>{o&&O()},[O,o]);const[le,Oe]=(0,t.useState)([]),Te=N=>{le.indexOf(N)===-1&&Oe([...le,N])},He=N=>{const _=le.indexOf(N);_>-1&&(le.splice(_,1),Oe([...le]))},H=async N=>{const{below:_,above:q}=C;if(C[N].loadingState===B.Gu.Loading)return;W(N,ae=>({...ae,loadingState:B.Gu.Loading}));const ne=Z.current;try{const ae=[...q.rows,e,..._.rows],De=await ve(N,ae),[nt,Zn]=(0,$.partition)(De,ze=>ze.timeEpochNs>e.timeEpochNs),Yn=n===k.UV.Ascending?Zn:nt,qn=n===k.UV.Ascending?nt:Zn;ne===Z.current&&I(ze=>{const di=Yn.length>0?(0,me.$u)([...Yn,...ze.above.rows],n):ze.above.rows,pi=qn.length>0?(0,me.$u)([...ze.below.rows,...qn],n):ze.below.rows;return{above:{rows:di,loadingState:N==="above"?De.length===0?B.Gu.Done:B.Gu.NotStarted:ze.above.loadingState},below:{rows:pi,loadingState:N==="below"?De.length===0?B.Gu.Done:B.Gu.NotStarted:ze.below.loadingState}}})}catch{W(N,ae=>({rows:ae.rows,loadingState:B.Gu.Error}))}},M=async(N,_)=>{for(const q of N){if(!q.isIntersecting)continue;const ee=q.target;ee===m.current?H("above"):ee===y.current&&H("below")}};(0,t.useEffect)(()=>{const N=c.current,_=m.current,q=y.current;if(N==null)return;const ee=new IntersectionObserver(M,{root:N});return _!=null&&ee.observe(_),q!=null&&ee.observe(q),()=>{ee.disconnect()}});const Le=(0,t.useCallback)(()=>{g.current?.scrollIntoView({block:"center"}),p.current?.scrollIntoView({block:"center"})},[g,p]);(0,t.useLayoutEffect)(()=>{const N=c.current;if(N==null)return;const _=f.current,q=N.clientHeight;if(f.current=q,_!==q){Le();return}if(v.current.above<=1&&v.current.below<=1){Le();return}const ee=d.current,ne=N.scrollHeight;if(d.current=ne,ee!=null){const ae=N.scrollTop+(ne-ee);N.scrollTop=ae}},[C.above.rows,Le]),(0,Rn.Z)(O,[r,e]);const Qe=C.above.loadingState,Ve=C.below.loadingState;return t.createElement(Me.u,{isOpen:o,title:"Log context",contentClassName:b.flexColumn,className:b.modal,onDismiss:i},Q.config.featureToggles.logsContextDatasourceUi&&a&&t.createElement("div",{className:b.datasourceUi},a(e,ye)),t.createElement("div",{className:(0,h.cx)(b.flexRow,b.paddingBottom)},t.createElement("div",null,t.createElement(Fs,{wrapLines:S,onChangeWrapLines:L,onScrollCenterClick:Le}))),t.createElement("div",{ref:c,className:b.logRowGroups},t.createElement("table",null,t.createElement("tbody",null,t.createElement("tr",null,t.createElement("td",{className:b.loadingCell},Qe!==B.Gu.Done&&Qe!==B.Gu.Error&&t.createElement("div",{ref:m},t.createElement(Tn,{place:"above"})),Qe===B.Gu.Error&&t.createElement("div",null,"Error loading log more logs."),Qe===B.Gu.Done&&t.createElement("div",null,"No more logs available."))),t.createElement("tr",null,t.createElement("td",{className:b.noMarginBottom},t.createElement(qe.w,{logRows:C.above.rows,dedupStrategy:k.Y4.none,showLabels:j.Z.getBool(G.showLabels,!1),showTime:j.Z.getBool(G.showTime,!0),wrapLogMessage:S,prettifyLogMessage:j.Z.getBool(G.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:le,onClickShowField:Te,onClickHideField:He}))),t.createElement("tr",{ref:g}),t.createElement("tr",{ref:p,className:(0,h.cx)(b.entry,R?b.sticky:null),"data-testid":"entry-row"},t.createElement("td",{className:b.noMarginBottom},t.createElement(qe.w,{logRows:[e],dedupStrategy:k.Y4.none,showLabels:j.Z.getBool(G.showLabels,!1),showTime:j.Z.getBool(G.showTime,!0),wrapLogMessage:S,prettifyLogMessage:j.Z.getBool(G.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:le,onClickShowField:Te,onClickHideField:He,onUnpinLine:()=>T(!1),onPinLine:()=>T(!0),pinnedRowId:R?e.uid:void 0,overflowingContent:!0}))),t.createElement("tr",null,t.createElement("td",null,t.createElement(t.Fragment,null,t.createElement(qe.w,{logRows:C.below.rows,dedupStrategy:k.Y4.none,showLabels:j.Z.getBool(G.showLabels,!1),showTime:j.Z.getBool(G.showTime,!0),wrapLogMessage:S,prettifyLogMessage:j.Z.getBool(G.prettifyLogMessage,!1),enableLogDetails:!0,timeZone:s,displayedFields:le,onClickShowField:Te,onClickHideField:He})))),t.createElement("tr",null,t.createElement("td",{className:b.loadingCell},Ve!==B.Gu.Done&&Ve!==B.Gu.Error&&t.createElement("div",{ref:y},t.createElement(Tn,{place:"below"})),Ve===B.Gu.Error&&t.createElement("div",null,"Error loading log more logs."),Ve===B.Gu.Done&&t.createElement("div",null,"No more logs available.")))))),t.createElement(Me.u.ButtonRow,null,U?.datasource?.uid&&t.createElement(P.zx,{variant:"secondary",onClick:async()=>{let N=e.uid;e.dataFrame.refId&&(N=e.uid.replace(e.dataFrame.refId,U.refId)),x((0,A.bW)({queries:[U],range:Y(),datasourceUid:U.datasource.uid,panelsState:{logs:{id:N}}})),i(),(0,z.ff)("grafana_explore_logs_log_context_open_split_view_clicked",{datasourceType:e.datasourceType,logRowUid:e.uid})}},"Open in split view")))};var Se=u(52436),At=u(44673);const zn=e=>e.status==="fulfilled";function Ie(e,o){return e in o}const As={parse:e=>({schemaVersion:0,left:Nn(typeof e.left=="string"?e.left:void 0),...e.right&&{right:Nn(typeof e.right=="string"?e.right:void 0)}})},Fn=(e,...o)=>o.some(n=>e.hasOwnProperty(n));var Ms=(e=>(e[e.RangeFrom=0]="RangeFrom",e[e.RangeTo=1]="RangeTo",e[e.Datasource=2]="Datasource",e[e.SegmentsStart=3]="SegmentsStart",e))(Ms||{});function Nn(e){const o=(0,ce.as)(e),n={datasource:null,queries:[],range:xe.UI};if(!o)return n;if(!Array.isArray(o))return{queries:[],range:xe.UI,...o};if(o.length<=3)return console.error("Error parsing compact URL state for Explore."),n;const s={from:o[0],to:o[1]},a=o[2],r=o.slice(3),i=r.filter(c=>!Fn(c,"ui","mode","__panelsState")),l=r.find(c=>Fn(c,"__panelsState"))?.__panelsState;return{datasource:a,queries:i,range:s,panelsState:l}}const $s={parse:e=>{if(!e||!e.panes||typeof e.panes!="string")return{schemaVersion:1,panes:{[(0,ce.z0)()]:xt}};const o=(0,ce.as)(e.panes)||{},n=Object.entries(o).map(([s,a])=>[s,Bs(a)]).reduce((s,[a,r])=>({...s,[a]:r}),{});return Object.keys(n).length||(n[(0,ce.z0)()]=xt),{schemaVersion:1,panes:n}},migrate:e=>({schemaVersion:1,panes:{[(0,ce.z0)()]:e.left,...e.right&&{[(0,ce.z0)()]:e.right}}})},xt={datasource:null,queries:[],range:xe.UI};function Bs(e){return!e||typeof e!="object"?xt:{...xt,...Ie("queries",e)&&Array.isArray(e.queries)&&{queries:e.queries},...Ie("datasource",e)&&typeof e.datasource=="string"&&{datasource:e.datasource},...Ie("panelsState",e)&&!!e.panelsState&&typeof e.panelsState=="object"&&{panelsState:e.panelsState},...Ie("range",e)&&!!e.range&&typeof e.range=="object"&&Ie("from",e.range)&&Ie("to",e.range)&&typeof e.range.from=="string"&&typeof e.range.to=="string"&&{range:{from:e.range.from,to:e.range.to}}}}const ks=e=>Qs(e),Ws=[As,$s],Qs=e=>{const o=Vs(e),[n,...s]=Ws.slice(o),a=n.parse(e);return s.reduce((i,l)=>l.migrate?l.migrate(i):i,a)};function Vs(e){return!e||!("schemaVersion"in e)||!e.schemaVersion?0:typeof e.schemaVersion=="number"?e.schemaVersion:typeof e.schemaVersion=="string"?Number.parseInt(e.schemaVersion,10):0}function Us(e){const{location:o}=(0,Ae.p)(),n=(0,w.useDispatch)(),s=(0,w.useSelector)(K.Ky),a=(0,w.useSelector)(l=>l.user.orgId),r=(0,t.useRef)(e),i=(0,t.useRef)("notstarted");(0,t.useEffect)(()=>{e.panes||(i.current="notstarted",r.current=e)},[e]),(0,t.useEffect)(()=>{const l=n((0,w.addListener)({predicate:c=>[A.YV.type,A.bW.fulfilled.type,D.aA.pending.type,ue.oW.type].includes(c.type),effect:async(c,{cancelActiveListeners:p,delay:g,getState:d})=>{p(),await g(200);const f=Object.entries(d().explore.panes).reduce((m,[y,v])=>v?{...m,[y]:St(v)}:m,{});if(!(0,$.isEqual)(r.current.panes,JSON.stringify(f))){const m=!!r.current.panes&&Object.values(r.current.panes).filter(Boolean).length===0;r.current={panes:JSON.stringify(f)},o.partial({panes:r.current.panes},m)}}}));return()=>l()},[n,o]),(0,t.useEffect)(()=>{const l=r.current?.panes!==e.panes,c=ks(e);async function p(){Object.values(c.panes).some(({range:g},d,[{range:f}])=>!(0,$.isEqual)(g,f))&&n((0,A.tl)({syncedTimes:!1})),Object.entries(c.panes).forEach(([g,d],f)=>{const{datasource:m,queries:y,range:v,panelsState:x}=d,E=s[g];if(E!==void 0){const b=Ys(d,St(E));Promise.resolve().then(async()=>{b.datasource&&m&&await n((0,Ue.zU)(g,m))}).then(()=>{b.range&&n((0,ue.b3)({exploreId:g,rawRange:(0,xe.dc)(v)})),b.queries&&n((0,D.SE)({exploreId:g,queries:(0,At.Z)(y)})),(b.queries||b.range)&&n((0,D.aA)({exploreId:g}))})}else n((0,Ee.CK)({exploreId:g,datasource:m||"",queries:(0,At.Z)(y),range:(0,xe.dc)(v),panelsState:x,position:f,eventBridge:new zt.F}))}),Object.keys(s).filter(g=>!Object.keys(c.panes).includes(g)).forEach(g=>n((0,A.YV)(g)))}!l&&i.current==="notstarted"&&(i.current="pending",n((0,A.VY)()),Promise.all(Object.entries(c.panes).map(([g,{datasource:d,queries:f,range:m,panelsState:y}])=>Zs(d,f,a).then(v=>Promise.resolve(v?f.length?(0,At.Z)(f).filter(js(v)).map(bt(v)?$.identity:x=>({...x,datasource:v.getRef()})):(0,Se.ak)().get(bt(v)?void 0:v.getRef()).then(x=>[In(x)]):[]).then(async x=>{let E=await Gs(x);return!E.length&&v&&(E=[In(bt(v)?await(0,Se.ak)().get():v)]),{exploreId:g,range:m,panelsState:y,queries:E,datasource:v}})))).then(async g=>{const f=(await Promise.all(g.map(({exploreId:m,range:y,panelsState:v,queries:x,datasource:E})=>n((0,Ee.CK)({exploreId:m,datasource:E,queries:x,range:(0,xe.dc)(y),panelsState:v,eventBridge:new zt.F})).unwrap()))).reduce((m,{exploreId:y,state:v})=>({...m,panes:{...m.panes,[y]:St(v)}}),{panes:{}});i.current="done",o.partial({...Object.keys(o.getSearchObject()).reduce((m,y)=>(m[y]=void 0,m),{}),panes:JSON.stringify(f.panes),schemaVersion:c.schemaVersion,orgId:a},!0)})),r.current=e,l&&i.current==="done"&&p()},[n,s,a,o,e])}function In(e){return{...e.getDefaultQuery?.(ke.zj.Explore),refId:"A",datasource:e.getRef()}}function bt(e){return e.name===Lt.D}function js(e){return e&&bt(e)?o=>!!o.datasource:o=>o.datasource?typeof o.datasource=="string"?o.datasource===e?.uid:o.datasource.uid===e?.uid:!0}async function Gs(e){return(await Promise.allSettled(e.map(n=>(0,Se.ak)().get(n.datasource).then(s=>({query:n,ds:s}))))).filter(zn).map(({value:n})=>n.query)}async function Zs(e,o,n){if(e)try{return await(0,Se.ak)().get(e)}catch{}const s=o.filter(r=>r.datasource);for(const r of s)try{return await(0,Se.ak)().get(r.datasource)}catch{}const a=(0,ce.y_)(n);return(0,Se.ak)().get(a).catch(()=>(0,Se.ak)().get()).catch(()=>{})}const Ys=(e,o)=>{const n=!(0,$.isEqual)(o?.datasource,e?.datasource),s=!(0,$.isEqual)(o?.queries,e?.queries),a=!(0,$.isEqual)(o?.range||xe.UI,e?.range||xe.UI),r=!(0,$.isEqual)(o?.panelsState,e?.panelsState);return{datasource:n,queries:s,range:a,panelsState:r}};function St(e){return{datasource:e.datasourceInstance?.uid||"",queries:e.queries.map(ce.uC),range:(0,Pt.R_)(e.range.raw),panelsState:On(e.panelsState)}}function On(e){let o=(0,$.mapValues)(e,n=>(0,$.isObject)(n)?On(n):n);if(o=(0,$.omitBy)(o,$.isEmpty),!(0,$.isEmpty)(o))return o}var qs=u(22160),Ks=u.n(qs),Js=u(85465),Xs=u(62577),_s=u(81084);const Hn=e=>({metaContainer:(0,h.css)`
    flex: 1;
    color: ${e.colors.text.secondary};
    margin-bottom: ${e.spacing(2)};
    min-width: 30%;
    display: flex;
    flex-wrap: wrap;
  `,metaItem:(0,h.css)`
    margin-right: ${e.spacing(2)};
    margin-top: ${e.spacing(.5)};
    display: flex;
    align-items: center;

    .logs-meta-item__error {
      color: ${e.colors.error.text};
    }
  `,metaLabel:(0,h.css)`
    margin-right: calc(${e.spacing(2)} / 2);
    font-size: ${e.typography.bodySmall.fontSize};
    font-weight: ${e.typography.fontWeightMedium};
  `,metaValue:(0,h.css)`
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
  `}),ea=(0,t.memo)(function(o){const n=(0,F.wW)(Hn),{label:s,value:a}=o;return t.createElement("div",{"data-testid":"meta-info-text-item",className:n.metaItem},s&&t.createElement("span",{className:n.metaLabel},s,":"),t.createElement("span",{className:n.metaValue},a))}),Mt=(0,t.memo)(function(o){const n=(0,F.wW)(Hn),{metaItems:s}=o;return t.createElement("div",{className:n.metaContainer,"data-testid":"meta-info-text"},s.map((a,r)=>t.createElement(ea,{key:`${r}-${a.label}`,label:a.label,value:a.value})))}),ta=()=>({metaContainer:(0,h.css)`
    flex: 1;
    display: flex;
    flex-wrap: wrap;
  `});var na=(e=>(e.Text="text",e.Json="json",e))(na||{});const Dn=t.memo(({meta:e,dedupStrategy:o,dedupCount:n,displayedFields:s,clearDetectedFields:a,hasUnescapedContent:r,forceEscape:i,onEscapeNewlines:l,logRows:c})=>{const p=(0,F.wW)(ta),g=m=>{switch((0,z.ff)("grafana_logs_download_logs_clicked",{app:ke.zj.Explore,format:m,area:"logs-meta-row"}),m){case"text":(0,Js.Fc)({meta:e,rows:c},"Explore");break;case"json":const y=(0,me.Di)(c),v=new Blob([JSON.stringify(y)],{type:"application/json;charset=utf-8"}),x=`Explore-logs-${(0,Dt.dq)(new Date)}.json`;Ks()(v,x);break}},d=[...e];o!==k.Y4.none&&d.push({label:"Deduplication count",value:n,kind:V.Ku.Number}),c.some(m=>m.entry.length>_s.n)&&d.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:V.Ku.String}),s?.length>0&&d.push({label:"Showing only selected fields",value:Pn(s,V.Ku.LabelsMap)},{label:"",value:t.createElement(P.zx,{variant:"secondary",size:"sm",onClick:a},"Show original line")}),r&&d.push({label:"Your logs might have incorrectly escaped content",value:t.createElement(we.u,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right"},t.createElement(P.zx,{variant:"secondary",size:"sm",onClick:l},i?"Remove escaping":"Escape newlines"))});const f=t.createElement(Ne.v,null,t.createElement(Ne.v.Item,{label:"txt",onClick:()=>g("text")}),t.createElement(Ne.v.Item,{label:"json",onClick:()=>g("json")}));return t.createElement(t.Fragment,null,d&&t.createElement("div",{className:p.metaContainer},t.createElement(Mt,{metaItems:d.map(m=>({label:m.label,value:"kind"in m?Pn(m.value,m.kind):m.value}))}),t.createElement(vn.L,{overlay:f},t.createElement(re.h,{isOpen:!1,variant:"canvas",icon:"download-alt"},"Download"))))});Dn.displayName="LogsMetaRow";function Pn(e,o){return o===V.Ku.LabelsMap?t.createElement(Xs.j,{labels:e}):o===V.Ku.Error?t.createElement("span",{className:"logs-meta-item__error"},e):e}var oa=u(58434),sa=u(47330);function aa({pages:e,currentPageIndex:o,oldestLogsFirst:n,timeZone:s,loading:a,onClick:r}){const i=g=>`${(0,Dt.dq)(g,{format:sa.U6.interval.second,timeZone:s})}`,l=(g,d)=>{if(o===d&&a)return t.createElement(Et.$,null);const f=i(n?g.logsRange.from:g.logsRange.to),m=i(n?g.logsRange.to:g.logsRange.from);return`${f} \u2014 ${m}`},c=(0,F.l4)(),p=ra(c,a);return t.createElement(rt.$,{autoHide:!0},t.createElement("div",{className:p.pagesWrapper,"data-testid":"logsNavigationPages"},t.createElement("div",{className:p.pagesContainer},e.map((g,d)=>t.createElement("button",{type:"button","data-testid":`page${d+1}`,className:(0,h.cx)((0,P.gN)(c),p.page),key:g.queryRange.to,onClick:()=>{r(g,d+1)}},t.createElement("div",{className:(0,h.cx)(p.line,{selectedBg:o===d})}),t.createElement("div",{className:(0,h.cx)(p.time,{selectedText:o===d})},l(g,d)))))))}const ra=(e,o)=>({pagesWrapper:(0,h.css)`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:(0,h.css)`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:(0,h.css)`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${o?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:(0,h.css)`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:(0,h.css)`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});function ia({absoluteRange:e,logsSortOrder:o,timeZone:n,loading:s,onChangeTime:a,scrollToTopLogs:r,visibleRange:i,queries:l,clearCache:c,addResultsToCache:p}){const[g,d]=(0,t.useState)([]),[f,m]=(0,t.useState)(0),y=(0,t.useRef)(),v=(0,t.useRef)(),x=(0,t.useRef)(0),E=o===k.UV.Ascending,b=E?f===g.length-1:f===0,R=E?f===0:f===g.length-1,T=(0,F.l4)(),C=ca(T,E);(0,t.useEffect)(()=>{const S={logsRange:i,queryRange:e};let L=[];if(!(0,$.isEqual)(v.current,e)||!(0,$.isEqual)(y.current,l))c(),d([S]),m(0),y.current=l,x.current=e.to-e.from;else{d(O=>(L=O.filter(ye=>!(0,$.isEqual)(S.queryRange,ye.queryRange)),L=[...L,S].sort((ye,ve)=>W(ye,ve,o)),L));const Y=L.findIndex(O=>O.queryRange.to===e.to);m(Y)}p()},[i,e,o,l,c,p]),(0,t.useEffect)(()=>{c()},[]);const I=(0,t.useCallback)(({from:S,to:L})=>{v.current={from:S,to:L},a({from:S,to:L})},[a]),W=(S,L,Y)=>Y===k.UV.Ascending?S.queryRange.to>L.queryRange.to?1:-1:S.queryRange.to>L.queryRange.to?-1:1,Z=t.createElement(P.zx,{"data-testid":"olderLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if((0,z.ff)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),R)I({from:i.from-x.current,to:i.from});else{const S=E?-1:1;I({from:g[f+S].queryRange.from,to:g[f+S].queryRange.to})}r()},disabled:s},t.createElement("div",{className:C.navButtonContent},s?t.createElement(Et.$,null):t.createElement(Ce.J,{name:E?"angle-up":"angle-down",size:"lg"}),"Older logs")),U=t.createElement(P.zx,{"data-testid":"newerLogsButton",className:C.navButton,variant:"secondary",onClick:()=>{if((0,z.ff)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!b){const S=E?1:-1;I({from:g[f+S].queryRange.from,to:g[f+S].queryRange.to})}r()},disabled:s||b},t.createElement("div",{className:C.navButtonContent},s&&t.createElement(Et.$,null),b||s?null:t.createElement(Ce.J,{name:E?"angle-down":"angle-up",size:"lg"}),b?"Start of range":"Newer logs")),J=(0,t.useCallback)((S,L)=>{(0,z.ff)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:L}),!s&&I({from:S.queryRange.from,to:S.queryRange.to}),r()},[I,s,r]);return t.createElement("div",{className:C.navContainer},E?Z:U,t.createElement(aa,{pages:g,currentPageIndex:f,oldestLogsFirst:E,timeZone:n,loading:s,onClick:J}),E?U:Z,t.createElement(P.zx,{"data-testid":"scrollToTop",className:C.scrollToTopButton,variant:"secondary",onClick:r,title:"Scroll to top"},t.createElement(Ce.J,{name:"arrow-up",size:"lg"})))}const la=(0,t.memo)(ia),ca=(e,o)=>{const n=`calc(100vh - 2*${e.spacing(2)} - 2*${oa.$}px)`;return{navContainer:(0,h.css)`
      max-height: ${n};
      display: flex;
      flex-direction: column;
      justify-content: ${o?"flex-start":"space-between"};
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:(0,h.css)`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:(0,h.css)`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:(0,h.css)`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `}};var ua=u(31312),An=u(53305),wt=u(52716),da=u(60593),$t=u(23968),pa=u(19087),Mn=u(90355);const ga=(0,Fe.Z)(e=>{const o=e?.reduce((n,s)=>s.length>n?s.length:n,0);return Math.min(600,Math.max(o??0*36,300)+40+46)}),ha=e=>{const{timeZone:o,splitOpen:n,range:s,logsSortOrder:a,width:r,logsFrames:i}=e,[l,c]=(0,t.useState)(void 0),p=(0,t.useCallback)(g=>{const f=(0,Mn.L)(g)?.timeField.index,m=(0,An.aK)(g,f,a===k.UV.Descending),[y]=(0,wt.SM)({data:[m],timeZone:o,theme:Q.config.theme2,replaceVariables:v=>v,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const v of y.fields)v.getLinks=x=>(0,Ze.a_)({field:v,rowIndex:x.valueRowIndex,splitOpenFn:n,range:s,dataFrame:m}),v.config={...v.config,custom:{filterable:!0,inspect:!0,...v.config.custom}};return y},[a,s,n,o]);return(0,t.useEffect)(()=>{(async()=>{if(!i||!i.length){c(void 0);return}let d=i[0];const m=(0,Mn.L)(d)?.timeField.index;d=(0,An.aK)(d,m,a===k.UV.Descending);const y=d.fields.filter(x=>x.typeInfo?.frame==="json.RawMessage").flatMap(x=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:x.name}},{id:"organize",options:{excludeByName:{[x.name]:!0}}}]);if((0,pa.i2)(d,{keepBody:!0,keepTimestamp:!0}).hidden.forEach((x,E)=>{y.push({id:"organize",options:{excludeByName:{[x.name]:!0}}})}),y.length>0){const[x]=await(0,ua.n)((0,da.H)(y,[d]));c(p(x))}else c(p(d))})()},[p,i,a]),l?t.createElement($t.i,{data:l,width:r,height:ga(e.logsFrames),footerOptions:{show:!0,reducer:["count"],countRows:!0}}):null};function Bt(e){const[o,n]=(0,t.useState)(!1),s=100,{error:a,title:r,suggestedAction:i,onSuggestedAction:l,onRemove:c,severity:p="warning"}=e,g=a?.message||a?.data?.message||"",d=!o&&g.length>s,f=(0,F.l4)(),m=ma(f);return t.createElement("div",{className:m.supplementaryErrorContainer},t.createElement(Ge.b,{title:r,severity:p,onRemove:c},t.createElement("div",{className:m.suggestedActionWrapper},d?t.createElement(P.zx,{variant:"secondary",size:"xs",onClick:()=>{n(!0)}},"Show details"):g,i&&l&&t.createElement("div",{className:m.suggestedActionWrapper},t.createElement(P.zx,{variant:"primary",size:"xs",onClick:l},i)))))}const ma=e=>({supplementaryErrorContainer:(0,h.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `,suggestedActionWrapper:(0,h.css)`
      height: ${e.spacing(6)};
      button {
        position: absolute;
        right: ${e.spacing(2)};
        top: ${e.spacing(7)};
      }
    `});var fa=u(61344);function ya(e){const{width:o,timeZone:n,splitOpen:s,onUpdateTimeRange:a,onHiddenSeriesChanged:r,allLogsVolumeMaximum:i}=e,l=(0,F.l4)(),c=(0,F.wW)(va),p=parseInt(l.spacing(2).slice(0,-2),10),g=150,d=e.logsVolumeData,f=(0,me.Js)(d?.data);let m=f?`${f.name}`:"";(0,me.FP)(d.data)&&(m=[m,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter($.identity).join(". "));let y=t.createElement("span",null,m);return d.state===B.Gu.Streaming&&(y=t.createElement(t.Fragment,null,y,t.createElement(we.u,{content:"Streaming"},t.createElement(Ce.J,{name:"circle-mono",size:"md",className:c.streaming,"data-testid":"logs-volume-streaming"})))),t.createElement("div",{style:{height:g},className:c.contentContainer},t.createElement(fa.y,{graphStyle:"lines",loadingState:d.state??B.Gu.Done,data:d.data,height:g,width:o-p*2,absoluteRange:e.absoluteRange,onChangeTime:a,timeZone:n,splitOpenFn:s,tooltipDisplayMode:k.f3.Multi,onHiddenSeriesChanged:r,anchorToZero:!0,yAxisMaximum:i,eventBus:e.eventBus}),y&&t.createElement("div",{className:c.extraInfoContainer},y))}const va=e=>({extraInfoContainer:(0,h.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: -10px;
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,contentContainer:(0,h.css)`
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    `,streaming:(0,h.css)`
      color: ${e.colors.success.text};
    `});function Ea(e){return!e||!e.error&&!e.errors?!1:(e.error?[e.error]:e.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const xa=({logsVolumeData:e,absoluteRange:o,onUpdateTimeRange:n,width:s,onLoadLogsVolume:a,onHiddenSeriesChanged:r,eventBus:i,splitOpen:l,timeZone:c,onClose:p})=>{const{logVolumes:g,maximumValue:d,maximumRange:f}=(0,t.useMemo)(()=>{let b=-1/0;const R=(0,$.sortBy)(e?.data||[],"meta.custom.datasourceName"),T=(0,$.groupBy)(R,"meta.custom.datasourceName"),C=(0,$.mapValues)(T,W=>{const Z=(0,me._c)(W);return b=Math.max(b,Z.maximum),Z.dataFrames}),I=(0,me.hY)((0,$.flatten)(Object.values(C)));return{maximumValue:b,maximumRange:I,logVolumes:C}},[e]),m=(0,F.wW)(ba),y=Object.keys(g).length,v=Object.values(g).some(b=>{const R=Sa(b,o);return!(0,me.FP)(b)&&R&&R<1}),x=Ea(e),E={from:Math.max(o.from,f.from),to:Math.min(o.to,f.to)};return e?.state===B.Gu.Loading?t.createElement("span",null,"Loading..."):x?t.createElement(Bt,{title:"The logs volume query has timed out",severity:"info",suggestedAction:"Retry",onSuggestedAction:a,onRemove:p}):e?.error!==void 0?t.createElement(Bt,{error:e.error,title:"Failed to load log volume for this query"}):y===0?t.createElement("div",{className:m.alertContainer},t.createElement(Ge.b,{severity:"info",title:"No logs volume available"},"No volume information available for the current queries and time range.")):t.createElement("div",{className:m.listContainer},Object.keys(g).map((b,R)=>{const T={data:g[b]};return t.createElement(ya,{key:R,absoluteRange:E,allLogsVolumeMaximum:d,width:s,logsVolumeData:T,onUpdateTimeRange:n,timeZone:c,splitOpen:l,onLoadLogsVolume:a,onHiddenSeriesChanged:y>1?()=>{}:r,eventBus:i})}),v&&t.createElement("div",{className:m.extraInfoContainer},t.createElement(be._,{label:"Reload log volume",transparent:!0},t.createElement(P.zx,{size:"xs",icon:"sync",variant:"secondary",onClick:a,id:"reload-volume"}))))},ba=e=>({listContainer:(0,h.css)`
      padding-top: 10px;
    `,extraInfoContainer:(0,h.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,oldInfoText:(0,h.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,alertContainer:(0,h.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `});function Sa(e,o){const n=e&&e[0]&&e[0].meta?.custom?.absoluteRange;return n?(o.from-o.to)/(n.from-n.to):void 0}const kt=Q.config.featureToggles.exploreScrollableLogsContainer,wa=[k.Y4.none,k.Y4.exact,k.Y4.numbers,k.Y4.signature];class Ca extends t.PureComponent{constructor(o){super(o),this.topLogsRef=(0,t.createRef)(),this.state={showLabels:j.Z.getBool(G.showLabels,!1),showTime:j.Z.getBool(G.showTime,!0),wrapLogMessage:j.Z.getBool(G.wrapLogMessage,!0),prettifyLogMessage:j.Z.getBool(G.prettifyLogMessage,!1),dedupStrategy:k.Y4.none,hiddenLogLevels:[],logsSortOrder:j.Z.get(G.logsSortOrder)||k.UV.Descending,isFlipping:!1,displayedFields:[],forceEscape:!1,contextOpen:!1,contextRow:void 0,tableFrame:void 0,visualisationType:"logs",logsContainer:void 0},this.onLogRowHover=n=>{n?this.props.eventBus.publish(new Cn.es({point:{time:n.timeEpochMs}})):this.props.eventBus.publish(new Cn.xH)},this.onLogsContainerRef=n=>{this.setState({logsContainer:n})},this.onChangeLogsSortOrder=()=>{this.setState({isFlipping:!0}),this.flipOrderTimer=window.setTimeout(()=>{this.setState(n=>{const s=n.logsSortOrder===k.UV.Descending?k.UV.Ascending:k.UV.Descending;return j.Z.set(G.logsSortOrder,s),{logsSortOrder:s}})},0),this.cancelFlippingTimer=window.setTimeout(()=>this.setState({isFlipping:!1}),1e3)},this.onEscapeNewlines=()=>{this.setState(n=>({forceEscape:!n.forceEscape}))},this.onChangeVisualisation=n=>{this.setState(()=>({visualisationType:n}))},this.onChangeDedup=n=>{(0,z.ff)("grafana_explore_logs_deduplication_clicked",{deduplicationType:n,datasourceType:this.props.datasourceType}),this.setState({dedupStrategy:n})},this.onChangeLabels=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showLabels:a}),j.Z.set(G.showLabels,a)}},this.onChangeTime=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({showTime:a}),j.Z.set(G.showTime,a)}},this.onChangeWrapLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({wrapLogMessage:a}),j.Z.set(G.wrapLogMessage,a)}},this.onChangePrettifyLogMessage=n=>{const{target:s}=n;if(s){const a=s.checked;this.setState({prettifyLogMessage:a}),j.Z.set(G.prettifyLogMessage,a)}},this.onToggleLogLevel=n=>{const s=n.map(a=>V.in[a]);this.setState({hiddenLogLevels:s})},this.onToggleLogsVolumeCollapse=n=>{this.props.onSetLogsVolumeEnabled(!n),(0,z.ff)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:this.props.datasourceType,type:n?"close":"open"})},this.onClickScan=n=>{n.preventDefault(),this.props.onStartScanning&&(this.props.onStartScanning(),(0,z.ff)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:this.props.datasourceType}))},this.onClickStopScan=n=>{n.preventDefault(),this.props.onStopScanning&&this.props.onStopScanning()},this.showField=n=>{this.state.displayedFields.indexOf(n)===-1&&this.setState(a=>({displayedFields:a.displayedFields.concat(n)}))},this.hideField=n=>{this.state.displayedFields.indexOf(n)>-1&&this.setState(a=>({displayedFields:a.displayedFields.filter(r=>n!==r)}))},this.clearDetectedFields=()=>{this.setState(n=>({displayedFields:[]}))},this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0})},this.onOpenContext=(n,s)=>{this.setState({contextOpen:!0,contextRow:n}),(0,z.ff)("grafana_explore_logs_log_context_opened",{datasourceType:n.datasourceType,logRowUid:n.uid}),this.onCloseContext=()=>{this.setState({contextOpen:!1,contextRow:void 0}),(0,z.ff)("grafana_explore_logs_log_context_closed",{datasourceType:n.datasourceType,logRowUid:n.uid}),s()}},this.onPermalinkClick=async n=>{if(n.rowId===void 0)return;const s=St((0,Ye.y0)().explore.panes[this.props.exploreId]);s.panelsState={...this.props.panelState,logs:{id:n.uid}},s.range={from:new Date(this.props.absoluteRange.from).toISOString(),to:new Date(this.props.absoluteRange.to).toISOString()};const a=(0,Pt.S)(s),r=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],i=Pt.Cj.renderUrl(`${r}/explore`,{left:a});await(0,It.L)(i),(0,z.ff)("grafana_explore_logs_permalink_clicked",{datasourceType:n.datasourceType??"unknown",logRowUid:n.uid,logRowLevel:n.logLevel})},this.scrollIntoView=n=>{if(Q.config.featureToggles.exploreScrollableLogsContainer){this.state.logsContainer&&(this.topLogsRef.current?.scrollIntoView(),this.state.logsContainer.scroll({behavior:"smooth",top:this.state.logsContainer.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2}));return}const{scrollElement:s}=this.props;s&&s.scroll({behavior:"smooth",top:s.scrollTop+n.getBoundingClientRect().top-window.innerHeight/2})},this.checkUnescapedContent=(0,Fe.Z)(n=>!!n.some(s=>s.hasUnescapedContent)),this.dedupRows=(0,Fe.Z)((n,s)=>{const a=(0,vt.UW)(n,s),r=a.reduce((i,l)=>l.duplicates?i+l.duplicates:i,0);return{dedupedRows:a,dedupCount:r}}),this.filterRows=(0,Fe.Z)((n,s)=>(0,vt.nu)(n,new Set(s))),this.createNavigationRange=(0,Fe.Z)(n=>{if(!n||n.length===0)return;const s=n[0].timeEpochMs,a=n[n.length-1].timeEpochMs;return a<s?{from:a,to:s}:{from:s,to:a}}),this.scrollToTopLogs=()=>{Q.config.featureToggles.exploreScrollableLogsContainer?this.state.logsContainer&&this.state.logsContainer.scroll({behavior:"auto",top:0}):this.topLogsRef.current?.scrollIntoView()},this.logsVolumeEventBus=o.eventBus.newScopedBus("logsvolume",{onlyLocal:!1})}componentWillUnmount(){this.flipOrderTimer&&window.clearTimeout(this.flipOrderTimer),this.cancelFlippingTimer&&window.clearTimeout(this.cancelFlippingTimer)}componentDidUpdate(o){this.props.loading&&!o.loading&&this.props.panelState?.logs?.id&&(delete this.props.panelState.logs.id,(0,Ye.WI)((0,Ee.km)(this.props.exploreId,"logs",{...this.props.panelState})))}render(){const{width:o,splitOpen:n,logRows:s,logsMeta:a,logsVolumeEnabled:r,logsVolumeData:i,loadLogsVolumeData:l,loading:c=!1,onClickFilterLabel:p,onClickFilterOutLabel:g,timeZone:d,scanning:f,scanRange:m,showContextToggle:y,absoluteRange:v,onChangeTime:x,getFieldLinks:E,theme:b,logsQueries:R,clearCache:T,addResultsToCache:C,exploreId:I,getRowContext:W,getLogRowContextUi:Z,getRowContextQuery:U}=this.props,{showLabels:J,showTime:S,wrapLogMessage:L,prettifyLogMessage:Y,dedupStrategy:O,hiddenLogLevels:ye,logsSortOrder:ve,isFlipping:le,displayedFields:Oe,forceEscape:Te,contextOpen:He,contextRow:H}=this.state,M=Ta(b,L),Le=s&&s.length>0,Qe=this.checkUnescapedContent(s),Ve=this.filterRows(s,ye),{dedupedRows:N,dedupCount:_}=this.dedupRows(Ve,O),q=this.createNavigationRange(s),ee=m?`Scanning ${Rs.describeTimeRange(m)}`:"Scanning...";return t.createElement(t.Fragment,null,W&&H&&t.createElement(Ps,{open:He,row:H,onClose:this.onCloseContext,getRowContext:(ne,ae)=>W(ne,H,ae),getRowContextQuery:U,getLogRowContextUi:Z,logsSortOrder:ve,timeZone:d}),t.createElement(Be.fm,{title:"Logs volume",collapsible:!0,collapsed:!r,onToggleCollapse:this.onToggleLogsVolumeCollapse},r&&t.createElement(xa,{absoluteRange:v,width:o,logsVolumeData:i,onUpdateTimeRange:x,timeZone:d,splitOpen:n,onLoadLogsVolume:l,onHiddenSeriesChanged:this.onToggleLogLevel,eventBus:this.logsVolumeEventBus,onClose:()=>this.onToggleLogsVolumeCollapse(!0)})),t.createElement(Be.fm,{title:Q.config.featureToggles.logsExploreTableVisualisation?this.state.visualisationType==="logs"?"Logs":"Table":"Logs",actions:t.createElement(t.Fragment,null,Q.config.featureToggles.logsExploreTableVisualisation&&t.createElement("div",{className:M.visualisationType},t.createElement(yt.S,{className:M.visualisationTypeRadio,options:[{label:"Table",value:"table",description:"Show results in table visualisation"},{label:"Logs",value:"logs",description:"Show results in logs visualisation"}],size:"sm",value:this.state.visualisationType,onChange:this.onChangeVisualisation}))),loadingState:c?B.Gu.Loading:B.Gu.Done},t.createElement("div",{className:M.stickyNavigation},this.state.visualisationType!=="table"&&t.createElement("div",{className:M.logOptions},t.createElement(Ts.Z,null,t.createElement(be._,{label:"Time",className:M.horizontalInlineLabel,transparent:!0},t.createElement(Re.x,{value:S,onChange:this.onChangeTime,className:M.horizontalInlineSwitch,transparent:!0,id:`show-time_${I}`})),t.createElement(be._,{label:"Unique labels",className:M.horizontalInlineLabel,transparent:!0},t.createElement(Re.x,{value:J,onChange:this.onChangeLabels,className:M.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${I}`})),t.createElement(be._,{label:"Wrap lines",className:M.horizontalInlineLabel,transparent:!0},t.createElement(Re.x,{value:L,onChange:this.onChangeWrapLogMessage,className:M.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${I}`})),t.createElement(be._,{label:"Prettify JSON",className:M.horizontalInlineLabel,transparent:!0},t.createElement(Re.x,{value:Y,onChange:this.onChangePrettifyLogMessage,className:M.horizontalInlineSwitch,transparent:!0,id:`prettify_${I}`})),t.createElement(be._,{label:"Deduplication",className:M.horizontalInlineLabel,transparent:!0},t.createElement(yt.S,{options:wa.map(ne=>({label:(0,$.capitalize)(ne),value:ne,description:V.Uv[ne]})),value:O,onChange:this.onChangeDedup,className:M.radioButtons}))),t.createElement("div",null,t.createElement(be._,{label:"Display results",className:M.horizontalInlineLabel,transparent:!0},t.createElement(yt.S,{disabled:le,options:[{label:"Newest first",value:k.UV.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:k.UV.Ascending,description:"Show results oldest to newest"}],value:ve,onChange:this.onChangeLogsSortOrder,className:M.radioButtons})))),t.createElement("div",{ref:this.topLogsRef}),t.createElement(Dn,{logRows:s,meta:a||[],dedupStrategy:O,dedupCount:_,hasUnescapedContent:Qe,forceEscape:Te,displayedFields:Oe,onEscapeNewlines:this.onEscapeNewlines,clearDetectedFields:this.clearDetectedFields})),t.createElement("div",{className:M.logsSection},this.state.visualisationType==="table"&&Le&&t.createElement("div",{className:M.logRows,"data-testid":"logRowsTable"},t.createElement(ha,{logsSortOrder:this.state.logsSortOrder,range:this.props.range,splitOpen:this.props.splitOpen,timeZone:d,width:o-80,logsFrames:this.props.logsFrames})),this.state.visualisationType==="logs"&&Le&&t.createElement("div",{className:M.logRows,"data-testid":"logRows",ref:this.onLogsContainerRef},t.createElement(qe.w,{logRows:s,deduplicatedRows:N,dedupStrategy:O,onClickFilterLabel:p,onClickFilterOutLabel:g,showContextToggle:y,showLabels:J,showTime:S,enableLogDetails:!0,forceEscape:Te,wrapLogMessage:L,prettifyLogMessage:Y,timeZone:d,getFieldLinks:E,logsSortOrder:ve,displayedFields:Oe,onClickShowField:this.showField,onClickHideField:this.hideField,app:ke.zj.Explore,onLogRowHover:this.onLogRowHover,onOpenContext:this.onOpenContext,onPermalinkClick:this.onPermalinkClick,permalinkedRowId:this.props.panelState?.logs?.id,scrollIntoView:this.scrollIntoView,isFilterLabelActive:this.props.isFilterLabelActive,containerRendered:!!this.state.logsContainer})),!c&&!Le&&!f&&t.createElement("div",{className:M.logRows},t.createElement("div",{className:M.noData},"No logs found.",t.createElement(P.zx,{size:"sm",variant:"secondary",onClick:this.onClickScan},"Scan for older logs"))),f&&t.createElement("div",{className:M.logRows},t.createElement("div",{className:M.noData},t.createElement("span",null,ee),t.createElement(P.zx,{size:"sm",variant:"secondary",onClick:this.onClickStopScan},"Stop scan"))),t.createElement(la,{logsSortOrder:ve,visibleRange:q??v,absoluteRange:v,timeZone:d,onChangeTime:x,loading:c,queries:R??[],scrollToTopLogs:this.scrollToTopLogs,addResultsToCache:C,clearCache:T}))))}}const Ra=(0,F.HE)(Ca),Ta=(e,o)=>({noData:(0,h.css)`
      > * {
        margin-left: 0.5em;
      }
    `,logOptions:(0,h.css)`
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      background-color: ${e.colors.background.primary};
      padding: ${e.spacing(1,2)};
      border-radius: ${e.shape.radius.default};
      margin: ${e.spacing(0,0,1)};
      border: 1px solid ${e.colors.border.medium};
    `,headerButton:(0,h.css)`
      margin: ${e.spacing(.5,0,0,1)};
    `,horizontalInlineLabel:(0,h.css)`
      > label {
        margin-right: 0;
      }
    `,horizontalInlineSwitch:(0,h.css)`
      padding: 0 ${e.spacing(1)} 0 0;
    `,radioButtons:(0,h.css)`
      margin: 0;
    `,logsSection:(0,h.css)`
      display: flex;
      flex-direction: row;
      justify-content: space-between;
    `,logRows:(0,h.css)`
      overflow-x: ${kt?"scroll;":`${o?"unset":"scroll"};`}
      overflow-y: visible;
      width: 100%;
      ${kt&&"max-height: calc(100vh - 170px);"}
    `,visualisationType:(0,h.css)`
      display: flex;
      flex: 1;
      justify-content: space-between;
    `,visualisationTypeRadio:(0,h.css)`
      margin: 0 0 0 ${e.spacing(1)};
    `,stickyNavigation:(0,h.css)`
      ${kt&&"margin-bottom: 0px"}
      overflow: visible;
    `}),Wt=500,Qt=100,La=(0,Fe.Z)(()=>({logsEnter:(0,h.css)`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:(0,h.css)`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${Wt}ms ease-out ${Qt}ms;
    `,logsExit:(0,h.css)`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:(0,h.css)`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${Wt}ms ease-out ${Qt}ms;
    `}));function $n(e){const{visible:o,children:n}=e,s=La();return t.createElement(yn.Z,{in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:Wt+Qt,classNames:{enter:s.logsEnter,enterActive:s.logsEnterActive,exit:s.logsExit,exitActive:s.logsExitActive}},n)}class za extends t.PureComponent{constructor(){super(...arguments),this.state={logDetailsFilterAvailable:!1},this.onChangeTime=o=>{const{exploreId:n,updateTimeRange:s}=this.props;s({exploreId:n,absoluteRange:o})},this.getLogRowContext=async(o,n,s)=>{const{datasourceInstance:a,logsQueries:r}=this.props;if((0,V.Q4)(a)){const i=this.getQuery(r,n,a);return a.getLogRowContext(o,s,i)}return[]},this.getLogRowContextQuery=async(o,n)=>{const{datasourceInstance:s,logsQueries:a}=this.props;if((0,V.Q4)(s)&&s.getLogRowContextQuery){const r=this.getQuery(a,o,s);return s.getLogRowContextQuery(o,n,r)}return null},this.getLogRowContextUi=(o,n)=>{const{datasourceInstance:s,logsQueries:a}=this.props;if((0,V.xW)(s)&&s.getLogRowContextUi){const r=this.getQuery(a,o,s);return s.getLogRowContextUi(o,n,r)}return t.createElement(t.Fragment,null)},this.showContextToggle=o=>{const{datasourceInstance:n}=this.props;return(0,V.Q4)(n)?n.showContextToggle(o):!1},this.getFieldLinks=(o,n,s)=>{const{splitOpenFn:a,range:r}=this.props;return(0,Ze.a_)({field:o,rowIndex:n,splitOpenFn:a,range:r,dataFrame:s})}}componentDidMount(){this.checkFiltersAvailability()}componentDidUpdate(o){this.checkFiltersAvailability()}checkFiltersAvailability(){const{logsQueries:o,datasourceInstance:n}=this.props;if(!o)return;if(n?.modifyQuery||(0,V.Vw)(n)){this.setState({logDetailsFilterAvailable:!0});return}const s=[];for(const a of o)a.datasource&&s.push((0,$e.F)().get(a.datasource));Promise.all(s).then(a=>{const r=a.some(i=>i.modifyQuery||(0,V.Vw)(i));this.setState({logDetailsFilterAvailable:r})})}getQuery(o,n,s){return(o??[]).find(a=>a.refId===n.dataFrame.refId&&a.datasource!=null&&a.datasource.type===s.type)}render(){const{loading:o,loadingState:n,logRows:s,logsMeta:a,logsSeries:r,logsQueries:i,loadSupplementaryQueryData:l,setSupplementaryQueryEnabled:c,onClickFilterLabel:p,onClickFilterOutLabel:g,onStartScanning:d,onStopScanning:f,absoluteRange:m,timeZone:y,visibleRange:v,scanning:x,range:E,width:b,splitOpenFn:R,isLive:T,exploreId:C,addResultsToCache:I,clearCache:W,logsVolume:Z,scrollElement:U}=this.props,{logDetailsFilterAvailable:J}=this.state;return s?t.createElement(t.Fragment,null,t.createElement($n,{visible:T},t.createElement(lt.U,{label:"Logs",loading:!1,isOpen:!0},t.createElement(bn,{exploreId:C},S=>t.createElement(Cs,{logRows:s,timeZone:y,stopLive:S.stop,isPaused:this.props.isPaused,onPause:S.pause,onResume:S.resume,onClear:S.clear,clearedAtIndex:this.props.clearedAtIndex})))),t.createElement($n,{visible:!T},t.createElement(Ra,{exploreId:C,datasourceType:this.props.datasourceInstance?.type,logRows:s,logsMeta:a,logsSeries:r,logsVolumeEnabled:Z.enabled,onSetLogsVolumeEnabled:S=>c(C,S,V.v8.LogsVolume),logsVolumeData:Z.data,logsQueries:i,width:b,splitOpen:R,loading:o,loadingState:n,loadLogsVolumeData:()=>l(C,V.v8.LogsVolume),onChangeTime:this.onChangeTime,onClickFilterLabel:J?p:void 0,onClickFilterOutLabel:J?g:void 0,onStartScanning:d,onStopScanning:f,absoluteRange:m,visibleRange:v,timeZone:y,scanning:x,scanRange:E.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:()=>I(C),clearCache:()=>W(C),eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:U,isFilterLabelActive:J?this.props.isFilterLabelActive:void 0,range:E}))):null}}function Fa(e,{exploreId:o}){const s=e.explore.panes[o],{logsResult:a,scanning:r,datasourceInstance:i,isLive:l,isPaused:c,clearedAtIndex:p,range:g,absoluteRange:d,supplementaryQueries:f}=s,m=(0,D.$9)(o)(e),y=s.panelsState,v=(0,it.Z)(e.user),x=f[V.v8.LogsVolume];return{loading:m,logRows:a?.rows,logsMeta:a?.meta,logsSeries:a?.series,logsQueries:a?.queries,visibleRange:a?.visibleRange,scanning:r,timeZone:v,datasourceInstance:i,isLive:l,isPaused:c,clearedAtIndex:p,range:g,absoluteRange:d,logsVolume:x,panelState:y,logsFrames:s.queryResponse.logsFrames}}const Na={updateTimeRange:ue.cD,addResultsToCache:D.K8,clearCache:D.LK,loadSupplementaryQueryData:D.W1,setSupplementaryQueryEnabled:D.z0},Ia=(0,de.connect)(Fa,Na)(za);function Oa(e){const{queryResponse:o,timeZone:n,enabled:s,setLogsSampleEnabled:a,datasourceInstance:r,queries:i,splitOpen:l}=e,c=(0,F.wW)(Ha),p=f=>{a(f),(0,z.ff)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:r?.type??"unknown",type:f?"open":"close"})},g=()=>{if(!(0,V.mN)(r,V.v8.LogsSample))return null;const f=i.map(y=>r.getSupplementaryQuery({type:V.v8.LogsSample},y)).filter(y=>!!y);if(!f.length)return null;const m=()=>{l({queries:f,datasourceUid:r.uid}),(0,z.ff)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:r?.type??"unknown",queriesCount:f.length})};return t.createElement(P.zx,{size:"sm",className:c.logSamplesButton,onClick:m},"Open logs in split view")};let d;if(o===void 0)d=null;else if(o.error!==void 0)d=t.createElement(Bt,{error:o.error,title:"Failed to load logs sample for this query"});else if(o.state===B.Gu.Loading)d=t.createElement("span",null,"Logs sample is loading...");else if(o.data.length===0||o.data.every(f=>f.length===0))d=t.createElement("span",null,"No logs sample data.");else{const f=(0,vt.aB)(o.data);d=t.createElement(t.Fragment,null,t.createElement(g,null),t.createElement("div",{className:c.logContainer},t.createElement(qe.w,{logRows:f.rows,dedupStrategy:k.Y4.none,showLabels:j.Z.getBool(G.showLabels,!1),showTime:j.Z.getBool(G.showTime,!0),wrapLogMessage:j.Z.getBool(G.wrapLogMessage,!0),prettifyLogMessage:j.Z.getBool(G.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0})))}return o?.state!==B.Gu.NotStarted?t.createElement(lt.U,{className:c.logsSamplePanel,label:t.createElement("div",null,"Logs sample",t.createElement(we.u,{content:"Show log lines that contributed to visualized metrics"},t.createElement(Ce.J,{name:"info-circle",className:c.infoTooltip}))),isOpen:s,collapsible:!0,onToggle:p},d):null}const Ha=e=>{const o=Q.config.featureToggles.exploreScrollableLogsContainer;return{logsSamplePanel:(0,h.css)`
      ${o&&"max-height: calc(100vh - 115px);"}
    `,logSamplesButton:(0,h.css)`
      position: absolute;
      top: ${e.spacing(1)};
      right: ${e.spacing(1)};
    `,logContainer:(0,h.css)`
      ${o&&"position: relative;"}
      ${o&&"height: 100%;"}
      overflow: scroll;
    `,infoTooltip:(0,h.css)`
      margin-left: ${e.spacing(1)};
    `}},Da=()=>{const e=(0,F.wW)(Pa);return t.createElement(t.Fragment,null,t.createElement(Ft.l,{"data-testid":"explore-no-data",className:e.wrapper},t.createElement("span",{className:e.message},"No data")))},Pa=e=>({wrapper:(0,h.css)`
    label: no-data-card;
    padding: ${e.spacing(3)};
    background: ${e.colors.background.primary};
    border-radius: ${e.shape.radius.default};
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
  `,message:(0,h.css)`
    font-size: ${e.typography.h2.fontSize};
    padding: ${e.spacing(4)};
    color: ${e.colors.text.disabled};
  `});var Aa=u(80318);const Ma=()=>{const e=(0,F.l4)(),o=Ht.Vt.hasPermission(w.AccessControlAction.DataSourcesCreate)&&Ht.Vt.hasPermission(w.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",s=t.createElement(t.Fragment,null,t.createElement(Ce.J,{name:"rocket"}),t.createElement(t.Fragment,null," ProTip: You can also define data sources through configuration files. "),t.createElement("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link"},"Learn more")),a=t.createElement(P.Qj,{size:"lg",href:"datasources/new",icon:"database",disabled:!o},"Add data source"),r=(0,h.css)`
    max-width: ${e.breakpoints.values.lg}px;
    margin-top: ${e.spacing(2)};
    align-self: center;
  `;return t.createElement(Aa._,{callToActionElement:a,className:r,footer:s,message:n})};var Vt=u(29721),$a=u(9272),Ba=u(47280);const ka=e=>({warningText:(0,h.css)`
    label: warningText;
    display: flex;
    align-items: center;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});function Wa(e){const{dataFrames:o,range:n,splitOpenFn:s,withTraceView:a,datasourceType:r}=e,i=(0,Ze.u8)(n,s),l=(0,F.l4)(),c=(0,F.wW)(ka),p=(0,wt.SM)({fieldConfig:{defaults:{},overrides:[]},data:o,replaceVariables:T=>T,theme:l}),{nodes:g}=(0,Ba.Y)(p),[d,f]=(0,en.Z)(!0),m=()=>{f(),(0,z.ff)("grafana_traces_node_graph_panel_clicked",{datasourceType:r,grafana_version:Q.config.buildInfo.version,isExpanded:!open})},{height:y}=(0,Vt.Z)(),v=(0,t.useRef)(null),[x,E]=(0,t.useState)(250);(0,t.useEffect)(()=>{if(v.current){const{top:T}=v.current.getBoundingClientRect();E(T)}},[v]);const b=y-x-32,R=a&&g[0]?.length>1e3?t.createElement("span",{className:c.warningText}," (",g[0].length," nodes, can be slow to load)"):null;return t.createElement(Be.fm,{title:"Node graph",titleItems:R,collapsible:!!a,collapsed:a?d:!1,onToggleCollapse:a?m:void 0},t.createElement("div",{ref:v,style:a?{height:500}:{minHeight:600,height:b}},t.createElement($a.E,{dataFrames:p,getLinks:i})))}function Qa(e,{exploreId:o}){return{range:e.explore.panes[o].range}}const Va=(0,de.connect)(Qa,{})(Wa);var Ke=u(38874),Ua=u(78354),ja=u(49245);const Ga=e=>{const o=(0,K.F9)(e);return{getQueries:(0,Ke.P1)(o,n=>n.queries),getQueryResponse:(0,Ke.P1)(o,n=>n.queryResponse),getHistory:(0,Ke.P1)(o,n=>n.history),getEventBridge:(0,Ke.P1)(o,n=>n.eventBridge),getDatasourceInstanceSettings:(0,Ke.P1)(o,n=>(0,Se.ak)().getInstanceSettings(n.datasourceInstance?.uid))}},Za=({exploreId:e})=>{const o=(0,w.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:s,getQueryResponse:a,getHistory:r,getEventBridge:i}=(0,t.useMemo)(()=>Ga(e),[e]),l=(0,w.useSelector)(n),c=(0,w.useSelector)(s),p=(0,w.useSelector)(a),g=(0,w.useSelector)(r),d=(0,w.useSelector)(i),f=(0,t.useCallback)(()=>{o((0,D.aA)({exploreId:e}))},[o,e]),m=(0,t.useCallback)(b=>{o((0,D.qV)({exploreId:e,queries:b}))},[o,e]),y=(0,t.useCallback)(b=>{m([...l,{...b,refId:(0,Ua.Hs)(l)}])},[m,l]),v=()=>{(0,z.ff)("grafana_explore_query_row_copy")},x=()=>{(0,z.ff)("grafana_explore_query_row_remove")},E=b=>{(0,z.ff)("grafana_query_row_toggle",b===void 0?{}:{queryEnabled:b})};return t.createElement(ja.l,{dsSettings:c,queries:l,onQueriesChange:m,onAddQuery:y,onRunQueries:f,onQueryCopied:v,onQueryRemoved:x,onQueryToggled:E,data:p,app:ke.zj.Explore,history:g,eventBus:d})};var Ct=u(79059),Ut=u(50820),Ya=u(74602),qa=u(68084),Bn=u(5989),Ka=u(66981),Ja=u(64979);const Je={wrapper:(0,h.css)`
    height: 100%;
    overflow: scroll;
  `,switchWrapper:(0,h.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: 0;
  `,switchLabel:(0,h.css)`
    margin-left: 15px;
    margin-bottom: 0;
  `,switch:(0,h.css)`
    margin-left: 10px;
  `,resultCount:(0,h.css)`
    margin-bottom: 4px;
  `,header:(0,h.css)`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    font-size: 12px;
    line-height: 1.25;
  `},Xa=480,_a=2,er=e=>{const{tableResult:o}=e,n=(0,$.cloneDeep)(o),s=(0,t.useRef)(null),a=n.fields.filter(m=>m.name.includes("Value")),r=(0,Bn.u)(n),{width:i}=(0,Vt.Z)(),[l,c]=(0,t.useState)(i<=Xa||a.length>_a),p=()=>{c(!l);const m={isExpanded:!l};(0,z.ff)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",m)};(0,t.useEffect)(()=>{s.current?.resetAfterIndex(0,!0)},[l]);const g=m=>{if(m<10){let x=0;for(let E=0;E<m;E++)x+=d(E,!0);return Math.min(600,x)}return 600},d=(m,y)=>{if(!y)return 32;const E=r[m];return 1.5*32+(Object.keys(E).length-a.length)*22},f=`isExpandedView ${(0,t.useId)()}`;return t.createElement("section",null,t.createElement("header",{className:Je.header},t.createElement(ct.g,{className:Je.switchWrapper,label:"Expand results",htmlFor:"isExpandedView"},t.createElement("div",{className:Je.switch},t.createElement(Re.r,{onChange:p,id:f,value:l,label:"Expand results"}))),t.createElement("div",{className:Je.resultCount},"Result series: ",r.length)),t.createElement("div",{role:"table"},t.createElement(t.Fragment,null,a.length>1&&!l&&t.createElement(Ka.I,{valueLabels:a,expanded:l}),t.createElement(qa.S_,{ref:s,itemCount:r.length,className:Je.wrapper,itemSize:m=>d(m,l),height:g(r.length),width:"100%"},({index:m,style:y})=>{let v;return l&&(v=a.filter(x=>{const E=r[m][x.name];return E&&E!==Bn.T})),t.createElement("div",{role:"row",style:{...y,overflow:"hidden"}},t.createElement(Ja.ZP,{isExpandedView:l,valueLabels:v,totalNumberOfValues:a.length,listKey:r[m].__name__,listItemData:r[m]}))}))))};function tr(e,{exploreId:o}){const s=e.explore.panes[o],{tableResult:a,rawPrometheusResult:r,range:i}=s,l=(0,D.$9)(o)(e),c=r?[r]:[],p=(a?.length??!1)>0&&r?a:c;return{loading:p&&p.length>0?!1:l,tableResult:p,range:i}}const nr=(0,de.connect)(tr,{});class or extends t.PureComponent{constructor(o){super(o),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,h.css)({display:"flex",justifyContent:"space-between",flex:"1"}),s=Ot.zN.map(a=>({value:a,label:a[0].toUpperCase()+a.slice(1).replace(/_/," ")}));return t.createElement("div",{className:n},this.state.resultsStyle===w.TABLE_RESULTS_STYLE.raw?"Raw":"Table",t.createElement(yt.S,{onClick:()=>{const a={state:this.state.resultsStyle===w.TABLE_RESULTS_STYLE.table?w.TABLE_RESULTS_STYLE.raw:w.TABLE_RESULTS_STYLE.table};(0,z.ff)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",a)},size:"sm",options:s,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle}))},o.showRawPrometheus&&(this.state={resultsStyle:w.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:o}=this.props;return!o||o.length===0?200:Math.max(Math.min(600,o[0].length*35)+35)}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:c}=this.props,p=this.getTableHeight(),g=a-Ut.config.theme.panelPadding*2-Ya.QO;let d=s;const f=(0,Ze.qQ)(r,i);d?.length&&(d=(0,wt.SM)({data:d,timeZone:c,theme:Ut.config.theme2,replaceVariables:(0,Ct.J)().replace.bind((0,Ct.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:f}));const m=d?.filter(x=>!!x&&x.length!==0),y=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",v=!this.state?.resultsStyle||this.state?.resultsStyle===w.TABLE_RESULTS_STYLE.table;return t.createElement(lt.U,{label:y,loading:o,isOpen:!0},m?.length&&t.createElement(t.Fragment,null,v&&t.createElement($t.i,{ariaLabel:l,data:m[0],width:g,height:p,onCellFilterAdded:n}),this.state?.resultsStyle===w.TABLE_RESULTS_STYLE.raw&&t.createElement(er,{tableResult:m[0]})),!m?.length&&t.createElement(Mt,{metaItems:[{value:"0 series returned"}]}))}}const sr=nr(or);var ar=u(72907);const rr=e=>{const o={transition:`opacity ${e.duration}ms linear`,opacity:0},n={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return t.createElement(ar.ZP,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited},s=>t.createElement("div",{style:{...o,...n[s]}},e.children))},ir=e=>{const{queryError:o}=e,n=!!o,s=n?100:10,a=o?"Query error":"Unknown error",r=o?.message||o?.data?.message||null;return t.createElement(rr,{in:n,duration:s},t.createElement(Ge.b,{severity:"error",title:a,topSpacing:2},r))};function lr(e){const o=(0,w.useSelector)(s=>s.explore.panes[e.exploreId].queryResponse),n=o?.state===B.Gu.Error?o?.error:void 0;return n?.refId?null:t.createElement(ir,{queryError:n})}var fe=u(80471),se=u(25999),cr=u(98263),Xe=u(9558),kn=u(41245),_e=u(77014),ur=u(68421),et=u(68497),dr=u(84766),jt=u(97316),Gt=u(90634),tt=u(73431);function pr(e,{exploreId:o}){const n=e.explore,{datasourceInstance:s}=n.panes[o];return{exploreId:o,datasourceInstance:s}}const gr={changeDatasource:Ue.zU,deleteHistoryItem:fe.NV,commentHistoryItem:fe.Ff,starHistoryItem:fe.ev,setQueries:D.KO},hr=(0,de.connect)(pr,gr),mr=e=>{const o="240px",n="170px",s=e.colors.background.secondary;return{queryCard:(0,h.css)`
      position: relative;
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(1)} 0;
      background-color: ${s};
      border-radius: ${e.shape.radius.default};
      .starred {
        color: ${e.v1.palette.orange};
      }
    `,cardRow:(0,h.css)`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing(1)};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border.weak};
        padding: ${e.spacing(.5,1)};
      }
      img {
        height: ${e.typography.fontSize}px;
        max-width: ${e.typography.fontSize}px;
        margin-right: ${e.spacing(1)};
      }
    `,queryActionButtons:(0,h.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing(1)};
      }
    `,queryContainer:(0,h.css)`
      font-weight: ${e.typography.fontWeightMedium};
      width: calc(100% - ${o});
    `,updateCommentContainer:(0,h.css)`
      width: calc(100% + ${o});
      margin-top: ${e.spacing(1)};
    `,comment:(0,h.css)`
      overflow-wrap: break-word;
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-top: ${e.spacing(.5)};
    `,commentButtonRow:(0,h.css)`
      > * {
        margin-top: ${e.spacing(1)};
        margin-right: ${e.spacing(1)};
      }
    `,textArea:(0,h.css)`
      width: 100%;
    `,runButton:(0,h.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing(.5,2)};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `,loader:(0,h.css)`
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: ${e.colors.background.secondary};
    `}};function fr(e){const{query:o,commentHistoryItem:n,starHistoryItem:s,deleteHistoryItem:a,changeDatasource:r,exploreId:i,datasourceInstance:l,setQueries:c}=e,[p,g]=(0,t.useState)(!1),[d,f]=(0,t.useState)(o.comment),{value:m,loading:y}=(0,Rn.Z)(async()=>{let S;try{S=await(0,$e.F)().get(o.datasourceUid)}catch{}return{dsInstance:S,queries:await Promise.all(o.queries.map(async L=>{let Y;if(S?.meta.mixed)try{Y=await(0,$e.F)().get(L.datasource)}catch{}else Y=S;return{query:L,datasource:Y}}))}},[o.datasourceUid,o.queries]),v=(0,F.wW)(mr),x=async()=>{const S=o.queries,L=o.datasourceUid!==l?.uid;L&&await r(i,o.datasourceUid),c(i,S),(0,z.ff)("grafana_explore_query_history_run",{queryHistoryEnabled:Q.config.queryHistoryEnabled,differentDataSource:L})},E=async()=>{const S=[...o.queries.map(Y=>Y.datasource?.type||"unknown")];if((0,z.ff)("grafana_explore_query_history_copy_query",{datasources:S,mixed:!!m?.dsInstance?.meta.mixed}),y||!m)return;const L=m.queries.map(Y=>(0,se.OH)(Y.query,Y.datasource)).join(`
`);(0,ce.n9)(L),(0,Ye.WI)((0,jt.$l)((0,Gt.AT)("Query copied to clipboard")))},b=async()=>{const S=(0,se.t2)(o);await(0,It.L)(S)},R=()=>{const S=L=>{a(L),(0,Ye.WI)((0,jt.$l)((0,Gt.AT)("Query deleted"))),(0,z.ff)("grafana_explore_query_history_deleted",{queryHistoryEnabled:Q.config.queryHistoryEnabled})};o.starred?(0,_e.N$)().publish(new tt.VJ({title:"Delete",text:"Are you sure you want to permanently delete your starred query?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>S(o.id)})):S(o.id)},T=()=>{s(o.id,!o.starred),(0,z.ff)("grafana_explore_query_history_starred",{queryHistoryEnabled:Q.config.queryHistoryEnabled,newValue:!o.starred})},C=()=>g(!p),I=()=>{n(o.id,d),g(!1),(0,z.ff)("grafana_explore_query_history_commented",{queryHistoryEnabled:Q.config.queryHistoryEnabled})},W=()=>{g(!1),f(o.comment)},Z=S=>{S.key==="Enter"&&(S.shiftKey||S.ctrlKey)&&I(),S.key==="Escape"&&W()},U=t.createElement("div",{className:v.updateCommentContainer,"aria-label":d?"Update comment form":"Add comment form"},t.createElement(ur.K,{onKeyDown:Z,value:d,placeholder:d?void 0:"An optional description of what the query does.",onChange:S=>f(S.currentTarget.value),className:v.textArea}),t.createElement("div",{className:v.commentButtonRow},t.createElement(P.zx,{onClick:I},"Save comment"),t.createElement(P.zx,{variant:"secondary",onClick:W},"Cancel"))),J=t.createElement("div",{className:v.queryActionButtons},t.createElement(et.h,{name:"comment-alt",onClick:C,tooltip:o.comment?.length>0?"Edit comment":"Add comment"}),t.createElement(et.h,{name:"copy",onClick:E,tooltip:"Copy query to clipboard"}),m?.dsInstance&&t.createElement(et.h,{name:"share-alt",onClick:b,tooltip:"Copy shortened link to clipboard"}),t.createElement(et.h,{name:"trash-alt",title:"Delete query",tooltip:"Delete query",onClick:R}),t.createElement(et.h,{name:o.starred?"favorite":"star",iconType:o.starred?"mono":"default",onClick:T,tooltip:o.starred?"Unstar query":"Star query"}));return t.createElement("div",{className:v.queryCard},t.createElement("div",{className:v.cardRow},t.createElement(Wn,{dsApi:m?.dsInstance,size:"sm"}),J),t.createElement("div",{className:(0,h.cx)(v.cardRow)},t.createElement("div",{className:v.queryContainer},m?.queries.map((S,L)=>t.createElement(vr,{query:S,key:`${S}-${L}`,showDsInfo:m?.dsInstance?.meta.mixed})),!p&&o.comment&&t.createElement("div",{"aria-label":"Query comment",className:v.comment},o.comment),p&&U),!p&&t.createElement("div",{className:v.runButton},t.createElement(P.zx,{variant:"secondary",onClick:x,disabled:!m?.dsInstance||m.queries.some(S=>!S.datasource)},l?.uid===o.datasourceUid?"Run query":"Switch data source and run query"))),y&&t.createElement(dr.u,{text:"loading...",className:v.loader}))}const yr=e=>({queryRow:(0,h.css)`
    border-top: 1px solid ${e.colors.border.weak};
    display: flex;
    flex-direction: row;
    padding: 4px 0px;
    gap: 4px;
    :first-child {
      border-top: none;
    }
  `,dsInfoContainer:(0,h.css)`
    display: flex;
    align-items: center;
  `,queryText:(0,h.css)`
    word-break: break-all;
  `}),vr=({query:e,showDsInfo:o=!1})=>{const n=(0,F.wW)(yr);return t.createElement("div",{className:n.queryRow},o&&t.createElement("div",{className:n.dsInfoContainer},t.createElement(Wn,{dsApi:e.datasource,size:"md"}),": "),t.createElement("span",{"aria-label":"Query text",className:n.queryText},(0,se.OH)(e.query,e.datasource)))},Er=e=>o=>(0,h.css)`
  display: flex;
  align-items: center;
  font-size: ${o.typography[e==="sm"?"bodySmall":"body"].fontSize};
  font-weight: ${o.typography.fontWeightMedium};
  white-space: nowrap;
`;function Wn({dsApi:e,size:o}){const n=(0,t.useCallback)(a=>Er(o)(a),[o]),s=(0,F.wW)(n);return t.createElement("div",{className:s},t.createElement("img",{src:e?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:e?.type||"Data source does not exist anymore","aria-label":"Data source icon"}),t.createElement("div",{"aria-label":"Data source name"},e?.name||"Data source does not exist anymore"))}const Qn=hr(fr),xr=(e,o)=>({container:(0,h.css)`
      display: flex;
    `,labelSlider:(0,h.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      &:last-of-type {
        margin-top: ${e.spacing(3)};
      }
      &:first-of-type {
        font-weight: ${e.typography.fontWeightMedium};
        margin-bottom: ${e.spacing(2)};
      }
    `,containerContent:(0,h.css)`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:(0,h.css)`
      width: 129px;
      margin-right: ${e.spacing(1)};
    `,fixedSlider:(0,h.css)`
      position: fixed;
    `,slider:(0,h.css)`
      bottom: 10px;
      height: ${o-180}px;
      width: 129px;
      padding: ${e.spacing(1)} 0;
    `,selectors:(0,h.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `,multiselect:(0,h.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,h.css)`
      width: 170px;
    `,sessionName:(0,h.css)`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing(3)};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:(0,h.css)`
      font-size: ${e.typography.h4.fontSize};
      margin: ${e.spacing(2,.25,1,.25)};
    `,footer:(0,h.css)`
      height: 60px;
      margin: ${e.spacing(3)} auto;
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `,queries:(0,h.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-left: ${e.spacing(.5)};
    `});function br(e){const{queries:o,totalQueries:n,loading:s,richHistorySearchFilters:a,updateFilters:r,clearRichHistoryResults:i,loadMoreRichHistory:l,richHistorySettings:c,exploreId:p,height:g,activeDatasourceInstance:d}=e,f=(0,F.wW)(xr,g),m=(0,se.DR)();if((0,t.useEffect)(()=>{const E=!c.activeDatasourceOnly&&c.lastUsedDatasourceFilters?c.lastUsedDatasourceFilters:[d],b={search:"",sortOrder:se.As.Descending,datasourceFilters:E,from:0,to:c.retentionPeriod,starred:!1};return r(b),()=>{i()}},[]),!a)return t.createElement("span",null,"Loading...");const y=(0,se.k4)(o,a.sortOrder),v=Un(),x=o.length&&o.length!==n;return t.createElement("div",{className:f.container},t.createElement("div",{className:f.containerSlider},t.createElement("div",{className:f.fixedSlider},t.createElement("div",{className:f.labelSlider},"Filter history"),t.createElement("div",{className:f.labelSlider},(0,se.bQ)(a.from)),t.createElement("div",{className:f.slider},t.createElement(cr.U,{tooltipAlwaysVisible:!1,min:0,max:c.retentionPeriod,value:[a.from,a.to],orientation:"vertical",formatTooltipResult:se.bQ,reverse:!0,onAfterChange:E=>{r({from:E[0],to:E[1]})}})),t.createElement("div",{className:f.labelSlider},(0,se.bQ)(a.to)))),t.createElement("div",{className:f.containerContent,"data-testid":"query-history-queries-tab"},t.createElement("div",{className:f.selectors},!c.activeDatasourceOnly&&t.createElement(Xe.NU,{className:f.multiselect,options:m.map(E=>({value:E.name,label:E.name})),value:a.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:E=>{r({datasourceFilters:E.map(b=>b.value)})}}),t.createElement("div",{className:f.filterInput},t.createElement(kn.H,{escapeRegex:!1,placeholder:"Search queries",value:a.search,onChange:E=>r({search:E})})),t.createElement("div",{"aria-label":"Sort queries",className:f.sort},t.createElement(Xe.Ph,{value:v.filter(E=>E.value===a.sortOrder),options:v,placeholder:"Sort queries by",onChange:E=>r({sortOrder:E.value})}))),s&&t.createElement("span",null,"Loading results..."),!s&&Object.keys(y).map(E=>t.createElement("div",{key:E},t.createElement("div",{className:f.heading},E," ",t.createElement("span",{className:f.queries},x?"Displaying ":"",y[E].length," queries")),y[E].map(b=>t.createElement(Qn,{query:b,key:b.id,exploreId:p})))),x?t.createElement("div",null,"Showing ",o.length," of ",n," ",t.createElement(P.zx,{onClick:l},"Load more")):null,t.createElement("div",{className:f.footer},Q.config.queryHistoryEnabled?"":"The history is local to your browser and is not shared with others.")))}var Sr=u(89739);const wr=e=>({container:(0,h.css)`
      font-size: ${e.typography.bodySmall.fontSize};
    `,spaceBetween:(0,h.css)`
      margin-bottom: ${e.spacing(3)};
    `,input:(0,h.css)`
      max-width: 200px;
    `,bold:(0,h.css)`
      font-weight: ${e.typography.fontWeightBold};
    `,bottomMargin:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Vn=[{value:2,label:"2 days"},{value:5,label:"5 days"},{value:7,label:"1 week"},{value:14,label:"2 weeks"}];function Cr(e){const{retentionPeriod:o,starredTabAsFirstTab:n,activeDatasourceOnly:s,onChangeRetentionPeriod:a,toggleStarredTabAsFirstTab:r,toggleactiveDatasourceOnly:i,deleteRichHistory:l}=e,c=(0,F.wW)(wr),p=Vn.find(d=>d.value===o),g=()=>{(0,_e.N$)().publish(new tt.VJ({title:"Delete",text:"Are you sure you want to permanently delete your query history?",yesText:"Delete",icon:"trash-alt",onConfirm:()=>{l(),(0,Ye.WI)((0,jt.$l)((0,Gt.AT)("Query history deleted")))}}))};return t.createElement("div",{className:c.container},(0,je.X)().changeRetention?t.createElement(ct.g,{label:"History time span",description:`Select the period of time for which Grafana will save your query history. Up to ${Sr.H6} entries will be stored.`},t.createElement("div",{className:c.input},t.createElement(Xe.Ph,{value:p,options:Vn,onChange:a}))):t.createElement(Ge.b,{severity:"info",title:"History time span"},"Grafana will keep entries up to ",p?.label,". Starred entries won't be deleted."),t.createElement(be._,{label:"Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D",className:c.spaceBetween},t.createElement(Re.x,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:r})),(0,je.X)().onlyActiveDataSource&&t.createElement(be._,{label:"Only show queries for data source currently active in Explore",className:c.spaceBetween},t.createElement(Re.x,{id:"explore-query-history-settings-data-source-behavior",value:s,onChange:i})),(0,je.X)().clearHistory&&t.createElement("div",null,t.createElement("div",{className:c.bold},"Clear query history"),t.createElement("div",{className:c.bottomMargin},"Delete all of your query history, permanently."),t.createElement(P.zx,{variant:"destructive",onClick:g},"Clear query history")))}const Rr=e=>({container:(0,h.css)`
      display: flex;
    `,containerContent:(0,h.css)`
      width: 100%;
    `,selectors:(0,h.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:(0,h.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,filterInput:(0,h.css)`
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,h.css)`
      width: 170px;
    `,footer:(0,h.css)`
      height: 60px;
      margin-top: ${e.spacing(3)};
      display: flex;
      justify-content: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `});function Tr(e){const{updateFilters:o,clearRichHistoryResults:n,loadMoreRichHistory:s,activeDatasourceInstance:a,richHistorySettings:r,queries:i,totalQueries:l,loading:c,richHistorySearchFilters:p,exploreId:g}=e,d=(0,F.wW)(Rr),f=(0,se.DR)();if((0,t.useEffect)(()=>{const y=r.activeDatasourceOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:[a],v={search:"",sortOrder:se.As.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return o(v),()=>{n()}},[]),!p)return t.createElement("span",null,"Loading...");const m=Un();return t.createElement("div",{className:d.container},t.createElement("div",{className:d.containerContent},t.createElement("div",{className:d.selectors},!r.activeDatasourceOnly&&t.createElement(Xe.NU,{className:d.multiselect,options:f.map(y=>({value:y.name,label:y.name})),value:p.datasourceFilters,placeholder:"Filter queries for data sources(s)","aria-label":"Filter queries for data sources(s)",onChange:y=>{o({datasourceFilters:y.map(v=>v.value)})}}),t.createElement("div",{className:d.filterInput},t.createElement(kn.H,{escapeRegex:!1,placeholder:"Search queries",value:p.search,onChange:y=>o({search:y})})),t.createElement("div",{"aria-label":"Sort queries",className:d.sort},t.createElement(Xe.Ph,{value:m.filter(y=>y.value===p.sortOrder),options:m,placeholder:"Sort queries by",onChange:y=>o({sortOrder:y.value})}))),c&&t.createElement("span",null,"Loading results..."),!c&&i.map(y=>t.createElement(Qn,{query:y,key:y.id,exploreId:g})),i.length&&i.length!==l?t.createElement("div",null,"Showing ",i.length," of ",l," ",t.createElement(P.zx,{onClick:s},"Load more")):null,t.createElement("div",{className:d.footer},Q.config.queryHistoryEnabled?"":"The history is local to your browser and is not shared with others.")))}var Zt=(e=>(e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings",e))(Zt||{});const Un=()=>[{label:"Newest first",value:se.As.Descending},{label:"Oldest first",value:se.As.Ascending},{label:"Data source A-Z",value:se.As.DatasourceAZ},{label:"Data source Z-A",value:se.As.DatasourceZA}].filter(e=>(0,je.X)().availableFilters.includes(e.value));class Lr extends t.PureComponent{constructor(){super(...arguments),this.state={loading:!1},this.updateSettings=o=>{this.props.updateHistorySettings({...this.props.richHistorySettings,...o})},this.updateFilters=o=>{const n={...this.props.richHistorySearchFilters,...o,page:1};this.props.updateHistorySearchFilters(this.props.exploreId,n),this.loadRichHistory()},this.clearResults=()=>{this.props.clearRichHistoryResults(this.props.exploreId)},this.loadRichHistory=(0,$.debounce)(()=>{this.props.loadRichHistory(this.props.exploreId),this.setState({loading:!0})},300),this.onChangeRetentionPeriod=o=>{o.value!==void 0&&this.updateSettings({retentionPeriod:o.value})},this.toggleStarredTabAsFirstTab=()=>this.updateSettings({starredTabAsFirstTab:!this.props.richHistorySettings.starredTabAsFirstTab}),this.toggleActiveDatasourceOnly=()=>this.updateSettings({activeDatasourceOnly:!this.props.richHistorySettings.activeDatasourceOnly})}componentDidUpdate(o){o.richHistory!==this.props.richHistory&&this.setState({loading:!1})}render(){const{richHistory:o,richHistoryTotal:n,height:s,exploreId:a,deleteRichHistory:r,onClose:i,firstTab:l,activeDatasourceInstance:c}=this.props,{loading:p}=this.state,g={label:"Query history",value:"Query history",content:t.createElement(br,{queries:o,totalQueries:n||0,loading:p,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),loadMoreRichHistory:()=>this.props.loadMoreRichHistory(this.props.exploreId),activeDatasourceInstance:c,richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:a,height:s}),icon:"history"},d={label:"Starred",value:"Starred",content:t.createElement(Tr,{queries:o,totalQueries:n||0,loading:p,activeDatasourceInstance:c,updateFilters:this.updateFilters,clearRichHistoryResults:()=>this.props.clearRichHistoryResults(this.props.exploreId),loadMoreRichHistory:()=>this.props.loadMoreRichHistory(this.props.exploreId),richHistorySettings:this.props.richHistorySettings,richHistorySearchFilters:this.props.richHistorySearchFilters,exploreId:a}),icon:"star"},f={label:"Settings",value:"Settings",content:t.createElement(Cr,{retentionPeriod:this.props.richHistorySettings.retentionPeriod,starredTabAsFirstTab:this.props.richHistorySettings.starredTabAsFirstTab,activeDatasourceOnly:this.props.richHistorySettings.activeDatasourceOnly,onChangeRetentionPeriod:this.onChangeRetentionPeriod,toggleStarredTabAsFirstTab:this.toggleStarredTabAsFirstTab,toggleactiveDatasourceOnly:this.toggleActiveDatasourceOnly,deleteRichHistory:r}),icon:"sliders-v-alt"};let m=[g,d,f];return t.createElement(an.W,{tabs:m,onClose:i,defaultTab:l,closeIconTooltip:"Close query history"})}}const zr=(0,F.HE)(Lr);function Fr(e,{exploreId:o}){const n=e.explore,s=n.panes[o],a=s.richHistorySearchFilters,r=n.richHistorySettings,{datasourceInstance:i}=s,l=r?.starredTabAsFirstTab?Zt.Starred:Zt.RichHistory,{richHistory:c,richHistoryTotal:p}=s;return{richHistory:c,richHistoryTotal:p,firstTab:l,activeDatasourceInstance:i.name,richHistorySettings:r,richHistorySearchFilters:a}}const Nr={initRichHistory:fe.sO,loadRichHistory:fe.TV,loadMoreRichHistory:fe.io,clearRichHistoryResults:fe.Cs,updateHistorySettings:fe.ch,updateHistorySearchFilters:fe.KZ,deleteRichHistory:fe.ik},Ir=(0,de.connect)(Fr,Nr);function Or(e){const o=(0,F.l4)(),[n,s]=(0,t.useState)(o.components.horizontalDrawer.defaultHeight),{richHistory:a,richHistoryTotal:r,width:i,firstTab:l,activeDatasourceInstance:c,exploreId:p,deleteRichHistory:g,initRichHistory:d,loadRichHistory:f,loadMoreRichHistory:m,clearRichHistoryResults:y,richHistorySettings:v,updateHistorySettings:x,richHistorySearchFilters:E,updateHistorySearchFilters:b,onClose:R}=e;return(0,t.useEffect)(()=>{d(),(0,z.ff)("grafana_explore_query_history_opened",{queryHistoryEnabled:Q.config.queryHistoryEnabled})},[d]),v?t.createElement(pn,{width:i,onResize:(T,C,I)=>{s(Number(I.style.height.slice(0,-2)))}},t.createElement(zr,{richHistory:a,richHistoryTotal:r,firstTab:l,activeDatasourceInstance:c,exploreId:p,onClose:R,height:n,deleteRichHistory:g,richHistorySettings:v,richHistorySearchFilters:E,updateHistorySettings:x,updateHistorySearchFilters:b,loadRichHistory:f,loadMoreRichHistory:m,clearRichHistoryResults:y})):t.createElement("span",null,"Loading...")}const Hr=Ir(Or);var Dr=u(22453);const Pr=e=>({containerMargin:(0,h.css)`
      display: flex;
      flex-wrap: wrap;
      gap: ${e.spacing(1)};
      margin-top: ${e.spacing(2)};
    `});function Ar(e){const o=(0,F.l4)(),n=Pr(o);return t.createElement("div",{className:n.containerMargin},!e.addQueryRowButtonHidden&&t.createElement(re.h,{variant:"canvas","aria-label":"Add query",onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus"},"Add query"),!e.richHistoryRowButtonHidden&&t.createElement(re.h,{variant:e.richHistoryButtonActive?"active":"canvas","aria-label":"Query history",onClick:e.onClickRichHistoryButton,"data-testid":Dr.z.QueryTab.queryHistoryButton,icon:"history"},"Query history"),t.createElement(re.h,{variant:e.queryInspectorButtonActive?"active":"canvas","aria-label":"Query inspector",onClick:e.onClickQueryInspectorButton,icon:"info-circle"},"Query inspector"))}var Mr=u(89591),jn=u(80977);function $r(e,{exploreId:o}){const s=e.explore.panes[o],{tableResult:a,range:r}=s,i=(0,D.$9)(o);return{loading:a&&a.length>0?!1:i,tableResult:a,range:r}}const Br=(0,de.connect)($r,{});class kr extends t.PureComponent{constructor(){super(...arguments),this.hasSubFrames=o=>o.fields.some(n=>n.type===Mr.fS.nestedFrames)}getTableHeight(o,n){return o===0?200:Math.min(600,Math.max(o*36,n?300:0)+40+46)}getTableTitle(o,n,s){let a=n.name;return!a&&(o?.length??0)>1&&(a=n.refId||`${s}`),a?(0,oe.t)("explore.table.title-with-name","Table - {{name}}",{name:a}):(0,oe.t)("explore.table.title","Table")}render(){const{loading:o,onCellFilterAdded:n,tableResult:s,width:a,splitOpenFn:r,range:i,ariaLabel:l,timeZone:c}=this.props;let p=(0,jn.yR)(s)?(0,jn.Bc)(s):s;const g=(0,Ze.qQ)(r,i);p?.length&&(p=(0,wt.SM)({data:p,timeZone:c,theme:Ut.config.theme2,replaceVariables:(0,Ct.J)().replace.bind((0,Ct.J)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:g}));const d=p?.filter(f=>!!f&&f.length!==0);return t.createElement(t.Fragment,null,d&&d.length===0&&t.createElement(Be.fm,{title:(0,oe.t)("explore.table.title","Table"),width:a,height:200},()=>t.createElement(Mt,{metaItems:[{value:(0,oe.t)("explore.table.no-data","0 series returned")}]})),d&&d.length>0&&d.map((f,m)=>t.createElement(Be.fm,{key:f.refId||`table-${m}`,title:this.getTableTitle(p,f,m),width:a,height:this.getTableHeight(f.length,this.hasSubFrames(f)),loadingState:o?B.Gu.Loading:void 0},(y,v)=>t.createElement($t.i,{ariaLabel:l,data:f,width:y,height:v,onCellFilterAdded:n}))))}}const Wr=Br(kr);var Qr=u(16217),Vr=u(87923),Ur=u(42583),jr=u(53073);function Gr(e){const o=e.dataFrames[0],{dataFrames:n,splitOpenFn:s,exploreId:a,scrollElement:r,topOfViewRef:i,queryResponse:l}=e,c=(0,t.useMemo)(()=>(0,jr.N)(o),[o]),p=(0,w.useSelector)(g=>g.explore.panes[e.exploreId]?.datasourceInstance??void 0);return c?t.createElement(Qr.f,{padding:"none",title:"Trace"},t.createElement(Vr.m,{exploreId:a,dataFrames:n,splitOpenFn:s,scrollElement:r,traceProp:c,queryResponse:l,datasource:p,topOfViewRef:i,topOfViewRefType:Ur.l4.Explore})):null}const Zr=e=>({exploreMain:(0,h.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:e.spacing(1)}),queryContainer:(0,h.css)({label:"queryContainer",padding:e.spacing(1)}),exploreContainer:(0,h.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:e.spacing(2),marginBottom:e.spacing(2)}),left:(0,h.css)({marginBottom:e.spacing(2)}),wrapper:(0,h.css)({position:"absolute",top:0,left:e.spacing(2),right:0,bottom:0,display:"flex"})});var Yr=(e=>(e[e.RichHistory=0]="RichHistory",e[e.QueryInspector=1]="QueryInspector",e))(Yr||{});class qr extends t.PureComponent{constructor(o){super(o),this.topOfViewRef=(0,t.createRef)(),this.memoizedGetNodeGraphDataFrames=(0,Fe.Z)(ro.Ee),this.onChangeTime=n=>{const{updateTimeRange:s,exploreId:a}=this.props;s({exploreId:a,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:s,key:a,operator:r}=n;r===_t.PT&&this.onClickFilterLabel(a,s),r===_t.tE&&this.onClickFilterOutLabel(a,s)},this.onContentOutlineToogle=()=>{this.setState(n=>((0,z.ff)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,s,a)=>{if(!Q.config.featureToggles.toggleLabelsInLogsUI)return!1;const r=this.props.queries.find(l=>l.refId===a);if(!r)return!1;const i=await(0,$e.F)().get(r.datasource);return!!((0,V.Vw)(i)&&i.queryHasFilter(r,{key:n,value:s}))},this.onClickFilterLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:s}},a)},this.onClickFilterOutLabel=(n,s,a)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:s}},a)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:s}=this.props;this.props.addQueryRow(n,s.length)},this.onModifyQueries=(n,s)=>{const a=async(r,i)=>{if(s&&s!==r.refId)return r;const{datasource:l}=r;if(l==null)return r;const c=await(0,$e.F)().get(l);return(0,V.Vw)(c)&&Q.config.featureToggles.toggleLabelsInLogsUI?c.toggleQueryFilter(r,{type:i.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:i.options??{}}):c.modifyQuery?c.modifyQuery(r,i):r};this.props.modifyQueries(this.props.exploreId,n,a)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:s,updateTimeRange:a}=this.props;a({exploreId:s,absoluteRange:n})},this.toggleShowRichHistory=()=>{this.setState(n=>({openDrawer:n.openDrawer===0?void 0:0}))},this.toggleShowQueryInspector=()=>{this.setState(n=>({openDrawer:n.openDrawer===1?void 0:1}))},this.onSplitOpen=n=>async s=>{if(this.props.splitOpen(s),s&&this.props.datasourceInstance){const a=(await(0,$e.F)().get(s.datasourceUid)).type,r=this.props.datasourceInstance.uid===Lt.D?(0,$.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,i={origin:"panel",panelType:n,source:r,target:a,exploreId:this.props.exploreId};(0,z.ff)("grafana_explore_split_view_opened",i)}},this.state={openDrawer:void 0,contentOutlineVisible:!1},this.graphEventBus=o.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=o.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(o){return t.createElement("div",{className:(0,h.cx)(o)},t.createElement(Ma,null))}renderNoData(){return t.createElement(Da,null)}renderCustom(o){const{timeZone:n,queryResponse:s,absoluteRange:a,eventBus:r}=this.props,i=(0,$.groupBy)(s?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(i).map(([l,c],p)=>t.createElement(pe,{title:l,icon:"plug",key:p},t.createElement(xo,{key:p,timeZone:n,pluginId:l,frames:c,state:s.state,absoluteRange:a,height:400,width:o,splitOpenFn:this.onSplitOpen(l),eventBus:r})))}renderGraphPanel(o){const{graphResult:n,absoluteRange:s,timeZone:a,queryResponse:r,showFlameGraph:i}=this.props;return t.createElement(pe,{title:"Graph",icon:"graph-bar"},t.createElement(fs.F,{data:n,height:i?180:400,width:o,absoluteRange:s,timeZone:a,onChangeTime:this.onUpdateTimeRange,annotations:r.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:r.state,eventBus:this.graphEventBus}))}renderTablePanel(o){const{exploreId:n,timeZone:s}=this.props;return t.createElement(pe,{title:"Table",icon:"table"},t.createElement(Wr,{ariaLabel:at.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:s,splitOpenFn:this.onSplitOpen("table")}))}renderRawPrometheus(o){const{exploreId:n,datasourceInstance:s,timeZone:a}=this.props;return t.createElement(pe,{title:"Raw Prometheus",icon:"gf-prometheus"},t.createElement(sr,{showRawPrometheus:!0,ariaLabel:at.wl.pages.Explore.General.table,width:o,exploreId:n,onCellFilterAdded:s?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:a,splitOpenFn:this.onSplitOpen("table")}))}renderLogsPanel(o){const{exploreId:n,syncedTimes:s,theme:a,queryResponse:r}=this.props,i=parseInt(a.spacing(2).slice(0,-2),10),l=(0,h.css)({display:"flex",flexDirection:"column",gap:a.spacing(1)});return t.createElement(pe,{title:"Logs",icon:"gf-logs",className:l},t.createElement(Ia,{exploreId:n,loadingState:r.state,syncedTimes:s,width:o-i,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.onSplitOpen("logs"),scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive}))}renderLogsSamplePanel(){const{logsSample:o,timeZone:n,setSupplementaryQueryEnabled:s,exploreId:a,datasourceInstance:r,queries:i}=this.props;return t.createElement(pe,{title:"Logs Sample",icon:"gf-logs"},t.createElement(Oa,{queryResponse:o.data,timeZone:n,enabled:o.enabled,queries:i,datasourceInstance:r,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:l=>s(a,l,V.v8.LogsSample)}))}renderNodeGraphPanel(){const{exploreId:o,showTrace:n,queryResponse:s,datasourceInstance:a}=this.props,r=a?a?.type:"unknown";return t.createElement(pe,{title:"Node Graph",icon:"code-branch"},t.createElement(Va,{dataFrames:this.memoizedGetNodeGraphDataFrames(s.series),exploreId:o,withTraceView:n,datasourceType:r,splitOpenFn:this.onSplitOpen("nodeGraph")}))}renderFlameGraphPanel(){const{queryResponse:o}=this.props;return t.createElement(pe,{title:"Flame Graph",icon:"fire"},t.createElement(hs,{dataFrames:o.flameGraphFrames}))}renderTraceViewPanel(){const{queryResponse:o,exploreId:n}=this.props,s=o.series.filter(a=>a.meta?.preferredVisualisationType==="trace");return s.length&&t.createElement(pe,{title:"Traces",icon:"file-alt"},t.createElement(Gr,{exploreId:n,dataFrames:s,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement,queryResponse:o,topOfViewRef:this.topOfViewRef}))}render(){const{datasourceInstance:o,exploreId:n,graphResult:s,queryResponse:a,isLive:r,theme:i,showMetrics:l,showTable:c,showRawPrometheus:p,showLogs:g,showTrace:d,showCustom:f,showNodeGraph:m,showFlameGraph:y,timeZone:v,showLogsSample:x,correlationEditorDetails:E,correlationEditorHelperData:b}=this.props,{openDrawer:R,contentOutlineVisible:T}=this.state,C=Zr(i),I=a&&a.state!==B.Gu.NotStarted,W=R===0,Z=!(0,je.X)().queryHistoryAvailable,U=R===1,J=a.state===B.Gu.Done&&[a.logsFrames,a.graphFrames,a.nodeGraphFrames,a.flameGraphFrames,a.tableFrames,a.rawPrometheusFrames,a.traceFrames,a.customFrames].every(O=>O.length===0);let S;const L=E?.editorMode;return!!(L||E?.dirty)&&b!==void 0&&(S=t.createElement(mo,{correlations:b})),t.createElement(io,null,t.createElement(ps,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:T}),t.createElement("div",{style:{position:"relative",height:"100%",paddingLeft:i.spacing(2)}},t.createElement("div",{className:C.wrapper},T&&t.createElement("div",{className:C.left},t.createElement(go,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`})),t.createElement(rt.$,{testId:at.wl.pages.Explore.General.scrollView,scrollRefCallback:O=>this.scrollElement=O||void 0,hideHorizontalTrack:!0},t.createElement("div",{className:C.exploreContainer,ref:this.topOfViewRef},o?t.createElement(t.Fragment,null,t.createElement(pe,{title:"Queries",icon:"arrow"},t.createElement(Ft.l,{className:C.queryContainer},S,t.createElement(Za,{exploreId:n}),t.createElement(Ar,{addQueryRowButtonDisabled:r||L&&o.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:Z,richHistoryButtonActive:W,queryInspectorButtonActive:U,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickRichHistoryButton:this.toggleShowRichHistory,onClickQueryInspectorButton:this.toggleShowQueryInspector}),t.createElement(lr,{exploreId:n}))),t.createElement(ao.Z,{onResize:this.onResize,disableHeight:!0},({width:O})=>O===0?null:t.createElement("main",{className:(0,h.cx)(C.exploreMain),style:{width:O}},t.createElement(te.z4,null,I&&t.createElement(t.Fragment,null,l&&s&&t.createElement(te.z4,null,this.renderGraphPanel(O)),p&&t.createElement(te.z4,null,this.renderRawPrometheus(O)),c&&t.createElement(te.z4,null,this.renderTablePanel(O)),g&&t.createElement(te.z4,null,this.renderLogsPanel(O)),m&&t.createElement(te.z4,null,this.renderNodeGraphPanel()),y&&t.createElement(te.z4,null,this.renderFlameGraphPanel()),d&&t.createElement(te.z4,null,this.renderTraceViewPanel()),x&&t.createElement(te.z4,null,this.renderLogsSamplePanel()),f&&t.createElement(te.z4,null,this.renderCustom(O)),J&&t.createElement(te.z4,null,this.renderNoData())),W&&t.createElement(Hr,{width:O,exploreId:n,onClose:this.toggleShowRichHistory}),U&&t.createElement(Qo,{exploreId:n,width:O,onClose:this.toggleShowQueryInspector,timeZone:v}))))):this.renderEmptyState(C.exploreContainer))))))}}function Kr(e,{exploreId:o}){const n=e.explore,{syncedTimes:s}=n,a=n.panes[o],r=(0,it.Z)(e.user),{datasourceInstance:i,queryKeys:l,queries:c,isLive:p,graphResult:g,tableResult:d,logsResult:f,showLogs:m,showMetrics:y,showTable:v,showTrace:x,showCustom:E,absoluteRange:b,queryResponse:R,showNodeGraph:T,showFlameGraph:C,showRawPrometheus:I,supplementaryQueries:W,correlationEditorHelperData:Z}=a,U=(0,D.$9)(o)(e),J=W[V.v8.LogsSample],S=!!(J.dataProvider!==void 0&&!f&&(g||d));return{datasourceInstance:i,queryKeys:l,queries:c,isLive:p,graphResult:g,logsResult:f??void 0,absoluteRange:b,queryResponse:R,syncedTimes:s,timeZone:r,showLogs:m,showMetrics:y,showTable:v,showTrace:x,showCustom:E,showNodeGraph:T,showRawPrometheus:I,showFlameGraph:C,splitted:(0,K.pd)(e),loading:U,logsSample:J,showLogsSample:S,correlationEditorHelperData:Z,correlationEditorDetails:n.correlationEditorDetails}}const Jr={changeSize:Ee.qN,modifyQueries:D.sK,scanStart:D.EA,scanStopAction:D.P4,setQueries:D.KO,updateTimeRange:ue.cD,addQueryRow:D.CS,splitOpen:A.bW,setSupplementaryQueryEnabled:D.z0},Xr=(0,de.connect)(Kr,Jr),_r=(0,F.HE)(Xr(qr)),ei=e=>({explore:(0,h.css)`
      label: explorePaneContainer;
      display: flex;
      flex-direction: column;
      min-width: 600px;
      height: 100%;
    `});function ti({exploreId:e}){si(e);const o=(0,F.wW)(ei),n=(0,t.useRef)(new zt.F),s=(0,t.useRef)(null);return(0,t.useEffect)(()=>{const a=n.current;return()=>a.removeAllListeners()},[]),t.createElement(rt.$,{hideVerticalTrack:!0},t.createElement("div",{className:o.explore,ref:s,"data-testid":at.wl.pages.Explore.General.container},t.createElement(_r,{exploreId:e,eventBus:n.current})))}function ni(e,o){return{pane:e.explore.panes[o.exploreId]}}const oi=(0,de.connect)(ni)(ti);function si(e){const o=(0,t.useMemo)(()=>(0,K.F9)(e),[e]),n=(0,t.useRef)();n.current=(0,w.useSelector)(o),(0,t.useEffect)(()=>()=>{(0,ce.RZ)(n.current?.querySubscription)},[])}var Gn=u(20015);function ai(e){const o=(0,t.useRef)();o.current=(0,Kt.q)("explore");const n=(0,t.useRef)((0,Se.ak)());(0,t.useEffect)(()=>{!e.panes||typeof e.panes!="string"||Promise.allSettled(Object.values((0,ce.as)(e.panes)).map(s=>!s||typeof s!="object"||!Ie("datasource",s)||!s.datasource||typeof s.datasource!="string"?Promise.reject():n.current.get(s.datasource))).then(s=>s.filter(zn).map(a=>a.value)).then(s=>{if(!o.current)return;const a=s.map(r=>r.name);if(a.length===0){u.g.document.title=`${o.current.main.text} - ${Gn.c.AppTitle}`;return}u.g.document.title=`${o.current.main.text} - ${a.join(" | ")} - ${Gn.c.AppTitle}`})},[e.panes])}function ri(){const{keybindings:e}=(0,Ae.p)(),o=(0,w.useDispatch)();(0,t.useEffect)(()=>{e.setupTimeRangeBindings(!1);const n=[];return n.push((0,_e.N$)().subscribe(tt.QI,()=>{o((0,ue.F9)())})),n.push((0,_e.N$)().subscribe(tt.Qt,s=>{o((0,ue.a1)(s.payload.direction))})),n.push((0,_e.N$)().subscribe(tt.p8,s=>{o((0,ue.vG)(s.payload.scale))})),()=>{n.forEach(s=>s.unsubscribe())}},[o,e])}const ii=e=>{const o=(0,w.useDispatch)(),{width:n}=(0,Vt.Z)(),s=(0,w.useSelector)(K.M),a=(0,w.useSelector)(K.pd),[r,i]=(0,t.useState)(.5),l=(0,w.useSelector)(g=>g.explore),c=g=>{const d=n/2,f=(0,$.inRange)(g,d-100,d+100);o(f?(0,A.Sx)({largerExploreId:void 0}):(0,A.Sx)({largerExploreId:g>d?s[1][0]:s[0][0]})),i(g/n)};let p=0;return a&&(!l.evenSplitPanes&&l.maxedExploreId?p=l.maxedExploreId===s[1][0]?n-e:e:l.evenSplitPanes?p=Math.floor(n/2):r!==void 0&&(p=n*r)),{updateSplitSize:c,widthCalc:p}};function li(){const{location:e}=(0,Ae.p)();(0,t.useEffect)(()=>{const o=e.getSearchObject();(o.from||o.to)&&e.partial({from:void 0,to:void 0},!0)},[e])}const Yt=200;function ci(e){const o=(0,F.wW)(ui),n=(0,F.l4)();li(),Us(e.queryParams),ai(e.queryParams);const{chrome:s}=(0,Ae.p)(),a=(0,Kt.q)("explore"),{updateSplitSize:r,widthCalc:i}=ii(Yt),l=(0,w.useSelector)(K.M),c=(0,w.useSelector)(K.pd),p=(0,w.useSelector)(K.z7),g=Q.config.featureToggles.correlations&&(p?.editorMode||!1);return(0,t.useEffect)(()=>{s.update({sectionNav:a})},[s,a]),ri(),t.createElement("div",{className:(0,h.cx)(o.pageScrollbarWrapper,{[o.correlationsEditorIndicator]:g})},t.createElement(so,null),g&&t.createElement(no,{panes:l}),t.createElement(ot.U,{splitOrientation:"vertical",paneSize:i,minSize:Yt,maxSize:Yt*-1,primary:"second",splitVisible:c,parentStyle:g?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:d=>d&&r(d)},l.map(([d])=>t.createElement(te.z4,{key:d,style:"page"},t.createElement(oi,{exploreId:d})))))}const ui=e=>({pageScrollbarWrapper:(0,h.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative"}),correlationsEditorIndicator:(0,h.css)({borderLeft:`4px solid ${e.colors.primary.main}`,borderRight:`4px solid ${e.colors.primary.main}`,borderBottom:`4px solid ${e.colors.primary.main}`,overflow:"scroll"})})},31954:(qt,Pe,u)=>{u.d(Pe,{q:()=>h});var h=(t=>(t.Data="data",t.Meta="meta",t.Error="error",t.Stats="stats",t.JSON="json",t.Query="query",t.Help="help",t))(h||{})},21891:(qt,Pe,u)=>{u.d(Pe,{Z:()=>Q});var h=u(39953),t=function(F,te){var ot=(0,h.useRef)(function(){});(0,h.useEffect)(function(){ot.current=F}),(0,h.useEffect)(function(){if(te!==null){var Ae=setInterval(function(){return ot.current()},te||0);return function(){return clearInterval(Ae)}}},[te])};const Q=t}}]);

//# sourceMappingURL=explore.d4881ca880c524f4fe80.js.map