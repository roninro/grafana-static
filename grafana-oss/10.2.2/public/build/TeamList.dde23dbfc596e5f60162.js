"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9671],{21090:(N,O,e)=>{e.d(O,{f:()=>A});var D=e(39953),n=e(65489),m=e(21308),f=e(57721),v=e(35430),u=e(4171);const A=({teamId:M,roleOptions:_,disabled:s,roles:l,onApplyRoles:d,pendingRoles:E,apply:C=!1,maxWidth:W,width:L,isLoading:h})=>{const[{loading:P,value:g=l||[]},R]=(0,n.Z)(async()=>{try{if(l)return l;if(C&&E?.length)return E;if(m.Vt.hasPermission(f.AccessControlAction.ActionTeamsRolesList))return await(0,u._C)(M)}catch(p){console.error("Error loading options",p)}return[]},[M,E,l]);(0,D.useEffect)(()=>{R()},[R]);const T=async p=>{C?d&&d(p):(await(0,u.u7)(p,M),await R())},I=m.Vt.hasPermission(f.AccessControlAction.ActionTeamsRolesAdd)&&m.Vt.hasPermission(f.AccessControlAction.ActionTeamsRolesRemove);return D.createElement(v.I,{apply:C,onRolesChange:T,roleOptions:_,appliedRoles:g,isLoading:P||h,disabled:s,basicRoleDisabled:!0,canUpdateRoles:I,maxWidth:W,width:L})}},84381:(N,O,e)=>{e.r(O),e.d(O,{TeamList:()=>I,default:()=>i});var D=e(41407),n=e(39953),m=e(89772),f=e(82803),v=e(99503),u=e(69865),A=e(12190),M=e(51932),_=e(69171),s=e(41245),l=e(4919),d=e(12223),E=e(94696),C=e(39017),W=e(11906),L=e(13253),h=e(4171),P=e(97125),g=e(57721),R=e(21090),T=e(33530);const I=({teams:c,query:S,noTeams:V,hasFetched:U,loadTeams:K,deleteTeam:x,changeQuery:$,totalPages:B,page:X,rolesLoading:j,changePage:Z,changeSort:H})=>{const[F,J]=(0,n.useState)([]),Y=(0,f.wW)(p);(0,n.useEffect)(()=>{K(!0)},[K]),(0,n.useEffect)(()=>{P.contextSrv.licensedAccessControlEnabled()&&P.contextSrv.hasPermission(g.AccessControlAction.ActionRolesList)&&(0,h.ul)().then(r=>J(r))},[]);const Q=P.contextSrv.hasPermission(g.AccessControlAction.ActionTeamsCreate),G=b(),z=(0,n.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&n.createElement(v.q,{src:r,alt:"User avatar"})},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"memberCount",header:"Members",cell:({cell:{value:r}})=>r,sortType:"number"},...G?[{id:"role",header:"Role",cell:({cell:{value:r},row:{original:y}})=>P.contextSrv.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsRolesList,y)&&n.createElement(R.f,{teamId:y.id,roles:y.roles||[],isLoading:j,roleOptions:F,width:40})}]:[],{id:"edit",header:"",cell:({row:{original:r}})=>P.contextSrv.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsRead,r)?n.createElement("a",{href:`org/teams/edit/${r.id}`,"aria-label":`Edit team ${r.name}`},n.createElement(u.u,{content:"Edit team"},n.createElement(A.J,{name:"pen"}))):null},{id:"delete",header:"",cell:({row:{original:r}})=>{const y=P.contextSrv.hasPermissionInMetadata(g.AccessControlAction.ActionTeamsDelete,r);return n.createElement(M.m,{"aria-label":`Delete team ${r.name}`,size:"sm",disabled:!y,onConfirm:()=>x(r.id)})}}],[G,j,F,x]);return n.createElement(L.T,{navId:"teams"},n.createElement(L.T.Contents,{isLoading:!U},V?n.createElement(W.Z,{title:"You haven't created any teams yet.",buttonIcon:"users-alt",buttonLink:"org/teams/new",buttonTitle:" New team",buttonDisabled:!P.contextSrv.hasPermission(g.AccessControlAction.ActionTeamsCreate),proTip:"Assign folder and dashboard permissions to teams instead of users to ease administration.",proTipLink:"",proTipLinkTitle:"",proTipTarget:"_blank"}):n.createElement(n.Fragment,null,n.createElement("div",{className:"page-action-bar"},n.createElement(_._,{grow:!0},n.createElement(s.H,{placeholder:"Search teams",value:S,onChange:$})),n.createElement(l.Qj,{href:Q?"org/teams/new":"#",disabled:!Q},"New Team")),n.createElement(d.wc,{spacing:"md"},n.createElement("div",{className:Y.wrapper},n.createElement(E.e,{columns:z,data:c,getRowId:r=>String(r.id),fetchData:H}),n.createElement(d.Lh,{justify:"flex-end"},n.createElement(C.t,{hideWhenSinglePage:!0,currentPage:X,numberOfPages:B,onNavigate:Z})))))))},p=c=>({wrapper:(0,D.css)({display:"flex",flexDirection:"column",overflowX:"auto",overflowY:"hidden",minHeight:"100vh",width:"100%","& > div":{overflowX:"unset",marginBottom:c.spacing(2)}})});function b(){return P.contextSrv.licensedAccessControlEnabled()&&P.contextSrv.hasPermission(g.AccessControlAction.ActionTeamsRolesList)&&P.contextSrv.hasPermission(g.AccessControlAction.ActionRolesList)}function t(c){return{teams:c.teams.teams,query:c.teams.query,perPage:c.teams.perPage,page:c.teams.page,noTeams:c.teams.noTeams,totalPages:c.teams.totalPages,hasFetched:c.teams.hasFetched,rolesLoading:c.teams.rolesLoading}}const a={loadTeams:T.jI,deleteTeam:T.fC,changePage:T.oO,changeQuery:T.R5,changeSort:T.nt},i=(0,m.connect)(t,a)(I)},33530:(N,O,e)=>{e.d(O,{A_:()=>I,P5:()=>p,QX:()=>d,R5:()=>C,fC:()=>E,fs:()=>R,jI:()=>s,j_:()=>T,nt:()=>L,oO:()=>W});var D=e(86832),n=e.n(D),m=e(4148),f=e(97316),v=e(21308),u=e(26893),A=e(57721),M=e(29560),_=e(98557);function s(t=!1){return async(a,o)=>{const{query:i,page:c,perPage:S,sort:V}=o().teams;if(!v.Vt.hasPermission(A.AccessControlAction.ActionTeamsRead)){a((0,_.PL)({teams:[],totalCount:0,page:1,perPage:S,noTeams:!0}));return}const U=await(0,m.i)().get("/api/teams/search",(0,u.y)({query:i,page:c,perpage:S,sort:V}));let K=!1;if(t&&(K=U.teams.length===0),v.Vt.licensedAccessControlEnabled()){a((0,_.Fy)());const x=U?.teams.map(B=>B.id),$=await(0,m.i)().post("/api/access-control/teams/roles/search",{teamIds:x});U.teams.forEach(B=>{B.roles=$?$[B.id]||[]:[]}),a((0,_.BR)())}a((0,_.PL)({noTeams:K,...U}))}}const l=(0,D.debounce)(t=>t(s()),500);function d(t){return async a=>{const o=await(0,m.i)().get(`/api/teams/${t}`,(0,u.y)());a((0,_.y$)(o)),a((0,f.RL)((0,M.B)(o)))}}function E(t){return async a=>{await(0,m.i)().delete(`/api/teams/${t}`),await v.Vt.fetchUserPermissions(),a(s())}}function C(t){return async a=>{a((0,_.aj)(t)),l(a)}}function W(t){return async a=>{a((0,_.PJ)(t)),a(s())}}function L({sortBy:t}){const a=t.length?`${t[0].id}-${t[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,_.UL)(a)),o(s())}}function h(){return async(t,a)=>{const o=a().team.team,i=await getBackendSrv().get(`/api/teams/${o.id}/members`);t(teamMembersLoaded(i))}}function P(t){return async(a,o)=>{const i=o().team.team;await getBackendSrv().post(`/api/teams/${i.id}/members`,{userId:t}),a(h())}}function g(t){return async(a,o)=>{const i=o().team.team;await getBackendSrv().delete(`/api/teams/${i.id}/members/${t}`),a(h())}}function R(t,a){return async(o,i)=>{const c=i().team.team;await(0,m.i)().put(`/api/teams/${c.id}`,{name:t,email:a}),o(d(c.id))}}function T(){return async(t,a)=>{const o=a().team.team,i=await(0,m.i)().get(`/api/teams/${o.id}/groups`);t((0,_.iI)(i))}}function I(t){return async(a,o)=>{const i=o().team.team;await(0,m.i)().post(`/api/teams/${i.id}/groups`,{groupId:t}),a(T())}}function p(t){return async(a,o)=>{const i=o().team.team;await(0,m.i)().delete(`/api/teams/${i.id}/groups?groupId=${encodeURIComponent(t)}`),a(T())}}function b(t){return async a=>{await getBackendSrv().put(`/api/teams/${t.teamId}/members/${t.userId}`,{permission:t.permission}),a(h())}}},29560:(N,O,e)=>{e.d(O,{B:()=>M,o:()=>_});var D=e(13475),n=e(42367),m=e(50820),f=e(97125),v=e(22001),u=e(57721);const A={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:u.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function M(s){const l={img:s.avatarUrl,id:"team-"+s.id,subTitle:"Manage members and settings",url:"",text:s.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${s.id}`,text:"Settings",url:`org/teams/edit/${s.id}/settings`}]};(s===A||f.contextSrv.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsPermissionsRead,s))&&l.children.unshift({active:!1,icon:"users-alt",id:`team-members-${s.id}`,text:"Members",url:`org/teams/edit/${s.id}/members`});const d={active:!1,icon:"sync",id:`team-groupsync-${s.id}`,text:"External group sync",url:`org/teams/edit/${s.id}/groupsync`},E=s===A;return(0,v.d5)()&&(d.tabSuffix=()=>(0,n.Z)({experimentId:E?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,D.v)("teamsync")?(E||f.contextSrv.hasPermissionInMetadata(u.AccessControlAction.ActionTeamsPermissionsRead,s))&&l.children.push(d):m.default.featureToggles.featureHighlights&&l.children.push({...d,tabSuffix:()=>(0,n.Z)({experimentId:E?"":"feature-highlights-team-sync-badge"})}),l}function _(s){const l=M(A);let d;for(const E of l.children)if(E.id.indexOf(s)>0){E.active=!0,d=E;break}return{main:l,node:d}}}}]);

//# sourceMappingURL=TeamList.dde23dbfc596e5f60162.js.map