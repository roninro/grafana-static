"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[560],{80560:(ne,H,s)=>{s.d(H,{l:()=>Dt});var r=s(39953),v=s(89772),J=s(51201),W=s(33567),Y=s(45580);function D({children:t,width:e,height:i,onLoad:n,onChange:a}){const o=(0,r.useId)(),[l,d]=(0,r.useState)(!1),[c,h]=(0,r.useState)(!1),g=(0,r.useRef)(null);return(0,Y.Z)(()=>{D.addCallback(o,T=>{!l&&T.isIntersecting&&(d(!0),n?.()),h(T.isIntersecting),a?.(T.isIntersecting)});const f=g.current;return f&&D.observer.observe(f),()=>{delete D.callbacks[o],f&&D.observer.unobserve(f),Object.keys(D.callbacks).length===0&&D.observer.disconnect()}}),r.createElement("div",{id:o,ref:g,style:{width:e,height:i}},l&&(typeof t=="function"?t({isInView:c}):t))}const m={};D.callbacks=m,D.addCallback=(t,e)=>D.callbacks[t]=e,D.observer=new IntersectionObserver(t=>{for(const e of t)D.callbacks[e.target.id]&&D.callbacks[e.target.id](e)},{rootMargin:"100px"});var M=s(31544),S=s(10694),b=s(54554),R=s(52275),E=s(4185),P=s(50820),V=s(74602),$=s(75361),X=s(6278),O=s(52807),C=s(79059),p=s(72639),I=s(13601),N=s(32688),y=s(31954),w=s(39617),U=s(2106),A=s(41407),q=s(41560),z=s(82803),G=s(69865),B=s(12190),oe=s(56064),ee=s(13767),Oe=s(58047),ge=s(3839);function xe({panelLinks:t,onShowPanelLinks:e}){const i=(0,z.wW)(Te),n=()=>{const a=e();return r.createElement(ee.v,null,a?.map((o,l)=>r.createElement(ee.v.Item,{key:l,label:o.title,url:o.href,target:o.target,onClick:o.onClick})))};if(t.length===1){const a=e()[0];return r.createElement(E.fm.TitleItem,{href:a.href,onClick:a.onClick,target:a.target,title:a.title},r.createElement(B.J,{name:"external-link-alt",size:"md"}))}else return r.createElement(Oe.L,{overlay:n},r.createElement(ge.h,{icon:"external-link-alt",iconSize:"md","aria-label":"panel links",className:i.menuTrigger}))}const Te=t=>({menuTrigger:(0,A.css)({height:"100%",background:"inherit",border:"none",borderRadius:`${t.shape.radius.default}`,cursor:"context-menu"})});var me=s(53039);const Ne=({notice:t,onClick:e})=>{const i=(0,z.wW)(Ae),n=t.severity==="error"||t.severity==="warning"?"exclamation-triangle":"file-landscape-alt";return t.inspect&&e?r.createElement(ge.h,{className:i.notice,icon:n,iconSize:"md",key:t.severity,tooltip:t.text,onClick:a=>e(a,t.inspect)}):t.link?r.createElement("a",{className:i.notice,"aria-label":t.text,href:t.link,target:"_blank",rel:"noreferrer"},r.createElement(B.J,{name:n,style:{marginRight:"8px"},size:"md"})):r.createElement(G.u,{key:t.severity,content:t.text},r.createElement("span",{className:i.iconTooltip},r.createElement(B.J,{name:n,size:"md"})))},Ae=t=>({notice:(0,A.css)({background:"inherit",border:"none",borderRadius:t.shape.radius.default}),iconTooltip:(0,A.css)({color:`${t.colors.text.secondary}`,backgroundColor:"inherit",cursor:"auto",border:"none",borderRadius:`${t.shape.radius.default}`,padding:`${t.spacing(0,1)}`,height:` ${t.spacing(t.components.height.md)}`,display:"flex",alignItems:"center",justifyContent:"center","&:focus, &:focus-visible":{...(0,me.getFocusStyles)(t),zIndex:1},"&: focus:not(:focus-visible)":(0,me.getMouseFocusStyles)(t),"&:hover ":{boxShadow:`${t.shadows.z1}`,color:`${t.colors.text.primary}`,background:`${t.colors.background.secondary}`}})}),Me=({frames:t,panelId:e})=>{const i=(0,r.useCallback)((a,o)=>{a.stopPropagation(),I.E1.partial({inspect:e,inspectTab:o})},[e]),n={};for(const a of t)if(!(!a.meta||!a.meta.notices))for(const o of a.meta.notices)n[o.severity]=o;return r.createElement(r.Fragment,null,Object.values(n).map(a=>r.createElement(Ne,{notice:a,onClick:i,key:a.severity})))};function Re(t){const{alertState:e,data:i,panelId:n,onShowPanelLinks:a,panelLinks:o,angularNotice:l}=t,d=(0,z.wW)(be),c=r.createElement(G.u,{content:e??"unknown"},r.createElement(E.fm.TitleItem,{className:(0,A.cx)({[d.ok]:e===q.Z.OK,[d.pending]:e===q.Z.Pending,[d.alerting]:e===q.Z.Alerting})},r.createElement(B.J,{name:e==="alerting"?"heart-break":"heart",className:"panel-alert-icon",size:"md"}))),h=r.createElement(r.Fragment,null,i.request&&i.request.timeInfo&&r.createElement(G.u,{content:r.createElement(oe.IF,{timeRange:i.request?.range,timeZone:i.request?.timezone})},r.createElement(E.fm.TitleItem,{className:d.timeshift},r.createElement(B.J,{name:"clock-nine",size:"md"})," ",i.request?.timeInfo))),g=`This ${Le(l)} requires Angular (deprecated).`,f=r.createElement(G.u,{content:g},r.createElement(E.fm.TitleItem,{className:d.angularNotice,"data-testid":"angular-deprecation-icon"},r.createElement(B.J,{name:"exclamation-triangle",size:"md"})));return r.createElement(r.Fragment,null,o&&o.length>0&&a&&r.createElement(xe,{onShowPanelLinks:a,panelLinks:o}),r.createElement(Me,{panelId:n,frames:i.series}),h,e&&c,l?.show&&f)}const Le=t=>t?.isAngularPanel?"panel":t?.isAngularDatasource?"data source":"panel or data source",be=t=>({ok:(0,A.css)({color:t.colors.success.text}),pending:(0,A.css)({color:t.colors.warning.text}),alerting:(0,A.css)({color:t.colors.error.text}),timeshift:(0,A.css)({color:t.colors.text.link,gap:t.spacing(.5),whiteSpace:"nowrap","&:hover":{color:t.colors.emphasize(t.colors.text.link,.03)}}),angularNotice:(0,A.css)({color:t.colors.warning.text})});function fe(t){let e=!1;function i(){return t.data.request&&t.data.request.timeInfo?!1:!t.panel.hasTitle()}const n=()=>{const L=(0,C.J)().replace(t.panel.description,t.panel.scopedVars),u=(0,O.a)(L);return e||((0,p.ff)("dashboards_panelheader_description_displayed"),e=!0),u},a=()=>{const L=(0,w.H)(t.panel);if(!L)return[];const u=L&&L.getLinks(t.panel.replaceVariables);return u.map(Q=>({...Q,onClick:(...Z)=>{(0,p.ff)("dashboards_panelheader_datalink_clicked",{has_multiple_links:u.length>1}),Q.onClick?.(...Z)}}))},o=(L,u)=>{L.stopPropagation(),I.E1.partial({inspect:t.panel.id,inspectTab:u})},l=L=>{L.stopPropagation(),I.E1.partial({inspect:t.panel.id,inspectTab:y.q.Error}),(0,p.ff)("dashboards_panelheader_statusmessage_clicked")},d=()=>{t.panel.getQueryRunner().cancelQuery(),(0,p.ff)("dashboards_panelheader_cancelquery_clicked",{data_state:t.data.state})},c=t.plugin.noPadding?"none":"md",h=t.data.alertState?.state,g=t.panel.datasource?.uid?(0,U.e)(t.panel.datasource?.uid):!1,f=t.panel.isAngularPlugin(),T=(N.config.featureToggles.angularDeprecationUI??!1)&&(g||f),se=(t.panel.links&&t.panel.links.length>0&&a||t.data.series.length>0&&t.data.series.some(L=>(L.meta?.notices?.length??0)>0)||t.data.request&&t.data.request.timeInfo||T||h)&&r.createElement(Re,{alertState:h,data:t.data,panelId:t.panel.id,panelLinks:t.panel.links,angularNotice:{show:T,isAngularDatasource:g,isAngularPanel:f},onShowPanelLinks:a}),k=t.panel.description?n:void 0,te=!(t.isViewing||t.isEditing)&&(t.isDraggable??!0)?"grid-drag-handle":"",F=t.panel.getDisplayTitle();return{hasOverlayHeader:i,onShowPanelDescription:n,onShowPanelLinks:a,onOpenInspector:o,onOpenErrorInspect:l,onCancelQuery:d,padding:c,description:k,dragClass:te,title:F,titleItems:se,onOpenMenu:()=>{(0,p.ff)("dashboards_panelheader_menu",{item:"menu"})}}}var Fe=s(28888);function Ve({items:t}){const e=i=>i.map(n=>{switch(n.type){case"divider":return r.createElement(ee.v.Divider,{key:n.text});case"group":return r.createElement(ee.v.Group,{key:n.text,label:n.text},n.subMenu?e(n.subMenu):void 0);default:return r.createElement(ee.v.Item,{key:n.text,label:n.text,icon:n.iconClassName,childItems:n.subMenu?e(n.subMenu):void 0,url:n.href,onClick:n.onClick,shortcut:n.shortcut,testId:Fe.wl.components.Panels.Panel.menuItems(n.text)})}});return r.createElement(ee.v,null,e(t))}var Ue=s(57721),ke=s(41175),He=s(73),We=s(44076),x=s(62679),Ee=s(97125),we=s(44951),_=s(30093),ze=s(33784),re=s(72137),Ge=s(70451),ve=s(74600),Be=s(60930);function Ke(t,e,i){const n=u=>{u.preventDefault(),I.E1.partial({viewPanel:e.id}),(0,p.ff)("dashboards_panelheader_menu",{item:"view"})},a=u=>{u.preventDefault(),I.E1.partial({editPanel:e.id}),(0,p.ff)("dashboards_panelheader_menu",{item:"edit"})},o=u=>{u.preventDefault(),(0,_.Po)(t,e),(0,p.ff)("dashboards_panelheader_menu",{item:"share"})},l=u=>{u.preventDefault(),(0,_.Kq)(t,e),(0,p.ff)("dashboards_panelheader_menu",{item:"createLibraryPanel"})},d=u=>{u.preventDefault(),(0,_.oe)(e),(0,p.ff)("dashboards_panelheader_menu",{item:"unlinkLibraryPanel"})},c=u=>{I.E1.partial({inspect:e.id,inspectTab:u}),(0,p.ff)("dashboards_panelheader_menu",{item:"inspect",tab:u??y.q.Data})},h=u=>{u.preventDefault()},g=u=>{u.preventDefault(),(0,_.jN)(t,e),(0,p.ff)("dashboards_panelheader_menu",{item:"duplicate"})},f=u=>{u.preventDefault(),(0,_.bY)(e),(0,p.ff)("dashboards_panelheader_menu",{item:"copy"})},T=u=>{u.preventDefault(),(0,_.WJ)(t,e,!0),(0,p.ff)("dashboards_panelheader_menu",{item:"remove"})},K=u=>{u.preventDefault();const Q=u.ctrlKey||u.metaKey?Z=>window.open(`${P.default.appSubUrl}${Z}`):void 0;ve.h.dispatch((0,Be.m$)(e,{timeRange:(0,X.$t)().timeRange(),getExploreUrl:we.H6,openInNewWindow:Q})),(0,p.ff)("dashboards_panelheader_menu",{item:"explore"})},se=u=>{u.preventDefault(),(0,_.qw)(e),(0,p.ff)("dashboards_panelheader_menu",{item:"toggleLegend"})},k=[];e.isEditing||k.push({text:(0,x.t)("panel.header-menu.view","View"),iconClassName:"eye",onClick:n,shortcut:"v"}),t.canEditPanel(e)&&!e.isEditing&&k.push({text:(0,x.t)("panel.header-menu.edit","Edit"),iconClassName:"edit",onClick:a,shortcut:"e"}),k.push({text:(0,x.t)("panel.header-menu.share","Share"),iconClassName:"share-alt",onClick:o,shortcut:"p s"}),Ee.contextSrv.hasAccessToExplore()&&!(e.plugin&&e.plugin.meta.skipDataQuery)&&e.datasource?.uid!==Ge.oe&&k.push({text:(0,x.t)("panel.header-menu.explore","Explore"),iconClassName:"compass",onClick:K,shortcut:"p x"});const te=[];e.plugin&&!e.plugin.meta.skipDataQuery&&(te.push({text:(0,x.t)("panel.header-menu.inspect-data","Data"),onClick:u=>c(y.q.Data)}),t.meta.canEdit&&te.push({text:(0,x.t)("panel.header-menu.query","Query"),onClick:u=>c(y.q.Query)})),te.push({text:(0,x.t)("panel.header-menu.inspect-json","Panel JSON"),onClick:u=>c(y.q.JSON)}),k.push({type:"submenu",text:(0,x.t)("panel.header-menu.inspect","Inspect"),iconClassName:"info-circle",onClick:u=>{const Q=u.currentTarget,Z=u.target;(Z===Q||Z instanceof HTMLElement&&Z.closest('[role="menuitem"]')===Q)&&c()},shortcut:"i",subMenu:te});const F=[],pe=t.canEditPanel(e);if(e.isViewing||e.isEditing||(pe?(F.push({text:(0,x.t)("panel.header-menu.duplicate","Duplicate"),onClick:g,shortcut:"p d"}),F.push({text:(0,x.t)("panel.header-menu.copy","Copy"),onClick:f}),(0,ze.V)(e)?F.push({text:(0,x.t)("panel.header-menu.unlink-library-panel","Unlink library panel"),onClick:d}):F.push({text:(0,x.t)("panel.header-menu.create-library-panel","Create library panel"),onClick:l})):Ee.contextSrv.isEditor&&F.push({text:(0,x.t)("panel.header-menu.copy","Copy"),onClick:f})),i){const u=i.getScope(),Q=u.$$childHead.ctrl,Z=Q.getExtendedMenu();for(const ie of Z){const Se={text:ie.text,href:ie.href,shortcut:ie.shortcut};ie.click&&(Se.onClick=()=>{u.$eval(ie.click,{ctrl:Q})}),F.push(Se)}}e.options.legend&&F.push({text:e.options.legend.showLegend?(0,x.t)("panel.header-menu.hide-legend","Hide legend"):(0,x.t)("panel.header-menu.show-legend","Show legend"),onClick:se,shortcut:"p l"}),e.isEditing&&(F.length=0),pe&&e.plugin&&!e.plugin.meta.skipDataQuery&&F.push({text:(0,x.t)("panel.header-menu.get-help","Get help"),onClick:u=>c(y.q.Help)});const{extensions:L}=(0,We.dj)({extensionPointId:ke.y.DashboardPanelMenu,context:Qe(e,t),limitPerPlugin:3});return L.length>0&&!e.isEditing&&k.push({text:"Extensions",iconClassName:"plug",type:"submenu",subMenu:Je(L)}),F.length&&k.push({type:"submenu",text:(0,x.t)("panel.header-menu.more","More..."),iconClassName:"cube",subMenu:F,onClick:h}),t.canEditPanel(e)&&!e.isEditing&&!e.isViewing&&(k.push({type:"divider",text:""}),k.push({text:(0,x.t)("panel.header-menu.remove","Remove"),iconClassName:"trash-alt",onClick:T,shortcut:"p r"})),k}function Qe(t,e){return{id:t.id,pluginId:t.type,title:t.title,timeRange:e.time,timeZone:(0,He.Z)({timeZone:e.timezone}),dashboard:{uid:e.uid,title:e.title,tags:Array.from(e.tags)},targets:t.targets,scopedVars:t.scopedVars,data:t.getQueryRunner().getLastResult()}}function Je(t){const e={},i=[];for(const a of t){const o=a.category;if(!o){i.push({text:(0,re.ew)(a.title,25),href:a.path,onClick:a.onClick});continue}Array.isArray(e[o])||(e[o]=[]),e[o].push({text:(0,re.ew)(a.title,25),href:a.path,onClick:a.onClick})}const n=Object.keys(e).reduce((a,o)=>(a.push({text:(0,re.ew)(o,25),type:"group",subMenu:e[o]}),a),[]);return i.length>0&&(n.length>0&&n.push({text:"divider",type:"divider"}),Array.prototype.push.apply(n,i)),n}function $e({panel:t,dashboard:e,loadingState:i,children:n}){const[a,o]=(0,r.useState)([]),l=(0,Ue.useSelector)(d=>(0,$.i)(d,t)?.angularComponent);return(0,r.useEffect)(()=>{o(Ke(e,t,l))},[e,t,l,i,o]),n({items:a})}function Ce({style:t,panel:e,dashboard:i,loadingState:n}){return r.createElement($e,{panel:e,dashboard:i,loadingState:n},({items:a})=>r.createElement(Ve,{style:t,items:a}))}class je extends r.PureComponent{constructor(e){super(e),this.element=null,this.timeSrv=(0,X.$t)(),this.subs=new M.w0,this.state={data:{state:S.Gu.NotStarted,series:[],timeRange:(0,b.JK)()}}}componentDidMount(){const{panel:e}=this.props;this.loadAngularPanel();const i=e.getQueryRunner();this.subs.add(i.getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:n=>this.onPanelDataUpdate(n)}))}onPanelDataUpdate(e){let i;if(e.state===S.Gu.Error){const{error:n}=e;n&&i!==n.message&&(i=n.message)}this.setState({data:e,errorMessage:i})}componentWillUnmount(){this.subs.unsubscribe(),this.props.angularComponent&&this.props.angularComponent?.destroy()}componentDidUpdate(e,i){const{plugin:n,height:a,width:o,panel:l}=this.props;e.plugin!==n&&this.loadAngularPanel(),(e.width!==o||e.height!==a)&&this.scopeProps&&(this.scopeProps.size.height=this.getInnerPanelHeight(),this.scopeProps.size.width=this.getInnerPanelWidth(),l.render())}getInnerPanelHeight(){const{plugin:e,height:i}=this.props,{theme:n}=P.default,a=this.hasOverlayHeader()?0:n.panelHeaderHeight,o=e.noPadding?0:n.panelPadding;return i-a-o*2-V.QO}getInnerPanelWidth(){const{plugin:e,width:i}=this.props,{theme:n}=P.default,a=e.noPadding?0:n.panelPadding;return i-a*2-V.QO}loadAngularPanel(){const{panel:e,dashboard:i,setPanelAngularComponent:n}=this.props;if(!this.element)return;const a=(0,R.w)(),o='<plugin-component type="panel" class="panel-height-helper"></plugin-component>';this.scopeProps={panel:e,dashboard:i,size:{width:this.getInnerPanelWidth(),height:this.getInnerPanelHeight()}},n({key:e.key,angularComponent:a.load(this.element,this.scopeProps,o)})}hasOverlayHeader(){const{panel:e}=this.props,{data:i}=this.state;return i.request&&i.request.timeInfo?!1:!e.hasTitle()}render(){const{dashboard:e,panel:i}=this.props,{errorMessage:n,data:a}=this.state,{transparent:o}=i,l=fe({...this.props,data:a}),d=(i.gridPos?.y??0)===0?-16:void 0,c=r.createElement("div",{"data-testid":"panel-dropdown"},r.createElement(Ce,{panel:i,dashboard:e,loadingState:a.state}));return r.createElement(E.fm,{width:this.props.width,height:this.props.height,title:l.title,loadingState:a.state,statusMessage:n,statusMessageOnClick:l.onOpenErrorInspect,description:l.description,titleItems:l.titleItems,menu:this.props.hideMenu?void 0:c,dragClass:l.dragClass,dragClassCancel:"grid-drag-cancel",padding:l.padding,hoverHeaderOffset:d,hoverHeader:l.hasOverlayHeader(),displayMode:o?"transparent":"default",onCancelQuery:l.onCancelQuery,onOpenMenu:l.onOpenMenu},()=>r.createElement("div",{ref:h=>this.element=h,className:"panel-height-helper"}))}}const Ze=(t,e)=>({angularComponent:(0,$.i)(t,e.panel)?.angularComponent}),Ye={setPanelAngularComponent:W.o8},Xe=(0,v.connect)(Ze,Ye)(je);var qe=s(40793),ae=s(96083),le=s(36316),ye=s(92403),_e=s(47635),et=s(53305),tt=s(77014),nt=s(31276),at=s(41393),st=s(2634),it=s(52436),ot=s(12741),rt=s(65355),Pe=s(86981),lt=s(97898);const dt=(t,e,i)=>{const{overrides:n}=i,a=i.overrides.findIndex(h=>h.matcher.id===Pe.mi.byName&&h.matcher.options===t);if(a<0)return{...i,overrides:[...i.overrides,ct(t,e)]};const o=Array.from(n),l=o[a],d=l.properties.findIndex(h=>h.id==="color");if(d<0)return o[a]={...l,properties:[...l.properties,de(e)]},{...i,overrides:o};const c=Array.from(l.properties);return c[d]=de(e),o[a]={...l,properties:c},{...i,overrides:o}},ct=(t,e)=>({matcher:{id:Pe.mi.byName,options:t},properties:[de(e)]}),de=t=>({id:"color",value:{mode:lt.S.Fixed,fixedColor:t}});var ut=s(73431),ce=s(7376),ue=s(32627),ht=s(23331),Ie=s(60862),j=(t=>(t.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT="field config overrides changed",t.NEW_PANEL_OPTION_EVENT="new panel option",t.PANEL_OPTION_CHANGED_EVENT="panel option changed",t.NEW_DEFAULT_FIELD_CONFIG_EVENT="new default field config",t.DEFAULT_FIELD_CONFIG_CHANGED_EVENT="default field config changed",t.NEW_CUSTOM_FIELD_CONFIG_EVENT="new custom field config",t.CUSTOM_FIELD_CONFIG_CHANGED_EVENT="custom field config changed",t.MEASURE_PANEL_LOAD_TIME_EVENT="measure panel load time",t.THRESHOLDS_COUNT_CHANGED_EVENT="thresholds count changed",t.THRESHOLDS_MODE_CHANGED_EVENT="thresholds mode changed",t.MAPPINGS_COUNT_CHANGED_EVENT="mappings count changed",t.LINKS_COUNT_CHANGED_EVENT="links count changed",t.PANEL_ERROR="panel error",t))(j||{});const pt="overrides",gt="custom",mt=t=>{const e=performance.now();return(0,r.useEffect)(()=>{P.config.grafanaJavascriptAgent.enabled&&requestAnimationFrame(()=>{setTimeout(()=>{Ie.s.api.pushMeasurement({type:j.MEASURE_PANEL_LOAD_TIME_EVENT,values:{start_loading_time_ms:e,load_time_ms:performance.now()-e}},{context:{panel_type:t.panelType,panel_id:String(t.panelId),panel_title:t.panelTitle}})},0)})},[]),null};var ft=s(40520),he=s(74482);class Et{constructor(e,i,n){this.logChanges=(a,o)=>{this.logPanelOptionChanges(a,this.initialPanelOptions),this.logFieldConfigChanges(o,this.initialFieldConfig),this.initialPanelOptions=a,this.initialFieldConfig=o},this.logPanelEvent=(a,o,l,d)=>{const c={key:o,newValue:l,oldValue:d??"",panelTitle:this.panelLogInfo.panelTitle,panelId:this.panelLogInfo.panelId,panelType:this.panelLogInfo.panelType};Ie.s.api.pushEvent(a,c)},this.logPanelOptionChanges=(a,o)=>{if(typeof a!="object"||a===null||typeof o!="object"||o===null)return;const l={...o};for(const[d,c]of Object.entries(a)){const h=typeof c!="string"?JSON.stringify(c):c,g=typeof c!="string"?JSON.stringify(l[d]):String(l[d]);l[d]===void 0?this.logPanelEvent(j.NEW_PANEL_OPTION_EVENT,d,h):g!==h&&this.logPanelEvent(j.PANEL_OPTION_CHANGED_EVENT,d,h,g)}},this.logFieldConfigChanges=(a,o)=>{const l=JSON.stringify(o.overrides),d=JSON.stringify(a.overrides);l!==d&&this.logPanelEvent(j.FIELD_CONFIG_OVERRIDES_CHANGED_EVENT,pt,d,l);const c={...o.defaults};for(const[g,f]of Object.entries(a.defaults)){if(g===gt)continue;const T=typeof f!="string"?JSON.stringify(f):f,K=typeof f!="string"?JSON.stringify(c[g]):String(c[g]);c[g]===void 0?this.logPanelEvent(j.NEW_DEFAULT_FIELD_CONFIG_EVENT,g,T):K!==T&&this.logPanelEvent(j.DEFAULT_FIELD_CONFIG_CHANGED_EVENT,g,T,K)}if(!a.defaults.custom||c.custom===void 0)return;const h={...c.custom};for(const[g,f]of Object.entries(a.defaults.custom)){if(c.custom===null||h[g]===null)continue;const T=typeof f!="string"?JSON.stringify(f):f,K=typeof f!="string"?JSON.stringify(h[g]):String(h[g]);h[g]===void 0?this.logPanelEvent(j.NEW_CUSTOM_FIELD_CONFIG_EVENT,g,T):K!==T&&this.logPanelEvent(j.CUSTOM_FIELD_CONFIG_CHANGED_EVENT,g,T,K)}},this.initialPanelOptions=e,this.initialFieldConfig=i,this.panelLogInfo=n}}const vt="Error in plugin";class Ct extends r.PureComponent{constructor(e){super(e),this.timeSrv=(0,X.$t)(),this.subs=new M.w0,this.eventFilter={onlyLocal:!0},this.panelOptionsLogger=void 0,this.getSync=()=>this.props.isEditing?qe.m.Off:this.props.dashboard.graphTooltip,this.onInstanceStateChange=n=>{this.props.onInstanceStateChange(n),this.setState({context:{...this.state.context,instanceState:n}})},this.onUpdateData=n=>(0,rt.F)(this.props.panel,n),this.onSeriesColorChange=(n,a)=>{this.onFieldConfigChange(dt(n,a,this.props.panel.fieldConfig))},this.onSeriesVisibilityChange=(n,a)=>{this.onFieldConfigChange((0,ft.N)(n,a,this.props.panel.fieldConfig,this.state.data.series))},this.onToggleLegendSort=n=>{const a=this.props.panel.options.legend;if(!a)return;let o=a.sortDesc,l=a.sortBy;n!==l&&(o=void 0),o===!1?(l=void 0,o=void 0):(o=!o,l=n),this.onOptionsChange({...this.props.panel.options,legend:{...a,sortBy:l,sortDesc:o}})},this.onRefresh=()=>{const{dashboard:n,panel:a,isInView:o,width:l}=this.props;if(!o){a.refreshWhenInView=!0;return}const d=(0,_.W1)(a,this.timeSrv.timeRange());if(this.wantsQueryExecution){if(l<0)return;a.refreshWhenInView=!1,a.runAllPanelQueries({dashboardUID:n.uid,dashboardTimezone:n.getTimezone(),timeData:d,width:l})}else this.setState({data:{...this.state.data,timeRange:this.timeSrv.timeRange()},renderCounter:this.state.renderCounter+1,liveTime:void 0})},this.onRender=()=>{const n={renderCounter:this.state.renderCounter+1};this.setState(n)},this.onOptionsChange=n=>{this.props.panel.updateOptions(n)},this.onFieldConfigChange=n=>{this.props.panel.updateFieldConfig(n)},this.onPanelError=n=>{P.default.featureToggles.panelMonitoring&&this.getPanelContextApp()===ae.zj.PanelEditor&&this.logPanelChangesOnError();const a=n.message||vt;this.state.errorMessage!==a&&this.setState({errorMessage:a})},this.onPanelErrorRecover=()=>{this.setState({errorMessage:void 0})},this.onAnnotationCreate=async n=>{const a=n.from!==n.to,o={dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:a,time:n.from,timeEnd:a?n.to:0,tags:n.tags,text:n.description};await(0,ce.xD)(o),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new le.n1(o))},this.onAnnotationDelete=async n=>{await(0,ce.Dl)({id:n}),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new le.n1({id:n}))},this.onAnnotationUpdate=async n=>{const a=n.from!==n.to,o={id:n.id,dashboardUID:this.props.dashboard.uid,panelId:this.props.panel.id,isRegion:a,time:n.from,timeEnd:a?n.to:0,tags:n.tags,text:n.description};await(0,ce._E)(o),(0,ue.kt)().run({dashboard:this.props.dashboard,range:this.timeSrv.timeRange()}),this.state.context.eventBus.publish(new le.n1(o))},this.onChangeTimeRange=n=>{this.timeSrv.setTime({from:(0,ye.zh)(n.from),to:(0,ye.zh)(n.to)})},this.onAddAdHocFilter=n=>{const{key:a,value:o,operator:l}=n,d=(0,it.ak)().getInstanceSettings(this.props.panel.datasource),c=d&&(0,_e.iU)(d);c&&(0,ve.WI)((0,ot.m2)({datasource:c,key:a,operator:l,value:o}))};const i=e.dashboard.events.newScopedBus(`panel:${e.panel.id}`,this.eventFilter);if(this.state={isFirstLoad:!0,renderCounter:0,context:{eventsScope:"__global_",eventBus:i,app:this.getPanelContextApp(),sync:this.getSync,onSeriesColorChange:this.onSeriesColorChange,onToggleSeriesVisibility:this.onSeriesVisibilityChange,onAnnotationCreate:this.onAnnotationCreate,onAnnotationUpdate:this.onAnnotationUpdate,onAnnotationDelete:this.onAnnotationDelete,onInstanceStateChange:this.onInstanceStateChange,onToggleLegendSort:this.onToggleLegendSort,canAddAnnotations:e.dashboard.canAddAnnotations.bind(e.dashboard),canEditAnnotations:e.dashboard.canEditAnnotations.bind(e.dashboard),canDeleteAnnotations:e.dashboard.canDeleteAnnotations.bind(e.dashboard),onAddAdHocFilter:this.onAddAdHocFilter,onUpdateData:this.onUpdateData},data:this.getInitialPanelDataState()},P.default.featureToggles.panelMonitoring&&this.getPanelContextApp()===ae.zj.PanelEditor){const n={panelId:String(e.panel.id),panelType:e.panel.type,panelTitle:e.panel.title};this.panelOptionsLogger=new Et(e.panel.getOptions(),e.panel.fieldConfig,n)}}getPanelContextApp(){return this.props.isEditing?ae.zj.PanelEditor:this.props.isViewing?ae.zj.PanelViewer:ae.zj.Dashboard}getInitialPanelDataState(){return{state:S.Gu.NotStarted,series:[],timeRange:(0,b.JK)()}}componentDidMount(){const{panel:e,dashboard:i}=this.props;if(this.subs.add(e.events.subscribe(tt.U5,this.onRefresh)),this.subs.add(e.events.subscribe(ut._z,this.onRender)),i.panelInitialized(this.props.panel),this.hasPanelSnapshot){this.setState({data:(0,ht.y)(e,i),isFirstLoad:!1});return}this.wantsQueryExecution||this.setState({isFirstLoad:!1}),this.subs.add(e.getQueryRunner().getData({withTransforms:!0,withFieldConfig:!0}).subscribe({next:n=>this.onDataUpdate(n)})),he.A.listen(this)}componentWillUnmount(){this.subs.unsubscribe(),he.A.remove(this)}liveTimeChanged(e){const{data:i}=this.state;if(i.timeRange){const n=e.to.valueOf()-i.timeRange.to.valueOf();if(n<100){console.log("Skip tick render",this.props.panel.title,n);return}}this.setState({liveTime:e})}componentDidUpdate(e){const{isInView:i,width:n,panel:a}=this.props,{context:o}=this.state,l=this.getPanelContextApp();o.app!==l&&this.setState({context:{...o,app:l}}),i!==e.isInView&&i&&a.refreshWhenInView&&this.onRefresh(),n!==e.width&&he.A.updateInterval(this)}onDataUpdate(e){const{dashboard:i,panel:n,plugin:a}=this.props;if(a.meta.skipDataQuery){this.setState({data:this.getInitialPanelDataState()});return}let{isFirstLoad:o}=this.state,l;switch(e.state){case S.Gu.Loading:if(this.state.data.state===S.Gu.Loading)return;break;case S.Gu.Error:const{error:d,errors:c}=e;c?.length?c.length===1?l=c[0].message:l="Multiple errors found. Click for more details":d&&l!==d.message&&(l=d.message);break;case S.Gu.Done:i.snapshot&&(n.snapshotData=e.series.map(h=>(0,et.og)(h))),o&&(o=!1);break}this.setState({isFirstLoad:o,errorMessage:l,data:e,liveTime:void 0})}logPanelChangesOnError(){this.panelOptionsLogger.logChanges(this.props.panel.getOptions(),this.props.panel.fieldConfig)}get hasPanelSnapshot(){const{panel:e}=this.props;return e.snapshotData&&e.snapshotData.length}get wantsQueryExecution(){return!(this.props.plugin.meta.skipDataQuery||this.hasPanelSnapshot)}shouldSignalRenderingCompleted(e,i){return e===S.Gu.Done||e===S.Gu.Error||i.skipDataQuery}skipFirstRender(e){const{isFirstLoad:i}=this.state;return this.wantsQueryExecution&&i&&(e===S.Gu.Loading||e===S.Gu.NotStarted)}renderPanelContent(e,i){const{panel:n,plugin:a,dashboard:o}=this.props,{renderCounter:l,data:d}=this.state,{state:c}=d;if(this.skipFirstRender(c))return null;this.shouldSignalRenderingCompleted(c,a.meta)&&st.r.renderingCompleted();const h=a.panel,g=this.state.liveTime??d.timeRange??this.timeSrv.timeRange(),f=n.getOptions();return this.eventFilter.onlyLocal=o.graphTooltip===0,r.createElement(r.Fragment,null,r.createElement(nt._w,{value:this.state.context},r.createElement(h,{id:n.id,data:d,title:n.title,timeRange:g,timeZone:this.props.dashboard.getTimezone(),options:f,fieldConfig:n.fieldConfig,transparent:n.transparent,width:e,height:i,renderCounter:l,replaceVariables:n.replaceVariables,onOptionsChange:this.onOptionsChange,onFieldConfigChange:this.onFieldConfigChange,onChangeTimeRange:this.onChangeTimeRange,eventBus:o.events}),P.default.featureToggles.panelMonitoring&&this.state.errorMessage===void 0&&r.createElement(mt,{panelType:a.meta.id,panelId:n.id,panelTitle:n.title})))}render(){const{dashboard:e,panel:i,width:n,height:a,plugin:o}=this.props,{errorMessage:l,data:d}=this.state,{transparent:c}=i,h=fe({...this.props,data:d}),g=(i.gridPos?.y??0)===0?-16:void 0,f=r.createElement("div",{"data-testid":"panel-dropdown"},r.createElement(Ce,{panel:i,dashboard:e,loadingState:d.state}));return r.createElement(E.fm,{width:n,height:a,title:h.title,loadingState:d.state,statusMessage:l,statusMessageOnClick:h.onOpenErrorInspect,description:h.description,titleItems:h.titleItems,menu:this.props.hideMenu?void 0:f,dragClass:h.dragClass,dragClassCancel:"grid-drag-cancel",padding:h.padding,hoverHeaderOffset:g,hoverHeader:h.hasOverlayHeader(),displayMode:c?"transparent":"default",onCancelQuery:h.onCancelQuery,onOpenMenu:h.onOpenMenu},(T,K)=>r.createElement(r.Fragment,null,r.createElement(at.SV,{dependencies:[d,o,i.getOptions()],onError:this.onPanelError,onRecover:this.onPanelErrorRecover},({error:se})=>se?null:this.renderPanelContent(T,K))))}}const yt=(t,e)=>{const i=t.panels[e.stateKey];return i?{plugin:i.plugin,instanceState:i.instanceState}:{plugin:null}},Pt={initPanelState:J.JI,setPanelInstanceState:W.pC},It=(0,v.connect)(yt,Pt);class De extends r.PureComponent{constructor(){super(...arguments),this.onInstanceStateChange=e=>{this.props.setPanelInstanceState({key:this.props.stateKey,value:e})},this.onVisibilityChange=e=>{this.props.panel.isInView=e},this.onPanelLoad=()=>{this.props.plugin||this.props.initPanelState(this.props.panel)},this.renderPanel=({isInView:e})=>{const{dashboard:i,panel:n,isViewing:a,isEditing:o,width:l,height:d,plugin:c,timezone:h,hideMenu:g,isDraggable:f=!0}=this.props;return c?c&&c.angularPanelCtrl?r.createElement(Xe,{plugin:c,panel:n,dashboard:i,isViewing:a,isEditing:o,isInView:e,isDraggable:f,width:l,height:d}):r.createElement(Ct,{plugin:c,panel:n,dashboard:i,isViewing:a,isEditing:o,isInView:e,isDraggable:f,width:l,height:d,onInstanceStateChange:this.onInstanceStateChange,timezone:h,hideMenu:g}):null}}componentDidMount(){this.props.panel.isInView=!this.props.lazy,this.props.lazy||this.onPanelLoad()}render(){const{width:e,height:i,lazy:n}=this.props;return n?r.createElement(D,{width:e,height:i,onChange:this.onVisibilityChange,onLoad:this.onPanelLoad},this.renderPanel):this.renderPanel({isInView:!0})}}De.defaultProps={lazy:!0};const Dt=It(De)},40520:(ne,H,s)=>{s.d(H,{N:()=>b});var r=s(82909),v=s(66654),J=s(86981),W=s(89591),Y=s(69330),D=s(36085),m=s(52343);const M="hideSeriesFrom",S=(0,r.Y4)(M);function b(O,C,p,I){const{overrides:N}=p,y=O,w=N.findIndex(S);if(w<0){if(C===m.R.ToggleSelection){const B=R([y,...X(N,I)]);return{...p,overrides:[...p.overrides,B]}}const z=$(I,y),G=R(z);return{...p,overrides:[...p.overrides,G]}}const U=Array.from(N),[A]=U.splice(w,1);if(C===m.R.ToggleSelection){let z=P(A);const G=X(U,I);if(G.length>0&&(z=z.filter(oe=>G.indexOf(oe)<0)),z[0]===y&&z.length===1)return{...p,overrides:U};const B=R([y,...G]);return{...p,overrides:[...U,B]}}const q=E(A,y);return V(q,I)?{...p,overrides:U}:{...p,overrides:[...U,q]}}function R(O,C=v.Ys.exclude,p){return p=p??{id:"custom.hideFrom",value:{viz:!0,legend:!1,tooltip:!1}},{__systemRef:M,matcher:{id:J.mi.byNames,options:{mode:C,names:O,prefix:C===v.Ys.exclude?"All except:":void 0,readOnly:!0}},properties:[{...p,value:{viz:!0,legend:!1,tooltip:!1}}]}}const E=(O,C,p=v.Ys.exclude)=>{const I=O.properties.find(w=>w.id==="custom.hideFrom"),N=P(O),y=N.findIndex(w=>w===C);return y<0?N.push(C):N.splice(y,1),R(N,p,I)},P=O=>{const C=O.matcher.options?.names;return Array.isArray(C)?[...C]:[]},V=(O,C)=>P(O).length===$(C).length,$=(O,C)=>{const p=new Set;for(const I of O)for(const N of I.fields){if(N.type!==W.fS.number)continue;const y=(0,Y.CZ)(N,I,O);y!==C&&p.add(y)}return Array.from(p)},X=(O,C)=>{let p=[];for(const I of O){const N=I.properties.find(y=>y.id==="custom.hideFrom");if(N!==void 0&&N.value?.legend===!0){const w=D.Ls.get(I.matcher.id).get(I.matcher.options);for(const U of C)for(const A of U.fields){if(A.type!==W.fS.number)continue;const q=(0,Y.CZ)(A,U,C);w(A,U,C)&&p.push(q)}}}return p}},23331:(ne,H,s)=>{s.d(H,{y:()=>b});var r=s(53305),v=s(54554),J=s(33975),W=s(10694),Y=s(52716),D=s(50820),m=s(68556),M=s(6278),S=s(30093);function b(R,E){const P=(0,r.F9)(R.snapshotData),V=new m.g,$={dashboard:E,range:(0,v.JK)()},X=V.canWork($)?V.getAnnotationsInSnapshot(E,R.id):[],O=[(0,J.P)(X)];return{timeRange:(0,S.W1)(R,(0,M.$t)().timeRange()).timeRange,state:W.Gu.Done,series:(0,Y.SM)({data:P,fieldConfig:{defaults:{},overrides:[]},replaceVariables:R.replaceVariables,fieldConfigRegistry:R.plugin.fieldConfigRegistry,theme:D.config.theme2,timeZone:E.getTimezone()}),structureRev:1,annotations:O}}},31954:(ne,H,s)=>{s.d(H,{q:()=>r});var r=(v=>(v.Data="data",v.Meta="meta",v.Error="error",v.Stats="stats",v.JSON="json",v.Query="query",v.Help="help",v))(r||{})},39617:(ne,H,s)=>{s.d(H,{H:()=>D,n:()=>Y});var r=s(53305),v=s(83502),J=s(86127),W=s(84278);const Y=m=>{const M=m.field.links;if(!(!M||M.length===0))return{getLinks:S=>{const b={};if(m.view){const{dataFrame:E}=m.view;b.__series={value:{name:E.name,refId:E.refId},text:"Series"};const P=m.colIndex!==void 0?E.fields[m.colIndex]:void 0;if(P){if(b.__field={value:{name:P.name,labels:P.labels},text:"Field"},m.rowIndex!==void 0&&m.rowIndex>=0){const{timeField:V}=(0,r.sV)(E);b.__value={value:{raw:P.values[m.rowIndex],numeric:m.display.numeric,text:(0,v.zc)(m.display),time:V?V.values[m.rowIndex]:void 0},text:"Value"}}m.view&&(b.__data={value:{name:E.name,refId:E.refId,fields:(0,J.z)({frame:E,rowIndex:m.rowIndex})},text:"Data"})}else b.__value={value:{raw:m.display.numeric,numeric:m.display.numeric,text:(0,v.zc)(m.display),calc:m.name},text:"Value"}}else console.log("VALUE",m);const R=(E,P,V)=>{const $={...b,...P};return S(E,$,V)};return M.map(E=>(0,W.Bq)().getDataLinkUIModel(E,R,m))}}},D=m=>{const M=m.links;if(!(!M||M.length===0))return{getLinks:()=>M.map(S=>(0,W.Bq)().getDataLinkUIModel(S,m.replaceVariables,m))}}},75361:(ne,H,s)=>{s.d(H,{i:()=>r});function r(v,J){return v.panels[J.key]}}}]);

//# sourceMappingURL=560.b619cf2dc8bcfc6097ae.js.map