"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8039],{27994:(ie,C,t)=>{t.d(C,{q:()=>k});var n=t(41407),r=t(39953),V=t(28888),A=t(82803),h=t(99503),$=t(51064),F=t(4919),P=t(12223),B=t(94696),z=t(39017),H=t(32840),j=t(69865),G=t(12190),J=t(10639),X=t(4171),Y=t(90139),Z=t(50820),f=t(21308),M=t(57721),w=t(65741);const S=`This user's role is not editable because it is synchronized from your auth provider.
  Refer to the Grafana authentication docs for details.`,x=c=>{let l=!f.Vt.hasPermissionInMetadata(M.AccessControlAction.OrgUsersWrite,c);return((Array.isArray(c.authLabels)&&c.authLabels.length>0?c.authLabels[0]:"")!=="grafana.com"||Z.default.featureToggles.gcomOnlyExternalOrgRoleSync)&&(l=c?.isExternallySynced||l),l},_=V.wl.pages.UserListPage.UsersListPage,k=({users:c,orgId:l,onRoleChange:E,onRemoveUser:i,fetchData:u,changePage:q,page:ee,totalPages:te,rolesLoading:b})=>{const[U,L]=(0,r.useState)(null),[Q,R]=(0,r.useState)([]),ne=(0,A.wW)(K);(0,r.useEffect)(()=>{async function a(){try{if(f.Vt.hasPermission(M.AccessControlAction.ActionRolesList)){let d=await(0,X.ul)(l);R(d)}}catch{console.error("Error loading options")}}f.Vt.licensedAccessControlEnabled()&&a()},[l]);const se=(0,r.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:a}})=>a&&r.createElement(h.q,{src:a,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:a}})=>r.createElement("div",null,a),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:a}})=>a,sortType:(a,d)=>new Date(a.original.lastSeenAt).getTime()-new Date(d.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:a},row:{original:d}})=>{const N=x(d);return f.Vt.licensedAccessControlEnabled()?r.createElement(J.R,{userId:d.userId,roles:d.roles||[],isLoading:b,orgId:l,roleOptions:Q,basicRole:a,onBasicRoleChange:T=>E(T,d),basicRoleDisabled:N,basicRoleDisabledMessage:S,width:40}):r.createElement(w.A,{"aria-label":"Role",value:a,disabled:N,onChange:T=>E(T,d)})}},{id:"info",header:"",cell:W},{id:"authLabels",header:"Origin",cell:({cell:{value:a}})=>r.createElement(r.Fragment,null,Array.isArray(a)&&a.length>0&&r.createElement(Y.e,{label:a[0],removeIcon:!1,count:0}))},{id:"isDisabled",header:"",cell:({cell:{value:a}})=>r.createElement(r.Fragment,null,a&&r.createElement($.V,{colorIndex:9,name:"Disabled"}))},{id:"delete",header:"",cell:({row:{original:a}})=>f.Vt.hasPermissionInMetadata(M.AccessControlAction.OrgUsersRemove,a)&&r.createElement(F.zx,{size:"sm",variant:"destructive",onClick:()=>{L(a)},icon:"times","aria-label":`Delete user ${a.name}`})}],[b,l,Q,E]);return r.createElement(P.wc,{spacing:"md","data-testid":_.container},r.createElement("div",{className:ne.wrapper},r.createElement(B.e,{columns:se,data:c,getRowId:a=>String(a.userId),fetchData:u}),r.createElement(P.Lh,{justify:"flex-end"},r.createElement(z.t,{onNavigate:q,currentPage:ee,numberOfPages:te,hideWhenSinglePage:!0}))),!!U&&r.createElement(H.s,{body:`Are you sure you want to delete user ${U?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{L(null)},isOpen:!0,onConfirm:()=>{U&&(i(U),L(null))}}))},W=({row:{original:c}})=>{const l=(0,A.wW)(K);return x(c)&&r.createElement("div",{className:l.row},r.createElement(j.u,{content:S},r.createElement(G.J,{name:"question-circle",className:l.icon})))},K=c=>({row:(0,n.css)({display:"flex",alignItems:"center"}),icon:(0,n.css)({marginLeft:c.spacing(1)}),wrapper:(0,n.css)({display:"flex",flexDirection:"column",overflowX:"auto",overflowY:"hidden",minHeight:"100vh",width:"100%","& > div":{overflowX:"unset",marginBottom:c.spacing(2)}})})},45894:(ie,C,t)=>{t.r(C),t.d(C,{UsersListPageContent:()=>le,UsersListPageUnconnected:()=>oe,default:()=>me});var n=t(39953),r=t(89772),V=t(52807),A=t(13253),h=t(21308),$=t(27994),F=t(36210),P=t(4919),B=t(65531);const z={revokeInvite:B.GY},H=(0,r.connect)(null,z);class j extends n.PureComponent{render(){const{invitee:s,revokeInvite:o}=this.props;return n.createElement("tr",null,n.createElement("td",null,s.email),n.createElement("td",null,s.name),n.createElement("td",{className:"text-right"},n.createElement(F.m,{icon:"copy",variant:"secondary",size:"sm",getText:()=>s.url},"Copy Invite"),"\xA0"),n.createElement("td",null,n.createElement(P.zx,{variant:"destructive",size:"sm",icon:"times",onClick:()=>o(s.code),"aria-label":"Revoke Invite"})))}}const G=H(j);class J extends n.PureComponent{render(){const{invitees:s}=this.props;return n.createElement("table",{className:"filter-table form-inline"},n.createElement("thead",null,n.createElement("tr",null,n.createElement("th",null,"Email"),n.createElement("th",null,"Name"),n.createElement("th",null),n.createElement("th",{style:{width:"34px"}}))),n.createElement("tbody",{"data-testid":"InviteesTable-body"},s.map((o,g)=>n.createElement(G,{key:`${o.id}-${g}`,invitee:o}))))}}var X=t(38874),Y=t(91969);const{selectAll:Z,selectById:f,selectTotal:M}=Y.selectors,w=(e,s)=>s,S=(0,X.P1)([Z,w],(e,s)=>{const o=new RegExp(s,"i");return e.filter(m=>o.test(m.name)||o.test(m.email))});var x=t(69171),_=t(41245),k=t(20454),W=t(50820),K=t(57721),c=t(86832),l=t(4148),E=t(26893),i=t(74311);function u(){return async(e,s)=>{try{e((0,i.tZ)());const{perPage:o,page:g,searchQuery:m,sort:I}=s().users,v=await(0,l.i)().get("/api/org/users/search",(0,E.y)({perpage:o,page:g,query:m,sort:I}));if(h.Vt.licensedAccessControlEnabled()){e((0,i.Fy)());const y=h.Vt.user.orgId,p=v?.orgUsers.map(O=>O.userId),D=await(0,l.i)().post("/api/access-control/users/roles/search",{userIds:p,orgId:y});v.orgUsers.forEach(O=>{O.roles=D?D[O.userId]||[]:[]}),e((0,i.BR)())}e((0,i.eT)(v))}catch{(0,i.k7)()}}}const q=(0,c.debounce)(e=>e(u()),300);function ee(e){return async s=>{await(0,l.i)().patch(`/api/org/users/${e.userId}`,{role:e.role}),s(u())}}function te(e){return async s=>{await(0,l.i)().delete(`/api/org/users/${e}`),s(u())}}function b(e){return async s=>{s((0,i.PJ)(e)),s(u())}}function U({sortBy:e}){const s=e.length?`${e[0].id}-${e[0].desc?"desc":"asc"}`:void 0;return async o=>{o((0,i.UL)(s)),o(u())}}function L(e){return async s=>{s((0,i.w4)(e)),q(s)}}const Q=e=>{const s=new RegExp(e.searchQuery,"i");return e.users.filter(o=>s.test(o.login)||s.test(o.email)||s.test(o.name))},R=e=>e.searchQuery;function ne(e){return{searchQuery:R(e.users),pendingInvitesCount:M(e.invites),externalUserMngLinkName:e.users.externalUserMngLinkName,externalUserMngLinkUrl:e.users.externalUserMngLinkUrl}}const se={changeSearchQuery:L},N=(0,r.connect)(ne,se)(({externalUserMngLinkName:e,externalUserMngLinkUrl:s,searchQuery:o,pendingInvitesCount:g,changeSearchQuery:m,onShowInvites:I,showInvites:v})=>{const y=[{label:"Users",value:"users"},{label:`Pending Invites (${g})`,value:"invites"}],D=h.Vt.hasPermission(K.AccessControlAction.OrgUsersAdd)&&!(W.default.disableLoginForm&&W.default.externalUserMngInfo);return n.createElement("div",{className:"page-action-bar","data-testid":"users-action-bar"},n.createElement(x._,{grow:!0},n.createElement(_.H,{value:o,onChange:m,placeholder:"Search user by login, email or name"})),g>0&&n.createElement("div",{style:{marginLeft:"1rem"}},n.createElement(k.S,{value:v?"invites":"users",options:y,onChange:I})),D&&n.createElement(P.Qj,{href:"org/users/invite"},"Invite"),s&&n.createElement(P.Qj,{href:s,target:"_blank",rel:"noopener"},e))});function T(e){const s=R(e.users);return{users:Q(e.users),searchQuery:R(e.users),page:e.users.page,totalPages:e.users.totalPages,perPage:e.users.perPage,invitees:S(e.invites,s),externalUserMngInfo:e.users.externalUserMngInfo,isLoading:e.users.isLoading,rolesLoading:e.users.rolesLoading}}const de={loadUsers:u,fetchInvitees:B.nW,changePage:b,changeSort:U,updateUser:ee,removeUser:te},ge=(0,r.connect)(T,de),oe=({users:e,page:s,totalPages:o,invitees:g,externalUserMngInfo:m,isLoading:I,rolesLoading:v,loadUsers:y,fetchInvitees:p,changePage:D,updateUser:O,removeUser:ue,changeSort:Ee})=>{const[ae,ve]=(0,n.useState)(!1),ce=m?(0,V.a)(m):"";(0,n.useEffect)(()=>{y(),p()},[p,y]);const he=(re,Ie)=>{O({...Ie,role:re})},Pe=re=>ue(re.userId),fe=()=>{ve(!ae)},Ue=()=>ae?n.createElement(J,{invitees:g}):n.createElement($.q,{users:e,orgId:h.Vt.user.orgId,rolesLoading:v,onRoleChange:he,onRemoveUser:Pe,fetchData:Ee,changePage:D,page:s,totalPages:o});return n.createElement(A.T.Contents,{isLoading:!I},n.createElement(N,{onShowInvites:fe,showInvites:ae}),ce&&n.createElement("div",{className:"grafana-info-box",dangerouslySetInnerHTML:{__html:ce}}),I&&Ue())},le=ge(oe);function me(){return n.createElement(A.T,{navId:"users"},n.createElement(le,null))}}}]);

//# sourceMappingURL=UsersListPage.9951aa456f3bb4074259.js.map