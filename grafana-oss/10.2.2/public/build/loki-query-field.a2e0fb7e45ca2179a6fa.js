"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7142,1598],{39702:($,C)=>{var c;c={value:!0},C.hl=C.x=void 0,C.x={wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g,comments:{lineComment:"#"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"},{open:"<",close:">"}],folding:{}};var w=["sum","avg","min","max","stddev","stdvar","count","topk","bottomk"],O=["json","logfmt","regexp","unpack","pattern"],N=["line_format","label_format"],A=["count_over_time","rate","bytes_over_time","bytes_rate","avg_over_time","sum_over_time","min_over_time","max_over_time","stdvar_over_time","stddev_over_time","quantile_over_time","first_over_time","last_over_time","absent_over_time"],S=["by","without"],G="(".concat(S.reduce(function(H,V){return"".concat(H,"|").concat(V)}),")"),U=["+","-","*","/","%","^","==","!=",">","<",">=","<=","|=","!=","|~","!~","and","or","unless","|"],z=w.concat(O).concat(N).concat(A).concat(S);C.hl={ignoreCase:!1,defaultToken:"",tokenPostfix:".logql",keywords:z,operators:U,vectorMatching:G,symbols:/[=><!~?:&|+\-*\/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,integersuffix:/(ll|LL|u|U|l|L)?(ll|LL|u|U|l|L)?/,floatsuffix:/[fFlL]?/,tokenizer:{root:[[/@vectorMatching\s*(?=\()/,"type","@clauses"],[/[a-z_]\w*(?=\s*(=|!=|=~|!~))/,"tag"],[/(^#.*$)/,"comment"],[/[a-zA-Z_]\w*/,{cases:{"@keywords":"type","@default":"identifier"}}],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/`/,"string","@string_backtick"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/\d+(?:ms|[smhdwy])/,"number"],[/\d*\d+[eE]([\-+]?\d+)?(@floatsuffix)/,"number.float"],[/\d*\.\d+([eE][\-+]?\d+)?(@floatsuffix)/,"number.float"],[/0[xX][0-9a-fA-F']*[0-9a-fA-F](@integersuffix)/,"number.hex"],[/0[0-7']*[0-7](@integersuffix)/,"number.octal"],[/0[bB][0-1']*[0-1](@integersuffix)/,"number.binary"],[/\d[\d']*\d(@integersuffix)/,"number"],[/\d(@integersuffix)/,"number"]],string_double:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\"]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]],string_backtick:[[/\{\{(.*?)\}\}/,{token:"number"}],[/[^\\`]/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/`/,"string","@pop"]],clauses:[[/[^(,)]/,"tag"],[/\)/,"identifier","@pop"]],whitespace:[[/[ \t\r\n]+/,"white"]]}}},29681:($,C,c)=>{c.r(C),c.d(C,{default:()=>lt,defaultWordPattern:()=>rt});var w=c(41407),O=c(86832),N=c(39953),A=c(66533),S=c(34032),G=c(28888),U=c(39702),z=c(82803),H=c(13094);function V(){const e=new Map;return e.set("expandSuggestionDocs",(!0).toString()),{onDidChangeValue:t=>{},onDidChangeTarget:t=>{},onWillSaveState:t=>{},get:(t,n,r)=>e.get(t)??r,getBoolean:(t,n,r)=>{const s=e.get(t);return s!==void 0?s==="true":r},getNumber:(t,n,r)=>{const s=e.get(t);return s!==void 0?parseInt(s,10):r},store:(t,n,r,s)=>{n==null?e.delete(t):e.set(t,n.toString())},remove:(t,n)=>{e.delete(t)},keys:(t,n)=>Array.from(e.keys()),logStorage:()=>{console.log("logStorage: not implemented")},migrate:()=>Promise.resolve(void 0),isNew:t=>!0,flush:t=>Promise.resolve(void 0)}}let ue={storageService:V()};function ce(){return ue}class Y extends Error{constructor(t){super(`Unexpected case in switch statement: ${JSON.stringify(t)}`)}}var j=c(38793),I=c(11569),E=c(29353),L=c(83566),Z=c(88553);const de=[{type:"PATTERN",label:"{}",insertText:"{$0}",isSnippet:!0,triggerOnInsert:!0}],q=Z.$5.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),J=Z.EH.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}({$0}[\\$__auto])`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),ge=Z.md.map(e=>({type:"FUNCTION",label:e.label,insertText:`${e.insertText??""}($0)`,isSnippet:!0,triggerOnInsert:!0,detail:e.detail,documentation:e.documentation})),pe=["$__auto","1m","5m","10m","30m","1h","1d"].map(e=>({type:"DURATION",label:e,insertText:e})),fe=[{type:"FUNCTION",label:"duration_seconds",documentation:"Will convert the label value in seconds from the go duration format (e.g 5m, 24s30ms).",insertText:"duration_seconds()"},{type:"FUNCTION",label:"duration",documentation:"Short version of duration_seconds().",insertText:"duration()"},{type:"FUNCTION",label:"bytes",documentation:"Will convert the label value to raw bytes applying the bytes unit (e.g. 5 MiB, 3k, 1G).",insertText:"bytes()"}],me=[{type:"FUNCTION",label:"--strict",documentation:"Strict parsing. The logfmt parser stops scanning the log line and returns early with an error when it encounters any poorly formatted key/value pair.",insertText:"--strict"},{type:"FUNCTION",label:"--keep-empty",documentation:"Retain standalone keys with empty value. The logfmt parser retains standalone keys (keys without a value) as labels with value set to empty string.",insertText:"--keep-empty"}],he=[{operator:"|=",documentation:(0,E.kf)(L.B5.LineContains),afterPipe:!0},{operator:"!=",documentation:(0,E.kf)(L.B5.LineContainsNot)},{operator:"|~",documentation:(0,E.kf)(L.B5.LineMatchesRegex),afterPipe:!0},{operator:"!~",documentation:(0,E.kf)(L.B5.LineMatchesRegexNot)}];function ye(e){return he.filter(t=>!e||t.afterPipe).map(({operator:t,documentation:n})=>({type:"LINE_FILTER",label:`${t} ""`,insertText:`${e?t.replace("|",""):t} "$0"`,isSnippet:!0,documentation:n}))}function ee(e=""){const t=[];return t.push({type:"PIPE_OPERATION",label:"line_format",insertText:`${e}line_format "{{.$0}}"`,isSnippet:!0,documentation:(0,E.kf)(L.B5.LineFormat)}),t.push({type:"PIPE_OPERATION",label:"label_format",insertText:`${e}label_format`,isSnippet:!0,documentation:(0,E.kf)(L.B5.LabelFormat)}),t.push({type:"PIPE_OPERATION",label:"unwrap",insertText:`${e}unwrap`,documentation:(0,E.kf)(L.B5.Unwrap)}),t.push({type:"PIPE_OPERATION",label:"decolorize",insertText:`${e}decolorize`,documentation:(0,E.kf)(L.B5.Decolorize)}),t.push({type:"PIPE_OPERATION",label:"drop",insertText:`${e}drop`,documentation:(0,E.kf)(L.B5.Drop)}),t.push({type:"PIPE_OPERATION",label:"keep",insertText:`${e}keep`,documentation:(0,E.kf)(L.B5.Keep)}),t}async function Ee(e){return(await e.getHistory()).map(n=>({type:"HISTORY",label:n,insertText:n}))}async function Le(e,t){return(await t.getLabelNames(e)).map(r=>({type:"LABEL_NAME",label:r,insertText:`${r}=`,triggerOnInsert:!0}))}async function be(e,t){const{extractedLabelKeys:n}=await t.getParserAndLabelKeys(e);return n.map(r=>({type:"LABEL_NAME",label:r,insertText:r,triggerOnInsert:!1}))}const Ne=["json","logfmt","pattern","regexp","unpack"];async function te(e,t,n,r,s,l){const a=new Set(Ne),u=[],m=s.some(d=>d==="level");if(t){const d=l?"":" (detected)";r?(a.delete("unpack"),u.push({type:"PARSER",label:`unpack${d}`,insertText:`${e}unpack`,documentation:(0,E.kf)(L.B5.Unpack)})):(a.delete("json"),u.push({type:"PARSER",label:`json${d}`,insertText:`${e}json`,documentation:m?"Use it to get log-levels in the histogram":(0,E.kf)(L.B5.Json)}))}if(n){a.delete("logfmt");const d=l?"":" (detected)";u.push({type:"PARSER",label:`logfmt${d}`,insertText:`${e}logfmt`,documentation:m?"Get detected levels in the histogram":(0,E.kf)(L.B5.Logfmt)})}return Array.from(a).sort().forEach(d=>{u.push({type:"PARSER",label:d,insertText:`${e}${d}`,documentation:(0,E.kf)(d)})}),u}async function Te(e,t,n,r){let s=e;t&&(s=(0,O.trimEnd)(e,"| "));const{extractedLabelKeys:l,hasJSON:a,hasLogfmt:u,hasPack:m}=await r.getParserAndLabelKeys(s),h=(0,I.cQ)(s).queryWithParser,d=`${n?"":" "}${t?"":"| "}`,T=await te(d,a,u,m,l,h),y=ee(d),b=[...T,...y];return h&&l.forEach(i=>{b.push({type:"LABEL_NAME",label:`${i} (detected)`,insertText:`${d}${i}`,documentation:`"${i}" was suggested based on the content of your log lines for the label filter expression.`})}),h?[...b]:[...t&&n?[]:ye(t),...b]}async function ve(e,t,n,r,s,l){let a=[];n&&(e=(0,O.trimEnd)(e,", "));const{extractedLabelKeys:u,hasJSON:m,hasLogfmt:h,hasPack:d}=await l.getParserAndLabelKeys(e),T=ee("| ");if(!n&&!t&&(a=[...me]),!n&&r){const i=s.length>0?await te("| ",m,h,d,u,!0):[];a=[...a,...i,...T]}const y=u.filter(i=>!s.includes(i));let b="";s.length>0&&r&&(b=n?"":", ");const R=y.map(i=>({type:"LABEL_NAME",label:i,insertText:b+i,triggerOnInsert:!1}));return a=[...a,...R],a}async function Ce(e,t,n,r){return(await r.getLabelValues(e,n)).map(l=>({type:"LABEL_VALUE",label:l,insertText:t?(0,j.U9)(l):`"${(0,j.U9)(l)}"`}))}async function Ae(e,t){const{unwrapLabelKeys:n}=await t.getParserAndLabelKeys(e);return[...n.map(s=>({type:"LABEL_NAME",label:s,insertText:s,triggerOnInsert:!1})),...fe]}async function Pe(e,t){const{extractedLabelKeys:n}=await t.getParserAndLabelKeys(e);return[...n.map(s=>({type:"LABEL_NAME",label:s,insertText:s,triggerOnInsert:!1}))]}async function Oe(e,t){switch(e.type){case"EMPTY":case"AT_ROOT":return[...await Ee(t),...de,...q,...ge,...J];case"IN_RANGE":return pe;case"IN_GROUPING":return be(e.logQuery,t);case"IN_LABEL_SELECTOR_NO_LABEL_NAME":return Le(e.otherLabels,t);case"IN_LABEL_SELECTOR_WITH_LABEL_NAME":return Ce(e.labelName,e.betweenQuotes,e.otherLabels,t);case"AFTER_SELECTOR":return Te(e.logQuery,e.afterPipe,e.hasSpace,t);case"AFTER_UNWRAP":return Ae(e.logQuery,t);case"IN_AGGREGATION":return[...J,...q];case"AFTER_KEEP_AND_DROP":return Pe(e.logQuery,t);case"IN_LOGFMT":return ve(e.logQuery,e.flags,e.trailingComma,e.trailingSpace,e.otherLabels,t);default:throw new Y(e)}}var o=c(71258);function Ie(e,t){return e[t]}function Re(e,t){let r=g(e,t);for(;r;){let s=g(r,t);if(s)r=s;else return r}return null}function g(e,t){let n=e;for(const[r,s]of t)if(n=Ie(n,r),n===null||n.type.id!==s)return null;return n}function B(e,t){return t.slice(e.from,e.to)}function Se(e){const t=e.slice(1,e.length-1);if(e.startsWith('"')&&e.endsWith('"'))return t.replace(/\\"/gm,'"');if(e.startsWith("'")&&e.endsWith("'"))return t.replace(/\\'/gm,"'");if(e.startsWith("`")&&e.endsWith("`"))return t;throw new Error(`Invalid string literal: ${e}`)}function _e(e,t){return e.every((n,r)=>n===t[r])}const f=0,xe=[{paths:[[o.Qf],[o.Qf,o.gP],[o.gP],[f,o.gP,o.Qf]],fun:Ge},{paths:[[o.WZ],[o.Tr],[f,o.UN,o.Tr],[f,o.nt],[o.UN],[f,o.nt],[o.nt],[o.m7]],fun:Be},{paths:[[o.WZ],[f,o.Qf]],fun:Ke},{paths:[[o.Ld,o.xO]],fun:re},{paths:[[o.Kz]],fun:Ue},{paths:[[o.UN]],fun:De},{paths:[[f,o.xO],[f,o.gP,o.Qf]],fun:re},{paths:[[f,o.e6]],fun:We},{paths:[[f,o.UN]],fun:Qe},{paths:[[f,o.dh,o.cq,o.M0]],fun:()=>({type:"IN_AGGREGATION"})},{paths:[[f,o.We,o.iP],[o.We,o.iP]],fun:$e},{paths:[[f,o.Xt],[o.Xt]],fun:Fe},{paths:[[f,o.yB],[f,o.Ph],[f,o.ge],[f,o.Di]],fun:ze}],we=new Map([["Eq","="],["Re","=~"],["Neq","!="],["Nre","!~"]]);function Me(e){return we.get(e.name)??null}function ke(e,t){if(e.type.id!==o.xO)return null;const n=g(e,[["firstChild",o.xb]]);if(n===null)return null;const r=n.nextSibling;if(r===null)return null;const s=Me(r);if(s===null)return null;const l=g(e,[["lastChild",o.Ld]]);if(l===null)return null;const a=B(n,t),u=Se(B(l,t));return{name:a,value:u,op:s}}function ne(e,t){if(e.type.id!==o.Qf&&e.type.id!==o.gP)return[];let n=null;e?.parent?.type.id===o.Qf?n=e:n=Re(e,[["parent",o.gP]])??g(e,[["firstChild",o.gP]])??g(e,[["lastChild",o.gP]]);const r=[];for(;n!==null;){const s=g(n,[["lastChild",o.xO]]);if(s!==null){const l=ke(s,t);l!==null&&r.push(l)}n=g(n,[["firstChild",o.gP]])}return r.reverse(),r}function Fe(e,t,n){return{type:"AFTER_UNWRAP",logQuery:(0,I.Eb)(t,n).trim()}}function $e(e,t,n){let r=null;return e.type.id===f?r=g(e,[["parent",o.We],["parent",o.iP]]):e.type.id===o.We&&(r=g(e,[["parent",o.iP]])),r?.parent?.type.id===o.bL||r?.parent?.type.id===o.UN?K(r.parent,t,n,!0):null}function Ue(e,t,n){const r=g(e,[["parent",o.M0]]);if(r===null)return null;const s=r.getChild("MetricExpr");return s===null||g(s,[["firstChild",o.Tr],["lastChild",o.UN],["firstChild",o.Qf]])===null?null:{type:"IN_GROUPING",logQuery:(0,I.Eb)(t,n).trim()}}function re(e,t,n){const r=!e.type.isError,s=g(e,[["parent",o.xO]]);if(s===null)return null;const l=g(s,[["firstChild",o.xb]]);if(l===null)return null;const a=B(l,t),u=g(s,[["parent",o.gP]]);if(u===null)return null;let m=u,h=null;for(;h===null;){const y=m.parent;if(y===null)return null;switch(y.type.id){case o.gP:m=y;continue;case o.Qf:h=y;continue;default:return null}}const T=ne(h,t).filter(y=>y.name!==a);return{type:"IN_LABEL_SELECTOR_WITH_LABEL_NAME",labelName:a,betweenQuotes:r,otherLabels:T}}function Be(e,t,n){const r=o.E2.parse(t),s=t.substring(0,n).trimEnd().length,l=s<n?s:n,a=r.cursorAt(l),u=[o.af,o.$Q,o.lc,o.nt];let m=!1;do{const{node:i}=a;if(u.includes(i.type.id)&&a.from<=l&&a.to>=l){m=!0;break}}while(a.next());if(!m)return null;const h=(0,I.Yk)(t,[o.$Q]).length>1,T=(0,I.Yk)(t,[o.lc]).map(i=>i.getChild(o.xb)).filter(i=>i!==null).map(i=>B(i,t)),y=(0,I.Eb)(t,l).trim(),b=t.charAt(n-1)===" ",R=t.trimEnd().charAt(l-1)===",";return{type:"IN_LOGFMT",otherLabels:T,flags:h,trailingSpace:b,trailingComma:R,logQuery:y}}function Ke(e,t,n){const r=g(e,[["lastChild",o.wi],["lastChild",o.bL]]);return r!=null&&t.endsWith(" ")?K(r,t,n,!1):g(e,[["firstChild",f],["firstChild",o.xb]])!=null?{type:"AT_ROOT"}:null}function We(e,t,n){return{type:"IN_RANGE"}}function De(e,t,n){const s=t.substring(0,n).trimEnd().endsWith("|");return K(e,t,n,s)}function Qe(e,t,n){const r=g(e,[["parent",o.UN]]);if(r===null)return null;const l=t.substring(0,n).trimEnd().endsWith("|");return K(r,t,n,l)}function K(e,t,n,r){const s=g(e,[["firstChild",o.Qf]]);return!s||s.to>n?null:{type:"AFTER_SELECTOR",afterPipe:r,hasSpace:t.charAt(n-1)===" ",logQuery:(0,I.Eb)(t,n).trim()}}function Ge(e,t,n){const r=g(e,[["firstChild",o.gP]]);if(r!==null&&!t.slice(r.from,n).trim().endsWith(","))return null;const s=e.type.id===f?g(e,[["parent",o.gP],["parent",o.Qf]]):e;return s?{type:"IN_LABEL_SELECTOR_NO_LABEL_NAME",otherLabels:ne(s,t)}:null}function ze(e,t,n){let r=(0,I.Eb)(t,n).trim(),s=null,l=e.parent;for(;l!==null;){if(l.type.id===o.We){s=l;break}l=l.parent}return s?.type.id===o.We&&(r=r.slice(0,s.from)),{type:"AFTER_KEEP_AND_DROP",logQuery:r}}function He(e,t){const n=e.trimEnd().length,r=n<t?n:t,s=o.E2.parse(e),l=s.cursorAt(r);do if(l.from===r&&l.to===r&&l.node.type.isError)return l;while(l.next());return s.cursorAt(r)}function Ve(e,t){if(e==="")return{type:"EMPTY"};const n=He(e,t),r=n.node,s=[n.type.id];for(;n.parent();)s.push(n.type.id);for(let l of xe)for(let a of l.paths)if(_e(a,s)){const u=l.fun(r,e,t);if(u)return u}return null}const Ze=4;function Xe(){return{showWords:!1}}function Ye(e,t){switch(e){case"DURATION":return t.languages.CompletionItemKind.Unit;case"FUNCTION":return t.languages.CompletionItemKind.Variable;case"HISTORY":return t.languages.CompletionItemKind.Snippet;case"LABEL_NAME":return t.languages.CompletionItemKind.Enum;case"LABEL_VALUE":return t.languages.CompletionItemKind.EnumMember;case"PATTERN":return t.languages.CompletionItemKind.Constructor;case"PARSER":return t.languages.CompletionItemKind.Class;case"LINE_FILTER":return t.languages.CompletionItemKind.TypeParameter;case"PIPE_OPERATION":return t.languages.CompletionItemKind.Interface;default:throw new Y(e)}}function je(e,t){return{triggerCharacters:["{",",","[","(","=","~"," ",'"',"|"],provideCompletionItems:(r,s)=>{const l=r.getWordAtPosition(s),a=r.getWordUntilPosition(s),u={column:s.column,lineNumber:s.lineNumber},m=r.getOffsetAt(u),h=Ve(r.getValue(),m),d=qe(h,l,a,e,s);return(h!=null?Oe(h,t):Promise.resolve([])).then(y=>{const b=y.length.toString().length;return{suggestions:y.map((i,W)=>({kind:Ye(i.type,e),label:i.label,insertText:i.insertText,insertTextRules:i.isSnippet?Ze:void 0,detail:i.detail,documentation:i.documentation,sortText:W.toString().padStart(b,"0"),range:d,command:i.triggerOnInsert?{id:"editor.action.triggerSuggest",title:""}:void 0}))}})}}}const qe=(e,t,n,r,s)=>{if(e&&e?.type==="IN_LABEL_SELECTOR_WITH_LABEL_NAME"&&"betweenQuotes"in e&&e.betweenQuotes){const l=n?.word?.indexOf('"')??0,a=t?.word?.lastIndexOf('"')??0,u=t?.word.indexOf("="),m=t?.word.lastIndexOf("=");if(m===u&&l!==-1&&a!==-1&&m!==-1)return t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:n.startColumn+l+1,endColumn:n.startColumn+a}):r.Range.fromPositions(s)}return e&&e.type==="IN_LABEL_SELECTOR_WITH_LABEL_NAME"?t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:n.endColumn,endColumn:n.endColumn}):r.Range.fromPositions(s):t!=null?r.Range.lift({startLineNumber:s.lineNumber,endLineNumber:s.lineNumber,startColumn:t.startColumn,endColumn:t.endColumn}):r.Range.fromPositions(s)};var Je=c(63163);class et{constructor(t,n={current:[]}){this.languageProvider=t,this.historyRef=n,this.queryToLabelKeysCache=new Map}buildSelector(t){return`{${t.map(r=>`${r.name}${r.op}"${(0,Je.U9)(r.value)}"`).join(",")}}`}getHistory(){return(0,O.chain)(this.historyRef.current).map(t=>t.query.expr).filter().uniq().value()}async getLabelNames(t=[]){if(t.length===0)return this.languageProvider.getLabelKeys();const n=await this.getSeriesLabels(t),r=Object.keys(n),s=new Set(t.map(l=>l.name));return r.filter(l=>!s.has(l))}async getLabelValues(t,n){return n.length===0?await this.languageProvider.getLabelValues(t):(await this.getSeriesLabels(n))[t]??[]}async getParserAndLabelKeys(t){const r=this.queryToLabelKeysCache.has(t)?this.queryToLabelKeysCache.get(t):null;if(r)return r;{if(this.queryToLabelKeysCache.size>=2){const a=this.queryToLabelKeysCache.keys().next().value;this.queryToLabelKeysCache.delete(a)}const s=await this.languageProvider.getParserAndLabelKeys(t);return this.queryToLabelKeysCache.set(t,s),s}}async getSeriesLabels(t){return await this.languageProvider.getSeriesLabels(this.buildSelector(t)).then(n=>n??{})}}var se=c(16699);const tt={codeLens:!1,contextmenu:!1,fixedOverflowWidgets:!0,folding:!1,fontSize:14,lineDecorationsWidth:8,lineNumbers:"off",minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:4,bottom:5},renderLineHighlight:"none",scrollbar:{vertical:"hidden",verticalScrollbarSize:8,horizontal:"hidden",horizontalScrollbarSize:0},scrollBeyondLastLine:!1,suggest:Xe(),suggestFontSize:12,wordWrap:"on"},nt=2,M="logql";let oe=!1;const rt=/(-?\d*\.\d\w*)|([^`~!#%^&*()\-=+\[{\]}\\|;:'",.<>\/?\s]+)/g;function st(e){oe===!1&&(oe=!0,e.languages.register({id:M}),e.languages.setMonarchTokensProvider(M,U.hl),e.languages.setLanguageConfiguration(M,{...U.x,wordPattern:/(-?\d*\.\d\w*)|([^`~!#%^&*()+\[{\]}\\|;:',.<>\/?\s]+)/g}))}const ot=(e,t)=>({container:(0,w.css)`
      border-radius: ${e.shape.radius.default};
      border: 1px solid ${e.components.input.borderColor};
      width: 100%;
      .monaco-editor .suggest-widget {
        min-width: 50%;
      }
    `,placeholder:(0,w.css)`
      ::after {
        content: '${t}';
        font-family: ${e.typography.fontFamilyMonospace};
        opacity: 0.3;
      }
    `}),lt=({history:e,onBlur:t,onRunQuery:n,initialValue:r,datasource:s,placeholder:l,onChange:a})=>{const u=(0,S.Z)(),m=(0,N.useRef)(ce()),h=(0,N.useRef)(null),d=(0,A.Z)(s.languageProvider),T=(0,A.Z)(e),y=(0,A.Z)(n),b=(0,A.Z)(t),R=(0,N.useRef)(null),i=(0,z.l4)(),W=ot(i,l);(0,N.useEffect)(()=>()=>{R.current?.()},[]);const at=(p,v)=>{const D=[{range:new p.Range(1,1,1,1),options:{className:W.placeholder,isWholeLine:!0}}];let Q=[];const k=()=>{const F=v.getModel();if(!F)return;const X=F.getValueLength()===0?D:[];Q=F.deltaDecorations(Q,X)};k(),v.onDidChangeModelContent(k)},it=(0,O.debounce)(async p=>{a(p)},1e3);return N.createElement("div",{"aria-label":G.wl.components.QueryField.container,className:W.container,ref:h},N.createElement(H.o,{overrideServices:m.current,options:tt,language:M,value:r,beforeMount:p=>{st(p)},onMount:(p,v)=>{const D=p.createContextKey("isEditorFocused"+u,!1);p.onDidBlurEditorWidget(()=>{D.set(!1),b.current(p.getValue())}),p.onDidChangeModelContent(_=>{const P=p.getModel();if(!P)return;const x=P.getValue(),ut=((0,se.O)(x,s.interpolateString(x,se.t),P.getLinesContent())||[]).map(({error:ie,...ct})=>({message:`${ie?`Error parsing "${ie}"`:"Parse error"}. The query appears to be incorrect and could fail to be executed.`,severity:v.MarkerSeverity.Error,...ct}));it(x),v.editor.setModelMarkers(P,"owner",ut)});const Q=new et(d.current,T),k=je(v,Q),F={...k,provideCompletionItems:(_,P,x,ae)=>p.getModel()?.id!==_.id?{suggestions:[]}:k.provideCompletionItems(_,P,x,ae)},{dispose:X}=v.languages.registerCompletionItemProvider(M,F);R.current=X;const le=()=>{const _=h.current;if(_!==null){const P=p.getContentHeight();_.style.height=`${P+nt}px`;const x=_.clientWidth;p.layout({width:x,height:P})}};p.onDidContentSizeChange(le),le(),p.addCommand(v.KeyMod.Shift|v.KeyCode.Enter,()=>{y.current(p.getValue())},"isEditorFocused"+u),p.onDidFocusEditorText(()=>{D.set(!0),p.getValue().trim()===""&&p.trigger("","editor.action.triggerSuggest",{})}),at(v,p)}}))}},66533:($,C,c)=>{c.d(C,{Z:()=>N});var w=c(39953),O=function(A){var S=(0,w.useRef)(A);return S.current=A,S};const N=O},93716:$=>{$.exports={id:"loki"}}}]);

//# sourceMappingURL=loki-query-field.a2e0fb7e45ca2179a6fa.js.map